<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: #f5f5f5;
      padding: 20px;
      margin: 0;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    #products {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .product {
      background: #2c2c2c;
      border-radius: 12px;
      padding: 16px;
      width: calc(33.333% - 20px);
      box-sizing: border-box;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      transition: transform .2s;
    }

    .product:hover {
      transform: scale(1.03);
    }

    .product img {
      width: 100%;
      border-radius: 8px;
      height: 220px;
      object-fit: cover;
    }

    .product h3 {
      margin: 10px 0 5px;
      font-size: 17px;
    }

    .product p {
      margin: 4px 0;
      font-weight: bold;
      color: #00e676;
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      inset: 0;
      background-color: rgba(0,0,0,0.7);
    }

    .modal-content {
      background: #2c2c2c;
      padding: 30px;
      border-radius: 20px;
      width: 420px;
      margin: 12% auto;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
    }

    .modal-content h3 {
      margin-top: 0;
    }

    .modal-content button {
      margin-top: 15px;
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      background: linear-gradient(45deg, #00c853, #64dd17);
      color: #fff;
      width: 100%;
    }

    /* CART */
    #cart {
      margin-top: 30px;
      background: #292929;
      padding: 25px;
      border-radius: 16px;
      border: 1px solid #444;
      display: none;
    }

    #cart h3 {
      text-align: center;
      margin-top: 0;
    }

    .cart-item {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #444;
      font-size: 14px;
    }

    .remove-btn {
      background: none;
      border: none;
      color: red;
      font-size: 18px;
      cursor: pointer;
    }

    .summary {
      margin-top: 15px;
      line-height: 1.8;
      font-size: 15px;
    }

    #cart button {
      margin-top: 12px;
      padding: 12px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      background: linear-gradient(45deg, #2196f3, #64b5f6);
      color: #fff;
    }

    #branch {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #555;
      background: #333;
      color: #fff;
      margin-top: 25px;
      font-size: 16px;
    }

    @media (max-width: 900px) {
      .product {
        width: calc(50% - 10px);
      }
    }

    @media (max-width: 500px) {
      .product {
        width: 100%;
      }
    }
  </style>
</head>

<body>

<h2>ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h2>
<div id="products"></div>

<input id="branch" placeholder="ğŸª Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹">

<div id="cart">
  <h3>ğŸ§¾ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
  <div id="cart-items"></div>
  <div id="cart-summary" class="summary"></div>
  <button onclick="downloadPDF()">ğŸ“„ ØªØ­Ù…ÙŠÙ„ / Ø·Ø¨Ø§Ø¹Ø© PDF</button>
</div>

<div id="productModal" class="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div id="modalContent"></div>
  </div>
</div>

<script>
let cart = [];
let selectedProduct = null;

/* ğŸ”— Ø±Ø§Ø¨Ø· Google Sheets JSON */
const SHEET_URL =
"https://docs.google.com/spreadsheets/d/1g3_D2NBwT27O2OI-v1R5tAB2QCfF3_ZCUL9sSLoCv54/gviz/tq?tqx=out:json";

/* Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
fetch(SHEET_URL)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(text.substring(47).slice(0, -2));
    const rows = json.table.rows;

    const products = rows.map(r => ({
      code: r.c[0]?.v || "",
      name: r.c[1]?.v || "",
      price: Number(r.c[2]?.v || 0),
      image: r.c[3]?.v || ""
    }));

    renderProducts(products);
  })
  .catch(() => alert("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"));

function renderProducts(products) {
  const container = document.getElementById("products");
  container.innerHTML = "";
  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "product";
    div.onclick = () => openModal(p);
    div.innerHTML = `
      <img src="${p.image}">
      <h3>${p.name}</h3>
      <p>â‚ª${p.price}</p>
    `;
    container.appendChild(div);
  });
}

function openModal(product) {
  selectedProduct = product;
  document.getElementById("modalContent").innerHTML = `
    <h3>${product.name}</h3>
    <p>â‚ª${product.price}</p>
    <input type="number" id="qty" value="1" min="1" style="width:100%;padding:10px;border-radius:8px;border:none;margin-top:10px">
    <button onclick="addToCart()">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
  `;
  document.getElementById("productModal").style.display = "block";
}

function closeModal() {
  document.getElementById("productModal").style.display = "none";
}

function addToCart() {
  const qty = Number(document.getElementById("qty").value);
  const found = cart.find(i => i.code === selectedProduct.code);

  if (found) found.quantity += qty;
  else cart.push({...selectedProduct, quantity: qty});

  updateCart();
  closeModal();
}

function updateCart() {
  const box = document.getElementById("cart");
  const items = document.getElementById("cart-items");
  const sum = document.getElementById("cart-summary");
  items.innerHTML = "";
  let total = 0;

  cart.forEach(i => {
    const t = i.price * i.quantity;
    total += t;
    items.innerHTML += `
      <div class="cart-item">
        <span>${i.name} | ${i.quantity} Ã— â‚ª${i.price}</span>
        <button class="remove-btn" onclick="removeItem('${i.code}')">âœ–</button>
      </div>
    `;
  });

  const tax = total * 0.18;

  sum.innerHTML = `
    <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: â‚ª${total.toFixed(2)}</p>
    <p>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© 18Ùª: â‚ª${tax.toFixed(2)}</p>
    <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: â‚ª${(total + tax).toFixed(2)}</strong></p>
  `;

  box.style.display = "block";
}

function removeItem(code) {
  cart = cart.filter(i => i.code !== code);
  updateCart();
}

function downloadPDF() {
  if (!cart.length) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
  const branch = document.getElementById("branch").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";

  let html = `
  <html><head><style>
  body{font-family:Arial;direction:rtl;padding:40px}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid #ccc;padding:10px;text-align:center}
  th{background:#eee}
  </style></head><body>
  <h2>ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
  <p><strong>Ø§Ù„ÙØ±Ø¹:</strong> ${branch}</p>
  <table>
  <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>
  `;

  let total = 0;
  cart.forEach(i => {
    const t = i.price * i.quantity;
    total += t;
    html += `<tr>
      <td>${i.name}</td>
      <td>${i.quantity}</td>
      <td>â‚ª${i.price}</td>
      <td>â‚ª${t.toFixed(2)}</td>
    </tr>`;
  });

  const tax = total * 0.18;

  html += `
  </table>
  <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: â‚ª${total.toFixed(2)}</p>
  <p>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: â‚ª${tax.toFixed(2)}</p>
  <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: â‚ª${(total + tax).toFixed(2)}</h3>
  </body></html>
  `;

  const w = window.open();
  w.document.write(html);
  w.print();
}
</script>

</body>
</html>
