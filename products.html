<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MAD - المنتجات</title>
  <meta name="description" content="كتالوج منتجات MAD مع بطاقات وصور وروابط مباشرة." />
  <style>
    :root {
      --bg: #0a0b0f;
      --card: #11131a;
      --line: rgba(255,255,255,.1);
      --text: #f4f6fb;
      --muted: #a0a7b5;
      --brand: #d4af37;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--text);
      background:
        radial-gradient(1000px 500px at 50% -200px, rgba(212,175,55,.14), transparent 60%),
        linear-gradient(180deg, #0a0b0f 0%, #07080c 100%);
      font-family: "Noto Kufi Arabic", "Noto Sans Arabic", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    }
    .wrap { max-width: 1160px; margin: 0 auto; padding: 24px 16px 48px; }
    .top { display: flex; justify-content: space-between; gap: 12px; align-items: center; margin-bottom: 18px; }
    .title { margin: 0; font-size: 26px; }
    .note { color: var(--muted); font-size: 13px; }
    .search {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 12px 14px;
      outline: none;
      margin-bottom: 16px;
      font-size: 14px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 12px;
    }
    .card {
      background: rgba(17,19,26,.9);
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow: hidden;
    }
    .img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; background: rgba(255,255,255,.03); }
    .body { padding: 12px; }
    .name { margin: 0 0 8px; font-size: 16px; line-height: 1.3; }
    .meta { color: var(--muted); font-size: 12px; line-height: 1.7; }
    .price { color: var(--brand); font-weight: 900; margin-top: 8px; }
    .row { display: flex; gap: 8px; margin-top: 10px; }
    .btn {
      flex: 1;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px;
      text-decoration: none;
      color: var(--text);
      font-weight: 800;
      text-align: center;
      background: rgba(255,255,255,.03);
      font-size: 13px;
    }
    .btn.primary {
      border-color: rgba(212,175,55,.35);
      background: linear-gradient(135deg, rgba(212,175,55,.2), rgba(212,175,55,.08));
    }
    .empty { color: var(--muted); border: 1px dashed var(--line); border-radius: 14px; padding: 16px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h1 class="title">كتالوج MAD</h1>
      <div class="note">جاهز للبوت • بطاقات + روابط Preview</div>
    </div>
    <input id="search" class="search" placeholder="ابحث بالاسم / الكود / المفتاح (alien | XF A.112)" />
    <div id="grid" class="grid"></div>
  </div>

  <script>
    const CURRENCY = "₪";
    const DATA_URL = "./catalog.json";

    const safe = (v) => (v ?? "").toString();
    const $ = (id) => document.getElementById(id);

    function slugFromProduct(p) {
      return safe(p.SEARCH_KEY || p["PRODUCT CODE"] || p.ORIGINAL_EN || "product")
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "") || "product";
    }

    function labelName(p) {
      return safe(p.ORIGINAL_AR || p.ORIGINAL_HE || p.ORIGINAL_EN || p.DESCRIPTION || "Product");
    }

    function makeCard(p) {
      const slug = slugFromProduct(p);
      const previewLink = `./products/${slug}.html`;
      const openLink = `./product.html?q=${encodeURIComponent(safe(p.SEARCH_KEY || p["PRODUCT CODE"] || ""))}`;

      const card = document.createElement("article");
      card.className = "card";
      card.dataset.search = [
        p.SEARCH_KEY,
        p["PRODUCT CODE"],
        p.ORIGINAL_AR,
        p.ORIGINAL_HE,
        p.ORIGINAL_EN,
        p.DESCRIPTION,
      ].map(safe).join(" ").toLowerCase();

      card.innerHTML = `
        <img class="img" src="${safe(p.IMAGE_LINK)}" alt="${labelName(p)}" loading="lazy" />
        <div class="body">
          <h2 class="name">${labelName(p)}</h2>
          <div class="meta">${safe(p["PRODUCT CODE"])} • ${safe(p.SIZE)} • ${safe(p["PRODUCT TYPE"])}</div>
          <div class="price">${CURRENCY}${safe(p.PRICE)}</div>
          <div class="row">
            <a class="btn primary" href="${previewLink}" target="_blank" rel="noopener">رابط البوت (Preview)</a>
            <a class="btn" href="${openLink}" target="_blank" rel="noopener">فتح المنتج</a>
          </div>
        </div>
      `;
      return card;
    }

    async function main() {
      const grid = $("grid");
      const q = $("search");

      let products = [];
      try {
        const res = await fetch(DATA_URL, { cache: "no-store" });
        const raw = await res.json();
        products = Array.isArray(raw) ? raw : (Array.isArray(raw.products) ? raw.products : []);
      } catch {
        grid.innerHTML = '<div class="empty">فشل تحميل catalog.json</div>';
        return;
      }

      if (!products.length) {
        grid.innerHTML = '<div class="empty">لا يوجد منتجات في الكتالوج.</div>';
        return;
      }

      products.forEach((p) => grid.appendChild(makeCard(p)));

      q.addEventListener("input", () => {
        const term = safe(q.value).trim().toLowerCase();
        Array.from(grid.children).forEach((el) => {
          el.style.display = !term || safe(el.dataset.search).includes(term) ? "" : "none";
        });
      });
    }

    main();
  </script>
</body>
</html>
