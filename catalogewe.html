<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD Catalog Sender</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: Arial; background:#f5f5f5 }
.card:hover { transform:scale(1.03); transition:.2s }
</style>
</head>
<body class="p-4">

<div class="max-w-7xl mx-auto">

<!-- Language Toggle -->
<div class="flex justify-between mb-4">
    <h1 class="text-2xl font-bold">MAD Product Selector</h1>
    <button onclick="toggleLang()" class="bg-black text-white px-4 py-2 rounded">
        Ø¹Ø±Ø¨ÙŠ / ×¢×‘×¨×™×ª
    </button>
</div>

<!-- Categories -->
<div id="categories" class="flex flex-wrap gap-2 mb-6"></div>

<!-- Products -->
<div id="products" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>

<!-- Actions -->
<div class="fixed bottom-4 left-0 right-0 flex justify-center gap-3">
    <button onclick="sendSelected()" class="bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg">
        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    </button>
    <button onclick="sendCategory()" class="bg-black text-white px-6 py-3 rounded-xl shadow-lg">
        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ
    </button>
</div>

</div>

<script>

let products = []
let selected = []
let currentCategory = ""
let lang = "ar"
const whatsappNumber = "972524033442" // Ø­Ø· Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªØ¨Ø¹Ùƒ

async function loadRSS(){
    const response = await fetch("products.rss")
    const text = await response.text()
    const parser = new DOMParser()
    const xml = parser.parseFromString(text,"text/xml")
    const items = xml.querySelectorAll("item")

    items.forEach(item=>{
        products.push({
            id: item.querySelector("g\\:id").textContent,
            title: item.querySelector("g\\:title").textContent,
            image: item.querySelector("g\\:image_link").textContent,
            link: item.querySelector("g\\:link").textContent,
            category: item.querySelector("g\\:product_type").textContent
        })
    })

    renderCategories()
}

function renderCategories(){
    const container = document.getElementById("categories")
    const cats = [...new Set(products.map(p=>p.category))]

    cats.forEach(cat=>{
        const btn = document.createElement("button")
        btn.className = "bg-gray-200 px-4 py-2 rounded"
        btn.innerText = translateCategory(cat)
        btn.onclick = ()=>filterCategory(cat)
        container.appendChild(btn)
    })
}

function filterCategory(cat){
    currentCategory = cat
    selected = []
    const filtered = products.filter(p=>p.category===cat)
    renderProducts(filtered)
}

function renderProducts(list){
    const container = document.getElementById("products")
    container.innerHTML=""
    list.forEach(p=>{
        const div = document.createElement("div")
        div.className="card bg-white p-2 rounded shadow cursor-pointer"
        div.innerHTML=`
            <img src="${p.image}" class="w-full h-40 object-contain">
            <p class="text-center mt-2 font-semibold">${p.title}</p>
        `
        div.onclick=()=>toggleSelect(p.id,div)
        container.appendChild(div)
    })
}

function toggleSelect(id,el){
    if(selected.includes(id)){
        selected = selected.filter(x=>x!==id)
        el.classList.remove("ring","ring-green-500")
    }else{
        selected.push(id)
        el.classList.add("ring","ring-green-500")
    }
}

function sendSelected(){
    if(selected.length===0) return alert("Ø§Ø®ØªØ± Ù…Ù†ØªØ¬Ø§Øª")
    const chosen = products.filter(p=>selected.includes(p.id))
    let message = "ğŸ› Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:\n\n"
    chosen.forEach(p=>{
        message += `${p.title}\n${p.link}\n\n`
    })
    openWhatsApp(message)
}

function sendCategory(){
    if(!currentCategory) return alert("Ø§Ø®ØªØ± ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ")
    const chosen = products.filter(p=>p.category===currentCategory)
    let message = "ğŸ› Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ¦Ø©:\n\n"
    chosen.forEach(p=>{
        message += `${p.title}\n${p.link}\n\n`
    })
    openWhatsApp(message)
}

function openWhatsApp(text){
    const url = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(text)}`
    window.open(url,"_blank")
}

function toggleLang(){
    lang = lang==="ar" ? "he" : "ar"
    location.reload()
}

function translateCategory(cat){
    if(lang==="ar"){
        if(cat.includes("×’×‘×¨×™×")) return "Ø¹Ø·ÙˆØ± Ø±Ø¬Ø§Ù„"
        if(cat.includes("× ×©×™×")) return "Ø¹Ø·ÙˆØ± Ù†Ø³Ø§Ø¡"
        if(cat.includes("××‘×¦×¢×™×")) return "Ø¹Ø±ÙˆØ¶"
        return cat
    }
    return cat
}

loadRSS()

</script>

</body>
</html>
