<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD Staff Catalog</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
body { font-family: 'Cairo', sans-serif; }
.card:hover { transform: translateY(-2px); }
</style>
</head>

<body class="bg-gray-100">

<div class="max-w-7xl mx-auto p-6 pb-32">

<h1 class="text-3xl font-black mb-4">اختيار منتجات وإرسال للزبون</h1>

<input id="search" placeholder="بحث..." class="w-full p-3 rounded-xl mb-4">

<div id="filters" class="flex gap-2 flex-wrap mb-4"></div>

<div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>

</div>

<div class="fixed bottom-4 left-4 right-4 bg-white shadow-xl p-4 rounded-xl flex gap-3 items-center">
<div>المحدد: <span id="count">0</span></div>
<button id="clear" class="text-red-600 font-bold">تفريغ</button>
<button id="send" class="bg-black text-white px-4 py-2 rounded-xl font-bold">فتح واتساب</button>
</div>

<script>

let products = []
let selected = new Map()
let activeCategory = "الكل"
let categories = new Set(["الكل"])

async function loadRSS() {
  const res = await fetch("products.rss")
  const text = await res.text()

  const parser = new DOMParser()
  const xml = parser.parseFromString(text, "text/xml")

  const items = [...xml.querySelectorAll("item")]

  products = items.map(item => {
    return {
      title: item.querySelector("g\\:title").textContent,
      link: item.querySelector("g\\:link").textContent,
      image: item.querySelector("g\\:image_link").textContent,
      category: item.querySelector("g\\:product_type")?.textContent || "غير مصنف"
    }
  })

  products.forEach(p => categories.add(p.category))

  renderFilters()
  renderGrid()
}

function renderFilters() {
  const container = document.getElementById("filters")
  container.innerHTML = ""

  categories.forEach(cat => {
    const btn = document.createElement("button")
    btn.innerText = cat
    btn.className = "px-4 py-2 bg-white rounded-xl border font-bold"
    btn.onclick = () => {
      activeCategory = cat
      renderGrid()
    }
    container.appendChild(btn)
  })
}

function renderGrid() {
  const grid = document.getElementById("grid")
  grid.innerHTML = ""

  const search = document.getElementById("search").value.toLowerCase()

  products
    .filter(p =>
      (activeCategory === "الكل" || p.category === activeCategory) &&
      p.title.toLowerCase().includes(search)
    )
    .forEach(p => {
      const card = document.createElement("div")
      card.className = "bg-white p-3 rounded-xl card"

      card.innerHTML = `
        <img src="${p.image}" class="w-full h-40 object-cover rounded-xl">
        <div class="font-black mt-2">${p.title}</div>
        <button class="mt-2 bg-gray-200 w-full py-2 rounded-xl font-bold">
          ${selected.has(p.link) ? "محدد ✓" : "تحديد"}
        </button>
      `

      card.querySelector("button").onclick = () => {
        if (selected.has(p.link)) {
          selected.delete(p.link)
        } else {
          selected.set(p.link, p)
        }
        updateCount()
        renderGrid()
      }

      grid.appendChild(card)
    })
}

function updateCount() {
  document.getElementById("count").innerText = selected.size
}

document.getElementById("search").addEventListener("input", renderGrid)

document.getElementById("clear").onclick = () => {
  selected.clear()
  updateCount()
  renderGrid()
}

document.getElementById("send").onclick = () => {
  if (!selected.size) return alert("حدد منتجات أولاً")

  let message = "هاي المنتجات المقترحة:\n\n"

  Array.from(selected.values()).forEach((p,i)=>{
    message += `${i+1}) ${p.title}\n${p.link}\n\n`
  })

  window.open(`https://wa.me/?text=${encodeURIComponent(message)}`)
}

loadRSS()

</script>

</body>
</html>
