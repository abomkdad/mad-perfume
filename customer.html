<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>MAD Parfumeur | VIP Catalog</title>

  <meta property="og:title" content="MAD Parfumeur - Premium Catalog" />
  <meta property="og:description" content="Choose your luxury fragrances and order directly via WhatsApp" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://www.mad-parfumeur.com/assets/hero/logo2.webp" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Cairo', 'sans-serif'],
          },
          colors: {
            brand: '#111111',     // Deep Luxury Black
            gold: '#C5A059',      // Elegant Gold
            paper: '#F9F9F9',     // Soft Off-White
          }
        }
      }
    }
  </script>

  <style>
    body { background-color: #F9F9F9; -webkit-tap-highlight-color: transparent; }
    .glass { backdrop-filter: blur(12px); background: rgba(255, 255, 255, 0.85); }
    .shadow-soft { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
    .shadow-hover:hover { box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); transform: translateY(-2px); }
    .transition-all { transition: all 0.3s ease; }
    
    /* Hide scrollbar for horizontal mobile scrolling */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>

<body class="min-h-screen text-gray-800 pb-20">

  <div class="sticky top-0 z-30 border-b border-gray-100 glass shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-2">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-black flex items-center justify-center overflow-hidden border border-gray-200">
          <img src="https://www.mad-parfumeur.com/assets/hero/logo.png" alt="MAD" class="w-8 h-8 object-contain filter invert">
        </div>
        <div>
          <div class="font-black text-lg leading-tight text-brand tracking-wide">MAD Parfumeur</div>
          <div id="t_sub" class="text-[10px] text-gray-500 font-semibold tracking-wider uppercase">Luxury Collection</div>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <button id="langBtn" class="px-3 py-1.5 rounded-lg border border-gray-200 text-gray-600 text-xs font-bold hover:bg-gray-50 transition-all">Ø¹Ø±Ø¨ÙŠ / ×¢×‘×¨×™×ª</button>

        <button id="cartBtn" class="relative px-4 py-1.5 rounded-lg bg-brand text-white text-sm font-bold shadow-soft flex items-center gap-2 transition-all hover:bg-black">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
          <span id="cartCountBadge" class="absolute -top-2 -right-2 bg-gold text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-black border-2 border-white">0</span>
        </button>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 pt-6">
    <div class="relative rounded-2xl overflow-hidden bg-brand text-white shadow-soft">
      <div class="absolute -right-20 -top-20 w-64 h-64 bg-gold rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
      
      <div class="relative p-6 md:p-10 flex flex-col md:flex-row md:items-center md:justify-between gap-6">
        <div>
          <div id="t_hero_title" class="text-2xl md:text-4xl font-black mb-2">Ø§Ø®ØªÙØ± Ø¹Ø·Ø±Ùƒ Ø§Ù„Ù…ÙØ¶Ù„</div>
          <div id="t_hero_desc" class="text-gray-300 text-sm md:text-base max-w-md">
            Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§ØªÙƒ Ù„Ù„Ø³Ù„Ø©ØŒ Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªØ¬Ù‡ÙŠØ² Ø·Ù„Ø¨Ùƒ ÙÙˆØ±Ø§Ù‹ Ø¹Ø¨Ø± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.
          </div>
        </div>

        <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/10 w-full md:w-[320px]">
          <div class="flex items-center gap-2 bg-white rounded-lg px-3 py-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
            <input id="search" class="w-full bg-transparent text-sm text-brand outline-none" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„ÙƒÙˆØ¯..." />
          </div>
          <div class="mt-2 text-[10px] text-gray-400 text-center font-semibold tracking-wider">
            <span id="t_status">CATALOG STATUS:</span> <span id="status" class="text-gold">LOADING...</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 mt-8">
    <div class="flex items-end justify-between mb-4">
      <div class="font-black text-xl text-brand" id="t_categories">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</div>
      <div class="text-xs text-gray-500 font-semibold bg-gray-200 px-2 py-1 rounded-md">
        <span id="t_products">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span> <span id="countAll">0</span>
      </div>
    </div>
    <div id="categories" class="flex overflow-x-auto gap-2 pb-2 hide-scrollbar"></div>
  </div>

  <div class="max-w-7xl mx-auto px-4 mt-2">
    <div id="products" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-5"></div>
  </div>

  <div id="cartOverlay" class="fixed inset-0 bg-brand/60 backdrop-blur-sm hidden z-40 transition-opacity"></div>
  <div id="cartDrawer" class="fixed top-0 right-0 h-full w-full md:max-w-md bg-paper z-50 translate-x-full transition-transform duration-300 shadow-2xl flex flex-col">
    
    <div class="p-5 border-b border-gray-200 bg-white flex items-center justify-between">
      <div>
        <div class="font-black text-xl text-brand" id="t_cart_title">Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</div>
        <div class="text-xs text-gray-500" id="t_cart_sub">Ø±Ø§Ø¬Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ ÙˆØ£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</div>
      </div>
      <button id="closeCart" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-gray-200 transition-colors">âœ•</button>
    </div>

    <div class="p-5 overflow-y-auto flex-1 space-y-5">
      
      <div class="flex gap-2">
        <button id="clearCart" class="flex-1 px-4 py-2.5 rounded-lg bg-gray-200 text-gray-700 text-sm font-bold transition-all hover:bg-gray-300" id="t_clear">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
        <button id="openBundle" class="flex-1 px-4 py-2.5 rounded-lg bg-brand text-white text-sm font-bold shadow-soft transition-all hover:bg-black">
          <span id="t_bundle">Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù†Ø¯Ù„</span>
        </button>
      </div>

      <div>
        <div class="text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider">
          <span id="t_selected">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:</span> <span id="countSel" class="text-brand">0</span>
        </div>
        <div id="cartItems" class="space-y-3"></div>
      </div>

      <div class="rounded-xl border border-gray-200 p-4 bg-white shadow-sm">
        <div class="font-black text-sm mb-3 text-brand" id="t_form">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</div>
        <div class="space-y-3">
          <input id="custName" class="w-full bg-paper border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-gold transition-colors" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" />
          <input id="custPhone" class="w-full bg-paper border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-gold transition-colors" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙÙˆÙ†" inputmode="tel" />
          <textarea id="custAddress" class="w-full bg-paper border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-gold transition-colors" rows="2" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹..."></textarea>

          <div class="border border-gray-200 rounded-lg p-3 bg-paper mt-2">
            <div class="text-xs font-bold mb-2 text-gray-600" id="t_pay">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
            <label class="flex items-center gap-2 text-sm cursor-pointer">
              <input type="radio" name="pay" value="COD" checked class="accent-gold" /> 
              <span id="t_cod" class="font-semibold">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span>
            </label>
            <label class="flex items-center gap-2 text-sm mt-2 cursor-pointer">
              <input type="radio" name="pay" value="CARD" class="accent-gold" /> 
              <span id="t_card" class="font-semibold">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† / ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="p-5 border-t border-gray-200 bg-white">
      <div class="space-y-2 mb-4">
        <div class="flex items-center justify-between text-sm text-gray-600">
          <span id="t_subtotal">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
          <span class="font-bold">â‚ª<span id="subtotal">0</span></span>
        </div>
        <div class="flex items-center justify-between text-sm text-gray-600">
          <span id="t_ship">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
          <span class="font-bold">â‚ª<span id="shipping">50</span></span>
        </div>
        <div class="flex items-center justify-between text-lg text-brand mt-2 pt-2 border-t border-dashed border-gray-200">
          <span class="font-black" id="t_total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</span>
          <span class="font-black text-xl text-gold">â‚ª<span id="total">50</span></span>
        </div>
      </div>

      <button id="sendOrder" class="w-full flex items-center justify-center gap-2 px-4 py-3.5 rounded-xl bg-[#25D366] text-white text-base font-black shadow-lg hover:bg-[#1EBE5D] transition-all">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/></svg>
        <span id="t_send">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span>
      </button>
      <div class="mt-3 text-center text-[10px] text-gray-400 font-semibold" id="t_note">
        ğŸ”’ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø¢Ù…Ù†Ø© ÙˆØ³ÛŒØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø¨Ø§Ø´Ø±Ø©
      </div>
    </div>
  </div>

<script>
/* ========= CONFIG ========= */
const CS_WHATSAPP = "972524033442";
const DELIVERY_FEE = 50;

const CUSTOMER_CATEGORIES = [
  { key: "men",   match: "×’×‘×¨×™×",  ar: "Ø¹Ø·ÙˆØ± Ø±Ø¬Ø§Ù„ÙŠØ©", he: "×‘×©××™ ×’×‘×¨×™×" },
  { key: "women", match: "× ×©×™×",   ar: "Ø¹Ø·ÙˆØ± Ù†Ø³Ø§Ø¦ÙŠØ©", he: "×‘×©××™ × ×©×™×" },
  { key: "offers",match: "××‘×¦×¢×™×", ar: "Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ©",   he: "××‘×¦×¢×™×" },
  { key: "niche", match: "× ×™×©×”",   ar: "Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´",  he: "× ×™×©×”" },
];

/* ========= STATE ========= */
let LANG = (navigator.language || "").toLowerCase().includes("he") ? "he" : "ar";
let PRODUCTS = [];
let FILTERED = [];
let CURRENT_CAT_KEY = CUSTOMER_CATEGORIES[0].key;
let CART = new Map();

/* ========= UI TEXT ========= */
function T(ar, he){ return (LANG==="he") ? he : ar; }
function setTexts(){
  document.documentElement.lang = LANG;
  document.documentElement.dir = (LANG==="he") ? "ltr" : "rtl";

  document.getElementById("t_sub").textContent = T("Luxury Collection","×§×•×œ×§×¦×™×™×ª ×™×•×§×¨×”");
  document.getElementById("t_hero_title").textContent = T("Ø§Ø®ØªÙØ± Ø¹Ø·Ø±Ùƒ Ø§Ù„Ù…ÙØ¶Ù„","×‘×—×¨ ××ª ×”×‘×•×©× ×©×œ×š");
  document.getElementById("t_hero_desc").textContent = T("Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§ØªÙƒ Ù„Ù„Ø³Ù„Ø©ØŒ Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªØ¬Ù‡ÙŠØ² Ø·Ù„Ø¨Ùƒ ÙÙˆØ±Ø§Ù‹ Ø¹Ø¨Ø± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.","×”×•×¡×£ ×œ×¢×’×œ×”, ××œ× ×¤×¨×˜×™×, ×•× ×›×™×Ÿ ××ª ×”×”×–×× ×” ×©×œ×š ××™×“ ×“×¨×š ×©×™×¨×•×ª ×”×œ×§×•×—×•×ª.");
  document.getElementById("search").placeholder = T("Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„ÙƒÙˆØ¯...","×—×¤×© ×œ×¤×™ ×©× / ×§×•×“...");
  document.getElementById("t_status").textContent = T("CATALOG STATUS:","×¡×˜×˜×•×¡ ×§×˜×œ×•×’:");
  document.getElementById("t_categories").textContent = T("Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª","×§×˜×’×•×¨×™×•×ª");
  document.getElementById("t_products").textContent = T("Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:","×¡×”×´×›:");
  document.getElementById("t_cart_title").textContent = T("Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚","×¢×’×œ×ª ×§× ×™×•×ª");
  document.getElementById("t_cart_sub").textContent = T("Ø±Ø§Ø¬Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ ÙˆØ£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ","×‘×“×•×§ ××ª ×”×”×–×× ×” ×•××œ× ×¤×¨×˜×™×");
  document.getElementById("clearCart").textContent = T("Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©","× ×§×” ×¢×’×œ×”");
  document.getElementById("t_bundle").textContent = T("Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù†Ø¯Ù„","×¦×¤×” ×‘×‘×× ×“×œ");
  document.getElementById("t_selected").textContent = T("Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:","×¤×¨×™×˜×™× ×©× ×‘×—×¨×•:");
  document.getElementById("t_form").textContent = T("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„","×¤×¨×˜×™ ××©×œ×•×—");
  document.getElementById("custName").placeholder = T("Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„","×©× ××œ×");
  document.getElementById("custPhone").placeholder = T("Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙÙˆÙ†","××¡×¤×¨ ×˜×œ×¤×•×Ÿ");
  document.getElementById("custAddress").placeholder = T("Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹...","×¢×™×¨, ×©×›×•× ×”, ×¨×—×•×‘...");
  document.getElementById("t_pay").textContent = T("Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹","×××¦×¢×™ ×ª×©×œ×•×");
  document.getElementById("t_cod").textContent = T("Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…","×ª×©×œ×•× ×‘×¢×ª ××¡×™×¨×”");
  document.getElementById("t_card").textContent = T("Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† / ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ","×›×¨×˜×™×¡ ××©×¨××™ / ×”×¢×‘×¨×” ×‘× ×§××™×ª");
  document.getElementById("t_subtotal").textContent = T("Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ","×¡×›×•× ×‘×™× ×™×™×");
  document.getElementById("t_ship").textContent = T("Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„","×“××™ ××©×œ×•×—");
  document.getElementById("t_total").textContent = T("Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨","×¡×”×´×› ×œ×ª×©×œ×•×");
  document.getElementById("t_send").textContent = T("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨","××™×©×•×¨ ×”×–×× ×” ×‘×•×•××˜×¡××¤");
  document.getElementById("t_note").textContent = T("ğŸ”’ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø¢Ù…Ù†Ø© ÙˆØ³ÛŒØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø¨Ø§Ø´Ø±Ø©","ğŸ”’ ×”×¤×¨×˜×™× ×××•×‘×˜×—×™× ×•×ª×•×¢×‘×¨ ×œ×©×™×¨×•×ª ×”×œ×§×•×—×•×ª");
}

document.getElementById("langBtn").onclick = ()=>{
  LANG = (LANG==="ar") ? "he" : "ar";
  setTexts();
  renderCategories();
  applyFilters();
  renderCart();
};

/* ========= RSS PARSE ========= */
function getTextByLocalName(parent, localName){
  const nodes = parent.getElementsByTagName("*");
  const target = localName.toLowerCase();
  for(let i=0;i<nodes.length;i++){
    const ln = (nodes[i].localName || "").toLowerCase();
    if(ln===target) return (nodes[i].textContent||"").trim();
  }
  return "";
}

function parsePrice(priceText){
  if(!priceText) return 0;
  const n = parseFloat(String(priceText).replace(/[^\d.]/g,""));
  return isNaN(n) ? 0 : n;
}

async function loadRSS(){
  const status = document.getElementById("status");
  status.textContent = T("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...","×˜×•×¢×Ÿ...");
  status.classList.remove("text-gold");
  status.classList.add("text-gray-400");
  
  try{
    const res = await fetch("products.rss", { cache:"no-store" });
    if(!res.ok) throw new Error("HTTP "+res.status);
    const text = await res.text();
    const xml = new DOMParser().parseFromString(text, "application/xml");
    const err = xml.getElementsByTagName("parsererror");
    if(err && err.length) throw new Error("XML parse error");

    const items = Array.from(xml.getElementsByTagName("item"));
    PRODUCTS = items.map(item=>{
      const priceRaw = getTextByLocalName(item, "price") || getTextByLocalName(item, "sale_price") || "";
      return {
        id: getTextByLocalName(item,"id"),
        title: getTextByLocalName(item,"title"),
        image: getTextByLocalName(item,"image_link"),
        link: getTextByLocalName(item,"link"),
        product_type: getTextByLocalName(item,"product_type") || "",
        price_raw: priceRaw,
        price: parsePrice(priceRaw)
      };
    }).filter(p=>p.id && p.title);

    document.getElementById("countAll").textContent = PRODUCTS.length.toString();
    status.textContent = "ONLINE âœ…";
    status.className = "text-green-500 font-bold";

    renderCategories();
    applyFilters();
  }catch(e){
    console.error(e);
    status.textContent = "OFFLINE âŒ";
    status.className = "text-red-500 font-bold";
    // alert("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª\n"+e.message);
  }
}

/* ========= CATEGORIES ========= */
function catLabel(cat){ return (LANG==="he") ? cat.he : cat.ar; }
function renderCategories(){
  const wrap = document.getElementById("categories");
  wrap.innerHTML="";
  CUSTOMER_CATEGORIES.forEach(cat=>{
    const active = (cat.key===CURRENT_CAT_KEY);
    const b = document.createElement("button");
    b.className = `whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all border ${active ? "bg-brand text-white border-brand shadow-md" : "bg-white text-gray-600 border-gray-200 hover:border-gray-300"}`;
    b.textContent = catLabel(cat);
    b.onclick = ()=>{ CURRENT_CAT_KEY = cat.key; applyFilters(); renderCategories(); };
    wrap.appendChild(b);
  });
}

/* ========= FILTER + RENDER PRODUCTS ========= */
document.getElementById("search").addEventListener("input", applyFilters);

function matchesCategory(pt, matchWord){ return (pt||"").includes(matchWord); }

function applyFilters(){
  const q = (document.getElementById("search").value||"").trim().toLowerCase();
  const cat = CUSTOMER_CATEGORIES.find(c=>c.key===CURRENT_CAT_KEY);

  FILTERED = PRODUCTS.filter(p=>{
    const catOk = matchesCategory(p.product_type, cat.match);
    const qOk = !q ? true : (p.title.toLowerCase().includes(q) || p.id.toLowerCase().includes(q));
    return catOk && qOk;
  });

  renderProducts(FILTERED);
}

function renderProducts(list){
  const grid = document.getElementById("products");
  grid.innerHTML="";

  list.forEach(p=>{
    const inCart = CART.has(p.id);
    const card = document.createElement("div");
    card.className = "bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden flex flex-col transition-all shadow-hover group";

    // Luxury Layout for Cards
    card.innerHTML = `
      <div class="relative w-full aspect-[4/5] bg-paper p-4 flex items-center justify-center">
        <img src="${escapeHtml(p.image)}" class="max-h-full max-w-full object-contain mix-blend-multiply group-hover:scale-105 transition-transform duration-500" alt="">
      </div>
      <div class="p-3 md:p-4 flex-1 flex flex-col">
        <div class="text-[10px] tracking-widest text-gray-400 font-bold uppercase mb-1">${escapeHtml(p.id)}</div>
        <h3 class="font-bold text-sm leading-snug text-gray-800 flex-1">${escapeHtml(p.title)}</h3>
        
        <div class="mt-3 flex items-end justify-between">
          <div>
            ${p.price_raw ? `<span class="text-[10px] text-gray-400 line-through block leading-none">${escapeHtml(p.price_raw)}</span>` : ''}
            <div class="text-base md:text-lg font-black text-brand leading-none mt-1">â‚ª${(p.price||0).toFixed(0)}</div>
          </div>
        </div>

        <button class="mt-3 w-full py-2.5 rounded-xl text-xs md:text-sm font-bold transition-all ${inCart ? "bg-brand text-white" : "bg-gold text-white hover:bg-[#b08d4a]" }">
          ${inCart ? "âœ“ " + T("Ù…Ø¶Ø§Ù Ù„Ù„Ø³Ù„Ø©","× ×•×¡×£ ×œ×¢×’×œ×”") : "+ " + T("Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©","×”×•×¡×£ ×œ×¢×’×œ×”")}
        </button>
      </div>
    `;

    card.querySelector("button").onclick = ()=>{
      if(CART.has(p.id)) CART.delete(p.id);
      else CART.set(p.id, 1);
      syncCartBadges();
      renderProducts(FILTERED);
      renderCart();
    };

    grid.appendChild(card);
  });
}

/* ========= CART DRAWER ========= */
const cartBtn = document.getElementById("cartBtn");
const cartDrawer = document.getElementById("cartDrawer");
const cartOverlay = document.getElementById("cartOverlay");
const closeCart = document.getElementById("closeCart");

cartBtn.onclick = openCart;
cartOverlay.onclick = closeCartFn;
closeCart.onclick = closeCartFn;

function openCart(){
  cartOverlay.classList.remove("hidden");
  // Small delay for smooth transition
  setTimeout(() => cartDrawer.classList.remove("translate-x-full"), 10);
  renderCart();
}
function closeCartFn(){
  cartDrawer.classList.add("translate-x-full");
  setTimeout(() => cartOverlay.classList.add("hidden"), 300);
}

document.getElementById("clearCart").onclick = ()=>{
  CART.clear();
  syncCartBadges();
  renderCart();
  renderProducts(FILTERED);
};

function syncCartBadges(){
  const count = CART.size;
  const badge = document.getElementById("cartCountBadge");
  badge.textContent = count.toString();
  
  // Animate badge
  badge.classList.add("scale-125");
  setTimeout(() => badge.classList.remove("scale-125"), 200);

  document.getElementById("countSel").textContent = count.toString();
}

function calcSubtotal(){
  const map = new Map(PRODUCTS.map(p=>[p.id,p]));
  let sum = 0;
  for(const [id, qty] of CART.entries()){
    const p = map.get(id);
    if(!p) continue;
    sum += (p.price||0) * qty;
  }
  return sum;
}

function renderTotals(){
  const sub = calcSubtotal();
  document.getElementById("subtotal").textContent = sub.toFixed(0);
  document.getElementById("shipping").textContent = DELIVERY_FEE.toFixed(0);
  document.getElementById("total").textContent = (sub + DELIVERY_FEE).toFixed(0);
}

function renderCart(){
  const wrap = document.getElementById("cartItems");
  wrap.innerHTML = "";

  if(CART.size === 0){
    wrap.innerHTML = `<div class="p-6 rounded-xl bg-gray-50 border border-gray-100 text-center text-gray-500 font-semibold text-sm">${escapeHtml(T("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©â€¦ Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ø·ÙˆØ± Ø¨Ø¹Ø¯","×”×¢×’×œ×” ×¨×™×§×”â€¦ ×˜×¨× ×”×•×¡×¤×ª ×‘×©××™×"))}</div>`;
    renderTotals();
    return;
  }

  const map = new Map(PRODUCTS.map(p=>[p.id,p]));

  for(const [id, qty] of CART.entries()){
    const p = map.get(id);
    if(!p) continue;

    const row = document.createElement("div");
    row.className = "flex gap-3 p-3 rounded-xl border border-gray-100 bg-white shadow-sm relative";
    row.innerHTML = `
      <div class="w-20 h-20 rounded-lg bg-paper flex items-center justify-center p-2">
        <img src="${escapeHtml(p.image)}" class="max-h-full mix-blend-multiply" alt="">
      </div>
      <div class="flex-1 py-1">
        <div class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">${escapeHtml(p.id)}</div>
        <div class="font-bold text-sm text-gray-800 leading-tight mt-0.5 pr-6">${escapeHtml(p.title)}</div>
        
        <div class="flex items-center justify-between mt-2">
          <div class="text-sm font-black text-brand">â‚ª${(p.price||0).toFixed(0)}</div>
          
          <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-1 border border-gray-100">
            <button class="w-6 h-6 rounded flex items-center justify-center bg-white shadow-sm text-gray-600 font-bold" data-act="dec">-</button>
            <div class="w-4 text-center text-xs font-black">${qty}</div>
            <button class="w-6 h-6 rounded flex items-center justify-center bg-white shadow-sm text-gray-600 font-bold" data-act="inc">+</button>
          </div>
        </div>
      </div>
      <button class="absolute top-3 ${LANG==='he' ? 'left-3' : 'left-3'} w-7 h-7 bg-red-50 text-red-500 rounded-full flex items-center justify-center hover:bg-red-100 transition-colors" data-act="rm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
      </button>
    `;

    row.querySelector('[data-act="dec"]').onclick = ()=>{
      const now = CART.get(id) || 1;
      if(now <= 1) CART.delete(id);
      else CART.set(id, now-1);
      syncCartBadges(); renderCart(); renderProducts(FILTERED);
    };
    row.querySelector('[data-act="inc"]').onclick = ()=>{
      const now = CART.get(id) || 1;
      CART.set(id, now+1);
      syncCartBadges(); renderCart();
    };
    row.querySelector('[data-act="rm"]').onclick = ()=>{
      CART.delete(id);
      syncCartBadges(); renderCart(); renderProducts(FILTERED);
    };

    wrap.appendChild(row);
  }

  renderTotals();
}

/* ========= BUNDLE + SEND ORDER ========= */
function buildBundleUrl(ids){
  const base = location.origin + location.pathname.replace(/[^/]+$/, "") + "bundle.html";
  const idsParam = encodeURIComponent(ids.join(","));
  const wa = CS_WHATSAPP;
  const langParam = LANG;
  return `${base}?ids=${idsParam}&lang=${encodeURIComponent(langParam)}&wa=${encodeURIComponent(wa)}`;
}

document.getElementById("openBundle").onclick = ()=>{
  if(CART.size === 0) return;
  const ids = Array.from(CART.keys());
  window.open(buildBundleUrl(ids), "_blank");
};

function getPay(){
  const el = document.querySelector('input[name="pay"]:checked');
  return el ? el.value : "COD";
}

function normalizePhone(p){
  return (p||"").trim();
}

document.getElementById("sendOrder").onclick = ()=>{
  if(CART.size === 0) return;

  const name = (document.getElementById("custName").value || "").trim();
  const phone = normalizePhone(document.getElementById("custPhone").value || "");
  const addr = (document.getElementById("custAddress").value || "").trim();
  const pay = getPay();

  if(!name || !phone || !addr){
    alert(T("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„","× × ×œ××œ× ×©×, ×˜×œ×¤×•×Ÿ ×•×›×ª×•×‘×ª ×‘××œ×•××"));
    document.getElementById("custName").focus();
    return;
  }

  const ids = Array.from(CART.keys());
  const bundleUrl = buildBundleUrl(ids);
  const map = new Map(PRODUCTS.map(p=>[p.id, p]));
  
  let msg = T("âœ¨ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (MAD Parfumeur)* âœ¨\n","âœ¨ *×”×–×× ×” ×—×“×©×” (MAD Parfumeur)* âœ¨\n");
  msg += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
  msg += T(`ğŸ‘¤ *Ø§Ù„Ø§Ø³Ù…:* ${name}\n`,`ğŸ‘¤ *×©×:* ${name}\n`);
  msg += T(`ğŸ“ *Ø§Ù„ØªÙ„ÙÙˆÙ†:* ${phone}\n`,`ğŸ“ *×˜×œ×¤×•×Ÿ:* ${phone}\n`);
  msg += T(`ğŸ“ *Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${addr}\n`,`ğŸ“ *×›×ª×•×‘×ª:* ${addr}\n`);
  msg += T(`ğŸ’³ *Ø§Ù„Ø¯ÙØ¹:* ${pay==="COD" ? "Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ğŸ’µ" : "Ø¨Ø·Ø§Ù‚Ø© / ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ ğŸ’³"}\n`,
           `ğŸ’³ *×ª×©×œ×•×:* ${pay==="COD" ? "×‘××–×•××Ÿ ×œ×©×œ×™×— ğŸ’µ" : "××©×¨××™ / ×”×¢×‘×¨×” ğŸ’³"}\n`);
  msg += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
  msg += T("ğŸ›ï¸ *ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:*\n","ğŸ›ï¸ *×¤×™×¨×•×˜ ×”×–×× ×”:*\n");

  for(const [id, qty] of CART.entries()){
    const p = map.get(id);
    if(!p) continue;
    msg += `â–ªï¸ ${p.title} (x${qty}) â‡¾ â‚ª${( (p.price||0)*qty ).toFixed(0)}\n`;
  }

  const sub = calcSubtotal();
  msg += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
  msg += T(`ğŸ’° *Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:* â‚ª${sub.toFixed(0)}\n`,`ğŸ’° *×¡×›×•× ×‘×™× ×™×™×:* â‚ª${sub.toFixed(0)}\n`);
  msg += T(`ğŸšš *Ø§Ù„ØªÙˆØµÙŠÙ„:* â‚ª${DELIVERY_FEE}\n`,`ğŸšš *××©×œ×•×—:* â‚ª${DELIVERY_FEE}\n`);
  msg += T(`ğŸ§¾ *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:* *â‚ª${(sub + DELIVERY_FEE).toFixed(0)}*\n`,`ğŸ§¾ *×¡×”×´×› ×œ×ª×©×œ×•×:* *â‚ª${(sub + DELIVERY_FEE).toFixed(0)}*\n`);
  msg += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
  msg += T("ğŸ“¦ *Ø±Ø§Ø¨Ø· Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø·Ù„Ø¨ (ØµÙˆØ±):*\n","ğŸ“¦ *×§×™×©×•×¨ ×¦×¤×™×™×” ×‘×”×–×× ×” (×ª××•× ×•×ª):*\n");
  msg += bundleUrl + "\n";

  const waUrl = `https://wa.me/${CS_WHATSAPP}?text=${encodeURIComponent(msg)}`;
  window.open(waUrl, "_blank");
};

/* ========= UTILS ========= */
function escapeHtml(s){
  return (s||"").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
}

/* ========= INIT ========= */
setTexts();
syncCartBadges();
window.addEventListener("load", loadRSS);
</script>
</body>
</html>
