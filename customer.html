<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0A0A0A" />
  <meta property="og:image" content="https://www.mad-parfumeur.com/assets/hero/logo2.webp" />
  <title>MAD Parfumeur | website</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { --gold:#C5A059; --dark:#0A0A0A; }

    body{
      background:#e9eaec;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior-y: none;
    }
    .app{
      max-width:520px;
      margin:0 auto;
      min-height:100dvh;
      background:#FDFCFB;
      box-shadow:0 10px 40px rgba(0,0,0,.12);
    }
    @media (max-width: 560px){
      body{ background:#FDFCFB; }
      .app{ max-width:none; box-shadow:none; }
    }

    .glass-dark{ background: rgba(10,10,10,.98); backdrop-filter: blur(14px); }
    .product-card{ background:#fff; border-radius:18px; transition:.2s; border:1px solid #f0f0f0; }
    .product-card:active{ transform: scale(.99); }

    .no-scrollbar::-webkit-scrollbar{ display:none; }
    .no-scrollbar{ scrollbar-width: none; }

    .clamp-1, .clamp-2{
      display:-webkit-box;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .clamp-1{ -webkit-line-clamp:1; }
    .clamp-2{ -webkit-line-clamp:2; }

    .modal-container {
      max-height: calc(100dvh - 2rem);
      margin-top: env(safe-area-inset-top);
    }

    /* Ø­Ø±ÙƒØ© Ù†Ø¨Ø¶ Ø§Ù„Ø¹Ø±Ø¨Ø© Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ */
    @keyframes cartPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); color: var(--gold); }
      100% { transform: scale(1); }
    }
    .animate-cart-pop {
      animation: cartPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* ÙˆÙ…ÙŠØ¶ ×›×œ ×”××•×¦×¨×™× Ù„Ù„ÙØª Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ */
    @keyframes attentionBlink {
      0%, 100% { color: #fff; transform: scale(1); filter: drop-shadow(0 0 0px transparent); }
      50% { color: var(--gold); transform: scale(1.15); filter: drop-shadow(0 0 8px rgba(197, 160, 89, 0.6)); }
    }
    .animate-menu-blink {
      animation: attentionBlink 2s infinite ease-in-out;
    }

    /* Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù… */
    .fab {
      position: fixed;
      z-index: 120;
      right: 16px;
      bottom: calc(16px + env(safe-area-inset-bottom));
      width: 56px;
      height: 56px;
      border-radius: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#25D366;
      color:#fff;
      box-shadow: 0 14px 30px rgba(0,0,0,.22);
      transition: transform .15s;
    }
    .fab:active { transform: scale(.98); }
    .fab-badge {
      position:absolute;
      top:-6px;
      left:-6px;
      background:#0A0A0A;
      color:#fff;
      font-size:10px;
      font-weight:900;
      padding:3px 7px;
      border-radius:999px;
      border: 1px solid rgba(255,255,255,.25);
    }
  </style>

  <script>
    const PIXELS = {
      facebook: "1072283127290819",
      tiktok: "D2D02JBC77U4ENLN9SBG",
      snapchat: "b143822e-1c3c-40ff-93f7-edadee74e626"
    };

    // Facebook Pixel
    (function(){
      try{
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
          n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
        if(PIXELS.facebook){
          fbq('init', PIXELS.facebook);
          fbq('track', 'PageView');
        }
      }catch(e){ console.warn("FB Pixel error", e); }
    })();

    // TikTok Pixel
    (function(){
      try{
        if(!PIXELS.tiktok) return;
        !function (w, d, t) {
          w.TiktokAnalyticsObject=t;
          var ttq=w[t]=w[t]||[];
          ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"];
          ttq.setAndDefer=function(t,e){ t[e]=function(){ t.push([e].concat([].slice.call(arguments,0))); }; };
          for(var i=0;i<ttq.methods.length;i++) ttq.setAndDefer(ttq, ttq.methods[i]);
          ttq.instance=function(t){ for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++) ttq.setAndDefer(e,ttq.methods[n]); return e; };
          ttq.load=function(e,n){
            var i="https://analytics.tiktok.com/i18n/pixel/events.js";
            ttq._i=ttq._i||{};
            ttq._i[e]=[];
            ttq._i[e]._u=i;
            ttq._t=ttq._t||{};
            ttq._t[e]=+new Date;
            ttq._o=ttq._o||{};
            ttq._o[e]=n||{};
            var o=d.createElement("script");
            o.type="text/javascript"; o.async=!0;
            o.src=i+"?sdkid="+e+"&lib="+t;
            var a=d.getElementsByTagName("script")[0];
            a.parentNode.insertBefore(o,a);
          };
          ttq.load(PIXELS.tiktok);
          ttq.page();
        }(window, document, 'ttq');
      }catch(e){ console.warn("TikTok Pixel error", e); }
    })();

    // Snap Pixel
    (function(){
      try{
        if(!PIXELS.snapchat) return;
        (function(e,t,n){if(e.snaptr)return;var a=e.snaptr=function()
          {a.handleRequest?a.handleRequest.apply(a,arguments):a.queue.push(arguments)};
          a.queue=[];var s='script';var r=t.createElement(s);r.async=!0;
          r.src=n;var u=t.getElementsByTagName(s)[0];u.parentNode.insertBefore(r,u);
        })(window,document,'https://sc-static.net/scevent.min.js');

        snaptr('init', PIXELS.snapchat, { 'user_email': '' });
        snaptr('track', 'PAGE_VIEW');
      }catch(e){ console.warn("Snap Pixel error", e); }
    })();

    // All events -> Lead
    function fireLeadEvent(extra){
      try{ if(window.fbq) fbq('track', 'Lead', extra || {}); }catch(e){}
      try{ if(window.ttq) ttq.track('Lead', extra || {}); }catch(e){}
      try{ if(window.snaptr) snaptr('track', 'CUSTOM_EVENT_1', Object.assign({ label: 'Lead' }, (extra||{}))); }catch(e){}
    }
  </script>
</head>

<body class="antialiased">
  <div class="app relative">

    <nav class="sticky top-0 z-40 glass-dark border-b border-white/10 px-4 py-3 flex justify-between items-center relative"
         style="padding-top: calc(0.75rem + env(safe-area-inset-top));">
      
      <button id="menuBtn" class="p-2 text-white active:scale-95 transition animate-menu-blink" aria-label="Menu">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <a href="#" onclick="goHome(event)" class="absolute left-1/2 -translate-x-1/2 flex items-center justify-center active:scale-95 transition p-2">
        <img src="https://www.mad-parfumeur.com/assets/hero/logo2.webp" class="h-6 sm:h-7 brightness-0 invert object-contain" alt="MAD Parfumeur" />
      </a>

      <button id="cartBtn" class="relative p-2 text-white active:scale-95 transition" aria-label="Cart">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <span id="cartCountBadge"
              class="absolute top-0 right-0 bg-[#C5A059] text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-black shadow">0</span>
      </button>
    </nav>

    <section class="bg-[#0A0A0A] pt-10 pb-16 px-5 text-center relative z-10 rounded-b-[2rem] shadow-sm">
      <h1 id="heroTitle" class="text-white text-3xl font-black mb-6 leading-tight">
        Ø¹Ø§Ù„Ù… Ù…Ù† <span class="text-[#C5A059]">Ø§Ù„ÙØ®Ø§Ù…Ø©</span>
      </h1>

      <div class="mx-auto max-w-md">
        <input id="search"
               class="w-full bg-white/10 border border-white/20 rounded-2xl px-4 py-3.5 text-white text-sm outline-none focus:border-[#C5A059] transition-colors"
               placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø·Ø±..."
               autocomplete="off" />
        <p id="searchHint" class="text-white/60 text-[11px] mt-3">Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø± Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯</p>
      </div>
    </section>

    <main class="px-3 pb-10 mt-6" style="padding-bottom: calc(6rem + env(safe-area-inset-bottom));">
      <h2 id="currentCategoryTitle" class="text-lg font-black text-gray-800 px-2 mb-4">Ø§Ù„ÙƒÙ„</h2>
      <div id="products" class="grid grid-cols-2 gap-3"></div>
    </main>

  </div>

  <button id="waFab" class="fab" aria-label="WhatsApp">
    <span id="waFabBadge" class="fab-badge">WA</span>
    <svg viewBox="0 0 32 32" width="26" height="26" fill="currentColor" aria-hidden="true">
      <path d="M19.11 17.49c-.27-.14-1.6-.79-1.85-.88-.25-.09-.43-.14-.61.14-.18.27-.7.88-.86 1.06-.16.18-.32.2-.59.07-.27-.14-1.14-.42-2.17-1.34-.8-.71-1.34-1.6-1.5-1.87-.16-.27-.02-.42.12-.56.13-.13.27-.32.41-.48.14-.16.18-.27.27-.45.09-.18.05-.34-.02-.48-.07-.14-.61-1.47-.84-2.01-.22-.53-.45-.46-.61-.47l-.52-.01c-.18 0-.48.07-.73.34-.25.27-.95.93-.95 2.27s.98 2.64 1.12 2.82c.14.18 1.93 2.95 4.67 4.13.65.28 1.15.45 1.54.57.65.21 1.24.18 1.7.11.52-.08 1.6-.65 1.82-1.28.23-.63.23-1.17.16-1.28-.07-.11-.25-.18-.52-.32zM16.01 5.33c-5.89 0-10.67 4.78-10.67 10.67 0 1.88.49 3.72 1.43 5.35L5.33 26.67l5.48-1.41c1.56.85 3.31 1.29 5.2 1.29 5.89 0 10.67-4.78 10.67-10.67S21.9 5.33 16.01 5.33zm0 19.21c-1.68 0-3.32-.45-4.75-1.3l-.34-.2-3.25.83.87-3.17-.22-.33c-.92-1.45-1.41-3.12-1.41-4.84 0-5.02 4.08-9.1 9.1-9.1s9.1 4.08 9.1 9.1-4.08 9.01-9.1 9.01z"></path>
    </svg>
  </button>

  <div id="menuOverlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-[100] transition-opacity duration-300 opacity-0"></div>
  <div id="menuDrawer" class="fixed top-0 right-0 bottom-0 w-64 bg-[#0A0A0A] z-[101] translate-x-full transition-transform duration-300 flex flex-col shadow-2xl border-l border-white/10">
    <div class="p-5 flex items-center justify-between border-b border-white/10" style="padding-top: calc(1.25rem + env(safe-area-inset-top));">
      <span class="text-white font-black text-lg">×›×œ ×”××•×¦×¨×™×</span>
      <button id="closeMenu" class="text-gray-400 text-2xl active:scale-95 transition" aria-label="Close Menu">âœ•</button>
    </div>
    <div class="flex-1 overflow-y-auto p-4 space-y-2 no-scrollbar" id="categoriesMenu"></div>
  </div>

  <div id="cartOverlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-[100] transition-opacity duration-300 opacity-0"></div>
  <div id="cartModal" class="fixed inset-4 sm:inset-auto sm:w-[440px] sm:top-1/2 sm:left-1/2 sm:-translate-x-1/2 sm:-translate-y-1/2 bg-white rounded-[2rem] z-[101] flex flex-col shadow-2xl transition-all duration-300 opacity-0 scale-95 pointer-events-none modal-container">
    
    <div class="px-5 py-4 border-b flex items-center justify-between shrink-0">
      <h3 id="cartTitle" class="text-lg font-black text-gray-900">Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
      
      <button id="closeCart" class="text-[#C5A059] text-xs font-black px-3 py-1.5 bg-[#C5A059]/10 hover:bg-[#C5A059]/20 rounded-xl active:scale-95 transition">
        Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª
      </button>
    </div>

    <div class="flex-1 overflow-y-auto px-4 py-4 space-y-3 bg-gray-50/50" id="cartItems"></div>

    <div class="p-5 bg-[#0A0A0A] text-white rounded-b-[2rem] shrink-0 border-t border-white/10">
      <div class="mb-4 space-y-2.5">
        <input id="custName"
               class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm outline-none focus:border-[#C5A059] focus:bg-white/10 transition-colors"
               placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
               autocomplete="name" />

        <input id="custPhone"
               class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm outline-none focus:border-[#C5A059] focus:bg-white/10 transition-colors"
               placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"
               inputmode="tel"
               autocomplete="tel" />

        <textarea id="custAddress"
                  class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm outline-none focus:border-[#C5A059] focus:bg-white/10 transition-colors"
                  rows="2"
                  placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                  autocomplete="street-address"></textarea>
      </div>

      <div class="mb-4 space-y-2">
        <div class="flex justify-between text-sm font-black text-gray-300">
          <span id="subLabel">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span>
          <span>â‚ª<span id="subtotal">0</span></span>
        </div>

        <div class="flex justify-between text-sm font-black text-gray-300">
          <span id="shipLabel">Ø§Ù„ØªÙˆØµÙŠÙ„</span>
          <span id="shippingDisplay" class="text-white">â‚ª50</span>
        </div>

        <div class="flex justify-between font-black text-lg pt-2 border-t border-white/10 mt-2">
          <span id="totalLabel">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
          <span class="text-[#C5A059]">â‚ª<span id="total">0</span></span>
        </div>
      </div>

      <button id="sendOrder"
              class="w-full bg-[#C5A059] text-black py-4 rounded-xl font-black text-sm uppercase tracking-widest flex items-center justify-center gap-2 hover:bg-[#d4b06a] active:scale-[0.98] transition">
        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
      </button>

      <p id="deliveryNote" class="text-[10px] text-white/50 mt-3 text-center">
        Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… â€” Ø³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
      </p>
    </div>
  </div>

  <div id="imageModal" class="fixed inset-0 bg-black/90 backdrop-blur-md hidden z-[150] transition-opacity duration-300 opacity-0 flex items-center justify-center p-4 cursor-zoom-out" onclick="closeImage()">
    <button class="absolute top-6 right-6 text-white bg-white/10 p-2 rounded-full backdrop-blur-md hover:bg-white/20 transition">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>
    <img id="enlargedImage" src="" class="max-w-full max-h-[85vh] object-contain rounded-2xl transition-transform duration-300 scale-95" alt="Enlarged">
  </div>

<script>
  /* =========================
     LANG (AUTO: AR / HE)
     ========================= */
  const I18N = {
    ar: {
      pageTitle: "MAD Parfumeur | Ø§Ù„Ù…ÙˆÙ‚Ø¹",
      heroTitleHTML: `Ø¹Ø§Ù„Ù… Ù…Ù† <span class="text-[#C5A059]">Ø§Ù„ÙØ®Ø§Ù…Ø©</span>`,
      searchPh: "Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø·Ø±...",
      searchHint: "Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ø·Ø± Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯",
      all: "Ø§Ù„ÙƒÙ„",
      cartTitle: "Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚",
      addProductsBtn: "Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª",
      namePh: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„",
      phonePh: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
      addrPh: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
      subLabel: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",
      shipLabel: "Ø§Ù„ØªÙˆØµÙŠÙ„",
      totalLabel: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
      codeLabel: "Ø§Ù„ÙƒÙˆØ¯",
      unitLabel: "Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø©",
      lineLabel: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",
      sendBtn: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
      deliveryNote: "Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… â€” Ø³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
      emptyCart: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©",
      loadFail: "ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
      noResults: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬",
      alertEmpty: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©",
      alertNeed: "ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ",
      addToCart: "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©",
      addMore: "Ø£Ø¶Ù Ø§Ù„Ù…Ø²ÙŠØ¯",
      waFabBadge: "Ù…Ø³Ø§Ø¹Ø¯Ø©",
      waFabMsg: "Ù…Ø±Ø­Ø¨Ø§ØŒ Ø¹Ù†Ø¯ÙŠ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø¹Ø·ÙˆØ±.",
      free: "Ù…Ø¬Ø§Ù†ÙŠ", // ÙƒÙ„Ù…Ø© Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
      wa: {
        header: "âœ¨ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ | MAD Parfumeur*",
        name: "ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…",
        phone: "ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ",
        addr: "ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
        cart: "ğŸ›’ Ø§Ù„Ø³Ù„Ø©",
        code: "ğŸ·ï¸ Ø§Ù„ÙƒÙˆØ¯ ",
        unit: "ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ù‚Ø·Ø¹Ø©",
        line: "ğŸ§¾ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø³Ø·Ø±",
        sub: "ğŸ§¾ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",
        ship: "ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„",
        total: "ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"
      }
    },
    he: {
      pageTitle: "MAD Parfumeur | ××ª×¨",
      heroTitleHTML: `×¢×•×œ× ×©×œ <span class="text-[#C5A059]">×™×•×§×¨×”</span>`,
      searchPh: "×—×™×¤×•×© ×‘×•×©×...",
      searchHint: "×”×§×œ×“ ×©× ×‘×•×©×",
      all: "×”×›×œ",
      cartTitle: "×¢×’×œ×ª ×§× ×™×•×ª",
      addProductsBtn: "×”×•×¡×£ ××•×¦×¨×™×",
      namePh: "×©× ××œ×",
      phonePh: "××¡×¤×¨ ×˜×œ×¤×•×Ÿ",
      addrPh: "×›×ª×•×‘×ª (××•×¤×¦×™×•× ×œ×™)",
      subLabel: "×¡×›×•× ×‘×™× ×™×™×",
      shipLabel: "××©×œ×•×—",
      totalLabel: "×¡×”×´×›",
      codeLabel: "×§×•×“",
      unitLabel: "××—×™×¨ ×™×—×™×“×”",
      lineLabel: "×¡×›×•×",
      sendBtn: "×©×œ×™×—×ª ×”×–×× ×” ×‘×•×•××˜×¡××¤",
      deliveryNote: "×ª×©×œ×•× ×‘×¢×ª ×”××¡×™×¨×” â€” × ×™×¦×•×¨ ×§×©×¨ ×‘×•×•××˜×¡××¤ ×œ××™×©×•×¨ ×¤×¨×˜×™×",
      emptyCart: "×”×¢×’×œ×” ×¨×™×§×”",
      loadFail: "×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ ××•×¦×¨×™×",
      noResults: "××™×Ÿ ×ª×•×¦××•×ª",
      alertEmpty: "×”×¢×’×œ×” ×¨×™×§×”",
      alertNeed: "× × ×œ××œ× ×©× ×•××¡×¤×¨ ×˜×œ×¤×•×Ÿ",
      addToCart: "×”×•×¡×£ ×œ×¢×’×œ×”",
      addMore: "×”×•×¡×£ ×¢×•×“",
      waFabBadge: "×¢×–×¨×”",
      waFabMsg: "×”×™×™, ×™×© ×œ×™ ×©××œ×” ×œ×’×‘×™ ×”×‘×©××™×.",
      free: "×—×™× ×", // ÙƒÙ„Ù…Ø© Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø¨Ø±ÙŠØ©
      wa: {
        header: "âœ¨ *×”×–×× ×” ×—×“×©×” | MAD Parfumeur*",
        name: "ğŸ‘¤ ×©×",
        phone: "ğŸ“ ×˜×œ×¤×•×Ÿ",
        addr: "ğŸ“ ×›×ª×•×‘×ª",
        cart: "ğŸ›’ ×¢×’×œ×”",
        code: "ğŸ·ï¸ ×§×•×“ ",
        unit: "ğŸ’µ ××—×™×¨ ×™×—×™×“×”",
        line: "ğŸ§¾ ×¡×”×´×› ×©×•×¨×”",
        sub: "ğŸ§¾ ×¡×›×•× ×‘×™× ×™×™×",
        ship: "ğŸšš ××©×œ×•×—",
        total: "ğŸ’° ×¡×”×´×›"
      }
    }
  };

  function detectLang(){
    const l = (navigator.language || navigator.userLanguage || "ar").toLowerCase();
    return l.startsWith("he") ? "he" : "ar";
  }

  let LANG = detectLang();
  let T = I18N[LANG] || I18N.ar;

  function applyLangUI(){
    document.documentElement.lang = LANG;
    document.documentElement.dir = "rtl";
    document.title = T.pageTitle;

    document.getElementById("heroTitle").innerHTML = T.heroTitleHTML;
    document.getElementById("search").placeholder = T.searchPh;
    document.getElementById("searchHint").textContent = T.searchHint;

    document.getElementById("cartTitle").textContent = T.cartTitle;
    document.getElementById("closeCart").textContent = T.addProductsBtn;
    document.getElementById("custName").placeholder = T.namePh;
    document.getElementById("custPhone").placeholder = T.phonePh;
    document.getElementById("custAddress").placeholder = T.addrPh;

    document.getElementById("subLabel").textContent = T.subLabel;
    document.getElementById("shipLabel").textContent = T.shipLabel;
    document.getElementById("totalLabel").textContent = T.totalLabel;
    document.getElementById("sendOrder").textContent = T.sendBtn;
    document.getElementById("deliveryNote").textContent = T.deliveryNote;
    document.getElementById("waFabBadge").textContent = T.waFabBadge;
  }

  /* =========================
     CONFIG
     ========================= */
  const WHATSAPP_API = "972524033442"; 
  const SHIPPING = 50;
  const RSS_PATH = "products.rss";

  const state = {
    products: [],
    filtered: [],
    currentCat: "ALL",
    cart: new Map(),  // feedId -> qty
    leadCartFired: false,
    leadOrderFired: false
  };

  // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù‚ØµÙ‡ Ø£Ùˆ ØªØ´ÙˆÙŠÙ‡Ù‡
  function chooseDisplayName({ mpn, sku, title, feedId }){
    if (title) return String(title).trim();
    if (mpn) return String(mpn).trim();
    if (sku) return String(sku).trim();
    return String(feedId || "").trim();
  }

  async function init() {
    applyLangUI();

    try {
      const res = await fetch(RSS_PATH + "?v=" + Date.now(), { cache: "no-store" });
      const xmlText = await res.text();
      const xml = new DOMParser().parseFromString(xmlText, "application/xml");

      state.products = Array.from(xml.querySelectorAll("item"))
        .map(i => {
          const getG = (t) => i.querySelector(t)?.textContent || i.querySelector(`g\\:${t}`)?.textContent || "";

          const feedId = (getG("id") || "").trim();
          const title  = (getG("title") || "").trim();
          const mpn    = (getG("mpn") || "").trim();
          const sku    = (getG("sku") || "").trim();

          const image  = (getG("image_link") || "").trim();
          const type   = (getG("product_type") || "General").trim();
          const price  = parseFloat((getG("price") || "").replace(/[^\d.]/g, "")) || 0;

          // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ù‡Ùˆ
          const realCode = chooseDisplayName({ mpn, sku, title, feedId });

          return { feedId, title, mpn, sku, realCode, image, type, price };
        })
        .filter(p => p.feedId && p.image);

      const urlParams = new URLSearchParams(window.location.search);
      const catFromUrl = urlParams.get("cat");
      
      if (catFromUrl) {
        state.currentCat = decodeURIComponent(catFromUrl);
      } else {
        const allCats = Array.from(new Set(state.products.map(p => p.type)));
        const offersCat = allCats.find(c => c.includes("××‘×¦×¢×™×") || c.includes("Ø¹Ø±ÙˆØ¶"));
        state.currentCat = offersCat || "ALL";
      }

      renderCategoriesMenu();
      applyFilter();
      bindEvents();
      updateCartUI();
    } catch (e) {
      console.error(e);
      document.getElementById("products").innerHTML =
        `<div class="col-span-2 text-center text-gray-500 font-bold py-10">${escapeHtml(T.loadFail)}</div>`;
    }
  }

  /* === HOME RESET === */
  window.goHome = (e) => {
    e.preventDefault();
    document.getElementById("search").value = "";
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø£Ùˆ Ø§Ù„ÙƒÙ„
    const allCats = Array.from(new Set(state.products.map(p => p.type)));
    const offersCat = allCats.find(c => c.includes("××‘×¦×¢×™×") || c.includes("Ø¹Ø±ÙˆØ¶"));
    state.currentCat = offersCat || "ALL";
    
    applyFilter();
    renderCategoriesMenu();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  function applyFilter() {
    const q = (document.getElementById("search").value || "").toLowerCase().trim();

    state.filtered = state.products.filter(p => {
      const okCat = (state.currentCat === "ALL" || p.type === state.currentCat);

      const t  = (p.title || "").toLowerCase();
      const c1 = (p.realCode || "").toLowerCase();
      const c2 = (p.feedId || "").toLowerCase();

      const okQ = !q ? true : (t.includes(q) || c1.includes(q) || c2.includes(q));
      return okCat && okQ;
    });

    document.getElementById("currentCategoryTitle").textContent = state.currentCat === "ALL" ? T.all : state.currentCat;
    
    renderProducts();
  }

  function renderCategoriesMenu() {
    const container = document.getElementById("categoriesMenu");
    const cats = ["ALL", ...new Set(state.products.map(p => p.type))];

    container.innerHTML = cats.map(c => `
      <button onclick="switchCat('${escapeQuotes(c)}')"
        class="w-full text-right px-4 py-3.5 rounded-xl font-black transition-all active:scale-[0.98]
        ${state.currentCat === c ? 'bg-[#C5A059] text-black shadow-md' : 'bg-white/5 text-gray-300 hover:bg-white/10'}">
        ${c === "ALL" ? escapeHtml(T.all) : escapeHtml(c)}
      </button>
    `).join("");
  }

  function renderProducts() {
    const container = document.getElementById("products");

    if (!state.filtered.length) {
      container.innerHTML = `
        <div class="col-span-2 text-center text-gray-400 font-bold py-10 bg-white rounded-2xl border border-gray-100">
          ${escapeHtml(T.noResults)}
        </div>`;
      return;
    }

    container.innerHTML = state.filtered.map(p => {
      const inCart = state.cart.has(p.feedId);

      return `
        <div class="product-card p-3 flex flex-col shadow-sm">
          <div class="aspect-square mb-2 bg-gray-50 rounded-2xl p-2 overflow-hidden relative">
            <img src="${p.image}" 
                 onclick="openImage('${p.image}')" 
                 class="w-full h-full object-contain mix-blend-multiply cursor-zoom-in hover:scale-105 transition-transform duration-300" 
                 loading="lazy" alt="MAD">
          </div>

          <p class="text-[11px] font-black text-gray-400 mb-3 clamp-1">${escapeHtml(p.type)}</p>

          <button onclick="addToCart('${escapeQuotes(p.feedId)}')"
            class="mt-auto w-full ${inCart ? 'bg-black text-white' : 'bg-gray-100 text-gray-800'} py-3 rounded-xl font-black text-xs active:scale-95 transition hover:bg-[#C5A059] hover:text-black">
            ${inCart ? escapeHtml(T.addMore) : escapeHtml(T.addToCart)}
          </button>
        </div>
      `;
    }).join("");
  }

  /* === MENU LOGIC === */
  function openMenu() {
    const overlay = document.getElementById("menuOverlay");
    const drawer = document.getElementById("menuDrawer");
    overlay.classList.remove("hidden");
    requestAnimationFrame(() => {
      overlay.classList.remove("opacity-0");
      drawer.classList.remove("translate-x-full");
    });
  }

  function closeMenu() {
    const overlay = document.getElementById("menuOverlay");
    const drawer = document.getElementById("menuDrawer");
    overlay.classList.add("opacity-0");
    drawer.classList.add("translate-x-full");
    setTimeout(() => overlay.classList.add("hidden"), 300);
  }

  window.switchCat = (c) => {
    state.currentCat = c;
    applyFilter();
    renderCategoriesMenu();
    closeMenu();
  };

  /* === CART LOGIC === */
  window.addToCart = (feedId) => {
    state.cart.set(feedId, (state.cart.get(feedId) || 0) + 1);
    updateCartUI();
    renderProducts();
    
    // ØªØ´ØºÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨Ø© Ù„Ø´Ø¯ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ø¨Ø¯ÙˆÙ† ÙØªØ­Ù‡Ø§
    const cartBtn = document.getElementById("cartBtn");
    cartBtn.classList.remove("animate-cart-pop");
    void cartBtn.offsetWidth; // Trigger reflow
    cartBtn.classList.add("animate-cart-pop");
    
    setTimeout(() => {
      cartBtn.classList.remove("animate-cart-pop");
    }, 400);
  };

  window.changeQty = (feedId, delta) => {
    const next = (state.cart.get(feedId) || 0) + delta;
    if (next <= 0) state.cart.delete(feedId);
    else state.cart.set(feedId, next);
    updateCartUI();
    renderProducts();
  };

  window.removeItem = (feedId) => {
    state.cart.delete(feedId);
    updateCartUI();
    renderProducts();
  };

  function calcTotals(){
    let subtotal = 0;
    let totalQty = 0;

    state.cart.forEach((qty, feedId) => {
      const p = state.products.find(x => x.feedId === feedId);
      if (!p) return;
      totalQty += qty;
      subtotal += (Number(p.price || 0) * qty);
    });

    // Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø· Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ Ù‡Ù†Ø§
    const currentShipping = (subtotal >= 500) ? 0 : SHIPPING;
    const total = totalQty > 0 ? (subtotal + currentShipping) : 0;
    
    return { subtotal, total, totalQty, currentShipping };
  }

  function updateCartUI() {
    const container = document.getElementById("cartItems");
    const badge = document.getElementById("cartCountBadge");

    const { subtotal, total, totalQty, currentShipping } = calcTotals();

    badge.textContent = totalQty;
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ ÙƒÙ…Ø¬Ø§Ù†ÙŠ Ø¥Ø°Ø§ ØªÙˆÙØ± Ø§Ù„Ø´Ø±Ø·
    if (currentShipping === 0) {
      document.getElementById("shippingDisplay").innerHTML = `<span class="text-[#C5A059] font-black">${T.free}</span>`;
    } else {
      document.getElementById("shippingDisplay").textContent = `â‚ª${currentShipping}`;
    }

    document.getElementById("subtotal").textContent = Number(subtotal).toFixed(0);
    document.getElementById("total").textContent = Number(total).toFixed(0);

    let html = "";

    state.cart.forEach((qty, feedId) => {
      const p = state.products.find(x => x.feedId === feedId);
      if (!p) return;

      const code = p.realCode || p.title || p.feedId; 
      const unit = Number(p.price || 0);
      const line = unit * qty;

      html += `
        <div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm">
          <div class="flex items-center gap-3">
            <div class="w-16 h-16 bg-gray-50 rounded-xl p-1 shrink-0">
              <img src="${p.image}" class="w-full h-full object-contain mix-blend-multiply" alt="MAD">
            </div>

            <div class="flex-1 min-w-0">
              <p class="font-black text-[13px] text-gray-800 leading-tight clamp-2">${escapeHtml(code)}</p>
              <p class="text-[10px] font-black text-gray-400 mt-1 clamp-1">${escapeHtml(p.type)}</p>

              <div class="flex items-center justify-between mt-3">
                <div class="text-[11px] font-black text-gray-600 bg-gray-50 px-2 py-1 rounded-md">
                  <span class="text-[#C5A059]">â‚ª${unit.toFixed(0)}</span>
                </div>
                
                <div class="flex items-center gap-3">
                  <button onclick="changeQty('${escapeQuotes(feedId)}', -1)"
                    class="w-7 h-7 rounded-lg bg-gray-50 hover:bg-gray-100 flex items-center justify-center font-black text-gray-700 transition">-</button>
                  <span class="text-sm font-black w-4 text-center">${qty}</span>
                  <button onclick="changeQty('${escapeQuotes(feedId)}', 1)"
                    class="w-7 h-7 rounded-lg bg-gray-50 hover:bg-gray-100 flex items-center justify-center font-black text-gray-700 transition">+</button>
                </div>
              </div>
            </div>

            <button onclick="removeItem('${escapeQuotes(feedId)}')"
              class="text-gray-300 text-xl px-2 active:scale-95 transition" aria-label="Remove">âœ•</button>
          </div>
        </div>
      `;
    });

    container.innerHTML = html || `
      <div class="flex flex-col items-center justify-center py-10 opacity-60">
        <svg class="w-16 h-16 text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
        <p class="text-gray-500 font-bold">${escapeHtml(T.emptyCart)}</p>
      </div>`;
  }

  function openCart() {
    const overlay = document.getElementById("cartOverlay");
    const modal = document.getElementById("cartModal");
    
    overlay.classList.remove("hidden");
    requestAnimationFrame(() => {
      overlay.classList.remove("opacity-0");
      modal.classList.remove("opacity-0", "scale-95", "pointer-events-none");
    });

    if (!state.leadCartFired && state.cart.size > 0) {
      state.leadCartFired = true;
      fireLeadEvent({ source: "cart_open" });
    }
  }

  function closeCart() {
    const overlay = document.getElementById("cartOverlay");
    const modal = document.getElementById("cartModal");
    
    overlay.classList.add("opacity-0");
    modal.classList.add("opacity-0", "scale-95", "pointer-events-none");
    
    setTimeout(() => overlay.classList.add("hidden"), 300);
  }

  /* === IMAGE ZOOM LOGIC === */
  window.openImage = (src) => {
    const modal = document.getElementById("imageModal");
    const img = document.getElementById("enlargedImage");
    img.src = src;
    modal.classList.remove("hidden");
    requestAnimationFrame(() => {
      modal.classList.remove("opacity-0");
      img.classList.remove("scale-95");
    });
  };

  window.closeImage = () => {
    const modal = document.getElementById("imageModal");
    const img = document.getElementById("enlargedImage");
    modal.classList.add("opacity-0");
    img.classList.add("scale-95");
    setTimeout(() => modal.classList.add("hidden"), 300);
  };

  /* === WHATSAPP HELP LOGIC === */
  function openWhatsAppHelp(){
    const text = (I18N[LANG] || I18N.ar).waFabMsg || "";
    window.open(`https://wa.me/${WHATSAPP_API}?text=${encodeURIComponent(text)}`, "_blank");
  }

  function sendWhatsApp() {
    const name = document.getElementById("custName").value.trim();
    const phone = document.getElementById("custPhone").value.trim();
    const addr = document.getElementById("custAddress").value.trim();

    if (state.cart.size === 0) return alert(T.alertEmpty);
    if (!name || !phone) return alert(T.alertNeed);

    const { subtotal, total, currentShipping } = calcTotals();

    let msg = `${T.wa.header}\n`;
    msg += `${T.wa.name}: ${name}\n`;
    msg += `${T.wa.phone}: ${phone}\n`;
    if (addr) msg += `${T.wa.addr}: ${addr}\n`;
    msg += `â”â”â”â”â”â”â”â”â”â”â”â”\n${T.wa.cart}:\n`;

    state.cart.forEach((qty, feedId) => {
      const p = state.products.find(x => x.feedId === feedId);
      if (!p) return;

      const code = p.realCode || p.title || p.feedId; 
      const unit = Number(p.price || 0);
      const line = unit * qty;

      msg += `â–ªï¸ ${code}\n`;
      msg += `   ${T.wa.unit}: â‚ª${unit.toFixed(0)} | x${qty} | ${T.wa.line}: â‚ª${line.toFixed(0)}\n`;
      msg += `   ${p.type}\n`;
    });

    msg += `â”â”â”â”â”â”â”â”â”â”â”â”\n${T.wa.sub}: â‚ª${subtotal.toFixed(0)}\n`;
    // ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ø¥Ø°Ø§ ØªÙˆÙØ± Ø§Ù„Ø´Ø±Ø· ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
    msg += `${T.wa.ship}: ${currentShipping === 0 ? T.free : 'â‚ª' + currentShipping}\n`;
    msg += `${T.wa.total}: â‚ª${total.toFixed(0)}`;

    if (!state.leadOrderFired) {
      state.leadOrderFired = true;
      fireLeadEvent({ source: "whatsapp_order", value: total, currency: "ILS" });
    }

    setTimeout(() => {
      window.open(`https://wa.me/${WHATSAPP_API}?text=${encodeURIComponent(msg)}`, "_blank");
    }, 120);
  }

  function bindEvents() {
    // Cart Events
    document.getElementById("cartBtn").onclick = openCart;
    document.getElementById("closeCart").onclick = closeCart;
    document.getElementById("cartOverlay").onclick = closeCart;
    document.getElementById("sendOrder").onclick = sendWhatsApp;
    
    // Menu Events
    document.getElementById("menuBtn").onclick = openMenu;
    document.getElementById("closeMenu").onclick = closeMenu;
    document.getElementById("menuOverlay").onclick = closeMenu;

    // Search Event
    document.getElementById("search").oninput = applyFilter;

    // WhatsApp Help Event
    document.getElementById("waFab").onclick = openWhatsAppHelp;

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeCart();
        closeMenu();
        closeImage();
      }
    });
  }

  function escapeHtml(str){
    return String(str || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function escapeQuotes(str){
    return String(str || "").replaceAll("\\","\\\\").replaceAll("'","\\'");
  }

  init();
</script>

</body>
</html>
