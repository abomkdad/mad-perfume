<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAD - Ø¨Ø§Ù‚Ø© Ù…Ø®ØªØ§Ø±Ø©</title>

  <!-- OG preview (ÙŠØ¹Ø±Ø¶ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· - Ø·Ø¨ÙŠØ¹ÙŠ Ø¨ÙˆØ§ØªØ³Ø§Ø¨) -->
  <meta property="og:title" content="MAD - Ø¨Ø§Ù‚Ø© Ù…Ø®ØªØ§Ø±Ø©" />
  <meta property="og:description" content="Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙˆØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://www.mad-parfumeur.com/assets/hero/1.webp" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#f6f7f9; }
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.75); }
    .shadow-soft { box-shadow: 0 10px 30px rgba(0,0,0,.08); }
    .card { transition: .15s transform; }
    .card:hover { transform: scale(1.02); }
    .danger { background:#dc2626; }
    .danger:hover { background:#b91c1c; }
  </style>
</head>

<body class="min-h-screen">

  <!-- Header -->
  <div class="sticky top-0 z-30 border-b bg-white/80 glass">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <img src="https://www.mad-parfumeur.com/assets/hero/logo.png" class="h-10 w-10 rounded-xl object-contain bg-white border" alt="MAD">
        <div>
          <div class="font-black text-lg" id="t_title">MAD - Ø¨Ø§Ù‚Ø© Ù…Ø®ØªØ§Ø±Ø©</div>
          <div class="text-xs text-gray-600" id="t_sub">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙˆØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</div>
        </div>
      </div>
      <button id="langBtn" class="px-4 py-2 rounded-xl bg-black text-white text-sm shadow-soft">Ø¹Ø±Ø¨ÙŠ / ×¢×‘×¨×™×ª</button>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 py-6 pb-24">

    <!-- Top Info + Actions -->
    <div class="bg-white rounded-3xl shadow-soft border p-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div class="rounded-2xl border p-3 bg-gray-50">
          <div class="text-xs text-gray-500" id="t_wa">WhatsApp</div>
          <div class="font-black text-lg" id="waBox">â€”</div>
        </div>

        <div class="rounded-2xl border p-3 bg-gray-50">
          <div class="text-xs text-gray-500" id="t_status">Status</div>
          <div class="font-bold" id="statusBox">Loadingâ€¦</div>
        </div>

        <div class="rounded-2xl border p-3 bg-gray-50">
          <div class="text-xs text-gray-500" id="t_products">Products</div>
          <div class="font-black text-lg"><span id="countBox">0</span></div>
        </div>
      </div>

      <div class="mt-4 flex flex-col md:flex-row gap-2 md:items-center md:justify-between">
        <div class="text-xs text-gray-500" id="notePreview">
          Ù…Ù„Ø§Ø­Ø¸Ø©: ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ¹Ø±Ø¶ Preview ÙˆØ§Ø­Ø¯ Ù„Ù„ØµÙØ­Ø© ÙÙ‚Ø· â€” Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© Ø³ØªØ¸Ù‡Ø± ÙƒÙ„ Ø§Ù„ØµÙˆØ±.
        </div>

        <div class="flex gap-2">
          <button id="copyTextBtn" class="px-4 py-3 rounded-2xl bg-gray-900 text-white font-bold">
            <span id="t_copy">Ù†Ø³Ø® Ù†Øµ Ø§Ù„Ø·Ù„Ø¨</span>
          </button>
          <button id="sendBtnTop" class="px-4 py-3 rounded-2xl bg-green-600 text-white font-black">
            <span id="t_send">Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Products -->
    <div class="mt-5">
      <div class="font-black mb-3" id="t_selected_products">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</div>
      <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
      <div id="emptyState" class="hidden mt-4 p-6 rounded-3xl bg-white border shadow-soft text-center text-gray-700">
        <div class="font-black text-lg" id="t_empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø©</div>
        <div class="text-sm text-gray-500 mt-1" id="t_empty2">Ø§Ø±Ø¬Ø¹ Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙˆØ£Ù†Ø´Ø¦ Ø¨Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©.</div>
      </div>
    </div>

    <!-- Order Form -->
    <div class="mt-6 bg-white rounded-3xl shadow-soft border p-4">
      <div class="font-black text-lg mb-2" id="t_form_title">ÙÙˆØ±Ù… Ø§Ù„Ø·Ù„Ø¨</div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <div class="text-xs text-gray-500 mb-1" id="t_name">Ø§Ù„Ø§Ø³Ù…</div>
          <input id="custName" class="w-full border rounded-2xl p-3" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" />
        </div>
        <div>
          <div class="text-xs text-gray-500 mb-1" id="t_phone">Ø§Ù„ØªÙ„ÙÙˆÙ†</div>
          <input id="custPhone" class="w-full border rounded-2xl p-3" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙÙˆÙ†" inputmode="tel" />
        </div>
      </div>

      <div class="mt-3">
        <div class="text-xs text-gray-500 mb-1" id="t_address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div>
        <textarea id="custAddress" class="w-full border rounded-2xl p-3" rows="3" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„"></textarea>
      </div>

      <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
        <div class="rounded-2xl border p-3 bg-gray-50">
          <div class="text-sm font-bold mb-2" id="t_pay">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
          <label class="flex items-center gap-2 text-sm"><input type="radio" name="pay" value="COD" checked> <span id="t_cod">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span></label>
          <label class="flex items-center gap-2 text-sm mt-2"><input type="radio" name="pay" value="CARD"> <span id="t_card">Ø¨Ø·Ø§Ù‚Ø© / ØªØ­ÙˆÙŠÙ„</span></label>
        </div>

        <div class="rounded-2xl border p-3 bg-white">
          <div class="flex items-center justify-between text-sm">
            <span id="t_subtotal">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
            <span class="font-black">â‚ª<span id="subtotal">0</span></span>
          </div>
          <div class="flex items-center justify-between text-sm mt-2">
            <span id="t_ship">Ø§Ù„ØªÙˆØµÙŠÙ„</span>
            <span class="font-black">â‚ª<span id="shipping">50</span></span>
          </div>
          <div class="h-px bg-gray-200 my-3"></div>
          <div class="flex items-center justify-between text-base">
            <span class="font-black" id="t_total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
            <span class="font-black text-lg">â‚ª<span id="total">50</span></span>
          </div>
        </div>
      </div>

      <button id="sendBtn" class="mt-4 w-full px-4 py-4 rounded-2xl bg-green-600 text-white font-black shadow-soft">
        <span id="t_send2">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span>
      </button>
    </div>

  </div>

<script>
/* =========================
   CONFIG
========================= */
const RSS_PATH = "products.rss";
const DELIVERY_FEE = 50;
const DEFAULT_WA = "972524033442";

/* =========================
   STATE
========================= */
let LANG = (navigator.language || "").toLowerCase().includes("he") ? "he" : "ar";
let IDS = [];            // selected ids from query
let PRODUCTS = [];       // all products from rss
let SELECTED = [];       // selected products objects
let WA = DEFAULT_WA;

/* =========================
   I18N
========================= */
function T(ar, he){ return (LANG==="he") ? he : ar; }

function setTexts(){
  document.documentElement.lang = LANG;
  document.documentElement.dir  = (LANG==="he") ? "ltr" : "rtl";

  document.getElementById("t_title").textContent = T("MAD - Ø¨Ø§Ù‚Ø© Ù…Ø®ØªØ§Ø±Ø©","MAD - ×××¨×– ××•×¦×¨×™×");
  document.getElementById("t_sub").textContent   = T("Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙˆØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨","×‘×—×¨ ××•×¦×¨×™× ×•×©×™×œ×—×• ×‘×•×•××˜×¡××¤");
  document.getElementById("t_wa").textContent = "WhatsApp";
  document.getElementById("t_status").textContent = "Status";
  document.getElementById("t_products").textContent = T("Products","××•×¦×¨×™×");
  document.getElementById("notePreview").textContent = T(
    "Ù…Ù„Ø§Ø­Ø¸Ø©: ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ¹Ø±Ø¶ Preview ÙˆØ§Ø­Ø¯ Ù„Ù„ØµÙØ­Ø© ÙÙ‚Ø· â€” Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© Ø³ØªØ¸Ù‡Ø± ÙƒÙ„ Ø§Ù„ØµÙˆØ±.",
    "×”×¢×¨×”: ×•×•××˜×¡××¤ ××¦×™×’ Preview ××—×“ ×‘×œ×‘×“ â€” ×‘×ª×•×š ×”×“×£ ×ª×•×¤×¢× ×” ×›×œ ×”×ª××•× ×•×ª."
  );
  document.getElementById("t_copy").textContent = T("Ù†Ø³Ø® Ù†Øµ Ø§Ù„Ø·Ù„Ø¨","×”×¢×ª×§ ×˜×§×¡×˜ ×”×–×× ×”");
  document.getElementById("t_send").textContent = T("Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨","×”×–×× ×” ×‘×•×•××˜×¡××¤");
  document.getElementById("t_selected_products").textContent = T("Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©","××•×¦×¨×™× ×©× ×‘×—×¨×•");
  document.getElementById("t_empty").textContent = T("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø©","××™×Ÿ ××•×¦×¨×™× ×‘×××¨×–");
  document.getElementById("t_empty2").textContent = T("Ø§Ø±Ø¬Ø¹ Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙˆØ£Ù†Ø´Ø¦ Ø¨Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©.","×—×–×•×¨ ×œ×¢××•×“ ×”×‘×—×™×¨×” ×•×¦×•×¨ ×××¨×– ×—×“×©.");

  document.getElementById("t_form_title").textContent = T("ÙÙˆØ±Ù… Ø§Ù„Ø·Ù„Ø¨","×˜×•×¤×¡ ×”×–×× ×”");
  document.getElementById("t_name").textContent = T("Ø§Ù„Ø§Ø³Ù…","×©×");
  document.getElementById("custName").placeholder = T("Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„","×©× ××œ×");
  document.getElementById("t_phone").textContent = T("Ø§Ù„ØªÙ„ÙÙˆÙ†","×˜×œ×¤×•×Ÿ");
  document.getElementById("custPhone").placeholder = T("Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙÙˆÙ†","××¡×¤×¨ ×˜×œ×¤×•×Ÿ");
  document.getElementById("t_address").textContent = T("Ø§Ù„Ø¹Ù†ÙˆØ§Ù†","×›×ª×•×‘×ª");
  document.getElementById("custAddress").placeholder = T("Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„","×›×ª×•×‘×ª ××œ××”");

  document.getElementById("t_pay").textContent = T("Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹","×××¦×¢×™ ×ª×©×œ×•×");
  document.getElementById("t_cod").textContent = T("Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…","×ª×©×œ×•× ×‘×¢×ª ××¡×™×¨×”");
  document.getElementById("t_card").textContent = T("Ø¨Ø·Ø§Ù‚Ø© / ØªØ­ÙˆÙŠÙ„","×›×¨×˜×™×¡ / ×”×¢×‘×¨×”");

  document.getElementById("t_subtotal").textContent = T("Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ","×¡×›×•× ×‘×™× ×™×™×");
  document.getElementById("t_ship").textContent = T("Ø§Ù„ØªÙˆØµÙŠÙ„","××©×œ×•×—");
  document.getElementById("t_total").textContent = T("Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ","×¡×”×´×›");

  document.getElementById("t_send2").textContent = T("Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨","×©×œ×— ×”×–×× ×” ×‘×•×•××˜×¡××¤");
}

/* =========================
   URL / QUERY
========================= */
function qs(name){
  const u = new URL(location.href);
  return u.searchParams.get(name) || "";
}
function normalizeWa(v){ return (v||"").toString().replace(/\D/g,"").trim(); }

function updateUrlFromIds(){
  const u = new URL(location.href);
  u.searchParams.set("ids", IDS.join(","));
  u.searchParams.set("lang", LANG);
  u.searchParams.set("wa", WA);
  history.replaceState({}, "", u.toString());
}

function readQuery(){
  const idsRaw = (qs("ids") || "").trim();
  IDS = idsRaw ? idsRaw.split(",").map(s=>s.trim()).filter(Boolean) : [];
  const langQ = (qs("lang") || "").toLowerCase();
  if(langQ === "ar" || langQ === "he") LANG = langQ;
  WA = normalizeWa(qs("wa")) || DEFAULT_WA;
  document.getElementById("waBox").textContent = WA;
}

/* =========================
   RSS PARSE
========================= */
function getTextByLocalName(parent, localName){
  const nodes = parent.getElementsByTagName("*");
  const target = localName.toLowerCase();
  for (let i=0;i<nodes.length;i++){
    const ln = (nodes[i].localName || "").toLowerCase();
    if (ln === target) return (nodes[i].textContent || "").trim();
  }
  return "";
}
function parsePrice(priceText){
  if(!priceText) return 0;
  const n = parseFloat(String(priceText).replace(/[^\d.]/g,""));
  return isNaN(n) ? 0 : n;
}

async function loadRSS(){
  const statusBox = document.getElementById("statusBox");
  statusBox.textContent = "Loading RSSâ€¦";
  try{
    const res = await fetch(RSS_PATH, { cache:"no-store" });
    if(!res.ok) throw new Error("HTTP " + res.status);
    const text = await res.text();
    const xml = new DOMParser().parseFromString(text, "application/xml");
    const err = xml.getElementsByTagName("parsererror");
    if(err && err.length) throw new Error("XML parse error");

    const items = Array.from(xml.getElementsByTagName("item"));
    PRODUCTS = items.map(item=>{
      const priceRaw = getTextByLocalName(item, "price") || getTextByLocalName(item, "sale_price") || "";
      return {
        id: getTextByLocalName(item,"id"),
        title: getTextByLocalName(item,"title"),
        image: getTextByLocalName(item,"image_link"),
        link: getTextByLocalName(item,"link"),
        price_raw: priceRaw,
        price: parsePrice(priceRaw)
      };
    }).filter(p=>p.id && p.title);

    rebuildSelected();
    statusBox.textContent = `OK âœ… Loaded bundle: ${IDS.length}`;
  }catch(e){
    console.error(e);
    document.getElementById("statusBox").textContent = "Failed âŒ";
    alert("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ products.rss\n" + e.message);
  }
}

function rebuildSelected(){
  const map = new Map(PRODUCTS.map(p=>[p.id,p]));
  SELECTED = IDS.map(id => map.get(id)).filter(Boolean);
  document.getElementById("countBox").textContent = String(SELECTED.length);

  if(SELECTED.length === 0){
    document.getElementById("productsGrid").innerHTML = "";
    document.getElementById("emptyState").classList.remove("hidden");
  }else{
    document.getElementById("emptyState").classList.add("hidden");
    renderProducts();
  }

  renderTotals();
  updateUrlFromIds();
}

/* =========================
   RENDER
========================= */
function renderProducts(){
  const grid = document.getElementById("productsGrid");
  grid.innerHTML = "";

  SELECTED.forEach(p=>{
    const card = document.createElement("div");
    card.className = "card bg-white rounded-3xl shadow-soft border overflow-hidden relative";

    card.innerHTML = `
      <div class="bg-gray-50">
        <img src="${esc(p.image)}" class="w-full h-44 object-contain" alt="">
      </div>

      <div class="p-3">
        <div class="text-center font-black">${esc(p.id)}</div>

        <div class="mt-2 flex gap-2">
          <a class="w-full px-3 py-3 rounded-2xl bg-black text-white font-bold text-sm text-center"
             href="${esc(p.link)}" target="_blank">
            ${esc(T("Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬","×§×™×©×•×¨ ×œ××•×¦×¨"))}
          </a>

          <button class="px-3 py-3 rounded-2xl danger text-white font-black text-sm"
                  data-remove="${esc(p.id)}">
            ${esc(T("Ø­Ø°Ù","××—×§"))}
          </button>
        </div>

        <div class="mt-2 text-center text-sm font-black">
          â‚ª${(p.price||0).toFixed(0)}
        </div>
      </div>
    `;

    card.querySelector(`[data-remove="${CSS.escape(p.id)}"]`).onclick = ()=>{
      removeProduct(p.id);
    };

    grid.appendChild(card);
  });
}

function removeProduct(id){
  IDS = IDS.filter(x => x !== id);
  rebuildSelected();
}

/* =========================
   TOTALS
========================= */
function calcSubtotal(){
  let sum = 0;
  for(const p of SELECTED) sum += (p.price||0);
  return sum;
}
function renderTotals(){
  const sub = calcSubtotal();
  document.getElementById("subtotal").textContent = sub.toFixed(0);
  document.getElementById("shipping").textContent = DELIVERY_FEE.toFixed(0);
  document.getElementById("total").textContent = (sub + DELIVERY_FEE).toFixed(0);
}

/* =========================
   ORDER TEXT + SEND
========================= */
function getPay(){
  const el = document.querySelector('input[name="pay"]:checked');
  return el ? el.value : "COD";
}

function buildBundleUrl(){
  const base = location.origin + location.pathname.replace(/[^/]+$/, "") + "bundle.html";
  const idsParam = encodeURIComponent(IDS.join(","));
  return `${base}?ids=${idsParam}&lang=${encodeURIComponent(LANG)}&wa=${encodeURIComponent(WA)}`;
}

function buildOrderText(){
  const name = (document.getElementById("custName").value || "").trim();
  const phone = (document.getElementById("custPhone").value || "").trim();
  const addr = (document.getElementById("custAddress").value || "").trim();
  const pay = getPay();

  if(!name || !phone || !addr){
    return { ok:false, text:"" };
  }

  const payTxt = (pay==="COD")
    ? T("Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…","×ª×©×œ×•× ×‘×¢×ª ××¡×™×¨×”")
    : T("Ø¨Ø·Ø§Ù‚Ø©/ØªØ­ÙˆÙŠÙ„","×›×¨×˜×™×¡/×”×¢×‘×¨×”");

  const sub = calcSubtotal();
  const total = sub + DELIVERY_FEE;

  let msg = T("ğŸ›’ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯\n","ğŸ›’ ×”×–×× ×” ×—×“×©×”\n");
  msg += "----------------------\n";
  msg += T(`ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\n`,`ğŸ‘¤ ×©×: ${name}\n`);
  msg += T(`ğŸ“ Ø§Ù„ØªÙ„ÙÙˆÙ†: ${phone}\n`,`ğŸ“ ×˜×œ×¤×•×Ÿ: ${phone}\n`);
  msg += T(`ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addr}\n`,`ğŸ“ ×›×ª×•×‘×ª: ${addr}\n`);
  msg += T(`ğŸ’³ Ø§Ù„Ø¯ÙØ¹: ${payTxt}\n`,`ğŸ’³ ×ª×©×œ×•×: ${payTxt}\n`);
  msg += "----------------------\n";
  msg += T("ğŸ§¾ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:\n","ğŸ§¾ ××•×¦×¨×™×:\n");

  SELECTED.forEach(p=>{
    msg += `â€¢ ${p.title} â€” â‚ª${(p.price||0).toFixed(0)}\n`;
  });

  msg += "----------------------\n";
  msg += T(`Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ: â‚ª${sub.toFixed(0)}\n`,`×¡×›×•× ×‘×™× ×™×™×: â‚ª${sub.toFixed(0)}\n`);
  msg += T(`Ø§Ù„ØªÙˆØµÙŠÙ„: â‚ª${DELIVERY_FEE}\n`,`××©×œ×•×—: â‚ª${DELIVERY_FEE}\n`);
  msg += T(`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: â‚ª${total.toFixed(0)}\n`,`×¡×”×´×›: â‚ª${total.toFixed(0)}\n`);
  msg += "----------------------\n";
  msg += T("ğŸ“¦ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø§Ù‚Ø©:\n","ğŸ“¦ ×§×™×©×•×¨ ×œ×××¨×–:\n");
  msg += buildBundleUrl();

  return { ok:true, text:msg };
}

async function copyOrderText(){
  if(IDS.length===0) return alert(T("Ø§Ù„Ø¨Ø§Ù‚Ø© ÙØ§Ø±ØºØ©","×”×××¨×– ×¨×™×§"));
  const data = buildOrderText();
  if(!data.ok){
    alert(T("Ø§Ù…Ù„Ø£ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØªÙ„ÙÙˆÙ† ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†","××œ× ×©×, ×˜×œ×¤×•×Ÿ ×•×›×ª×•×‘×ª"));
    return;
  }
  try{
    await navigator.clipboard.writeText(data.text);
    alert(T("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ âœ…","×”×˜×§×¡×˜ ×”×•×¢×ª×§ âœ…"));
  }catch{
    alert(T("Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§","×”×¢×ª×§ ×™×“× ×™×ª"));
  }
}

function sendWhatsApp(){
  if(IDS.length===0) return alert(T("Ø§Ù„Ø¨Ø§Ù‚Ø© ÙØ§Ø±ØºØ©","×”×××¨×– ×¨×™×§"));
  const data = buildOrderText();
  if(!data.ok){
    alert(T("Ø§Ù…Ù„Ø£ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØªÙ„ÙÙˆÙ† ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†","××œ× ×©×, ×˜×œ×¤×•×Ÿ ×•×›×ª×•×‘×ª"));
    return;
  }
  window.open(`https://wa.me/${WA}?text=${encodeURIComponent(data.text)}`, "_blank");
}

/* =========================
   UTILS
========================= */
function esc(s){
  return (s||"").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
}

/* =========================
   EVENTS / INIT
========================= */
document.getElementById("langBtn").onclick = ()=>{
  LANG = (LANG==="ar") ? "he" : "ar";
  setTexts();
  rebuildSelected();
};

document.getElementById("copyTextBtn").onclick = copyOrderText;
document.getElementById("sendBtn").onclick = sendWhatsApp;
document.getElementById("sendBtnTop").onclick = sendWhatsApp;

(function init(){
  readQuery();
  setTexts();
  loadRSS();
})();
</script>

</body>
</html>
