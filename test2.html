<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MAD PARFUMEUR | Premium Experience</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Assistant:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
    --gold: #D4AF37;
    --gold-glow: rgba(212, 175, 55, 0.5);
    --black: #0a0a0a;
    --card-bg: #141414;
    --wa-green: #25D366;
    --sky-blue: #4db8ff;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
    background-color: var(--black); 
    background-image: radial-gradient(circle at center, #1a1a1a 0%, #0a0a0a 100%);
    color: #fff; 
    font-family: 'Assistant', sans-serif; 
    opacity: 0; transition: opacity 0.5s;
}

/* Header & Top Branding */
header {
    text-align: center;
    padding: 30px 20px;
    background: linear-gradient(to bottom, #1a1a1a, transparent);
}
.brand-nav { display: flex; align-items: center; justify-content: flex-start; gap: 15px; margin-bottom: 20px; }
.logo-circle { width: 45px; height: 45px; border-radius: 50%; border: 1px solid var(--gold); display: flex; align-items: center; justify-content: center; background: #000; }
.logo-circle img { width: 30px; }
.brand-name-top { font-family: 'Cinzel'; font-size: 1.1rem; letter-spacing: 1px; color: #eee; }

/* Duty Officer Banner */
.duty-banner {
    border: 2px solid var(--gold);
    border-radius: 20px;
    margin: 15px;
    padding: 15px;
    background: rgba(20, 20, 20, 0.8);
    position: relative;
    box-shadow: 0 0 15px var(--gold-glow);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
.gift-icon { position: absolute; top: -20px; right: 10px; width: 50px; }

/* Product Horizontal Card */
.product-card {
    background: var(--card-bg);
    border: 1px solid #333;
    border-radius: 20px;
    margin: 15px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    position: relative;
    transition: 0.3s;
}
.product-card:hover { border-color: var(--gold); box-shadow: 0 0 20px var(--gold-glow); }

.card-top { display: flex; justify-content: space-between; align-items: flex-start; }
.product-title { font-family: 'Cinzel'; color: var(--gold); font-size: 1.2rem; margin-bottom: 5px; }
.product-status { font-size: 0.8rem; color: var(--wa-green); display: flex; align-items: center; gap: 5px; }

.card-content { display: flex; gap: 20px; align-items: center; }
.img-container {
    width: 100px; height: 100px;
    border-radius: 50%;
    border: 2px solid var(--gold);
    padding: 5px; background: #000;
    overflow: hidden;
}
.img-container img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }

.action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
.btn {
    padding: 12px; border-radius: 12px; border: none;
    font-weight: 700; font-size: 0.9rem; text-decoration: none;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    color: #fff; cursor: pointer;
}
.btn-wa { background-color: var(--wa-green); }
.btn-blue { background-color: var(--sky-blue); }
.btn-dark { background-color: #333; }

/* Sale Popup Image Overlay */
#popup-sale {
    position: fixed; inset: 0; background: rgba(0,0,0,0.95);
    display: none; align-items: center; justify-content: center; z-index: 10000;
}
.sale-inner {
    width: 90%; max-width: 380px;
    border: 2px solid var(--gold); border-radius: 25px;
    overflow: hidden; background: #000; text-align: center;
}
.countdown-txt { background: var(--gold); color: #000; padding: 10px; font-weight: 900; font-size: 1.5rem; }

/* Floating Widget */
#reopen-btn {
    position: fixed; bottom: 20px; left: 20px;
    width: 60px; height: 60px; background: var(--gold);
    border-radius: 50%; display: none; align-items: center; justify-content: center;
    box-shadow: 0 0 20px var(--gold-glow); z-index: 999; animation: bounce 2s infinite;
}
@keyframes bounce { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }

.cats-nav { display: flex; gap: 10px; overflow-x: auto; padding: 10px 15px; scrollbar-width: none; }
.cats-nav button { background: #222; border: 1px solid #444; color: #fff; padding: 8px 20px; border-radius: 50px; white-space: nowrap; }
.cats-nav button.active { background: var(--gold); color: #000; border-color: var(--gold); }
</style>
</head>

<body dir="rtl">

<header>
    <div class="brand-nav">
        <div class="logo-circle"><img src="logo.png"></div>
        <div class="brand-name-top">MAD PARFUMEUR ISRAEL</div>
    </div>
    
    <div id="br-name" style="font-size: 1.4rem; font-weight: 700; margin-bottom: 10px;"></div>

    <div class="duty-banner">
        <img src="https://cdn-icons-png.flaticon.com/512/679/679821.png" class="gift-icon">
        <div style="font-size: 1.1rem; color: var(--gold); font-weight: 700;" id="duty-title"></div>
        <a id="wa-header-btn" class="btn btn-wa" target="_blank" style="width: 150px;">
            <i class="fab fa-whatsapp"></i> WhatsApp
        </a>
    </div>
</header>

<nav id="cats" class="cats-nav"></nav>

<main id="main-grid"></main>

<div id="popup-sale">
    <div class="sale-inner">
        <div id="timer" class="countdown-txt">00:00:00</div>
        <img src="sale.png" style="width: 100%;">
        <a id="popup-wa" class="btn btn-wa" style="margin: 15px; border-radius: 50px; padding: 15px;">WhatsApp</a>
        <div onclick="closeSale()" style="padding-bottom: 15px; cursor: pointer; opacity: 0.7;">إغلاق / סגירה</div>
    </div>
</div>

<div id="reopen-btn" onclick="openSale()"><i class="fas fa-gift" style="color: #000; font-size: 1.5rem;"></i></div>

<script>
const params = new URLSearchParams(window.location.search);
const branchID = parseInt(params.get('branch')) || 1; 
const lang = navigator.language.startsWith('ar') ? 'ar' : 'he';

const TXT = {
    ar: { duty: "الموظف المناوب", order: "واتساب", view: "عرض", status: "متوفر الآن", offer: "احصل على العرض", all: "الكل" },
    he: { duty: "המנהל בתורנות", order: "וואטסאפ", view: "عرض", status: "זמין כעת", offer: "קבלת ההטבה", all: "הכל" }
};

let STATE = { branch: null, products: [] };

async function start() {
    try {
        const [bj, pc] = await Promise.all([
            fetch('test.json').then(r => r.json()),
            fetch('products.csv').then(r => r.text())
        ]);
        STATE.branch = bj.branches.find(b => b.id === branchID) || bj.branches[0];
        parseCSV(pc);
        renderUI();
        initSale();
    } catch (e) { console.error(e); }
}

function parseCSV(text) {
    const lines = text.split('\n');
    for(let i=1; i<lines.length; i++){
        const c = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(!c[1]) continue;
        STATE.products.push({ title: c[1].replace(/"/g,'').trim(), img: c[4], price: c[10].replace('ILS','').trim()+' ₪', cat: c[11] });
    }
}

function renderUI() {
    const b = STATE.branch; const t = TXT[lang];
    document.getElementById('br-name').textContent = b[`name_${lang}`];
    document.getElementById('duty-title').textContent = t.duty;
    document.getElementById('wa-header-btn').href = `https://wa.me/${b.phone}?text=${encodeURIComponent(t.duty)}`;

    renderCats();
    renderProducts('all');
    document.body.style.opacity = "1";
}

function renderCats() {
    const t = TXT[lang];
    const cats = [t.all, ...new Set(STATE.products.map(p => p.cat))].filter(Boolean);
    const nav = document.getElementById('cats');
    cats.forEach(c => {
        const btn = document.createElement('button');
        btn.textContent = c; btn.onclick = () => renderProducts(c === t.all ? 'all' : c);
        nav.appendChild(btn);
    });
}

function renderProducts(f) {
    const grid = document.getElementById('main-grid'); grid.innerHTML = '';
    const t = TXT[lang];
    const list = f === 'all' ? STATE.products : STATE.products.filter(p => p.cat === f);

    list.forEach(p => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
            <div class="card-top">
                <div>
                    <div class="product-title">${p.title}</div>
                    <div class="product-status"><i class="fas fa-check-circle"></i> ${t.status}</div>
                    <div style="color: #888; font-size: 0.9rem; margin-top: 5px;">${p.price}</div>
                </div>
                <div class="img-container"><img src="${p.img}"></div>
            </div>
            <div class="action-buttons">
                <a class="btn btn-wa" href="https://wa.me/${STATE.branch.phone}?text=${encodeURIComponent(p.title)}" target="_blank">
                    <i class="fab fa-whatsapp"></i> ${t.order}
                </a>
                <button class="btn btn-blue">Fast Order</button>
            </div>
        `;
        grid.appendChild(card);
    });
}

/** Sale Popup Logic **/
function initSale() {
    const key = 'mad_sale_' + new Date().toDateString();
    if(localStorage.getItem(key)) { document.getElementById('reopen-btn').style.display = 'flex'; return; }
    
    setTimeout(openSale, 2000);
}

function openSale() {
    document.getElementById('popup-sale').style.display = 'flex';
    document.getElementById('reopen-btn').style.display = 'none';
    startTimer();
}

function closeSale() {
    document.getElementById('popup-sale').style.display = 'none';
    document.getElementById('reopen-btn').style.display = 'flex';
    localStorage.setItem('mad_sale_' + new Date().toDateString(), '1');
}

function startTimer() {
    setInterval(() => {
        const diff = new Date().setHours(23,59,59) - new Date();
        const h = Math.floor(diff/3600000).toString().padStart(2,'0');
        const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
        const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
        document.getElementById('timer').textContent = `${h}:${m}:${s}`;
    }, 1000);
}

start();
</script>
</body>
</html>
