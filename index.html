<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD PARFUMEUR | Professional Experience</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --mad-blue: #1e3a8a; --mad-white: #ffffff; }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: #f8fbff; }
        
        nav { padding: 15px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .logo { width: 50px; border-radius: 50%; border: 2px solid var(--mad-blue); }
        
        .container { max-width: 480px; margin: 0 auto; padding: 20px; }
        .btn-geo { background: var(--mad-blue); color: #fff; width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .card { background: #fff; border-radius: 24px; padding: 20px; margin-bottom: 15px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .status-badge { font-size: 0.75rem; padding: 4px 12px; border-radius: 20px; font-weight: bold; }
        .is-open { background: #e8f5e9; color: #2e7d32; }
        .is-closed { background: #ffebee; color: #c62828; }
        
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-icon { padding: 10px; border-radius: 10px; background: #f5f5f7; text-decoration: none; color: #333; font-size: 0.8rem; text-align: center; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-enter { background: var(--mad-blue); color: #fff; width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; }

        .lang-bar { display: flex; gap: 5px; }
        .l-btn { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; border: 1px solid #ddd; background: #fff; cursor: pointer; }
        .l-btn.active { background: var(--mad-blue); color: #fff; border: none; }
    </style>
</head>
<body>

<nav>
    <div class="lang-bar">
        <button class="l-btn active" id="btn-ar" onclick="setLanguage('ar')">AR</button>
        <button class="l-btn" id="btn-he" onclick="setLanguage('he')">HE</button>
        <button class="l-btn" id="btn-en" onclick="setLanguage('en')">EN</button>
        <button class="l-btn" id="btn-ru" onclick="setLanguage('ru')">RU</button>
    </div>
    <img src="logo.png" class="logo">
</nav>

<div class="container">
    <button class="btn-geo" onclick="findNearest()"><i class="fas fa-location-arrow"></i> <span id="geo-txt">أقرب فرع</span></button>
    <div id="list"></div>
</div>

<script>
    let BRANCHES = [];
    let LANG = 'ar';

    const UI = {
        ar: { geo: "أقرب فرع لي", open: "مفتوح الآن", closed: "مغلق حالياً", map: "خريطة", wa: "واتساب", enter: "تصفح العطور" },
        he: { geo: "הסניף הקרוב אלי", open: "פתוח עכשيو", closed: "סגור כעת", map: "מפה", wa: "וואטסאפ", enter: "צפה במוצרים" },
        en: { geo: "Nearest Branch", open: "Open Now", closed: "Closed Now", map: "Map", wa: "WhatsApp", enter: "Browse Store" },
        ru: { geo: "Ближайший филиал", open: "Открыто", closed: "Закрыто", map: "Карта", wa: "WhatsApp", enter: "В магазин" }
    };

    async function start() {
        Papa.parse('branches.csv', {
            download: true, header: true, skipEmptyLines: true,
            complete: (res) => {
                BRANCHES = res.data;
                const auto = navigator.language.split('-')[0];
                setLanguage(['ar','he','en','ru'].includes(auto) ? auto : 'ar');
            }
        });
    }

    function setLanguage(l) {
        LANG = l;
        document.querySelectorAll('.l-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${l}`).classList.add('active');
        document.getElementById('geo-txt').innerText = UI[l].geo;
        render();
    }

    function isBranchOpen(h) {
        if(!h || h.includes("مغلق") || h.includes("סגור")) return false;
        const now = new Date();
        const cur = now.getHours() + (now.getMinutes()/60);
        const t = h.match(/(\d+):(\d+)\s*-\s*(\d+):(\d+)/);
        if(!t) return true;
        return cur >= (parseInt(t[1]) + t[2]/60) && cur <= (parseInt(t[3]) + t[4]/60);
    }

    function render(data = BRANCHES) {
        const div = document.getElementById('list');
        div.innerHTML = '';
        data.forEach(b => {
            if(!b.ID) return;
            const open = isBranchOpen(b['ساعات الدوام عربي']);
            const name = b[`اسم الفرع ${LANG === 'ar' ? 'عربي' : (LANG === 'he' ? 'عبري' : 'انجليزي')}`] || b['اسم الفرع عربي'];
            const hours = b[`ساعات الدوام ${LANG === 'ar' ? 'عربي' : 'عبري'}`] || b['ساعات الدوام عربي'];
            
            div.innerHTML += `
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h2 style="margin:0; font-size:1.1rem; color:var(--mad-blue);">${name}</h2>
                        <span class="status-badge ${open ? 'is-open' : 'is-closed'}">${open ? UI[LANG].open : UI[LANG].closed}</span>
                    </div>
                    <p style="font-size:0.8rem; color:#666; margin:8px 0;"><i class="far fa-clock"></i> ${hours}</p>
                    <div class="action-grid">
                        <a href="${b['رابط Waze / Maps']}" class="btn-icon"><i class="fab fa-waze"></i> ${UI[LANG].map}</a>
                        <a href="https://wa.me/${b['الهاتف']}" class="btn-icon"><i class="fab fa-whatsapp"></i> ${UI[LANG].wa}</a>
                    </div>
                    <button class="btn-enter">${UI[LANG].enter}</button>
                </div>`;
        });
    }

    function findNearest() {
        if (!navigator.geolocation) return;
        navigator.geolocation.getCurrentPosition(p => {
            const sorted = [...BRANCHES].sort((a,b) => {
                const dA = Math.hypot(a.Lat - p.coords.latitude, a.Lng - p.coords.longitude);
                const dB = Math.hypot(b.Lat - p.coords.latitude, b.Lng - p.coords.longitude);
                return dA - dB;
            });
            render(sorted);
        });
    }

    start();
</script>
</body>
</html>
