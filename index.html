<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<style>
:root{
  --black:#0a0a0a;
  --gold:#d4af37;
  --bg:#f2f2f2;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
  color:#111;
}
header{
  background:var(--black);
  color:var(--gold);
  padding:20px;
  text-align:center;
  letter-spacing:2px;
  font-weight:bold;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
.hidden{display:none}

/* فروع */
.branch-list a{
  display:block;
  background:#fff;
  padding:18px;
  border-radius:14px;
  margin-bottom:14px;
  text-decoration:none;
  color:#000;
  box-shadow:0 8px 20px rgba(0,0,0,.06);
}
.branch-list small{color:#777}

/* بطاقات */
.card{
  background:#fff;
  border-radius:20px;
  padding:24px;
  margin-bottom:30px;
  box-shadow:0 15px 35px rgba(0,0,0,.08);
}

/* أزرار */
.btn{
  display:block;
  padding:14px;
  margin-top:12px;
  border-radius:10px;
  text-align:center;
  text-decoration:none;
  font-weight:bold;
}
.btn-gold{background:var(--gold);color:#000}
.btn-green{background:#25D366;color:#fff}
.btn-blue{background:#0099cc;color:#fff}

/* منتجات */
.category-block{margin-bottom:50px}
.category-title{
  font-size:22px;
  font-weight:bold;
  margin-bottom:20px;
  border-bottom:3px solid var(--gold);
  padding-bottom:6px;
}
.products{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:24px;
}
.product{
  background:#fff;
  border-radius:20px;
  padding:18px;
  text-align:center;
  box-shadow:0 12px 28px rgba(0,0,0,.1);
  transition:.3s;
}
.product:hover{transform:translateY(-6px)}
.product img{
  width:100%;
  height:200px;
  object-fit:contain;
}
.price{
  color:var(--gold);
  font-weight:bold;
  margin:10px 0;
}
</style>
</head>

<body>

<header>MAD PARFUMEUR</header>

<div class="container">

<!-- قائمة الفروع -->
<div id="branchesView" class="branch-list"></div>

<!-- صفحة الفرع -->
<div id="branchView" class="hidden">

  <!-- معلومات الفرع -->
  <div class="card">
    <h2 id="branchNameAr"></h2>
    <h4 id="branchNameHe" style="color:#777"></h4>
    <p id="branchHours"></p>
    <p id="branchPhone" dir="ltr"></p>

    <a id="branchWaze" class="btn btn-blue" target="_blank">Waze</a>
    <a id="branchWhatsapp" class="btn btn-green" target="_blank">WhatsApp</a>
  </div>

  <!-- منتجات الفرع -->
  <div class="card">
    <h3 style="margin-bottom:25px">المنتجات المتوفرة في هذا الفرع</h3>
    <div id="branchProducts"></div>
  </div>

</div>

</div>

<script>
/* ========= CSV ========= */
const BRANCHES_CSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vQzL_F54ThIR-jtJoX9mU4gc6FPo2FzMWsvaPY9K9CDJ_qdHFf3VAqncUj51mEa3A/pub?output=csv';

const PRODUCTS_CSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEkstd7ZCKTNYZL_8TC2ofQ9Z91JJ2IM0awOPLgegDweraKayLGitwiLY7A382iQ/pub?output=csv';

/* ========= سعر آمن ========= */
function getPrice(val){
  if(!val) return 0;
  return parseFloat(val.toString().replace(/[^\d.]/g,'')) || 0;
}

/* ========= لغة ========= */
function getLang(){
  const p=new URLSearchParams(location.search);
  if(p.get('lang')==='he') return 'he';
  return navigator.language.startsWith('he')?'he':'ar';
}
const lang=getLang();
document.documentElement.lang=lang;
document.documentElement.dir=lang==='he'?'ltr':'rtl';

/* ========= راوتر ========= */
const params=new URLSearchParams(location.search);
const branchId=params.get('id');
branchId ? loadBranch(branchId) : loadBranches();

/* ========= فروع ========= */
function loadBranches(){
Papa.parse(BRANCHES_CSV,{
  download:true,
  header:true,
  complete:r=>{
    const box=document.getElementById('branchesView');
    box.innerHTML='';
    r.data.forEach(b=>{
      if(!b.ID) return;
      box.innerHTML+=`
        <a href="?id=${b.ID}&lang=${lang}">
          ${b['اسم الفرع عربي']}<br>
          <small>${b['اسم الفرع عبري']}</small>
        </a>`;
    });
  }
});
}

/* ========= فرع ========= */
function loadBranch(id){
Papa.parse(BRANCHES_CSV,{
  download:true,
  header:true,
  complete:r=>{
    const b=r.data.find(x=>x.ID==id);
    if(!b) return;

    document.getElementById('branchesView').classList.add('hidden');
    document.getElementById('branchView').classList.remove('hidden');

    branchNameAr.innerText=b['اسم الفرع عربي'];
    branchNameHe.innerText=b['اسم الفرع عبري'];
    branchHours.innerText=b['ساعات الدوام عربي']||b['ساعات الدوام عبري'];
    branchPhone.innerText=b['الهاتف'];

    branchWaze.href=b['رابط Waze / Maps'];
    branchWhatsapp.href=b['WhatsApp'] ||
      `https://wa.me/${b['الهاتف'].replace(/\D/g,'').replace(/^0/,'972')}`;

    loadBranchProducts();
  }
});
}

/* ========= منتجات ========= */
function loadBranchProducts(){
Papa.parse(PRODUCTS_CSV,{
  download:true,
  header:true,
  complete:r=>{
    const container=document.getElementById('branchProducts');
    container.innerHTML='';
    const grouped={};

    r.data.forEach(p=>{
      if(!p['Title']) return;
      const cat=p['Category (g:product_type)']||'أخرى';
      if(!grouped[cat]) grouped[cat]=[];
      grouped[cat].push(p);
    });

    const categoryOrder=['בשמי גברים','בשמי נשים','נישה','أخرى'];

    categoryOrder
      .filter(c=>grouped[c])
      .forEach(cat=>{
        grouped[cat].sort((a,b)=>{
          return getPrice(a['Price'])-getPrice(b['Price']);
        });

        container.innerHTML+=`
          <div class="category-block">
            <div class="category-title">${cat}</div>
            <div class="products" id="cat-${cat}"></div>
          </div>`;

        const box=container.querySelector(`#cat-${cat}`);
        grouped[cat].forEach(p=>{
          box.innerHTML+=`
            <div class="product">
              <img src="${p['Image']}">
              <h4>${p['Title']}</h4>
              <div class="price">${p['Price']}</div>
              <a class="btn btn-gold" target="_blank" href="${p['Product Link']}">
                ${lang==='he'?'לרכישה':'شراء'}
              </a>
            </div>`;
        });
      });
  }
});
}
</script>

</body>
</html>
