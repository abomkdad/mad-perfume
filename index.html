<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
    --black:#000;
    --gold:#d4af37;
    --bg:#f9f9f9;
}
body {
    font-family: Arial, sans-serif;
    margin:0;
    background:var(--bg);
}
header {
    background:#000;
    color:var(--gold);
    padding:15px;
    text-align:center;
}
.container {
    max-width:700px;
    margin:auto;
    padding:15px;
}
.card {
    background:#fff;
    border-radius:10px;
    padding:15px;
    margin-bottom:15px;
    box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.btn {
    display:block;
    padding:12px;
    margin-top:10px;
    border-radius:6px;
    text-align:center;
    text-decoration:none;
    font-weight:bold;
}
.btn-black {background:#000;color:#d4af37;}
.btn-green {background:#25D366;color:#fff;}
.btn-blue {background:#0099cc;color:#fff;}
.list a {
    display:block;
    padding:12px;
    background:#fff;
    margin-bottom:10px;
    border-radius:8px;
    text-decoration:none;
    color:#000;
}
.products {
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
    gap:12px;
}
.product img {
    width:100%;
    height:150px;
    object-fit:contain;
}
.product {
    background:#fff;
    border-radius:10px;
    padding:10px;
    text-align:center;
}
.price {color:var(--gold);font-weight:bold;}
.hidden {display:none;}
</style>
</head>

<body>

<header>
    <h1>MAD PARFUMEUR</h1>
</header>

<div class="container">

<div id="branchesView" class="list"></div>

<div id="branchView" class="hidden card">
    <h2 id="bNameAr"></h2>
    <h4 id="bNameHe" style="color:#777"></h4>
    <p id="bHours"></p>
    <p dir="ltr" id="bPhone"></p>

    <a id="btnWaze" class="btn btn-blue" target="_blank">Waze</a>
    <a id="btnWhatsapp" class="btn btn-green" target="_blank">WhatsApp</a>
    <a id="btnProducts" class="btn btn-black">المتجر</a>
</div>

<div id="productsView" class="hidden">
    <h2 id="productsTitle"></h2>
    <div class="products" id="products"></div>
</div>

</div>

<script>
// ================== CONFIG ==================
const BRANCHES_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQzL_F54ThIR-jtJoX9mU4gc6FPo2FzMWsvaPY9K9CDJ_qdHFf3VAqncUj51mEa3A/pub?output=csv';
const PRODUCTS_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEkstd7ZCKTNYZL_8TC2ofQ9Z91JJ2IM0awOPLgegDweraKayLGitwiLY7A382iQ/pub?output=csv';

// ================== LANGUAGE ==================
function getLang(){
    const p=new URLSearchParams(location.search);
    if(p.get('lang')==='he') return 'he';
    return navigator.language.startsWith('he')?'he':'ar';
}
const lang=getLang();
document.documentElement.lang=lang;
document.documentElement.dir=lang==='he'?'ltr':'rtl';

// ================== ROUTING ==================
const params=new URLSearchParams(location.search);
const page=params.get('page');
const id=params.get('id');

if(page==='products'){
    loadProducts();
}else if(id){
    loadBranch(id);
}else{
    loadBranches();
}

// ================== BRANCHES ==================
function loadBranches(){
Papa.parse(BRANCHES_CSV,{
download:true,header:true,complete:r=>{
    const box=document.getElementById('branchesView');
    r.data.forEach(b=>{
        if(!b.ID) return;
        box.innerHTML+=`
        <a href="?id=${b.ID}&lang=${lang}">
            ${b['اسم الفرع عربي']}<br>
            <small>${b['اسم الفرع عبري']}</small>
        </a>`;
    });
}});
}

function loadBranch(id){
Papa.parse(BRANCHES_CSV,{
download:true,header:true,complete:r=>{
    const b=r.data.find(x=>x.ID==id);
    if(!b) return;
    document.getElementById('branchesView').classList.add('hidden');
    document.getElementById('branchView').classList.remove('hidden');

    bNameAr.innerText=b['اسم الفرع عربي'];
    bNameHe.innerText=b['اسم الفرع عبري'];
    bHours.innerText=b['ساعات الدوام عربي']||b['ساعات الدوام عبري'];
    bPhone.innerText=b['الهاتف'];

    btnWaze.href=b['رابط Waze / Maps'];
    btnWhatsapp.href=b['WhatsApp']||`https://wa.me/${b['الهاتف'].replace(/\D/g,'').replace(/^0/,'972')}`;
    btnProducts.href=`?page=products&lang=${lang}`;
}});
}

// ================== PRODUCTS ==================
function loadProducts(){
document.getElementById('branchesView').classList.add('hidden');
document.getElementById('productsView').classList.remove('hidden');
productsTitle.innerText=lang==='he'?'החנות':'المتجر';

Papa.parse(PRODUCTS_CSV,{
download:true,header:true,complete:r=>{
    const box=document.getElementById('products');
    r.data.forEach(p=>{
        const name=lang==='he'?p['العطر عبري']:p['العطر بالعربي'];
        const link=lang==='he'?p['رابط الشراء العبري']:p['رابط الشراء العربي'];
        if(!name) return;
        box.innerHTML+=`
        <div class="product">
            <img src="${p['رابط الصوره']}">
            <h4>${name}</h4>
            <div class="price">${p['السعر']} ₪</div>
            <a class="btn btn-black" target="_blank" href="${link}">
                ${lang==='he'?'לרכישה':'شراء'}
            </a>
        </div>`;
    });
}});
}
</script>

</body>
</html>
