<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<style>
:root{
  --black:#000;
  --gold:#d4af37;
  --bg:#f4f4f4;
}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
}
header{
  background:#000;
  color:var(--gold);
  padding:18px;
  text-align:center;
  font-weight:bold;
  letter-spacing:2px;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}
.hidden{display:none;}
.list a{
  display:block;
  padding:16px;
  margin-bottom:12px;
  background:#fff;
  border-radius:12px;
  text-decoration:none;
  color:#000;
  box-shadow:0 6px 18px rgba(0,0,0,.06);
}
.card{
  background:#fff;
  border-radius:16px;
  padding:20px;
  margin-bottom:25px;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
}
.btn{
  display:block;
  padding:14px;
  margin-top:12px;
  border-radius:8px;
  text-align:center;
  text-decoration:none;
  font-weight:bold;
}
.btn-black{background:#000;color:var(--gold);}
.btn-green{background:#25D366;color:#fff;}
.btn-blue{background:#0099cc;color:#fff;}

.products-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
  gap:22px;
}
.product{
  background:#fff;
  border-radius:18px;
  padding:16px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
  transition:.3s;
}
.product:hover{transform:translateY(-6px);}
.product img{
  width:100%;
  height:200px;
  object-fit:contain;
}
.price{
  color:var(--gold);
  font-weight:bold;
  margin:8px 0;
}
.category-block{
  margin-bottom:45px;
}
.category-title{
  font-size:20px;
  font-weight:bold;
  margin-bottom:18px;
  border-bottom:3px solid var(--gold);
  padding-bottom:6px;
}
</style>
</head>

<body>

<header>MAD PARFUMEUR</header>

<div class="container">

<!-- قائمة الفروع -->
<div id="branchesView" class="list"></div>

<!-- صفحة الفرع -->
<div id="branchView" class="hidden">

  <!-- معلومات الفرع -->
  <div class="card">
    <h2 id="bAr"></h2>
    <h4 id="bHe" style="color:#777"></h4>
    <p id="bHours"></p>
    <p id="bPhone" dir="ltr"></p>

    <a id="waze" class="btn btn-blue" target="_blank">Waze</a>
    <a id="wa" class="btn btn-green" target="_blank">WhatsApp</a>
  </div>

  <!-- منتجات الفرع -->
  <div class="card">
    <h3 style="margin-bottom:25px">المنتجات المتوفرة في هذا الفرع</h3>
    <div id="branchProducts"></div>
  </div>

</div>

</div>

<script>
// ================= CONFIG =================
const BRANCHES_CSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vQzL_F54ThIR-jtJoX9mU4gc6FPo2FzMWsvaPY9K9CDJ_qdHFf3VAqncUj51mEa3A/pub?output=csv';

const PRODUCTS_CSV =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEkstd7ZCKTNYZL_8TC2ofQ9Z91JJ2IM0awOPLgegDweraKayLGitwiLY7A382iQ/pub?output=csv';

// ================= LANGUAGE =================
function getLang(){
  const p=new URLSearchParams(location.search);
  if(p.get('lang')==='he') return 'he';
  return navigator.language.startsWith('he')?'he':'ar';
}
const lang=getLang();
document.documentElement.lang=lang;
document.documentElement.dir=lang==='he'?'ltr':'rtl';

// ================= ROUTER =================
const params=new URLSearchParams(location.search);
const branchId=params.get('id');

if(branchId) loadBranch(branchId);
else loadBranches();

// ================= LOAD BRANCHES =================
function loadBranches(){
Papa.parse(BRANCHES_CSV,{
  download:true,
  header:true,
  complete:r=>{
    branchesView.innerHTML='';
    r.data.forEach(b=>{
      if(!b.ID) return;
      branchesView.innerHTML+=`
        <a href="?id=${b.ID}&lang=${lang}">
          ${b['اسم الفرع عربي']}<br>
          <small>${b['اسم الفرع عبري']}</small>
        </a>`;
    });
  }
});
}

// ================= LOAD BRANCH =================
function loadBranch(id){
Papa.parse(BRANCHES_CSV,{
  download:true,
  header:true,
  complete:r=>{
    const b=r.data.find(x=>x.ID==id);
    if(!b) return;

    branchesView.classList.add('hidden');
    branchView.classList.remove('hidden');

    bAr.innerText=b['اسم الفرع عربي'];
    bHe.innerText=b['اسم الفرع عبري'];
    bHours.innerText=b['ساعات الدوام عربي']||b['ساعات الدوام عبري'];
    bPhone.innerText=b['الهاتف'];

    waze.href=b['رابط Waze / Maps'];
    wa.href=b['WhatsApp'] ||
      `https://wa.me/${b['الهاتف'].replace(/\D/g,'').replace(/^0/,'972')}`;

    loadBranchProducts();
  }
});
}

// ================= LOAD PRODUCTS =================
function loadBranchProducts(){
Papa.parse(PRODUCTS_CSV,{
  download:true,
  header:true,
  complete:r=>{
    const container=document.getElementById('branchProducts');
    container.innerHTML='';

    const grouped={};

    r.data.forEach(p=>{
      if(!p['Title']) return;
      const cat=p['Category (g:product_type)']||'أخرى';
      if(!grouped[cat]) grouped[cat]=[];
      grouped[cat].push(p);
    });

    Object.keys(grouped).forEach(cat=>{
      container.innerHTML+=`
        <div class="category-block">
          <div class="category-title">${cat}</div>
          <div class="products-grid" id="cat-${cat}"></div>
        </div>
      `;
      const box=container.querySelector(`#cat-${cat}`);
      grouped[cat].forEach(p=>{
        box.innerHTML+=`
          <div class="product">
            <img src="${p['Image']}">
            <h4>${p['Title']}</h4>
            <div class="price">${p['Price']}</div>
            <a class="btn btn-black" target="_blank" href="${p['Product Link']}">
              ${lang==='he'?'לרכישה':'شراء'}
            </a>
          </div>
        `;
      });
    });
  }
});
}
</script>

</body>
</html>
