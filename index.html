<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
  --black:#000;
  --gold:#d4af37;
  --bg:#f5f5f5;
}
body {
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
}
header {
  background:#000;
  color:var(--gold);
  padding:18px;
  text-align:center;
  font-weight:bold;
  letter-spacing:2px;
}
.container {
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card {
  background:#fff;
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
.hidden {display:none;}
.list a {
  display:block;
  padding:15px;
  margin-bottom:12px;
  background:#fff;
  border-radius:10px;
  text-decoration:none;
  color:#000;
  box-shadow:0 5px 15px rgba(0,0,0,.05);
}
.btn {
  display:block;
  padding:14px;
  margin-top:12px;
  border-radius:8px;
  text-align:center;
  text-decoration:none;
  font-weight:bold;
}
.btn-black {background:#000;color:var(--gold);}
.btn-green {background:#25D366;color:#fff;}
.btn-blue {background:#0099cc;color:#fff;}

.controls {
  display:flex;
  gap:10px;
  margin-bottom:20px;
}
.controls select {
  flex:1;
  padding:12px;
  border-radius:10px;
}

.products {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:20px;
}
.product {
  background:#fff;
  border-radius:16px;
  padding:15px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
  transition:.3s;
}
.product:hover {
  transform:translateY(-6px);
}
.product img {
  width:100%;
  height:180px;
  object-fit:contain;
}
.price {
  color:var(--gold);
  font-weight:bold;
  margin:8px 0;
}
</style>
</head>

<body>

<header>MAD PARFUMEUR</header>

<div class="container">

<div id="branchesView" class="list"></div>

<div id="branchView" class="hidden card">
  <h2 id="bAr"></h2>
  <h4 id="bHe" style="color:#777"></h4>
  <p id="bHours"></p>
  <p id="bPhone" dir="ltr"></p>

  <a id="waze" class="btn btn-blue" target="_blank">Waze</a>
  <a id="wa" class="btn btn-green" target="_blank">WhatsApp</a>
  <a id="goStore" class="btn btn-black">المتجر</a>
</div>

<div id="storeView" class="hidden">
  <div class="controls card">
    <select id="brandFilter"></select>
    <select id="sortPrice">
      <option value="">ترتيب السعر</option>
      <option value="asc">الأقل → الأعلى</option>
      <option value="desc">الأعلى → الأقل</option>
    </select>
  </div>
  <div class="products" id="products"></div>
</div>

</div>

<script>
// ====== CONFIG ======
const BRANCHES_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQzL_F54ThIR-jtJoX9mU4gc6FPo2FzMWsvaPY9K9CDJ_qdHFf3VAqncUj51mEa3A/pub?output=csv';
const PRODUCTS_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEkstd7ZCKTNYZL_8TC2ofQ9Z91JJ2IM0awOPLgegDweraKayLGitwiLY7A382iQ/pub?output=csv';

// ====== LANG ======
function getLang(){
  const p=new URLSearchParams(location.search);
  if(p.get('lang')==='he') return 'he';
  return navigator.language.startsWith('he')?'he':'ar';
}
const lang=getLang();
document.documentElement.lang=lang;
document.documentElement.dir=lang==='he'?'ltr':'rtl';

// ====== ROUTER ======
const params=new URLSearchParams(location.search);
const id=params.get('id');
const page=params.get('page');

if(page==='products') loadProducts();
else if(id) loadBranch(id);
else loadBranches();

// ====== BRANCHES ======
function loadBranches(){
Papa.parse(BRANCHES_CSV,{download:true,header:true,complete:r=>{
  const box=document.getElementById('branchesView');
  box.innerHTML='';
  r.data.forEach(b=>{
    if(!b.ID) return;
    box.innerHTML+=`
      <a href="?id=${b.ID}&lang=${lang}">
        ${b['اسم الفرع عربي']}<br>
        <small>${b['اسم الفرع عبري']}</small>
      </a>`;
  });
}});
}

function loadBranch(id){
Papa.parse(BRANCHES_CSV,{download:true,header:true,complete:r=>{
  const b=r.data.find(x=>x.ID==id);
  if(!b) return;
  branchesView.classList.add('hidden');
  branchView.classList.remove('hidden');

  bAr.innerText=b['اسم الفرع عربي'];
  bHe.innerText=b['اسم الفرع عبري'];
  bHours.innerText=b['ساعات الدوام عربي']||b['ساعات الدوام عبري'];
  bPhone.innerText=b['الهاتف'];

  waze.href=b['رابط Waze / Maps'];
  wa.href=b['WhatsApp']||`https://wa.me/${b['الهاتف'].replace(/\D/g,'').replace(/^0/,'972')}`;
  goStore.href=`?page=products&id=${id}&lang=${lang}`;
}});
}

// ====== PRODUCTS ======
let allProducts=[];

function loadProducts(){
branchesView.classList.add('hidden');
storeView.classList.remove('hidden');

Papa.parse(PRODUCTS_CSV,{download:true,header:true,complete:r=>{
  const branchId=params.get('id');
  allProducts=r.data.filter(p=>{
    if(!p.Title) return false;
    if(!branchId) return true;
    return p['Internal Label']?.includes(branchId);
  });
  initFilters(allProducts);
  render(allProducts);
}});
}

function initFilters(list){
const brands=[...new Set(list.map(p=>p.Brand).filter(Boolean))];
brandFilter.innerHTML='<option value="">كل الماركات</option>';
brands.forEach(b=>brandFilter.innerHTML+=`<option>${b}</option>`);

brandFilter.onchange=()=>apply();
sortPrice.onchange=()=>apply();
}

function apply(){
let list=[...allProducts];
if(brandFilter.value)
  list=list.filter(p=>p.Brand===brandFilter.value);

if(sortPrice.value==='asc')
  list.sort((a,b)=>parseFloat(a.Price)-parseFloat(b.Price));
if(sortPrice.value==='desc')
  list.sort((a,b)=>parseFloat(b.Price)-parseFloat(a.Price));

render(list);
}

function render(list){
products.innerHTML='';
list.forEach(p=>{
  products.innerHTML+=`
  <div class="product">
    <img src="${p.Image}">
    <h4>${p.Title}</h4>
    <div class="price">${p.Price}</div>
    <a class="btn btn-black" target="_blank" href="${p['Product Link']}">
      ${lang==='he'?'לרכישה':'شراء'}
    </a>
  </div>`;
});
}
</script>

</body>
</html>
