<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>MAD PARFUMEUR | Elite Portal</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&family=Cinzel:wght@700&display=swap">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>

:root{
--gold:#D4AF37;
--wa:#25D366;
--fb:#1877F2;
--ig:#E1306C;
--tt:#000;
--bg:#ffffff;
--text:#111;
--border:#e5e5e5;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
background:var(--bg);
color:var(--text);
font-family:Assistant,sans-serif;
padding-bottom:90px;
}

/* ===== WhatsApp Top Bar ===== */

.top-wa-bar{
background:var(--wa);
color:#fff;
padding:12px;
text-align:center;
font-weight:700;
display:flex;
justify-content:center;
gap:8px;
text-decoration:none;
}

/* ===== Header ===== */

header{
padding:20px;
text-align:center;
border-bottom:1px solid var(--border);
background:#fff;
}

.logo-img{
width:110px;
margin-bottom:10px;
}

.branch-title{
font-family:Cinzel;
font-size:20px;
color:var(--gold);
font-weight:800;
}

.open-status-text{
font-size:14px;
font-weight:700;
margin-top:5px;
}

/* ===== Social ===== */

.social-icons{
display:flex;
justify-content:center;
gap:12px;
margin-top:12px;
}

.social-icons a{
width:42px;
height:42px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
color:#fff;
font-size:18px;
}

.social-icons a.facebook{background:var(--fb)}
.social-icons a.instagram{background:var(--ig)}
.social-icons a.tiktok{background:var(--tt)}
.social-icons a.whatsapp{background:var(--wa)}

/* ===== Categories ===== */

.cats-wrapper{
position:sticky;
top:0;
background:#fff;
border-bottom:1px solid var(--border);
z-index:1000;
}

.cats-container{
display:flex;
gap:10px;
padding:10px;
overflow-x:auto;
}

.cat-pill{
border:1px solid var(--border);
border-radius:30px;
padding:6px 14px;
white-space:nowrap;
font-size:13px;
font-weight:700;
cursor:pointer;
background:#fff;
}

.cat-pill.active{
background:var(--gold);
color:#000;
}

/* ===== Products Grid ===== */

.shop-grid{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:12px;
padding:12px;
}

.p-card{
border:1px solid var(--border);
border-radius:12px;
overflow:hidden;
background:#fff;
}

.p-card img{
width:100%;
aspect-ratio:1/1;
object-fit:cover;
}

.p-info{
padding:10px;
text-align:center;
}

.add-btn{
margin-top:8px;
background:var(--gold);
border:none;
width:100%;
padding:10px;
border-radius:8px;
font-weight:700;
cursor:pointer;
}

.add-btn.added{
background:#000;
color:#fff;
}

/* ===== Floating Cart ===== */

#cart-fab{
position:fixed;
bottom:90px;
right:15px;
width:56px;
height:56px;
border-radius:50%;
background:var(--gold);
display:flex;
align-items:center;
justify-content:center;
font-size:20px;
cursor:pointer;
}

#cart-count{
position:absolute;
top:-5px;
right:-5px;
background:red;
color:#fff;
width:20px;
height:20px;
border-radius:50%;
font-size:11px;
display:flex;
align-items:center;
justify-content:center;
}

/* ===== Bottom Bar ===== */

.frag-footer{
position:fixed;
bottom:0;
left:0;
width:100%;
background:#fff;
border-top:1px solid var(--border);
padding:10px;
display:flex;
justify-content:space-between;
align-items:center;
}

.frag-btn{
background:#000;
color:#fff;
border:none;
padding:8px 16px;
border-radius:20px;
font-size:12px;
cursor:pointer;
}

/* ===== Drawer ===== */

.drawer{
position:fixed;
bottom:-100%;
left:0;
width:100%;
height:75%;
background:#fff;
border-top:3px solid var(--gold);
transition:.35s;
padding:15px;
display:flex;
flex-direction:column;
}

.drawer.open{bottom:0}

.checkout-btn{
background:var(--wa);
border:none;
color:#fff;
padding:15px;
border-radius:12px;
font-weight:800;
margin-top:10px;
}

/* ===== Performance ===== */

img{loading:lazy}

</style>

</head>

<body dir="rtl">

<a id="top-wa-btn" class="top-wa-bar">
<i class="fab fa-whatsapp"></i>
<span id="top-wa-txt"></span>
</a>

<header>
<img src="logo.png" class="logo-img">
<div id="br-name" class="branch-title"></div>
<div id="open-status-display" class="open-status-text"></div>
<div id="br-social" class="social-icons"></div>
</header>

<div class="cats-wrapper">
<div id="cats-box" class="cats-container"></div>
</div>

<main id="main-grid" class="shop-grid"></main>

<div id="cart-fab" onclick="toggleCart(true)">
<i class="fas fa-shopping-cart"></i>
<div id="cart-count">0</div>
</div>

<div class="frag-footer">
<div>
<b id="f-h"></b><br>
<small id="f-p"></small>
</div>
<button class="frag-btn" onclick="toggleFrag(true)" id="f-b"></button>
</div>

<div id="cart-drawer" class="drawer">
<h3 id="cart-title"></h3>
<div id="cart-list" style="flex:1;overflow:auto"></div>
<div id="cart-total"></div>
<button class="checkout-btn" onclick="sendOrder()">
<i class="fab fa-whatsapp"></i>
<span id="check-txt"></span>
</button>
</div>

<script>

const params=new URLSearchParams(location.search)
const branchID=parseInt(params.get('branch'))||1
const lang=navigator.language.startsWith('ar')?'ar':'he'

const TXT={
ar:{all:'الكل',add:'إضافة',added:'في السلة',check:'إرسال الطلب',cart:'سلة المشتريات',wa_top:'تواصل واتساب'},
he:{all:'הכל',add:'הוסף',added:'בסל',check:'שליחה',cart:'עגלה',wa_top:'צור קשר'}
}

let STATE={products:[],cart:[],branch:null}

async function init(){
const [b,p]=await Promise.all([
fetch('branches.json').then(r=>r.json()),
fetch('products.csv').then(r=>r.text())
])

STATE.branch=b.branches.find(x=>x.id===branchID)
parseCSV(p)
renderHeader()
renderCats()
renderGrid('all')
}

function renderHeader(){
document.getElementById('top-wa-txt').textContent=TXT[lang].wa_top
document.getElementById('br-name').textContent=STATE.branch.name_he
document.getElementById('top-wa-btn').href=`https://wa.me/972${STATE.branch.phone.substring(1)}`

const soc=document.getElementById('br-social')
if(STATE.branch.social?.facebook) soc.innerHTML+=`<a class="facebook" href="${STATE.branch.social.facebook}"><i class="fab fa-facebook-f"></i></a>`
if(STATE.branch.social?.instagram) soc.innerHTML+=`<a class="instagram" href="${STATE.branch.social.instagram}"><i class="fab fa-instagram"></i></a>`
if(STATE.branch.social?.tiktok) soc.innerHTML+=`<a class="tiktok" href="${STATE.branch.social.tiktok}"><i class="fab fa-tiktok"></i></a>`
}

function parseCSV(t){
const rows=t.split('\n')
for(let i=1;i<rows.length;i++){
const c=rows[i].split(',')
if(!c[0])continue
STATE.products.push({id:i,title:c[0],img:c[3],price:c[9],cat:c[10]})
}
}

function renderCats(){
const cats=[...new Set(STATE.products.map(p=>p.cat))]
const box=document.getElementById('cats-box')
box.innerHTML=`<div class="cat-pill active" onclick="filterCats(this,'all')">${TXT[lang].all}</div>`
cats.forEach(c=>{
box.innerHTML+=`<div class="cat-pill" onclick="filterCats(this,'${c}')">${c}</div>`
})
}

function filterCats(el,name){
document.querySelectorAll('.cat-pill').forEach(x=>x.classList.remove('active'))
el.classList.add('active')
renderGrid(name)
}

function renderGrid(cat){
const g=document.getElementById('main-grid')
g.innerHTML=''
const list=cat==='all'?STATE.products:STATE.products.filter(p=>p.cat===cat)

list.forEach(p=>{
g.innerHTML+=`
<div class="p-card">
<img src="${p.img}">
<div class="p-info">
<div>${p.title}</div>
<div>${p.price}</div>
<button class="add-btn" onclick="addToCart(${p.id},this)">${TXT[lang].add}</button>
</div>
</div>`
})
}

function addToCart(id,btn){
if(STATE.cart.includes(id))return
STATE.cart.push(id)
btn.textContent=TXT[lang].added
document.getElementById('cart-count').textContent=STATE.cart.length
}

function toggleCart(s){
document.getElementById('cart-drawer').classList.toggle('open',s)
}

function sendOrder(){
window.open(`https://wa.me/972${STATE.branch.phone.substring(1)}`,'_blank')
}

init()

</script>

</body>
</html>
