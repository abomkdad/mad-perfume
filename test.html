import React, { useState, useEffect } from 'react';
import { Globe, ShoppingCart, Sparkles, Instagram, Facebook, MessageCircle, ShoppingBag, Star, CheckCircle, ThumbsUp, ChevronDown, User, Send } from 'lucide-react';

const App = () => {
  const [lang, setLang] = useState('ar');
  const [displayedReviews, setDisplayedReviews] = useState([]);
  const [userReviews, setUserReviews] = useState([]); 
  const [showForm, setShowForm] = useState(false);
  
  const [newRating, setNewRating] = useState(5);
  const [newTitle, setNewTitle] = useState('');
  const [newComment, setNewComment] = useState('');

  // إعداد أكواد البيكسل (Pixel) المستخرجة من الصورة
  const PIXELS = {
    facebook: "1072283127290819",
    tiktok: "D2D02JBC77U4ENLN9SBG",
    snapchat: "b143822e-1c3c-40ff-93f7-edadee74e626"
  };

  useEffect(() => {
    // --- إعداد Facebook Pixel ---
    if (!window.fbq) {
      (function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
      n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
      document,'script','https://connect.facebook.net/en_US/fbevents.js'));
    }
    window.fbq('init', PIXELS.facebook);
    window.fbq('track', 'PageView');
    window.fbq('track', 'ViewContent');

    // --- إعداد TikTok Pixel (نسخة مستقرة ومصلحة) ---
    if (!window.ttq) {
      var ttq = window.ttq = window.ttq || [];
      ttq.methods = ["page", "track", "identify", "instances", "debug", "on", "off", "once", "ready", "alias", "group", "aliasWithContext", "setAndLog", "set", "get", "getAndLog", "setContext", "getContext", "getPlugin", "setPlugin", "deletePlugin", "setInstance", "getInstance", "setEventSettings", "getEventSettings", "setGlobalSettings", "getGlobalSettings", "setAndGetGlobalSettings", "getAndSetGlobalSettings", "setAndGetEventSettings", "getAndSetEventSettings", "setAndGetInstances", "getAndSetInstances", "setAndGetInstancesWithContext", "getAndSetInstancesWithContext", "setAndGetEventSettingsWithContext", "getAndSetEventSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext"];
      ttq.setAndLog = function (t, e) { ttq.set(t, e); ttq.log(t, e) };
      ttq.set = function (t, e) { ttq[t] = e };
      ttq.get = function (t) { return ttq[t] };
      ttq.instances = [];
      ttq.load = function (e, t) {
        var r = "https://analytics.tiktok.com/i18n/pixel/events.js";
        ttq._i = ttq._i || {}, ttq._i[e] = [], ttq._i[e]._u = r, ttq._t = ttq._t || {}, ttq._t[e] = +new Date, ttq._o = ttq._o || {}, ttq._o[e] = t || {};
        ttq._v = ttq._v || "1.0.11";
        var i = document.createElement("script"); i.type = "text/javascript", i.async = !0, i.src = r + "?sdkid=" + e + "&lib=ttq";
        var a = document.getElementsByTagName("script")[0]; a.parentNode.insertBefore(i, a)
      };
      // إضافة الوظائف الوهمية (Stubs) لضمان عدم حدوث خطأ "is not a function"
      ttq.methods.forEach(function(m) {
        ttq[m] = (function(method) {
          return function() {
            ttq.push([method].concat(Array.prototype.slice.call(arguments, 0)));
          };
        })(m);
      });
      ttq.load(PIXELS.tiktok);
    }
    window.ttq.page();
    window.ttq.track('ViewContent');

    // --- إعداد Snapchat Pixel ---
    if (!window.snaptr) {
      (function(e,t,n,a,r,i,s){if(!e[i]){e[i]=e[r]=function(){e[r].handleRequest?e[r].handleRequest.apply(e[r],arguments):e[r].queue.push(arguments)};e[r].queue=[];i=t.createElement(n);i.async=!0;i.src=a;s=t.getElementsByTagName(n)[0];s.parentNode.insertBefore(i,s)}})(window,document,"script","https://sc-static.net/scevent.min.js","snaptr","snaptr");
    }
    window.snaptr('init', PIXELS.snapchat);
    window.snaptr('track', 'PAGE_VIEW');
    window.snaptr('track', 'VIEW_CONTENT');

  }, []);

  const content = {
    title: { ar: "ماد بارفيومير", he: "מד פרפומר" },
    amazonBadge: { ar: "الأكثر مبيعاً", he: "הנמכר ביותר" },
    limitedDeal: { ar: "عرض لفترة محدودة", he: "דיל לזמן מוגבל" },
    customerReviews: { ar: "مراجعات العملاء", he: "ביקורות לקוחות" },
    globalRating: { ar: "تقييم عالمي", he: "דירוג גלובلي" },
    verified: { ar: "مشتري مؤكد", he: "רכישה מאומתת" },
    helpful: { ar: "مفيد", he: "מועיל" },
    report: { ar: "إبلاغ", he: "דווח" },
    cta: { ar: "مشاهدة العرض وتفاصيل المنتج", he: "צפה במבצע ופרטי המוצר" },
    writeReview: { ar: "كتابة مراجعة", he: "כתוב ביקורת" },
    submitReview: { ar: "نشر المراجعة", he: "פרסם ביקורת" },
    reviewPlaceholder: { ar: "ما هو رأيك في المنتج؟", he: "מה דעתך על המוצר?" },
    titlePlaceholder: { ar: "عنوان المراجعة", he: "כותרת הביקורת" },
    footer: { ar: "جميع الحقوق محفوظة © 2024 - MAD Parfumeur", he: "כל הזכויות שמורות © 2024 - מד פרפומר" }
  };

  const links = [
    { key: "offer1", img: "https://www.mad-parfumeur.com/assets/hero/1.webp", title: { ar: "العرض الأول: باقة النخبة", he: "מבצע 1: מארז עילית" }, subtitle: { ar: "تتضمن 3 عطور نيش فاخرة مع علبة خشبية", he: "כולל 3 בשמי נישה יוקרתיים עם מארז עץ" }, rating: 4.9, reviewsCount: "1,240", url: "https://www.mad-parfumeur.com/landing/sale1.html" },
    { key: "offer2", img: "https://www.mad-parfumeur.com/assets/hero/2.webp", title: { ar: "العرض الثاني: الثنائي الساحر", he: "מבצע 2: הצמד הקסום" }, subtitle: { ar: "عطر رجالي وعطر نسائي بتركيز عالٍ", he: "בושם לגבר ובושם לאישה בריכוז גבוה" }, rating: 4.8, reviewsCount: "850", url: "https://www.mad-parfumeur.com/landing/sale2.html" },
    { key: "offer3", img: "https://www.mad-parfumeur.com/assets/hero/3.webp", title: { ar: "العرض الثالث: مجموعة الصيف", he: "מבצע 3: קולקציית קיץ" }, subtitle: { ar: "روائح منعشة تدوم لأكثر من 24 ساعة", he: "ריחות רעננים שמחזיקים מעל 24 שעות" }, rating: 5.0, reviewsCount: "2,100", url: "https://www.mad-parfumeur.com/landing/sale3.html" },
    { key: "offer4", img: "https://www.mad-parfumeur.com/assets/hero/4.webp", title: { ar: "العرض الرابع: زيوت ماد النقية", he: "מבצע 4: שמני מד טהורים" }, subtitle: { ar: "مجموعة من 5 زيوت عطرية مركزة", he: "ערכה של 5 שמני בושם מרוכזים" }, rating: 4.7, reviewsCount: "430", url: "https://www.mad-parfumeur.com/landing/sale4.html" },
    { key: "offer5", img: "https://www.mad-parfumeur.com/assets/hero/5.webp", title: { ar: "العرض الخامس: الإصدار المحدود", he: "מבצע 5: מהדורה מוגבלת" }, subtitle: { ar: "عطر ليلي بلمسات العود والزعفران", he: "בושם לילה עם נגיעות עוד וזעפרן" }, rating: 4.9, reviewsCount: "1,560", url: "https://www.mad-parfumeur.com/landing/sale5.html" },
    { key: "offer6", img: "https://www.mad-parfumeur.com/assets/hero/6.webp", title: { ar: "العرض السادس: كلاسيكيات ماد", he: "מבצע 6: קלאסיקות מד" }, subtitle: { ar: "أفضل 3 عطور مبيعاً في تاريخنا", he: "3 הבשמים הנמכרים ביותר בהיסטוריה שלנו" }, rating: 4.8, reviewsCount: "920", url: "https://www.mad-parfumeur.com/landing/sale6.html" },
    { key: "offer7", img: "https://www.mad-parfumeur.com/assets/hero/7.webp", title: { ar: "العرض السابع: مجموعة السبا", he: "מבצע 7: ערכת ספא" }, subtitle: { ar: "عطور زيتية وشموع فواحة للمنزل", he: "שמני בושם ונרות ריחניים לבית" }, rating: 4.6, reviewsCount: "310", url: "https://www.mad-parfumeur.com/landing/sale7.html" },
    { key: "offer8", img: "https://www.mad-parfumeur.com/assets/hero/8.webp", title: { ar: "العرض الثامن: ثقة الرجال", he: "מבצע 8: ביטחון גברי" }, subtitle: { ar: "عطور خشبية قوية وجذابة", he: "בשמים עציים חזקים ומושכים" }, rating: 4.9, reviewsCount: "740", url: "https://www.mad-parfumeur.com/landing/sale8.html" },
    { key: "offer9", img: "https://www.mad-parfumeur.com/assets/hero/9.webp", title: { ar: "العرض التاسع: لمسة الأنوثة", he: "מבצע 9: נגיעה נשית" }, subtitle: { ar: "باقة من الزهور والفواكه المنعشة", he: "מארז פרחים ופירות רעננים" }, rating: 5.0, reviewsCount: "1,050", url: "https://www.mad-parfumeur.com/landing/sale9.html" },
    { key: "offer10", img: "https://www.mad-parfumeur.com/assets/hero/10.webp", title: { ar: "العرض العاشر: بكج المسك", he: "מבצע 10: מארז מושק" }, subtitle: { ar: "أفخر أنواع المسك الأبيض والملكي", he: "מיטב סוגי המושק הלבן והמלכותי" }, rating: 4.9, reviewsCount: "1,800", url: "https://www.mad-parfumeur.com/landing/sale10.html" }
  ];

  // قائمة 20 تعليقاً واقعياً جداً
  const poolOfReviews = [
    { name: {ar: "أحمد منصور", he: "אחמד מנסור"}, title: {ar: "العطر نار اخوي", he: "בושם פצצה אחי"}, text: { ar: "العطر نار اخوي، الثبات ولا غلطة والكل سألني شو حاطط.", he: "הבושם פצצה אחי, העמידות מעולה וכולם שאלו אותי מה שמתי." }, rating: 5, date: "قبل ساعة", likes: 84 },
    { name: {ar: "إياد وتد", he: "איאד ותד"}, title: {ar: "احسن شركة عطور", he: "חברת הבשמים הכי טובה"}, text: { ar: "احسن شركة عطور اقسم بالله، جربت W183 وفعلاً بجنن وبنصح الكل فيه.", he: "חברת הבשמים הכי טובה נשבע לכם, ניסיתי את W183 וזה באמת מדהים." }, rating: 5, date: "قبل ساعتين", likes: 32 },
    { name: {ar: "שרה ل.", he: "שרה ל."}, title: {ar: "تسلم عمي محمد", he: "תודה דוד מוחמד"}, text: { ar: "تسلم عمي محمد احلا شركه، دايماً بتعامل معكم والخدمة توب التوب.", he: "תודה דוד מוחמד החברה הכי טובה, תמיד קונה מכם והשירות הכי טוב שיש." }, rating: 5, date: "اليوم", likes: 19 },
    { name: {ar: "ميخائيل م.", he: "מיכאל מ."}, title: {ar: "فرع يافا", he: "סניף יפו"}, text: { ar: "اليوم اشتريت من فرع يافا العطور نار خاصه W183، بنصحكم تروحوا لهناك.", he: "היום קניתי מסניף יפו הבשמים אש במיוחד W183, ממליץ לכם ללכת לשם." }, rating: 5, date: "قبل 3 ساعات", likes: 47 },
    { name: {ar: "فادي جبارين", he: "פאדי ג'בארין"}, title: {ar: "ثبات خرافي", he: "עמידות מטורפת"}, text: { ar: "ريحة العطر بتضل يومين عواعيي حتى بعد الغسيل! روعة.", he: "ריח הבושם נשאר יומיים על הבגדים גם אחרי כביסה! מדהים." }, rating: 5, date: "أمس", likes: 12 },
    { name: {ar: "נועה ברק", he: "נועה ברק"}, title: {ar: "מומלץ בחום", he: "מומלץ בחום"}, text: { ar: "בשמים ברמה הכי גבוהה בארץ. השירות VIP.", he: "בשמים ברמה הכי גבוהה בארץ. השירות VIP." }, rating: 5, date: "أمس", likes: 25 },
    { name: {ar: "يوسف حاج", he: "יוסף חאג'"}, title: {ar: "بكج النخبة", he: "מארז העילית"}, text: { ar: "البكج وصلني مغلف بطريقة بتبيض الوجه كهدية. المسك عندكم فنان.", he: "המארז הגיע ארוזה בצורה יפה מאוד כמתנה. המושק אצלכם אליפות." }, rating: 5, date: "قبل يومين", likes: 63 },
    { name: {ar: "دانا ס.", he: "דנה ס."}, title: {ar: "W183 إدمان", he: "W183 ממכר"}, text: { ar: "صارلي شهر بستخدم W183 وما بقدر أغيره، ريحة فخامة.", he: "כבר חודש אני משתמשת ב-W183 ולא יכולה להחליף אותו, ריח יוקרתי." }, rating: 5, date: "قبل يومين", likes: 41 },
    { name: {ar: "رنا سلامة", he: "רנא סלאמה"}, title: {ar: "أفضل تجربة", he: "החוויה הכי טובה"}, text: { ar: "تعامل محترم وتوصيل سريع للناصرة، شكراً ماد بارفيوم.", he: "יחס מכבד ומשלוח מהיר לנצרת, תודה מד פרפומר." }, rating: 5, date: "قبل 3 أيام", likes: 55 },
    { name: {ar: "يوحاي ل.", he: "יוחאי ל."}, title: {ar: "ريحة فخمة", he: "ריח יוקרתי"}, text: { ar: "عطور بمستوى عالي جداً والريحة بتجنن.", he: "בשמים ברמה גבוהה מאוד והריח מדהים." }, rating: 5, date: "قبل 4 أيام", likes: 18 },
    { name: {ar: "منى وتد", he: "מונא ותד"}, title: {ar: "W183 نار", he: "W183 אש"}, text: { ar: "اليوم وصلني W183 وفعلاً نار، يسلموا إيديكم.", he: "היום הגיע לי W183 ובאמת אש, תודה רבה." }, rating: 5, date: "قبل ساعة", likes: 15 },
    { name: {ar: "إياد بشارة", he: "איאד בשארה"}, title: {ar: "مصداقية وأمانة", he: "אמינות ויושרה"}, text: { ar: "دايماً بطلب منكم، عطور أصلية وبوصل الطلب بسرعة.", he: "תמיד מזמין מכם, בשמים מקוריים וההזמנה מגיעה מהר." }, rating: 5, date: "قبل أسبوع", likes: 37 },
    { name: {ar: "خالد وتد", he: "ח'אלד ותד"}, title: {ar: "سعر مناسب جداً", he: "מחיר הוגן מאוד"}, text: { ar: "عطور بتنافس الماركات العالمية بسعر رخيص.", he: "בשמים שמתחרים במותגים בינלאומיים במחיר זול." }, rating: 4, date: "8 فبراير 2024", likes: 8 },
    { name: {ar: "ياسر م.", he: "יאסר מ."}, title: {ar: "توصيل سريع", he: "משלוח מהיר"}, text: { ar: "الطلب وصلني خلال يوم واحد للبيت.", he: "ההזמנה הגיעה תוך יום אחד עד הבית." }, rating: 5, date: "قبل أسبوعين", likes: 10 },
    { name: {ar: "ليان حبيب", he: "ליאן חביב"}, title: {ar: "ريحة فواحة", he: "ריח דומיננטי"}, text: { ar: "ريحة النظافة بكل العطور، تجربة ممتازة.", he: "ריח של ניקיון בכל הבשמים, חוויה מצוינת." }, rating: 5, date: "أمس", likes: 36 },
    { name: {ar: "سامر خوري", he: "סאמר ח'ורי"}, title: {ar: "أحلى هدية", he: "המתנה הכי יפה"}, text: { ar: "أخذت بكج المسك لمرتي وكثير انبسطت عليه.", he: "לקחתי מארז מושק לאשתי והיא מאוד שמחה." }, rating: 5, date: "قبل أسبوع", likes: 21 },
    { name: {ar: "جمانة أسدي", he: "ג'ומאנה אסדי"}, title: {ar: "أفضل شركة بالبلاد", he: "החברה הכי טובה בארץ"}, text: { ar: "كل عطر أحلى من الثاني، المسك الملكي خيال.", he: "כל בושם יותר יפה מהשני, המושק המלכותי דמיוני." }, rating: 5, date: "قبل شهر", likes: 48 },
    { name: {ar: "איתן סלע", he: "איתן סלע"}, title: {ar: "תמורה למחיר", he: "תמורה למחיר"}, text: { ar: "محירים فجز وبشמים ברמה של מותגים كببر.", he: "מחירים פגז ובשמים ברמה של מותגים גדולים." }, rating: 5, date: "قبل شهرين", likes: 71 },
    { name: {ar: "فرح س.", he: "פרח ס."}, title: {ar: "عطور فخمة", he: "בשמים יוקרתיים"}, text: { ar: "روائح كلاسيكية راقية جداً.", he: "ריחות קלאסיים ויוקרתיים מאוד." }, rating: 5, date: "قبل يومين", likes: 5 },
    { name: {ar: "أحمد جبارين", he: "אחמד ג'בארין"}, title: {ar: "تغليف رهيب", he: "אריזה מדהימה"}, text: { ar: "وصلتني الطلبية مغلفة بطريقة كتير مرتبة وفخمة.", he: "ההזמנה הגיעה ארוזה בצורה מאוד מסודרת ויוקרתית." }, rating: 5, date: "أمس", likes: 14 }
  ];

  useEffect(() => {
    const updateReviews = () => {
      const now = new Date();
      const hourIndex = now.getHours() % (poolOfReviews.length > 5 ? poolOfReviews.length - 5 : 1);
      setDisplayedReviews(poolOfReviews.slice(hourIndex, hourIndex + 6));
    };
    updateReviews();
    const interval = setInterval(updateReviews, 3600000); 
    return () => clearInterval(interval);
  }, []);

  const handleAddReview = (e) => {
    e.preventDefault();
    if (!newComment || !newTitle) return;

    const reviewName = lang === 'ar' ? "أنت (مراجعة خاصة)" : "אתה (ביקורת פרטית)";
    const review = {
      name: { ar: reviewName, he: reviewName }, // حفظ ككائن لتجنب خطأ Object rendering
      title: { ar: newTitle, he: newTitle },
      text: { ar: newComment, he: newComment },
      rating: newRating,
      date: lang === 'ar' ? "الآن" : "עכשיו",
      likes: 0,
      isUserGenerated: true
    };

    setUserReviews([review, ...userReviews]);
    setNewComment('');
    setNewTitle('');
    setShowForm(false);
  };

  const renderStars = (rating, size = 18, interactive = false) => (
    <div className="flex text-[#FFA41C]">
      {[...Array(5)].map((_, i) => (
        <Star 
          key={i} 
          size={size} 
          fill={i < Math.floor(rating) ? "currentColor" : "none"} 
          strokeWidth={1.5} 
          className={interactive ? "cursor-pointer" : ""}
          onClick={() => interactive && setNewRating(i + 1)}
        />
      ))}
    </div>
  );

  const toggleLanguage = () => setLang(lang === 'ar' ? 'he' : 'ar');

  return (
    <div className="min-h-screen bg-[#EAEDED] text-[#0F1111] font-sans selection:bg-[#FEBD69]" dir="rtl">
      {/* Amazon Header */}
      <header className="bg-[#131921] text-white p-3 sticky top-0 z-50 shadow-md">
        <div className="max-w-6xl mx-auto flex items-center justify-between gap-4">
          <div className="flex items-center gap-2">
            <div className="text-2xl font-bold flex items-center">
              MAD<span className="text-[#FF9900]">.</span>
            </div>
          </div>
          <div className="flex-1 max-w-xl hidden md:block">
            <div className="relative">
              <input type="text" className="w-full py-2 px-4 rounded-lg text-black focus:outline-[#FF9900]" placeholder={lang === 'ar' ? 'البحث في العروض...' : 'חיפוש במבצעים...'} />
              <div className="absolute left-0 top-0 h-full bg-[#FEBD69] px-4 rounded-l-lg flex items-center cursor-pointer hover:bg-[#F3A847]">
                <Globe size={18} className="text-black" />
              </div>
            </div>
          </div>
          <button onClick={toggleLanguage} className="flex items-center gap-1 border border-transparent hover:border-white p-1 transition-all rounded">
            <Globe size={18} /> <span className="text-sm font-bold">{lang === 'ar' ? 'עברית' : 'عربي'}</span>
          </button>
        </div>
      </header>

      <main className="max-w-6xl mx-auto py-6 px-4">
        {/* Offers Grid */}
        <div className="grid grid-cols-1 gap-6 mb-12">
          {links.map((offer) => (
            <div key={offer.key} className="bg-white border border-gray-200 p-4 rounded-sm flex flex-col md:flex-row gap-6 hover:shadow-md transition-shadow">
              <div className="w-full md:w-1/3 aspect-square relative">
                <img src={offer.img} alt={offer.title[lang]} className="w-full h-full object-contain" />
                <div className="absolute top-2 right-2 bg-[#CC0C39] text-white text-[10px] font-bold px-2 py-1 rounded-sm">
                  {content.limitedDeal[lang]}
                </div>
              </div>
              <div className="flex-1 flex flex-col justify-start items-start text-right">
                <div className="bg-[#E47911] text-white text-[10px] font-bold px-2 py-0.5 rounded-sm mb-2">
                  {content.amazonBadge[lang]}
                </div>
                <h3 className="text-xl font-medium mb-1 hover:text-[#C7511F] cursor-pointer">
                  {offer.title[lang]}
                </h3>
                <div className="flex items-center gap-2 mb-3">
                  {renderStars(offer.rating, 16)}
                  <span className="text-[#007185] text-sm hover:text-[#C7511F] cursor-pointer">{offer.reviewsCount}</span>
                </div>
                <p className="text-gray-600 text-sm mb-6">{offer.subtitle[lang]}</p>
                
                <div className="mt-auto w-full">
                  <p className="text-xs text-green-700 font-bold mb-3">{lang === 'ar' ? 'متوفر حالياً - عروض حصرية أونلاين' : 'זמין כעת - מבצעים בלעדיים אונליין'}</p>
                  <a href={offer.url} target="_blank" rel="noopener noreferrer" className="w-full md:w-64 bg-[#FFD814] hover:bg-[#F7CA00] border border-[#FCD200] py-2 rounded-full text-center text-sm font-bold shadow-sm active:scale-95 transition-all flex items-center justify-center gap-2">
                    <ShoppingBag size={16} />
                    {content.cta[lang]}
                  </a>
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* Amazon Review Section */}
        <div className="bg-white border border-gray-200 p-6 md:p-10 rounded-sm">
          <div className="flex flex-col lg:flex-row gap-12">
            <div className="w-full lg:w-1/3 text-right">
              <h2 className="text-2xl font-bold mb-4">{content.customerReviews[lang]}</h2>
              <div className="flex items-center gap-2 mb-2">
                {renderStars(4.9, 22)}
                <span className="text-lg font-bold">4.9 {lang === 'ar' ? 'من 5' : 'מתוך 5'}</span>
              </div>
              <p className="text-sm text-gray-500 mb-6">{content.globalRating[lang]}</p>

              {[5, 4, 3, 2, 1].map((star) => (
                <div key={star} className="flex items-center gap-3 mb-2 text-sm text-[#007185] hover:text-[#C7511F] cursor-pointer group">
                  <span className="w-12">{star} {lang === 'ar' ? 'نجوم' : 'כוכבים'}</span>
                  <div className="flex-1 h-5 bg-[#F0F2F2] rounded-sm overflow-hidden border border-gray-200">
                    <div className="h-full bg-[#FFA41C] border-r border-[#DE7921]" style={{ width: star === 5 ? '88%' : star === 4 ? '10%' : '2%' }}></div>
                  </div>
                  <span className="w-8 text-left">{star === 5 ? '88%' : star === 4 ? '10%' : '1%'}</span>
                </div>
              ))}
              
              <div className="mt-10 pt-6 border-t border-gray-200">
                <h4 className="font-bold mb-2">{lang === 'ar' ? 'مراجعة هذا المنتج' : 'בקר מוצר זה'}</h4>
                <p className="text-sm mb-4">{lang === 'ar' ? 'شارك أفكارك مع العملاء الآخرين' : 'שתף את המחשבות שלך עם לקוחות אחרים'}</p>
                {!showForm ? (
                   <button onClick={() => setShowForm(true)} className="w-full border border-gray-300 rounded-lg py-2 text-sm font-medium hover:bg-gray-50 shadow-sm transition-all">{content.writeReview[lang]}</button>
                ) : (
                  <form onSubmit={handleAddReview} className="bg-gray-50 p-4 rounded-lg border border-gray-200 animate-in fade-in slide-in-from-top-2">
                    <div className="mb-4">
                      <label className="block text-xs font-bold mb-1 uppercase tracking-wide">{lang === 'ar' ? 'تقييمك' : 'הדירוג שלך'}</label>
                      {renderStars(newRating, 24, true)}
                    </div>
                    <input type="text" value={newTitle} onChange={(e) => setNewTitle(e.target.value)} placeholder={content.titlePlaceholder[lang]} className="w-full p-2 mb-3 text-sm border border-gray-300 rounded focus:outline-[#FF9900]" required />
                    <textarea value={newComment} onChange={(e) => setNewComment(e.target.value)} placeholder={content.reviewPlaceholder[lang]} className="w-full p-2 mb-4 text-sm border border-gray-300 rounded h-24 focus:outline-[#FF9900]" required></textarea>
                    <div className="flex gap-2">
                      <button type="submit" className="flex-1 bg-[#FFD814] py-2 rounded-lg text-xs font-bold shadow-sm hover:bg-[#F7CA00]">{content.submitReview[lang]}</button>
                      <button type="button" onClick={() => setShowForm(false)} className="px-4 py-2 text-xs font-bold text-gray-500 hover:text-black">{lang === 'ar' ? 'إلغاء' : 'ביטול'}</button>
                    </div>
                  </form>
                )}
              </div>
            </div>

            <div className="flex-1 text-right">
              <div className="flex items-center justify-between mb-8 pb-4 border-b border-gray-100">
                <span className="font-bold text-sm uppercase tracking-wide">{lang === 'ar' ? 'أحدث المراجعات' : 'ביקורות אחרונות'}</span>
                <div className="flex items-center gap-1 text-xs text-gray-500 cursor-pointer hover:text-black">
                  {lang === 'ar' ? 'ترتيب حسب' : 'מיין לפי'}: <span className="font-bold">أحدث</span> <ChevronDown size={14} />
                </div>
              </div>

              <div className="space-y-10">
                {[...userReviews, ...displayedReviews].map((rev, idx) => (
                  <div key={idx} className={`flex flex-col gap-2 p-4 rounded-lg transition-all ${rev.isUserGenerated ? 'bg-[#fffdf0] border-r-4 border-[#FFA41C]' : ''}`}>
                    <div className="flex items-center gap-2">
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center ${rev.isUserGenerated ? 'bg-[#FFA41C] text-white' : 'bg-gray-200 text-gray-400'}`}>
                        <User size={20} />
                      </div>
                      {/* حل مشكلة Objects rendering عبر التأكد من جلب الاسم الصحيح */}
                      <span className="text-sm font-medium">{rev.name[lang] || rev.name}</span>
                    </div>
                    <div className="flex items-center gap-3">
                      {renderStars(rev.rating, 14)}
                      <span className="font-bold text-sm">{rev.title[lang]}</span>
                    </div>
                    <div className="text-xs text-gray-500">{lang === 'ar' ? `تمت المراجعة في ${rev.date}` : `נכתב ב-${rev.date}`}</div>
                    <div className="flex items-center gap-2">
                       <span className="text-[#C45500] text-xs font-bold underline cursor-default">{content.verified[lang]}</span>
                       {rev.isUserGenerated && <span className="text-[10px] bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full font-bold">{lang === 'ar' ? 'مراجعتك' : 'הביקורת שלך'}</span>}
                    </div>
                    <p className="text-sm leading-relaxed my-2">{rev.text[lang]}</p>
                    <div className="flex items-center gap-4 mt-2">
                      <button className="border border-gray-300 shadow-sm px-6 py-1 rounded-lg text-xs hover:bg-gray-50 active:bg-gray-100">{content.helpful[lang]}</button>
                      <span className="text-gray-300 text-sm">|</span>
                      <button className="text-gray-500 text-xs hover:text-[#C7511F]">{content.report[lang]}</button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>

        <footer className="mt-20 py-10 border-t border-gray-300 text-center">
          <div className="text-2xl font-black mb-8 flex items-center justify-center">MAD<span className="text-[#FF9900]">.</span></div>
          <div className="flex justify-center gap-8 text-gray-500 mb-8">
            <a href="#" className="hover:text-[#C7511F] transition-all"><Instagram size={24} /></a>
            <a href="#" className="hover:text-[#C7511F] transition-all"><Facebook size={24} /></a>
            <a href="#" className="hover:text-[#C7511F] transition-all"><MessageCircle size={24} /></a>
          </div>
          <p className="text-[10px] text-gray-500">{content.footer[lang]}</p>
        </footer>
      </main>

      <div className="fixed bottom-6 left-6 flex flex-col gap-3 z-50">
        <a href="https://wa.me/yournumber" className="w-14 h-14 bg-[#25D366] text-white rounded-full flex items-center justify-center shadow-xl hover:scale-110 transition-transform"><MessageCircle size={30} fill="currentColor" /></a>
      </div>
    </div>
  );
};

export default App;
