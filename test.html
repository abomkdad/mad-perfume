<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<!-- FONTS -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">

<!-- ICONS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- CSV -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<!-- ================= META PIXEL (Ø§Ù†Ø³Ø® ID ÙÙ‚Ø·) ================= -->
<script>
!function(f,b,e,v,n,t,s){
 if(f.fbq)return;n=f.fbq=function(){n.callMethod?
 n.callMethod.apply(n,arguments):n.queue.push(arguments)};
 if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
 n.queue=[];t=b.createElement(e);t.async=!0;
 t.src=v;s=b.getElementsByTagName(e)[0];
 s.parentNode.insertBefore(t,s)
}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init','PUT_META_PIXEL_ID_HERE');
fbq('track','PageView');
</script>

<!-- ================= TIKTOK PIXEL (Ø§Ù†Ø³Ø® ID ÙÙ‚Ø·) ================= -->
<script>
!function (w, d, t) {
 w.TiktokAnalyticsObject=t;
 var ttq=w[t]=w[t]||[];
 ttq.methods=["page","track","identify"];
 ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};
 for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
 ttq.load=function(e){
  var i="https://analytics.tiktok.com/i18n/pixel/events.js";
  ttq._i=ttq._i||{};
  ttq._i[e]=[];
  var o=d.createElement("script");
  o.type="text/javascript";o.async=!0;o.src=i+"?sdkid="+e;
  var a=d.getElementsByTagName("script")[0];
  a.parentNode.insertBefore(o,a)
 };
 ttq.load('PUT_TIKTOK_PIXEL_ID_HERE');
 ttq.page();
}(window, document, 'ttq');
</script>

<style>
:root{--bg:#0a0a0a;--card:#141414;--gold:#d4af37;--text:#fff;--muted:#aaa}
*{box-sizing:border-box}
body{
 margin:0;background:var(--bg);color:var(--text);
 font-family:'Cairo','Heebo',sans-serif;padding-bottom:80px
}
header{
 background:#000;padding:30px 15px;text-align:center;
 border-bottom:4px solid var(--gold)
}
.logo img{width:80px}
.brand{color:var(--gold);font-weight:800}
.branch-name{font-size:22px;font-weight:800;margin-top:6px}

.socials{
 display:flex;justify-content:center;gap:12px;margin-top:15px;flex-wrap:wrap
}
.socials a{
 width:42px;height:42px;border-radius:50%;
 border:1px solid var(--gold);
 color:var(--gold);
 display:flex;align-items:center;justify-content:center;
 text-decoration:none;font-size:18px
}

.products{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
 gap:15px;padding:15px
}
.card{
 background:var(--card);border-radius:16px;
 padding:12px;text-align:center
}
.card img{width:100%;border-radius:12px;background:#fff}
.code{margin-top:8px;font-weight:800}
.price{color:var(--gold);font-weight:700}
.btn{
 background:#25D366;color:#fff;
 padding:10px;border-radius:8px;
 text-decoration:none;font-weight:700;display:block;margin-top:10px
}

/* POPUP */
.popup-overlay{
 position:fixed;inset:0;
 background:rgba(0,0,0,.8);
 display:none;align-items:center;justify-content:center;
 z-index:9999
}
.popup{
 width:92%;max-width:420px;
 background:#0b0b0b;
 border:2px solid var(--gold);
 border-radius:18px;padding:12px;position:relative
}
.popup-close{
 position:absolute;top:10px;right:10px;
 background:#000;color:#fff;
 padding:6px 10px;border-radius:10px;cursor:pointer
}
.popup img{
 width:100%;aspect-ratio:1/1;
 object-fit:cover;border-radius:12px
}
.popup-cta{
 margin-top:12px;background:#22c55e;
 color:#fff;font-size:18px;font-weight:800;
 text-align:center;padding:14px;border-radius:14px;cursor:pointer
}
.popup-timer{
 margin-top:8px;text-align:center;
 color:var(--gold);font-weight:700
}
</style>
</head>

<body>

<header>
 <div class="logo">
  <img src="https://abomkdad.github.io/Digital-Business-Card/logo.png">
 </div>
 <div class="brand">MAD PARFUMEUR</div>
 <div id="branchName" class="branch-name"></div>
 <div class="socials" id="socials"></div>
</header>

<div class="products" id="products"></div>

<!-- POPUP -->
<div class="popup-overlay" id="popup">
 <div class="popup">
  <div class="popup-close" onclick="closePopup()">âœ•</div>
  <img src="sale.png">
  <div class="popup-cta" id="popupCta"></div>
  <div class="popup-timer" id="popupTimer"></div>
 </div>
</div>

<script>
/* ================= LANGUAGE ================= */
const lang=navigator.language.startsWith("he")?"he":"ar";
document.documentElement.lang=lang;
document.documentElement.dir="rtl";

const TXT={
 ar:{cta:"ðŸ”¥ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…",timer:"ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø®Ù„Ø§Ù„"},
 he:{cta:"ðŸ”¥ ×§×‘×œ ××ª ×ž×‘×¦×¢ ×”×™×•×",timer:"×”×”×¦×¢×” ×ž×¡×ª×™×™×ž×ª ×‘×¢×•×“"}
};

/* ================= HELPERS ================= */
function trackLead(source,branch){
 if(window.fbq) fbq('track','Lead',{source,branch});
 if(window.ttq) ttq.track('SubmitForm',{source,branch});
}

/* ================= COUNTDOWN ================= */
function startCountdown(){
 const el=document.getElementById("popupTimer");
 setInterval(()=>{
  const now=new Date();
  const end=new Date();end.setHours(24,0,0,0);
  const d=end-now;if(d<=0)return;
  const h=Math.floor(d/36e5),
        m=Math.floor(d/6e4)%60,
        s=Math.floor(d/1e3)%60;
  el.textContent=`${TXT[lang].timer} ${h}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
 },1000);
}

/* ================= MAIN ================= */
const branchID=new URLSearchParams(location.search).get("branch");

fetch("test.json").then(r=>r.json()).then(data=>{
 const branch=data.branches.find(b=>String(b.id)===branchID);
 if(!branch)return;

 document.getElementById("branchName").textContent=
  lang==="he"?branch.name_he:branch.name_ar;

 const phone="972"+branch.phone.replace(/^0/,"");

 /* SOCIALS */
 const icons=[
  ["location-dot",branch.social.waze],
  ["whatsapp",`https://wa.me/${phone}`],
  ["instagram",branch.social.instagram],
  ["tiktok",branch.social.tiktok],
  ["facebook-f",branch.social.facebook],
  ["envelope",branch.social.email?`mailto:${branch.social.email}`:null]
 ];
 document.getElementById("socials").innerHTML=
  icons.filter(i=>i[1]).map(i=>`
   <a href="${i[1]}" target="_blank"
    onclick="trackLead('${i[0]}',${branch.id})">
    <i class="fa-${i[0]==='envelope'?'solid':'brands'} fa-${i[0]}"></i>
   </a>`).join("");

 /* PRODUCTS */
 Papa.parse("products.csv",{download:true,header:true,complete:r=>{
  r.data.forEach(p=>{
   if(!p.Title)return;
   document.getElementById("products").innerHTML+=`
   <div class="card">
    <img src="${p.Image}">
    <div class="code">${p.Title}</div>
    <div class="price">${p.Price}</div>
    <a class="btn" href="https://wa.me/${phone}?text=${encodeURIComponent(p.Title)}"
     target="_blank" onclick="trackLead('product',${branch.id})">WhatsApp</a>
   </div>`;
  });
 }});

 /* POPUP */
 const key=`popup_${branch.id}_${new Date().toISOString().split("T")[0]}`;
 if(!localStorage.getItem(key)){
  document.getElementById("popup").style.display="flex";
  document.getElementById("popupCta").textContent=TXT[lang].cta;
  document.getElementById("popupCta").onclick=()=>{
   trackLead("popup",branch.id);
   window.open(`https://wa.me/${phone}`,"_blank");
  };
  startCountdown();
 }

 window.closePopup=function(){
  localStorage.setItem(key,"1");
  document.getElementById("popup").style.display="none";
 };
});
</script>

</body>
</html>
