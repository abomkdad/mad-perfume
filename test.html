<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAD PARFUMEUR | Elite Portal</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&family=Cairo:wght@700;900&family=Cinzel:wght@900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1072283127290819'); fbq('init', '365261313317768'); fbq('track', 'PageView');
        !function(w,d,t){w.TTPixel=w.TTPixel||[];var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=r+"?sdkid="+e+"&lib=ttq";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(a,s)};
        ttq.load('D2D02JBC77U4ENLN9SBG'); ttq.load('CR6S9CBCJ9B8B0Q6U30G'); ttq.page();
    }(window, document, 'ttq');

    function track(ev, name = "") {
        if(window.fbq) fbq('trackCustom', ev, {name: name});
        if(window.ttq) ttq.track('Contact', {content_name: ev + '_' + name});
    }
    </script>

    <style>
        :root { --blue: #0046be; --gold: #d4af37; --wa: #25D366; --bg: #f8fafc; }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #333; font-family: 'Assistant', sans-serif; direction: rtl; padding-bottom: 140px; }

        .top-wa { background: var(--wa); color: #fff; text-align: center; padding: 12px; font-weight: 800; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; position: sticky; top: 0; z-index: 2001; }
        
        header { background: linear-gradient(135deg, var(--blue), #002d7a); color: white; text-align: center; padding: 30px 15px; border-bottom: 3px solid var(--gold); border-radius: 0 0 35px 35px; }
        .logo { width: 85px; margin-bottom: 10px; }
        .staff-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #fff; object-fit: cover; margin: 10px auto; display: block; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        
        /* Social Icons Real Colors */
        .soc { display: flex; justify-content: center; gap: 15px; margin-top: 15px; }
        .soc a { font-size: 1.6rem; transition: 0.2s; }
        .fa-facebook { color: #1877F2; } .fa-instagram { color: #E4405F; } .fa-tiktok { color: #000; background: #fff; border-radius: 50%; padding: 1px; } .fa-waze { color: #33CCFF; } .fa-snapchat { color: #FFFC00; text-shadow: 0 0 1px #000; }

        .cats-bar { position: sticky; top: 46px; z-index: 1000; background: #fff; border-bottom: 1px solid #ddd; display: flex; overflow-x: auto; padding: 10px; gap: 10px; scrollbar-width: none; }
        .cat-btn { background: #f0f2f5; padding: 8px 18px; border-radius: 50px; cursor: pointer; white-space: nowrap; font-weight: 700; font-size: 0.9rem; border: none; }
        .cat-btn.active { background: var(--blue); color: #fff; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .card { background: #fff; border-radius: 15px; overflow: hidden; border: 1px solid #eee; display: flex; flex-direction: column; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .add-btn { background: var(--blue); color: #fff; border: none; padding: 10px; border-radius: 10px; font-weight: 800; width: 100%; margin-top: 5px; }
        .add-btn.added { background: #eef2f7; color: var(--blue); }

        /* Floating Buttons */
        #cart-fab { position: fixed; bottom: 85px; right: 20px; width: 60px; height: 60px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 2000; box-shadow: 0 5px 20px rgba(0,70,190,0.4); }
        #count { position: absolute; top: 0; right: 0; background: var(--gold); color: #000; width: 22px; height: 22px; border-radius: 50%; font-size: 11px; font-weight: 900; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; }
        #sale-fab { position: fixed; bottom: 85px; left: 20px; width: 60px; height: 60px; background: #fff; border-radius: 50%; border: 3px solid var(--gold); display: flex; align-items: center; justify-content: center; z-index: 2000; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} }

        /* Footer Sticky */
        .frag-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 2px solid var(--gold); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 2000; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .frag-btn { background: var(--gold); color: #000; padding: 8px 18px; border-radius: 20px; font-weight: 900; border: none; font-size: 12px; }

        .drawer { position: fixed; bottom: -100%; left: 0; width: 100%; height: 75%; background: #fff; border-top: 5px solid var(--blue); z-index: 10001; transition: 0.3s; border-radius: 30px 30px 0 0; padding: 20px; display: flex; flex-direction: column; }
        .drawer.open { bottom: 0; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 10005; padding: 20px; }
        .sale-box { width: 100%; max-width: 380px; background: #fff; border-radius: 20px; overflow: hidden; position: relative; border: 2px solid var(--gold); }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 10000; }
    </style>
</head>
<body>

<a id="wa-top" href="#" class="top-wa" target="_blank" onclick="track('TopWA')">
    <i class="fab fa-whatsapp"></i> <span id="wa-txt"></span>
</a>

<header>
    <img src="logo.png" class="logo">
    <img src="https://madperfume.ps/upload/01-2026/page/6966930e9af7f.png" class="staff-img">
    <h1 id="b-title" style="font-family:'Cinzel', serif; font-size:1.6rem; color:var(--gold); margin:5px 0;"></h1>
    <div id="b-status" style="font-weight:800; font-size:1rem;"></div>
    <div id="socials" class="soc"></div>
</header>

<div id="cats" class="cats-bar"></div>
<main id="p-grid" class="grid"></main>

<div id="cart-fab" onclick="toggleCart(true)"><i class="fas fa-shopping-bag" style="color:#fff; font-size:1.6rem"></i><div id="count">0</div></div>
<div id="sale-fab" onclick="toggleSale(true)"><i class="fas fa-gift" style="color:var(--gold); font-size:1.8rem;"></i></div>

<div class="frag-footer">
    <div style="text-align:right">
        <h5 id="f-h" style="color:var(--blue); font-size:13px; font-weight:900;"></h5>
        <p id="f-p" style="font-size:11px; color:#666;"></p>
    </div>
    <button id="f-b" class="frag-btn" onclick="toggleGate(true)"></button>
</div>

<div id="cart-drawer" class="drawer">
    <h2 id="cart-head" style="text-align:center; color:var(--blue); margin-bottom:15px;"></h2>
    <div id="cart-list" style="flex-grow:1; overflow-y:auto;"></div>
    <div id="total" style="text-align:center; font-size:1.5rem; font-weight:900; padding:15px 0;"></div>
    <button class="frag-btn" style="width:100%; padding:18px; border-radius:12px; background:var(--wa); color:#fff;" onclick="order()">
        <i class="fab fa-whatsapp"></i> <span id="order-txt"></span>
    </button>
</div>

<div id="gate" class="modal">
    <div style="background:#fff; border-radius:25px; padding:30px; text-align:center; max-width:350px;">
        <img src="https://www.fragrantica.com/favicon.ico" style="height:40px; margin-bottom:15px;">
        <h2 id="g-h" style="color:var(--blue); margin-bottom:10px;"></h2>
        <p id="g-p" style="font-size:13px; color:#555; margin-bottom:20px;"></p>
        <button class="frag-btn" style="width:100%; margin-bottom:10px;" onclick="window.open('https://www.fragrantica.com/designers/Mad-Parfumeur.html')"><span id="g-b"></span></button>
        <button style="background:none; border:none; color:#999; font-weight:bold;" onclick="toggleGate(false)"><span id="g-c"></span></button>
    </div>
</div>

<div id="sale-modal" class="modal">
    <div class="sale-box">
        <span style="position:absolute; top:10px; right:15px; font-size:2rem; cursor:pointer;" onclick="toggleSale(false)">&times;</span>
        <img src="sale.png" style="width:100%;">
        <div id="timer" style="background:var(--gold); text-align:center; padding:10px; font-size:1.8rem; font-weight:900;">00:00:00</div>
        <button class="frag-btn" style="width:100%; border-radius:0; padding:15px;" onclick="track('ClaimOffer'); order()"><span id="s-b"></span></button>
    </div>
</div>

<div id="overlay" onclick="toggleCart(false)"></div>

<script>
const bID = new URLSearchParams(window.location.search).get('branch') || 1;
const lang = navigator.language.startsWith('ar') ? 'ar' : 'he';

const T = {
    ar: { all:'الكل', add:'إضافة', in:'في السلة', total:'المجموع:', order:'طلب عبر واتساب', cart:'سلة المشتريات', wa:'تحدث معنا واتساب', open:'مفتوح الآن', closed:'مغلق حالياً', f1:'MAD العالمية', f2:'الأعلى تقييماً في Fragrantica', f3:'استكشف', g1:'العالم يثق بـ MAD', g2:'اكتشف لماذا تُصنف عطورنا كأفضل عطور نيش عالمياً.', g3:'شاهد التقييمات', g4:'إغلاق', s_b:'احصل على العرض' },
    he: { all:'הכל', add:'הוסף', in:'בסל', total:'סה"כ:', order:'הזמן בוואטסאפ', cart:'سל קניות', wa:'דברו איתנו בוואטסאפ', open:'פתוח עכשיו', closed:'סגור כעת', f1:'MAD העולמית', f2:'המדורגת ביותר ב-Fragrantica', f3:'גלה עכשיו', g1:'העולם בוטח ב-MAD', g2:'גלו מדוע הבשמים שלנו מדורגים כטובים בעולם.', g3:'לצפייה בדירוגים', g4:'סגור', s_b:'קבל את המבצע' }
}[lang];

let DB = { b: null, p: [], cart: [] };

async function init() {
    try {
        const [brs, prs] = await Promise.all([fetch('branches.json').then(r => r.json()), fetch('products.csv').then(r => r.text())]);
        DB.b = brs.branches.find(x => x.id == bID) || brs.branches[0];
        const rows = prs.split('\n');
        const cIdx = lang === 'ar' ? 11 : 10;
        for(let i=1; i<rows.length; i++) {
            const c = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if(c[0]) DB.p.push({ id:i, n:c[0].replace(/"/g,''), img:c[3]?.trim(), p:parseFloat(c[9]?.replace(/[^\d.]/g,''))||0, ps:c[9]?.replace('ILS','').trim()+' ₪', cat:c[cIdx]?.trim() });
        }
        render();
        startTimer();
    } catch(e) { console.log(e); }
}

function render() {
    const b = DB.b;
    document.getElementById('b-title').innerText = lang==='ar'?b.name_ar:b.name_he;
    document.getElementById('wa-txt').innerText = T.wa;
    document.getElementById('wa-top').href = `https://wa.me/972${b.phone.substring(1)}`;
    document.getElementById('f-h').innerText = T.f1; document.getElementById('f-p').innerText = T.f2; document.getElementById('f-b').innerText = T.f3;
    document.getElementById('g-h').innerText = T.g1; document.getElementById('g-p').innerText = T.g2; document.getElementById('g-b').innerText = T.g3; document.getElementById('g-c').innerText = T.g4;
    document.getElementById('cart-head').innerText = T.cart; document.getElementById('order-txt').innerText = T.order; document.getElementById('s-b').innerText = T.s_b;

    const icons = { facebook:'fa-facebook', instagram:'fa-instagram', tiktok:'fa-tiktok', waze:'fa-waze', snapchat:'fa-snapchat' };
    let socH = '';
    Object.entries(b.social || {}).forEach(([k,v]) => { if(v && icons[k]) socH += `<a href="${v}" target="_blank" onclick="track('Soc_${k}')"><i class="fab ${icons[k]}"></i></a>`; });
    document.getElementById('socials').innerHTML = socH;

    const now = new Date(); const day = ['sun','mon','tue','wed','thu','fri','sat'][now.getDay()];
    const time = now.getHours() * 60 + now.getMinutes(); let open = false;
    if(b.schedule?.[day]) b.schedule[day].forEach(s => { if(time >= parseInt(s[0].split(':')[0])*60 && time < parseInt(s[1].split(':')[0])*60) open = true; });
    document.getElementById('b-status').innerText = open ? T.open : T.closed; document.getElementById('b-status').style.color = open ? '#2ecc71' : '#e74c3c';

    const cats = [T.all, ...new Set(DB.p.map(x => x.cat))].filter(Boolean);
    document.getElementById('cats').innerHTML = cats.map(c => `<div class="cat-btn ${c===T.all?'active':''}" onclick="filter(this, '${c}')">${c}</div>`).join('');
    grid(T.all);
}

function filter(el, c) { document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active')); el.classList.add('active'); grid(c); }
function grid(f) {
    const list = f === T.all ? DB.p : DB.p.filter(x => x.cat === f);
    document.getElementById('p-grid').innerHTML = list.map(p => {
        const inC = DB.cart.some(x => x.id === p.id);
        return `<div class="card"><img src="${p.img}" loading="lazy"><div style="padding:10px; text-align:center;">
        <div style="font-size:12px; font-weight:bold; height:32px; overflow:hidden;">${p.n}</div>
        <div style="color:var(--blue); font-weight:900; margin:5px 0;">${p.ps}</div>
        <button class="add-btn ${inC?'added':''}" onclick="add(${p.id}, this)">${inC?T.in:T.add}</button></div></div>`;
    }).join('');
}

function add(id, btn) {
    if(DB.cart.some(x => x.id === id)) return;
    DB.cart.push(DB.p.find(x => x.id === id)); btn.classList.add('added'); btn.innerText = T.in; update();
}

function update() {
    document.getElementById('count').innerText = DB.cart.length; let tot = 0;
    document.getElementById('cart-list').innerHTML = DB.cart.map(x => { tot += x.p; return `<div style="display:flex; align-items:center; gap:10px; padding:10px; border-bottom:1px solid #eee;"><img src="${x.img}" style="width:35px;"><div style="flex-grow:1; font-size:12px; font-weight:bold;">${x.n}</div><div>${x.ps}</div><i class="fas fa-trash" style="color:#ff4d4d" onclick="remove(${x.id})"></i></div>`; }).join('');
    document.getElementById('total').innerText = T.total + ' ' + tot + ' ₪';
}

function remove(id) { DB.cart = DB.cart.filter(x => x.id !== id); update(); grid(T.all); }
function toggleCart(s) { document.getElementById('cart-drawer').classList.toggle('open', s); document.getElementById('overlay').style.display = s ? 'block' : 'none'; }
function toggleGate(s) { document.getElementById('gate').style.display = s ? 'flex' : 'none'; }
function toggleSale(s) { document.getElementById('sale-modal').style.display = s ? 'flex' : 'none'; }

function startTimer() { setInterval(() => { const d = new Date().setHours(23,59,59) - new Date(); document.getElementById('timer').innerText = new Date(d).toISOString().substr(11, 8); }, 1000); }
function order() { let m = "*Order:*\n"; DB.cart.forEach((x, i) => m += `${i+1}. ${x.n}\n`); window.open(`https://wa.me/972${DB.b.phone.substring(1)}?text=${encodeURIComponent(m)}`, '_blank'); }

init();
</script>
</body>
</html>
