<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MAD PARFUMEUR | Elite Branch Portal</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Assistant:wght@400;700&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Meta Pixel -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){
n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window,document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init','1072283127290819');
fbq('track','PageView');
</script>

<!-- TikTok Pixel -->
<script>
!function(w,d,t){
w.TiktokAnalyticsObject=t;
var ttq=w[t]=w[t]||[];
ttq.methods=["page","track","identify","instances","debug","on","off","once","ready"];
ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat([].slice.call(arguments)))}}; 
for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
ttq.load=function(e){
var s=d.createElement("script");
s.async=true;
s.src="https://analytics.tiktok.com/i18n/pixel/events.js?sdkid="+e;
var x=d.getElementsByTagName("script")[0];
x.parentNode.insertBefore(s,x);
};
ttq.load('D2D02JBC77U4ENLN9SBG');
ttq.page();
}(window,document,'ttq');

function trackLead(name){
if(window.fbq) fbq('track','Lead',{content_name:name});
if(window.ttq) ttq.track('Lead',{content_name:name});
}
</script>

<style>
:root{--gold:#D4AF37;--black:#080808;--wa:#25D366;--live-red:#ff0000;--live-green:#00ff00}
*{box-sizing:border-box;margin:0;padding:0}
body{background:#080808;color:#fff;font-family:'Assistant','Cairo',sans-serif;overflow-x:hidden;padding-bottom:140px;opacity:0;transition:.4s}
.top-wa-bar{background:var(--wa);color:#fff;text-align:center;padding:12px;font-weight:900;display:flex;gap:10px;justify-content:center;align-items:center;position:sticky;top:0;z-index:2001}
header{text-align:center;padding:30px 20px;background:linear-gradient(rgba(0,0,0,.8),#000),url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover;border-bottom:2px solid var(--gold)}
.logo-img{max-width:120px;margin-bottom:15px}
.staff-wrapper{position:relative;width:100px;height:100px;margin:0 auto 15px}
.staff-img{width:100%;height:100%;border-radius:50%;border:3px solid var(--gold);object-fit:cover}
.status-dot{position:absolute;bottom:5px;right:5px;width:20px;height:20px;border-radius:50%;border:3px solid #000}
.branch-title{font-family:'Cinzel';font-size:1.7rem;color:var(--gold);font-weight:900}
.open-status-text{font-weight:900;margin-top:5px}
.social-icons{display:flex;justify-content:center;gap:15px;margin:20px 0}
.social-icons a{width:45px;height:45px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.15)}
.cats-wrapper{position:sticky;top:48px;background:#080808f0;border-bottom:1px solid #222;z-index:1000}
.cats-container{display:flex;gap:10px;overflow-x:auto;padding:12px}
.cat-pill{display:flex;align-items:center;background:#1a1a1a;border-radius:50px;padding:5px 15px;gap:10px;cursor:pointer}
.cat-pill img{width:38px;height:38px;border-radius:50%;border:1.5px solid var(--gold)}
.cat-pill.active{background:var(--gold);color:#000}
.shop-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:15px}
.p-card{background:#121212;border-radius:15px;overflow:hidden}
.p-card img{width:100%;aspect-ratio:1/1;object-fit:cover}
.p-info{padding:12px;text-align:center}
.add-btn{background:var(--gold);border:none;padding:10px;border-radius:8px;font-weight:900}
.add-btn.added{background:#333;color:#fff}
#cart-fab{position:fixed;bottom:100px;right:20px;width:60px;height:60px;border-radius:50%;background:var(--gold);display:flex;align-items:center;justify-content:center;z-index:2000}
#cart-count{position:absolute;top:-2px;right:-2px;background:red;width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px}
.drawer{position:fixed;bottom:-100%;left:0;width:100%;height:80%;background:#0a0a0a;border-top:3px solid var(--gold);transition:.4s;z-index:10001;padding:25px;border-radius:25px 25px 0 0}
.drawer.open{bottom:0}
.checkout-btn{background:var(--wa);border:none;width:100%;padding:18px;border-radius:12px;font-weight:900;margin-top:15px}
</style>
</head>

<body>

<a id="top-wa-btn" class="top-wa-bar" target="_blank" onclick="trackLead('Top WhatsApp')">
<i class="fab fa-whatsapp"></i><span id="top-wa-txt"></span>
</a>

<header>
<img src="logo.png" class="logo-img">
<div class="staff-wrapper">
<img src="https://madperfume.ps/upload/01-2026/page/6966930e9af7f.png" class="staff-img">
<div id="status-dot" class="status-dot"></div>
</div>
<div id="br-name" class="branch-title"></div>
<div id="open-status-display" class="open-status-text"></div>
<div id="br-social" class="social-icons"></div>
</header>

<div class="cats-wrapper"><div id="cats-box" class="cats-container"></div></div>
<main id="main-grid" class="shop-grid"></main>

<div id="cart-fab" onclick="toggleCart(true)">
<i class="fas fa-shopping-bag" style="color:#000;font-size:1.8rem"></i>
<div id="cart-count">0</div>
</div>

<div id="cart-drawer" class="drawer">
<h2 id="cart-title" style="text-align:center;color:var(--gold)"></h2>
<div id="cart-list" style="flex-grow:1;overflow:auto"></div>
<div id="cart-total" style="text-align:center;color:var(--gold);font-size:1.4rem"></div>
<button class="checkout-btn" onclick="sendOrder()">
<i class="fab fa-whatsapp"></i> <span id="check-txt"></span>
</button>
</div>

<div id="overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;z-index:10000" onclick="closeAll()"></div>

<script>
const params=new URLSearchParams(location.search);
const branchID=parseInt(params.get('branch'))||1;
const lang=navigator.language.startsWith('ar')?'ar':'he';

const TXT={
ar:{all:'الكل',add:'إضافة للسلة',added:'في السلة',total:'المجموع:',check:'إرسال الطلب عبر واتساب',prefix:'فرع ',wa_top:'تحدث معنا عبر واتساب',open:'مفتوح الآن',closed:'مغلق الآن',cart:'سلة المشتريات'},
he:{all:'הכל',add:'הוסף לסל',added:'בסל',total:'סה"כ:',check:'שליחת הזמנה בוואטסאפ',prefix:'סניף ',wa_top:'דברו איתנו בוואטסאפ',open:'פתוח עכשיו',closed:'סגור כעת',cart:'סל קניות'}
};

let STATE={branch:null,products:[],cart:[]};

async function init(){
const [bj,pc]=await Promise.all([
fetch('branches.json').then(r=>r.json()),
fetch('products.csv').then(r=>r.text())
]);
STATE.branch=bj.branches.find(b=>b.id===branchID)||bj.branches[0];
parseData(pc);
renderHeader();
updateBranchStatus();
setInterval(updateBranchStatus,60000);
renderCats();
renderGrid('all');
document.body.style.opacity=1;
}

function parseData(text){
const lines=text.trim().split('\n');
const headers=lines[0].split(',');
const idx={
title:headers.indexOf('title'),
image:headers.indexOf('image'),
price:headers.indexOf('price'),
cat_ar:headers.indexOf('category_ar'),
cat_he:headers.indexOf('category_he')
};
for(let i=1;i<lines.length;i++){
const c=lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
if(!c[idx.title])continue;
STATE.products.push({
id:i,
title:c[idx.title].replace(/"/g,''),
img:c[idx.image]||'logo.png',
price:parseFloat(c[idx.price])||0,
priceStr:c[idx.price]+' ₪',
cat:lang==='ar'?c[idx.cat_ar]:c[idx.cat_he]
});
}
}

function renderHeader(){
const b=STATE.branch,t=TXT[lang];
document.getElementById('br-name').textContent=t.prefix+(lang==='ar'?b.name_ar:b.name_he);
document.getElementById('top-wa-txt').textContent=t.wa_top;
document.getElementById('top-wa-btn').href=`https://api.whatsapp.com/send/?phone=972${b.phone.substring(1)}`;
document.getElementById('cart-title').textContent=t.cart;
document.getElementById('check-txt').textContent=t.check;
}

function updateBranchStatus(){
const dot=document.getElementById('status-dot');
const txt=document.getElementById('open-status-display');
dot.style.background='var(--live-green)';
txt.textContent=TXT[lang].open;
txt.style.color='var(--live-green)';
}

function renderCats(){
const cats=[...new Set(STATE.products.map(p=>p.cat))].filter(Boolean);
const box=document.getElementById('cats-box');
let html=`<div class="cat-pill active" onclick="filterCats(this,'all')">${TXT[lang].all}</div>`;
cats.forEach(c=>html+=`<div class="cat-pill" onclick="filterCats(this,'${c}')">${c}</div>`);
box.innerHTML=html;
}

function filterCats(el,name){
document.querySelectorAll('.cat-pill').forEach(p=>p.classList.remove('active'));
el.classList.add('active');
renderGrid(name);
}

function renderGrid(f){
const g=document.getElementById('main-grid');
const list=f==='all'?STATE.products:STATE.products.filter(p=>p.cat===f);
let html='';
list.forEach(p=>{
const inCart=STATE.cart.some(i=>i.id===p.id);
html+=`
<div class="p-card">
<img src="${p.img}">
<div class="p-info">
<div>${p.title}</div>
<div style="color:var(--gold)">${p.priceStr}</div>
<button class="add-btn ${inCart?'added':''}" onclick="addToCart(${p.id},this)">
${inCart?TXT[lang].added:TXT[lang].add}
</button>
</div>
</div>`;
});
g.innerHTML=html;
}

function addToCart(id,btn){
if(STATE.cart.some(i=>i.id===id))return;
STATE.cart.push(STATE.products.find(p=>p.id===id));
btn.classList.add('added');
btn.textContent=TXT[lang].added;
updateCartUI();
}

function updateCartUI(){
document.getElementById('cart-count').textContent=STATE.cart.length;
let html='',total=0;
STATE.cart.forEach(i=>{
total+=i.price;
html+=`<div>${i.title} - ${i.priceStr}</div>`;
});
document.getElementById('cart-list').innerHTML=html;
document.getElementById('cart-total').textContent=`${TXT[lang].total} ${total} ₪`;
}

function toggleCart(s){
document.getElementById('cart-drawer').classList.toggle('open',s);
document.getElementById('overlay').style.display=s?'block':'none';
}

function closeAll(){
toggleCart(false);
}

function sendOrder(){
let m=TXT[lang].check+"\n";
STATE.cart.forEach((i,n)=>m+=`${n+1}. ${i.title}\n`);
trackLead('Checkout');
window.open(`https://api.whatsapp.com/send/?phone=972${STATE.branch.phone.substring(1)}&text=${encodeURIComponent(m)}`,'_blank');
}

init();
</script>
</body>
</html>
