<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>MAD PARFUMEUR | Online Official Shop</title>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Assistant:wght@400;700&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init','1072283127290819'); fbq('track', 'PageView');
    </script>

    <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
    var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
    ;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
      ttq.load('D2D02JBC77U4ENLN9SBG');
      ttq.page();
    }(window, document, 'ttq');

    // وظيفة تتبع الـ Lead
    function trackLead() {
        if (window.ttq) {
            ttq.track('Contact'); // احتساب ليد في تيك توك
        }
        if (window.fbq) {
            fbq('track', 'Lead'); // احتساب ليد في فيسبوك
        }
    }
    </script>

    <style>
        :root{ --gold:#D4AF37; --black:#000; --card:#111; --white:#fff; --wa:#25D366; --live-red:#ff0000; }
        *{box-sizing:border-box; margin:0; padding:0}
        body{background:#000; color:#fff; font-family:'Assistant', 'Cairo', sans-serif; opacity:0; transition: opacity 0.5s; padding-bottom: 100px;}

        header{
            position: relative; text-align:center; padding: 60px 20px;
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.9)), url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover;
            border-bottom: 2px solid var(--gold);
        }
        .logo-img { max-width: 140px; margin-bottom: 15px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        .brand-name{font-size:2rem; font-weight:900; color: var(--gold); letter-spacing: 1px;}
        .online-label { display: inline-block; background: var(--wa); color: #000; padding: 5px 15px; border-radius: 20px; font-weight: 800; font-size: 14px; margin-top: 10px; }

        .action-grid { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
        .action-item {
            background: #111; border: 1px solid var(--gold); padding: 15px 25px; border-radius: 15px;
            text-decoration: none; color: white; text-align: center; transition: 0.3s;
        }
        .action-item i { display: block; font-size: 24px; color: var(--gold); margin-bottom: 8px; }

        .cats-wrapper { position: sticky; top: 0; background: rgba(0,0,0,0.95); z-index: 100; border-bottom: 1px solid #222; backdrop-filter: blur(10px); }
        .cats{display:flex; gap:10px; overflow-x:auto; padding:15px; scrollbar-width:none;}
        .cats::-webkit-scrollbar{display:none}
        .cats button{ background: #222; color: #ccc; border: 1px solid #333; padding: 10px 24px; border-radius: 50px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 700; }
        .cats button.active{background: var(--gold); color: #000; border-color: var(--gold);}

        .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px; padding:15px}
        @media(min-width:768px){.grid{grid-template-columns:repeat(4,1fr); gap:20px}}
        .card{background:#111; border:1px solid #222; border-radius:15px; overflow:hidden; display: flex; flex-direction: column; transition: 0.3s;}
        .card:hover { transform: translateY(-5px); border-color: var(--gold); }
        .img { position: relative; width: 100%; aspect-ratio: 1/1; background: #080808;}
        .img img{width:100%; height: 100%; object-fit:cover; opacity:0; transition:.5s}
        .img img.loaded{opacity:1}
        .info{padding:15px; text-align:center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between;}
        .product-title { font-size:0.9rem; font-weight: 700; margin-bottom: 10px; height: 2.5em; overflow: hidden; }
        .price{color:var(--gold); font-weight:900; margin:10px 0; font-size: 1.3rem}
        .wa-btn{background:var(--wa); color:#fff; text-decoration:none; padding:12px; font-weight:900; border-radius:10px; display:flex; align-items:center; justify-content:center; gap:8px;}

        .sticky-footer-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #111; border-top: 2px solid var(--gold);
            padding: 12px 15px; display: flex; justify-content: space-between;
            align-items: center; z-index: 999;
        }
        .open-frag-btn { background: var(--gold); color: #000; padding: 10px 20px; border-radius: 25px; font-weight: 900; border: none; cursor: pointer; }
    </style>
</head>

<body dir="rtl">

<header>
    <img src="logo.png" alt="MAD" class="logo-img">
    <div class="brand-name">MAD PARFUMEUR</div>
    <div id="shop-label" class="online-label"></div>
    
    <div class="action-grid">
        <a id="wa-link" href="#" class="action-item" onclick="trackLead()">
            <i class="fab fa-whatsapp"></i>
            <span id="wa-text"></span>
        </a>
        <a href="tel:*9935" class="action-item">
            <i class="fas fa-phone-alt"></i>
            <span id="call-text"></span>
        </a>
    </div>
</header>

<div class="cats-wrapper"><nav id="cats" class="cats"></nav></div>
<main id="grid" class="grid"></main>

<div class="sticky-footer-bar">
    <div class="txt-side">
        <h5 id="foot-h" style="color:var(--gold)"></h5>
        <p id="foot-p" style="font-size:10px"></p>
    </div>
    <button class="open-frag-btn" onclick="window.open('https://www.fragrantica.com/designers/Mad-Parfumeur.html', '_blank')" id="foot-b"></button>
</div>

<script>
const lang = navigator.language.startsWith('ar') ? 'ar' : 'he';
const CORP_PHONE = "0509787730"; 

const TXT = {
    he: { 
        shop: 'חנות אונליין רשמית', wa: 'שלחו لنا הודעה', call: 'מוקד שירות', all: 'הכל', 
        order: 'הזמנה מהירה', msg: 'היי, אני מעוניין להזמין אונליין: ',
        f_h: 'MAD: המותג המדורג בעולם', f_p: 'אנציקלופדיית Fragrantica העולמית', f_b: 'למידע נוסף'
    },
    ar: { 
        shop: 'المتجر الإلكتروني الرسمي', wa: 'تواصل معنا', call: 'مركز الخدمة', all: 'الكل', 
        order: 'طلب سريع', msg: 'مرحباً، أود الطلب أونلاين: ',
        f_h: 'MAD: الأعلى تقييماً عالمياً', f_p: 'عبر موسوعة Fragrantica العالمية', f_b: 'اكتشف المزيد'
    }
};

let products = [];

function buildWaUrl(phone, text) {
    let cleanPhone = phone.replace(/\D/g, ''); 
    if (cleanPhone.startsWith('0')) cleanPhone = '972' + cleanPhone.substring(1);
    return `https://api.whatsapp.com/send/?phone=${cleanPhone}&text=${encodeURIComponent(text)}&type=phone_number&app_absent=0`;
}

async function start() {
    try {
        const res = await fetch('products.csv');
        const text = await res.text();
        parseCSV(text);
        renderUI();
    } catch (e) { console.error("CSV Load Error", e); }
}

function parseCSV(text) {
    const lines = text.split('\n');
    const catIndex = (lang === 'ar') ? 11 : 10; 
    
    for(let i=1; i<lines.length; i++){
        const c = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(!c[0]) continue;
        products.push({ 
            title: c[0].replace(/"/g,'').trim(), 
            img: c[3] ? c[3].trim() : '', 
            price: c[9] ? c[9].replace('ILS', '').trim() + ' ₪' : '', 
            cat: c[catIndex] ? c[catIndex].trim() : '' 
        });
    }
}

function renderUI() {
    const t = TXT[lang];
    document.getElementById('shop-label').textContent = t.shop;
    document.getElementById('wa-text').textContent = t.wa;
    document.getElementById('call-text').textContent = t.call;
    document.getElementById('wa-link').href = buildWaUrl(CORP_PHONE, t.msg);
    
    document.getElementById('foot-h').textContent = t.f_h;
    document.getElementById('foot-p').textContent = t.f_p;
    document.getElementById('foot-b').textContent = t.f_b;

    renderCats(); renderGrid('all');
    document.body.style.opacity = "1";
}

function renderCats() {
    const t = TXT[lang];
    const cats = [t.all, ...new Set(products.map(p => p.cat))].filter(Boolean);
    const nav = document.getElementById('cats'); nav.innerHTML = '';
    cats.forEach(c => {
        const btn = document.createElement('button'); btn.textContent = c; btn.className = c === t.all ? 'active' : '';
        btn.onclick = (e) => {
            document.querySelectorAll('.cats button').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active'); renderGrid(c === t.all ? 'all' : c);
        };
        nav.appendChild(btn);
    });
}

function renderGrid(f) {
    const g = document.getElementById('grid'); g.innerHTML = ''; const t = TXT[lang];
    const list = f === 'all' ? products : products.filter(p => p.cat === f);
    
    const obs = new IntersectionObserver(es => {
        es.forEach(e => { if(e.isIntersecting){ e.target.src = e.target.dataset.src; e.target.onload = () => e.target.classList.add('loaded'); } });
    });

    list.forEach(p => {
        const d = document.createElement('div'); d.className = 'card';
        const waProductUrl = buildWaUrl(CORP_PHONE, t.msg + p.title);
        d.innerHTML = `
            <div class="img"><img data-src="${p.img}"></div>
            <div class="info">
                <div class="product-title">${p.title}</div>
                <div class="price">${p.price}</div>
                <a class="wa-btn" target="_blank" href="${waProductUrl}" onclick="trackLead()">
                    <i class="fab fa-whatsapp"></i> ${t.order}
                </a>
            </div>`;
        g.appendChild(d); obs.observe(d.querySelector('img'));
    });
}

start();
</script>
</body>
</html>
