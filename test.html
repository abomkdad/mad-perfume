<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>MAD PARFUMEUR | Official Online Shop</title>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Assistant:wght@400;700&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --gold: #D4AF37; --black: #000; --card: #111; --wa: #25D366; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: #000; color: #fff; font-family: 'Assistant', 'Cairo', sans-serif; opacity: 0; transition: opacity 0.5s; padding-bottom: 120px; overflow-x: hidden; }

        header {
            position: relative; text-align: center; padding: 40px 20px;
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.95)), url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }
        .logo-img { max-width: 120px; margin-bottom: 15px; }

        /* --- تثبيت الشريط ومنع الفراغ --- */
        .cats-wrapper { 
            position: sticky; 
            top: 0; 
            background: rgba(10, 10, 10, 0.98); 
            z-index: 1000; 
            border-bottom: 2px solid var(--gold);
            padding: 15px 0; 
            overflow: hidden; 
            width: 100%;
        }

        .marquee-container {
            display: flex;
            width: max-content; /* هام جداً للحسابات */
            will-change: transform;
            animation: scroll-loop 40s linear infinite;
        }

        /* الربط اللامتناهي: نتحرك لنصف العرض المكرر فقط */
        @keyframes scroll-loop {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .cats-wrapper:hover .marquee-container { animation-play-state: paused; }

        .cat-item {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.05);
            color: #ddd;
            border: 1px solid rgba(212, 175, 55, 0.2);
            padding: 6px 18px 6px 6px;
            border-radius: 50px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 700;
            margin: 0 10px; /* مسافة متساوية بين العناصر */
            transition: 0.3s;
            gap: 10px;
        }

        .cat-thumb { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 1px solid var(--gold); }
        .cat-item.active { background: var(--gold); color: #000; border-color: #fff; box-shadow: 0 0 15px rgba(212, 175, 55, 0.5); }

        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 15px; }
        @media(min-width: 768px){ .grid { grid-template-columns: repeat(4, 1fr); gap: 20px; } }
        .card { background: #111; border: 1px solid #222; border-radius: 20px; overflow: hidden; display: flex; flex-direction: column; }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .info { padding: 15px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .price { color: var(--gold); font-weight: 900; font-size: 1.2rem; margin: 8px 0; font-family: 'Cinzel', serif; }
        .wa-btn { background: var(--wa); color: #fff; text-decoration: none; padding: 12px; border-radius: 12px; font-weight: 800; text-align: center; }
    </style>
</head>

<body dir="rtl">

<header>
    <img src="logo.png" class="logo-img">
    <div class="brand-name" style="font-family:'Cinzel'; color:var(--gold); font-size: 1.8rem; font-weight: 900;">MAD PARFUMEUR</div>
</header>

<div class="cats-wrapper">
    <div id="cats" class="marquee-container">
        </div>
</div>

<main id="grid" class="grid"></main>

<script>
const lang = navigator.language.startsWith('ar') ? 'ar' : 'he';
const CORP_PHONE = "0509787730"; 

const TXT = {
    he: { all: 'הכל', order: 'הזמנה', msg: 'היי, אשمح להזמין: ' },
    ar: { all: 'الكل', order: 'طلب سريع', msg: 'مرحباً، أود طلب: ' }
};

function buildWaUrl(phone, text) {
    let cleanPhone = phone.replace(/\D/g, ''); 
    if (cleanPhone.startsWith('0')) cleanPhone = '972' + cleanPhone.substring(1);
    return `https://api.whatsapp.com/send/?phone=${cleanPhone}&text=${encodeURIComponent(text)}`;
}

async function start() {
    try {
        const res = await fetch('products.csv');
        const text = await res.text();
        const lines = text.split('\n');
        const catColIndex = (lang === 'ar') ? 11 : 10; 

        const products = lines.slice(1).map(line => {
            const c = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if (!c[0]) return null;
            return { title: c[0].replace(/"/g,'').trim(), img: c[3]?.trim(), price: c[9]?.replace('ILS','').trim() + ' ₪', cat: c[catColIndex]?.replace(/"/g,'').trim() };
        }).filter(p => p);

        window.allProducts = products;
        renderUI(products);
    } catch (e) { console.error(e); }
}

function renderUI(products) {
    const t = TXT[lang];
    const uniqueCats = [...new Set(products.map(p => p.cat))].filter(Boolean);
    const nav = document.getElementById('cats');
    
    const catData = [{ name: t.all, img: 'logo.png' }];
    uniqueCats.forEach(name => {
        const p = products.find(prod => prod.cat === name);
        catData.push({ name: name, img: p ? p.img : 'logo.png' });
    });

    // إنشاء محتوى الأزرار
    const buttonsHtml = catData.map(cat => `
        <div class="cat-item ${cat.name === t.all ? 'active' : ''}" onclick="filterBy('${cat.name.replace(/'/g, "\\'")}')">
            <span>${cat.name}</span>
            <img src="${cat.img}" class="cat-thumb" onerror="this.src='logo.png'">
        </div>
    `).join('');

    // تكرار المحتوى مرتين بالضبط لضمان الربط اللامتناهي
    nav.innerHTML = buttonsHtml + buttonsHtml; 

    renderGrid(products, 'all');
    document.body.style.opacity = "1";
}

function filterBy(catName) {
    // تحديث الحالة النشطة في كلا المجموعتين
    document.querySelectorAll('.cat-item').forEach(el => {
        el.classList.toggle('active', el.querySelector('span').textContent === catName);
    });
    renderGrid(window.allProducts, catName === TXT[lang].all ? 'all' : catName);
}

function renderGrid(products, filter) {
    const g = document.getElementById('grid');
    g.innerHTML = '';
    const filtered = filter === 'all' ? products : products.filter(p => p.cat === filter);
    filtered.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<img src="${p.img}" loading="lazy"><div class="info"><div>${p.title}</div><div class="price">${p.price}</div><a class="wa-btn" href="${buildWaUrl(CORP_PHONE, TXT[lang].msg + p.title)}" target="_blank">${TXT[lang].order}</a></div>`;
        g.appendChild(card);
    });
}

start();
</script>
</body>
</html>
