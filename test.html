<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MAD PARFUMEUR | Official Portal</title>

<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)
}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init','1072283127290819');
fbq('track','PageView');
</script>

<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject = t;var ttq = w[t] = w[t] || [];ttq.methods = ["page","track","identify","instances","debug","on","off","once","ready","alias","group","trackWithQuery","click"];
  ttq.setAndDefer = function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};
  for (var i=0;i<ttq.methods.length;i++){ttq.setAndDefer(ttq, ttq.methods[i]);}
  ttq.load('D2D02JBC77U4ENLN9SBG');
  ttq.page();
}(window, document, 'ttq');
</script>

<link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{ --gold:#d4af37;--dark:#0a0a0a;--card:#161616; --wa:#25D366;--waze:#33CCFF;--gray:#333; }
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--dark);color:#fff;font-family:'Assistant','Cairo',sans-serif;opacity:0;transition:.4s}
header{
background:linear-gradient(rgba(0,0,0,.8),rgba(0,0,0,.9)),
url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover;
padding:30px 15px 60px;text-align:center;border-bottom:2px solid var(--gold)
}
.logo img{width:80px;margin-bottom:10px}
.brand-name{font-size:22px;font-weight:900;margin-bottom:20px}
.action-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;max-width:650px;margin:auto}
.action-item{
background:var(--gray);border:2px solid rgba(212,175,55,.4);
padding:15px;border-radius:15px;color:#fff;text-decoration:none;
display:flex;flex-direction:column;align-items:center
}
.action-item i{color:var(--gold);font-size:20px;margin-bottom:6px}
.hotline{color:var(--gold);font-weight:900}
.container{max-width:800px;margin:-35px auto 50px;padding:0 15px}
.branch-card{
background:var(--card);border-radius:20px;padding:25px;margin-bottom:20px;
border-right:5px solid var(--gold)
}
.br-title{font-size:20px;font-weight:800;color:var(--gold)}
.br-dist{font-size:12px;color:#888;margin-top:4px;font-weight:bold}
.btn-group{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:15px}
.btn{padding:12px;border-radius:12px;color:#fff;text-decoration:none;font-weight:800;font-size:12px;text-align:center}
.bg-wa{background:var(--wa)}
.bg-waze{background:var(--waze);color:#000}
.bg-enter{background:var(--gray)}
</style>
</head>

<body>

<header>
<div class="logo"><img src="https://abomkdad.github.io/Digital-Business-Card/logo.png"></div>
<div class="brand-name">MAD PARFUMEUR ISRAEL</div>

<div class="action-grid">
<a href="tel:*9935" class="action-item" onclick="trackLead('Phone_HQ')">
<i class="fas fa-phone-alt"></i>
<div class="hotline">*9935</div>
</a>
<a href="https://wa.me/972509787730" class="action-item" onclick="trackLead('WhatsApp_HQ')">
<i class="fab fa-whatsapp"></i>
<div class="hotline">050-978-7730</div>
</a>
<a href="https://madperfume.co.il" class="action-item" onclick="trackView('Online_Shop')">
<i class="fas fa-shopping-bag"></i>
<div class="hotline">Shop Now</div>
</a>
</div>
</header>

<div class="container">
<div id="branchesList" style="text-align:center;color:#888">טוען סניפים קרובים...</div>
</div>

<script>
/* ========== PIXEL EVENTS ========== */
function trackLead(source, info=''){
  const p={source,info,lang:document.documentElement.lang};
  if(window.fbq)fbq('track','Lead',p);
  if(window.ttq)ttq.track('Contact',p);
}
function trackView(name, info=''){
  const p={content_name:name,info};
  if(window.fbq)fbq('track','ViewContent',p);
  if(window.ttq)ttq.track('ViewContent',p);
}
function trackWaze(info){
  if(window.fbq)fbq('track','FindLocation',{content_name:'Waze',branch:info});
  if(window.ttq)ttq.track('ClickButton',{button:'Waze',info});
}

/* ========== CALC DISTANCE ========== */
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Radius of earth in km
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

/* ========== LOAD & SORT BRANCHES ========== */
const userLang = navigator.language.startsWith('he') ? 'he' : 'ar';
document.documentElement.lang = userLang;
document.documentElement.dir = userLang === 'ar' ? 'rtl' : 'ltr';

async function init() {
    try {
        const res = await fetch('branches.json?v=' + Date.now());
        const data = await res.json();
        let branches = data.branches;

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                const uLat = pos.coords.latitude;
                const uLon = pos.coords.longitude;
                
                branches.forEach(b => {
                    b.distance = getDistance(uLat, uLon, b.lat, b.lng);
                });
                
                branches.sort((a, b) => a.distance - b.distance);
                render(branches);
            }, () => render(branches), {timeout: 5000});
        } else {
            render(branches);
        }
    } catch (e) {
        document.getElementById('branchesList').innerText = 'שגיאה בטעינת הנתונים';
    }
}

function render(list) {
    const box = document.getElementById('branchesList');
    box.innerHTML = '';
    list.forEach(b => {
        const name = b[`name_${userLang}`];
        const distText = b.distance ? `<div class="br-dist">${b.distance.toFixed(1)} ק"מ ממך</div>` : '';
        const waze = b.social?.waze || `https://ul.waze.com/ul?ll=${b.lat},${b.lng}&navigate=yes`;
        
        box.innerHTML += `
        <div class="branch-card">
          <div class="br-title">${name}</div>
          ${distText}
          <div class="btn-group">
            <a href="https://wa.me/${b.phone}" class="btn bg-wa" onclick="trackLead('Branch_WA','${name}')">WhatsApp</a>
            <a href="${waze}" target="_blank" class="btn bg-waze" onclick="trackWaze('${name}')">Waze</a>
            <a href="offer.html?branch=${b.id}" class="btn bg-enter" onclick="trackView('Branch','${name}')">כניסה</a>
          </div>
        </div>`;
    });
    document.body.style.opacity = '1';
}

init();
</script>

</body>
</html>
