<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر الجوال السريع</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 400px; margin: auto; }
        .product-card { 
            background: white; padding: 15px; border-radius: 12px; 
            margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .qty-controls { display: flex; align-items: center; gap: 10px; }
        button { 
            background: var(--primary); color: white; border: none; 
            padding: 8px 15px; border-radius: 6px; cursor: pointer; 
        }
        .btn-order { 
            width: 100%; padding: 15px; font-size: 1.1rem; 
            margin-top: 20px; background: #059669; 
        }
        .loading { display: none; text-align: center; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <h2>سلة الطلبات</h2>
    
    <div class="product-card" data-name="iPhone 15">
        <span>آيفون 15</span>
        <div class="qty-controls">
            <button onclick="changeQty(this, -1)">-</button>
            <span class="qty">0</span>
            <button onclick="changeQty(this, 1)">+</button>
        </div>
    </div>

    <div class="product-card" data-name="AirPods">
        <span>إيربودز</span>
        <div class="qty-controls">
            <button onclick="changeQty(this, -1)">-</button>
            <span class="qty">0</span>
            <button onclick="changeQty(this, 1)">+</button>
        </div>
    </div>

    <button class="btn-order" onclick="submitOrder()">إتمام الطلب وتحديث المخزون</button>
    <div id="loader" class="loading">جاري التحديث...</div>
</div>

<script>
    function changeQty(btn, delta) {
        let qtySpan = btn.parentElement.querySelector('.qty');
        let current = parseInt(qtySpan.innerText);
        qtySpan.innerText = Math.max(0, current + delta);
    }

    async function submitOrder() {
        const url = "YOUR_GOOGLE_SCRIPT_URL_HERE"; // ضع رابط السكربت هنا
        const products = document.querySelectorAll('.product-card');
        let orders = [];

        products.forEach(p => {
            let qty = parseInt(p.querySelector('.qty').innerText);
            if (qty > 0) {
                orders.push({ name: p.getAttribute('data-name'), quantity: qty });
            }
        });

        if (orders.length === 0) return alert("الرجاء اختيار منتج واحد على الأقل");

        document.getElementById('loader').style.display = 'block';

        try {
            const response = await fetch(url, {
                method: 'POST',
                mode: 'no-cors', // مهم لتجنب مشاكل الـ CORS مع جوجل
                body: JSON.stringify({ orders: orders })
            });
            
            alert("تم إرسال الطلب! تحقق من الجدول.");
            // تصفير الكميات بعد النجاح
            document.querySelectorAll('.qty').forEach(q => q.innerText = "0");
        } catch (error) {
            alert("حدث خطأ في الاتصال");
        } finally {
            document.getElementById('loader').style.display = 'none';
        }
    }
</script>

</body>
</html>
