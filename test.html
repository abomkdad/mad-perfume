<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>MAD PARFUMEUR | Official Online Shop</title>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Assistant:wght@400;700&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root{ --gold:#D4AF37; --black:#000; --card:#111; --white:#fff; --wa:#25D366; --live-red:#ff0000; }
        *{box-sizing:border-box; margin:0; padding:0}
        body{background:#000; color:#fff; font-family:'Assistant', 'Cairo', sans-serif; opacity:0; transition: opacity 0.5s; padding-bottom: 120px;}

        /* --- Header --- */
        header {
            position: relative; text-align: center; padding: 40px 20px;
            background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.95)), url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }
        .logo-img { max-width: 120px; margin-bottom: 15px; }

        /* --- شريط التصنيفات المطور مع الصور --- */
        .cats-wrapper { 
            position: sticky; 
            top: 0; 
            background: rgba(10, 10, 10, 0.95); 
            z-index: 1000; 
            border-bottom: 2px solid var(--gold);
            padding: 12px 0;
            overflow: hidden;
            backdrop-filter: blur(15px);
        }

        .marquee-container {
            display: flex;
            width: max-content;
            animation: scroll-loop 45s linear infinite;
        }

        @keyframes scroll-loop {
            from { transform: translateX(0); }
            to { transform: translateX(calc(-50%)); }
        }

        .cats-wrapper:hover .marquee-container { animation-play-state: paused; }

        .cat-item {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.05);
            color: #ddd;
            border: 1px solid rgba(212, 175, 55, 0.2);
            padding: 8px 20px 8px 8px; /* مساحة للطلب من اليمين وللصورة من اليسار */
            border-radius: 50px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 700;
            font-size: 13px;
            margin: 0 10px;
            transition: all 0.3s ease;
            gap: 10px;
        }

        .cat-thumb {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid var(--gold);
            background: #000;
        }

        .cat-item.active { 
            background: var(--gold);
            color: #000;
            border-color: #fff;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        /* --- Grid System --- */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 15px; }
        @media(min-width: 768px){ .grid { grid-template-columns: repeat(4, 1fr); gap: 20px; } }
        
        .card { 
            background: #111; border: 1px solid #222; border-radius: 20px; 
            overflow: hidden; display: flex; flex-direction: column; transition: 0.4s;
        }
        .card:hover { border-color: var(--gold); transform: translateY(-5px); }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        
        .info { padding: 15px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .price { color: var(--gold); font-weight: 900; font-size: 1.3rem; margin: 10px 0; font-family: 'Cinzel', serif; }
        
        .wa-btn { background: var(--wa); color: #fff; text-decoration: none; padding: 12px; border-radius: 12px; font-weight: 800; }

        /* Footer */
        .frag-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(17, 17, 17, 0.98); border-top: 1px solid var(--gold);
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; z-index: 999; backdrop-filter: blur(10px);
        }
        .open-frag-btn { background: var(--gold); color: #000; padding: 10px 22px; border-radius: 50px; font-weight: 900; border: none; cursor: pointer; }
    </style>
</head>

<body dir="rtl">

<header>
    <img src="logo.png" alt="MAD" class="logo-img">
    <div class="brand-name" style="font-family:'Cinzel'; color:var(--gold); font-size: 1.8rem; font-weight: 900;">MAD PARFUMEUR</div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; max-width: 500px; margin: 25px auto 0;">
        <a href="tel:*9935" style="background: #111; border: 1px solid rgba(212,175,55,0.4); padding: 12px; border-radius: 15px; text-decoration: none; color: white;">
            <i class="fas fa-phone-alt" style="color: var(--gold); margin-bottom: 5px;"></i><br>
            <span style="font-size: 12px; font-weight: 800;">שירות לקוחות</span>
        </a>
        <a id="wa-corp-btn" href="#" style="background: #111; border: 1px solid rgba(212,175,55,0.4); padding: 12px; border-radius: 15px; text-decoration: none; color: white;">
            <i class="fab fa-whatsapp" style="color: var(--gold); margin-bottom: 5px;"></i><br>
            <span style="font-size: 12px; font-weight: 800;">WhatsApp</span>
        </a>
    </div>
</header>

<div class="cats-wrapper">
    <div id="cats" class="marquee-container"></div>
</div>

<main id="grid" class="grid"></main>

<div class="frag-footer">
    <div class="txt-side">
        <h5 id="foot-h" style="font-family: 'Cairo';"></h5>
        <p id="foot-p"></p>
    </div>
    <button class="open-frag-btn" onclick="openFrag()" id="foot-b"></button>
</div>

<script>
const lang = navigator.language.startsWith('ar') ? 'ar' : 'he';
const CORP_PHONE = "0509787730"; 

const TXT = {
    he: { all: 'הכל', order: 'הזמנה מהירה', msg: 'היי, אשמח להזמין: ', f_h: 'MAD: המוביلة בעולם', f_p: 'מדורג ב-Fragrantica', f_b: 'גלה' },
    ar: { all: 'الكل', order: 'طلب سريع', msg: 'مرحباً، أود طلب: ', f_h: 'MAD: الأعلى تقييماً', f_p: 'عبر Fragrantica العالمية', f_b: 'استكشف' }
};

function buildWaUrl(phone, text) {
    let cleanPhone = phone.replace(/\D/g, ''); 
    if (cleanPhone.startsWith('0')) cleanPhone = '972' + cleanPhone.substring(1);
    return `https://api.whatsapp.com/send/?phone=${cleanPhone}&text=${encodeURIComponent(text)}`;
}

function openFrag() {
    window.open((lang === "he") ? "https://www.fragrantica.co.il/designers/Mad-Parfumeur.html" : "https://www.fragranticarabia.com/designers/Mad-Parfumeur.html", '_blank');
}

async function start() {
    try {
        const res = await fetch('products.csv');
        const text = await res.text();
        const lines = text.split('\n');
        const catColIndex = (lang === 'ar') ? 11 : 10; 

        const products = lines.slice(1).map(line => {
            const c = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if (!c[0]) return null;
            return { title: c[0].replace(/"/g,'').trim(), img: c[3]?.trim(), price: c[9]?.replace('ILS','').trim() + ' ₪', cat: c[catColIndex]?.replace(/"/g,'').trim() };
        }).filter(p => p);

        window.allProducts = products;
        renderUI(products);
    } catch (e) { console.error(e); }
}

function renderUI(products) {
    const t = TXT[lang];
    document.getElementById('wa-corp-btn').href = buildWaUrl(CORP_PHONE, t.msg);
    document.getElementById('foot-h').textContent = t.f_h;
    document.getElementById('foot-p').textContent = t.f_p;
    document.getElementById('foot-b').textContent = t.f_b;

    const uniqueCats = [...new Set(products.map(p => p.cat))].filter(Boolean);
    const nav = document.getElementById('cats');
    
    // إنشاء بيانات الأزرار مع صورة أول منتج لكل فئة
    const catData = [{ name: t.all, img: 'logo.png' }]; // "الكل" نضع لها اللوجو
    uniqueCats.forEach(catName => {
        const firstProd = products.find(p => p.cat === catName);
        catData.push({ name: catName, img: firstProd ? firstProd.img : 'logo.png' });
    });

    const content = catData.map(cat => {
        const activeClass = (cat.name === t.all) ? 'active' : '';
        return `
            <div class="cat-item ${activeClass}" onclick="filterBy('${cat.name}')">
                <span>${cat.name}</span>
                <img src="${cat.img}" class="cat-thumb" onerror="this.src='logo.png'">
            </div>
        `;
    }).join('');

    nav.innerHTML = content + content; // تكرار مرتين للحركة اللانهائية

    renderGrid(products, 'all');
    document.body.style.opacity = "1";
}

function filterBy(catName) {
    const t = TXT[lang];
    document.querySelectorAll('.marquee-container .cat-item').forEach(btn => {
        btn.classList.remove('active');
        if(btn.querySelector('span').textContent === catName) btn.classList.add('active');
    });
    renderGrid(window.allProducts, catName === t.all ? 'all' : catName);
}

function renderGrid(products, filter) {
    const g = document.getElementById('grid');
    g.innerHTML = '';
    const filtered = filter === 'all' ? products : products.filter(p => p.cat === filter);
    filtered.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<img src="${p.img}" loading="lazy"><div class="info"><div>${p.title}</div><div class="price">${p.price}</div><a class="wa-btn" href="${buildWaUrl(CORP_PHONE, TXT[lang].msg + p.title)}" target="_blank">${TXT[lang].order}</a></div>`;
        g.appendChild(card);
    });
}

start();
</script>
</body>
</html>
