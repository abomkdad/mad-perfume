<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<!-- ===== FONTS & ICONS ===== -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<!-- ================= META PIXEL ================= -->
<script>
!function(f,b,e,v,n,t,s){
 if(f.fbq)return;
 n=f.fbq=function(){n.callMethod?
 n.callMethod.apply(n,arguments):n.queue.push(arguments)};
 if(!f._fbq)f._fbq=n;
 n.push=n;n.loaded=!0;n.version='2.0';
 n.queue=[];
 t=b.createElement(e);t.async=!0;
 t.src=v;
 s=b.getElementsByTagName(e)[0];
 s.parentNode.insertBefore(t,s)
}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');

/* ðŸ”´ Ø¶Ø¹ Meta Pixel ID Ù‡Ù†Ø§ */
fbq('init','META_PIXEL_ID_HERE');
fbq('track','PageView');
</script>

<!-- ================= TIKTOK PIXEL ================= -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject = t;
  var ttq = w[t] = w[t] || [];
  ttq.methods = ["page","track"];
  ttq.methods.forEach(m=>ttq[m]=function(){
    ttq.push([m].concat([].slice.call(arguments)));
  });
  ttq.load = function(id){
    var s=document.createElement("script");
    s.async=true;
    s.src="https://analytics.tiktok.com/i18n/pixel/events.js?sdkid="+id;
    document.head.appendChild(s);
  };
  /* ðŸ”´ Ø¶Ø¹ TikTok Pixel ID Ù‡Ù†Ø§ */
  ttq.load('TIKTOK_PIXEL_ID_HERE');
  ttq.page();
}(window,document,'ttq');
</script>

<style>
:root{--bg:#0a0a0a;--card:#141414;--gold:#d4af37;--text:#fff;--muted:#aaa}
body{margin:0;background:var(--bg);color:var(--text);font-family:Cairo,Heebo;padding-bottom:80px}
header{text-align:center;padding:30px 15px;border-bottom:3px solid var(--gold)}
.logo{width:80px;margin:auto}
.logo img{width:100%}
.branch-name{font-size:22px;font-weight:800;margin-top:8px}
.products{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
 gap:15px;padding:15px
}
.card{background:var(--card);border-radius:16px;padding:12px;text-align:center}
.card img{width:100%;border-radius:12px;background:#fff}
.code{font-weight:800;margin-top:6px}
.price{color:var(--gold);font-weight:700}
.btn{
 background:#25D366;color:#fff;padding:10px;
 border-radius:8px;text-decoration:none;
 display:block;margin-top:10px;font-weight:700
}

/* ===== POPUP ===== */
.popup-overlay{
 position:fixed;inset:0;
 background:rgba(0,0,0,.75);
 display:none;align-items:center;justify-content:center;
 z-index:9999
}
.popup{
 width:92%;max-width:420px;
 background:#000;border:2px solid var(--gold);
 border-radius:18px;padding:12px;position:relative
}
.popup-close{
 position:absolute;top:8px;right:8px;
 background:#000;color:#fff;
 padding:6px 10px;border-radius:10px;
 cursor:pointer;font-size:13px
}
.popup img{width:100%;border-radius:12px}
.popup-cta{
 margin-top:10px;background:#22c55e;
 color:#000;font-weight:800;
 padding:14px;border-radius:14px;
 text-align:center;cursor:pointer
}
.popup-timer{
 margin-top:6px;text-align:center;
 color:var(--gold);font-weight:700;font-size:14px
}
</style>
</head>

<body>

<header>
 <div class="logo">
  <img src="https://abomkdad.github.io/Digital-Business-Card/logo.png">
 </div>
 <div id="branchName" class="branch-name"></div>
</header>

<div class="products" id="products"></div>

<!-- ===== POPUP ===== -->
<div class="popup-overlay" id="popup">
 <div class="popup">
  <div class="popup-close" onclick="closePopup()">âœ•</div>
  <img src="sale.png" alt="Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…">
  <div class="popup-timer" id="popupTimer"></div>
  <div class="popup-cta" id="popupBtn"></div>
 </div>
</div>

<script>
/* ===== LANGUAGE ===== */
const lang = navigator.language.startsWith("he") ? "he" : "ar";
document.documentElement.lang = lang;
document.documentElement.dir = "rtl";

const T={
 ar:{cta:"ðŸ”¥ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…",ends:"ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø®Ù„Ø§Ù„"},
 he:{cta:"ðŸ”¥ ×§×‘×œ ××ª ×ž×‘×¦×¢ ×”×™×•×",ends:"×”×”×¦×¢×” ×ž×¡×ª×™×™×ž×ª ×‘×¢×•×“"}
};

/* ===== EVENTS ===== */
function trackEvent(name,data={}){
 if(window.fbq){
  if(name==="Lead") fbq("track","Lead",data);
  else fbq("trackCustom",name,data);
 }
 if(window.ttq){
  if(name==="Lead") ttq.track("SubmitForm",data);
  else ttq.track(name,data);
 }
}

/* ===== BRANCH ===== */
const params=new URLSearchParams(location.search);
const branchID=params.get("branch");

let phone="972549634449";

/* ===== PRODUCTS (CSV â€“ Ù†ÙØ³ Ø§Ù„Ù‚Ø¯ÙŠÙ…) ===== */
Papa.parse("products.csv",{
 download:true,header:true,
 complete:r=>{
  r.data.forEach(p=>{
   if(!p.Title)return;
   document.getElementById("products").innerHTML+=`
   <div class="card">
    <img src="${p.Image}">
    <div class="code">${p.Title}</div>
    <div class="price">${p.Price}</div>
    <a class="btn" href="https://wa.me/${phone}?text=${encodeURIComponent(p.Title)}"
     target="_blank"
     onclick="trackEvent('Lead',{source:'product',branch:'${branchID}'})">
     ÙˆØ§ØªØ³Ø§Ø¨
    </a>
   </div>`;
  });
 }
});

/* ===== POPUP LOGIC ===== */
function todayKey(){
 const d=new Date();
 return d.toISOString().split("T")[0];
}
function closePopup(){
 document.getElementById("popup").style.display="none";
 localStorage.setItem("popup_closed",todayKey());
}

function updateTimer(){
 const now=new Date();
 const end=new Date();
 end.setHours(24,0,0,0);
 const diff=end-now;
 if(diff<=0)return;
 const h=Math.floor(diff/3600000);
 const m=Math.floor(diff/60000)%60;
 const s=Math.floor(diff/1000)%60;
 document.getElementById("popupTimer").textContent=
 `${T[lang].ends} ${h}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
}

setTimeout(()=>{
 if(localStorage.getItem("popup_closed")===todayKey())return;
 document.getElementById("popup").style.display="flex";
 document.getElementById("popupBtn").textContent=T[lang].cta;
 document.getElementById("popupBtn").onclick=()=>{
  trackEvent("Lead",{source:"popup_offer",branch:branchID});
  window.open(`https://wa.me/${phone}`,"_blank");
 };
 updateTimer();
 setInterval(updateTimer,1000);
},1000);
</script>

</body>
</html>
