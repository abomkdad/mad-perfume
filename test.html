<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
!function(f,b,e,v,n,t,s){
 if(f.fbq)return;
 n=f.fbq=function(){n.callMethod?
 n.callMethod.apply(n,arguments):n.queue.push(arguments)};
 if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
 n.queue=[];t=b.createElement(e);t.async=!0;
 t.src=v;s=b.getElementsByTagName(e)[0];
 s.parentNode.insertBefore(t,s)
}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init','1072283127290819');
fbq('track','PageView');
</script>

<script>
!function(w,d,t){
 w.TiktokAnalyticsObject=t;
 var ttq=w[t]=w[t]||[];
 ttq.methods=["page","track"];
 ttq.setAndDefer=function(t,e){
  t[e]=function(){
   t.push([e].concat(Array.prototype.slice.call(arguments,0)))
  }
 };
 for(var i=0;i<ttq.methods.length;i++){
  ttq.setAndDefer(ttq,ttq.methods[i]);
 }
 ttq.load=function(e){
  var i=d.createElement("script");i.async=!0;
  i.src="https://analytics.tiktok.com/i18n/pixel/events.js?sdkid="+e;
  var s=d.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(i,s)
 };
 ttq.load("D2D02JBC77U4ENLN9SBG");
 ttq.page();
}(window,document,'ttq');
</script>

<style>
:root{--bg:#0a0a0a;--card:#141414;--gold:#d4af37;--text:#fff;--muted:#aaa}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Cairo','Heebo',sans-serif;padding-bottom:90px}
header{text-align:center;padding:40px 15px;border-bottom:3px solid var(--gold)}
.logo{width:80px;margin:auto}
.logo img{width:100%}
.brand{color:var(--gold);font-weight:800;margin-top:10px}
.branch-name{font-size:24px;font-weight:800}
.status{margin-top:8px;padding:6px 14px;border-radius:20px;font-weight:700;font-size:13px;display:inline-block}
.open{background:rgba(37,211,102,.2);color:#25D366}
.closed{background:rgba(255,68,68,.2);color:#ff4444}
.socials{display:flex;justify-content:center;gap:12px;margin-top:20px}
.socials a{width:42px;height:42px;border-radius:50%;border:1px solid var(--gold);display:flex;align-items:center;justify-content:center;color:var(--gold);font-size:18px;text-decoration:none}

#categories{display:flex;gap:10px;overflow-x:auto;padding:15px; scrollbar-width: none;}
#categories::-webkit-scrollbar {display: none;}
.cat{border:1px solid var(--gold);padding:8px 16px;border-radius:20px;background:#111;color:#fff;font-weight:700;cursor:pointer; white-space: nowrap;}
.cat.active{background:var(--gold);color:#000}

.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;padding:15px}
.card{background:var(--card);border-radius:16px;padding:12px;text-align:center; display: flex; flex-direction: column; justify-content: space-between;}
.card img{width:100%;border-radius:12px;background:#fff; aspect-ratio: 1/1; object-fit: cover;}
.price{color:var(--gold);font-weight:700; margin: 8px 0;}
.btn{background:#25D366;color:#fff;padding:10px;border-radius:8px;text-decoration:none;font-weight:700;display:block;margin-top:10px}

.popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:9999}
.popup{width:90%;max-width:380px;background:#000;border:2px solid var(--gold);border-radius:18px;padding:15px;position:relative; text-align: center;}
.popup img{width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:12px}
.popup-close{position:absolute;top:10px;right:10px;cursor:pointer;font-size:18px;background:#000;color:var(--gold);padding:5px 10px;border-radius:12px; z-index: 10;}
.popup-cta{margin-top:12px;background:#22c55e;color:#fff;padding:14px;border-radius:14px;font-weight:800;text-align:center;cursor:pointer}
.timer{text-align:center;margin-top:8px;font-size:14px;color:var(--gold); font-family: monospace;}
</style>
</head>

<body>

<header>
 <div class="logo">
  <img src="https://abomkdad.github.io/Digital-Business-Card/logo.png" alt="Logo">
 </div>
 <div class="brand">MAD PARFUMEUR</div>
 <div id="branchName" class="branch-name">ØªØ­Ù…ÙŠÙ„...</div>
 <div id="status"></div>
 <div class="socials" id="socials"></div>
</header>

<div id="categories"></div>
<div class="products" id="products"></div>

<div class="popup-overlay" id="popup">
 <div class="popup">
  <div class="popup-close" onclick="closePopup()">âœ•</div>
  <img src="sale.png" alt="Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…" onerror="this.src='https://via.placeholder.com/300?text=Sale'">
  <div class="timer" id="timer"></div>
  <div class="popup-cta" onclick="popupWhatsApp()">ğŸ”¥ Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…</div>
 </div>
</div>

<script>
/* LANGUAGE */
const lang=navigator.language.startsWith("he")?"he":"ar";
document.documentElement.lang=lang;
document.documentElement.dir=lang==="he"?"ltr":"rtl";

const TXT={
 ar:{open:"Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†",closed:"Ù…ØºÙ„Ù‚ Ø§Ù„Ø¢Ù†",all:"Ø§Ù„ÙƒÙ„",ends:"ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯",wa_msg:"Ø£Ù‡Ù„Ø§Ù‹ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù†: "},
 he:{open:"×¤×ª×•×— ×¢×›×©×™×•",closed:"×¡×’×•×¨ ×¢×›×©×™×•",all:"×”×›×œ",ends:"××¡×ª×™×™× ×‘×¢×•×“",wa_msg:"×©×œ×•×, ×× ×™ ××¢×•× ×™×™×Ÿ ×‘: "}
};

const branchID=new URLSearchParams(location.search).get("branch");
let phone="",popupTimer=null;

/* EVENTS */
function lead(action){
 if(window.fbq) fbq('track','Lead',{action,branch:branchID});
 if(window.ttq) ttq.track('SubmitForm',{action,branch:branchID});
}

/* POPUP */
function closePopup(){
 localStorage.setItem("popupDate",new Date().toDateString());
 document.getElementById("popup").style.display="none";
 clearInterval(popupTimer);
}

function popupWhatsApp(){
 lead("popup_whatsapp");
 window.open(`https://wa.me/${phone}`,"_blank");
}

/* TIMER */
function startTimer(){
 const end=new Date(); end.setHours(23, 59, 59, 999);
 const pad = (n) => n < 10 ? '0'+n : n;

 popupTimer=setInterval(()=>{
  const diff=end-new Date();
  if(diff<=0){clearInterval(popupTimer); closePopup(); return;}
  const h=Math.floor(diff/36e5),
        m=Math.floor(diff%36e5/6e4),
        s=Math.floor(diff%6e4/1000);
  document.getElementById("timer").textContent= `${TXT[lang].ends} ${pad(h)}:${pad(m)}:${pad(s)}`;
 },1000);
}

/* LOAD BRANCH */
fetch("test.json").then(r=>r.json()).then(d=>{
 const b=d.branches.find(x=>String(x.id)===String(branchID));
 if(!b) {
     document.getElementById("branchName").textContent = "Branch Not Found";
     return;
 }

 document.getElementById("branchName").textContent= lang==="he"?b.name_he:b.name_ar;
 phone="972"+b.phone.replace(/^0/,"");

 // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ù‡Ù†Ø§ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ isOpenNow Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ JSON
 document.getElementById("status").innerHTML= `<div class="status open">${TXT[lang].open}</div>`;

 const s=b.social||{};
 const icons=[
  {id:"location-dot", link:s.waze, type:"solid"},
  {id:"whatsapp", link:`https://wa.me/${phone}`, type:"brands"},
  {id:"instagram", link:s.instagram, type:"brands"},
  {id:"tiktok", link:s.tiktok, type:"brands"},
  {id:"facebook-f", link:s.facebook, type:"brands"},
  {id:"envelope", link:s.email?`mailto:${s.email}`:null, type:"solid"}
 ];

 document.getElementById("socials").innerHTML=
 icons.filter(i=>i.link).map(i=>`
  <a href="${i.link}" target="_blank" onclick="lead('${i.id}')">
   <i class="fa-${i.type} fa-${i.id}"></i>
  </a>`).join("");

 if(localStorage.getItem("popupDate")!==new Date().toDateString()){
  setTimeout(()=>{
   document.getElementById("popup").style.display="flex";
   startTimer();
  },1200);
 }
});

/* PRODUCTS */
let products=[],cat="all";

Papa.parse("products.csv",{download:true,header:true,complete:r=>{
 products=r.data.filter(p=>p.Title && String(p.BranchID)===String(branchID));
 buildCats();render();
}});

function buildCats(){
 const cats=[...new Set(products.map(p=>p.Category))].filter(c => c);
 document.getElementById("categories").innerHTML=
 `<button class="cat active" onclick="setCat('all',this)">${TXT[lang].all}</button>`+
 cats.map(c=>`<button class="cat" onclick="setCat('${c}',this)">${c}</button>`).join("");
}

function setCat(c,e){
 cat=c;
 document.querySelectorAll(".cat").forEach(x=>x.classList.remove("active"));
 e.classList.add("active");
 render();
}

function render(){
 const box=document.getElementById("products");box.innerHTML="";
 products.filter(p=>cat==="all"||p.Category===cat).forEach(p=>{
  box.innerHTML+=`
  <div class="card">
   <img src="${p.Image}" onerror="this.src='https://via.placeholder.com/150?text=Product'">
   <div style="font-weight:600; margin-top:5px;">${p.Title}</div>
   <div class="price">â‚ª ${p.Price}</div>
   <a class="btn"
      href="https://wa.me/${phone}?text=${encodeURIComponent(TXT[lang].wa_msg + p.Title)}"
      target="_blank"
      onclick="lead('product_whatsapp')">${lang === 'he' ? '×•×•××˜×¡××¤' : 'ÙˆØ§ØªØ³Ø§Ø¨'}</a>
  </div>`;
 });
}
</script>

</body>
</html>
