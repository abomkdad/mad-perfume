<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>MAD PARFUMEUR | Official Portal</title>

    <meta property="og:title" content="MAD PARFUMEUR ISRAEL">
    <meta property="og:image" content="https://abomkdad.github.io/Digital-Business-Card/logo.png">

    <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){
    n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init','1072283127290819'); fbq('track', 'PageView');

    !function (w, d, t) {
      w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
      ttq.load('D2D02JBC77U4ENLN9SBG'); ttq.page();
    }(window, document, 'ttq');
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --gold: #d4af37; --dark-bg: #0a0a0a; --card-bg: #161616; --wa-green: #25D366; --waze-blue: #33CCFF; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--dark-bg); color: #fff; font-family: 'Assistant', 'Cairo', sans-serif; direction: rtl; opacity: 0; transition: opacity 0.5s; }
        header { background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.9)), url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover; padding: 30px 15px 60px; text-align: center; border-bottom: 2px solid var(--gold); }
        .logo img { width: 80px; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; max-width: 650px; margin: 0 auto; }
        .action-item { background: #333; border: 2px solid rgba(212,175,55,0.4); padding: 15px 5px; border-radius: 15px; text-decoration: none; color: white; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; margin: -35px auto 50px; padding: 0 15px; }
        .branch-card { background: var(--card-bg); border-radius: 20px; padding: 20px; margin-bottom: 20px; border-right: 5px solid var(--gold); }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 15px; }
        .btn { padding: 10px 5px; border-radius: 10px; text-decoration: none; color: white; font-size: 12px; text-align: center; display: flex; flex-direction: column; align-items: center; }

        /* Popup Styles */
        #popup-sale { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 99999; display: none; align-items: center; justify-content: center; }
        .sale-box { background: var(--card-bg); border: 2px solid var(--gold); width: 90%; max-width: 400px; border-radius: 25px; padding: 30px; text-align: center; position: relative; }
        #sale-timer { font-size: 40px; font-weight: 900; color: var(--gold); margin: 20px 0; font-family: monospace; }
        .sale-link { display: block; background: var(--wa-green); color: white; padding: 15px; border-radius: 50px; text-decoration: none; font-weight: 900; font-size: 18px; }
        #reopen-sale { position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px; background: var(--gold); border-radius: 50%; z-index: 9999; display: none; align-items: center; justify-content: center; cursor: pointer; color: #000; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div id="popup-sale">
    <div class="sale-box">
        <button onclick="closeSale()" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#fff; font-size:30px;">&times;</button>
        <h2 style="color:var(--gold)">عرض اليوم المحدود!</h2>
        <div id="sale-timer">00:00:00</div>
        <a id="sale-wa-link" href="#" class="sale-link"></a>
    </div>
</div>

<div id="reopen-sale" onclick="openSale()"><i class="fas fa-gift fa-2x"></i></div>

<header>
    <div class="logo"><img src="https://abomkdad.github.io/Digital-Business-Card/logo.png"></div>
    <div class="brand-name" style="font-weight:900; margin-top:10px;">MAD PARFUMEUR ISRAEL</div>
    <div class="action-grid" style="margin-top:20px;">
        <a href="tel:*9935" class="action-item"><i class="fas fa-phone"></i><span id="txt-cs"></span></a>
        <a href="https://wa.me/972509787730" class="action-item"><i class="fab fa-whatsapp"></i><span id="txt-wa"></span></a>
        <a href="https://madperfume.co.il" class="action-item"><i class="fas fa-shopping-bag"></i><span id="txt-shop"></span></a>
    </div>
</header>

<div class="container">
    <div id="branchesList"></div>
</div>

<script>
    // الإعدادات العامة (STATE & TXT)
    const lang = navigator.language.startsWith("he") ? "he" : "ar";
    let timerInterval;
    
    const TXT = {
        ar: { cs: "خدمة الزبائن", wa: "واتساب الشركة", shop: "المتجر", offer: "اطلب العرض الآن", km: "كم", open: "مفتوح", closed: "مغلق" },
        he: { cs: "שירות לקוחות", wa: "וואטסאפ חברה", shop: "חנות אונליין", offer: "קבל את ההטבה", km: 'ק"מ', open: "פתוח", closed: "סגור" }
    };

    let STATE = {
        branch: { phone: "972509787730", name_ar: "الشركة الرئيسي", name_he: "החברה הראשי" }
    };

    // --- الوظائف المطلوبة بالضبط ---

    function openSale() {
        document.getElementById('popup-sale').style.display = 'flex';
        document.getElementById('reopen-sale').style.display = 'none';
        startTimer();
    }

    function closeSale() {
        document.getElementById('popup-sale').style.display = 'none';
        document.getElementById('reopen-sale').style.display = 'flex';
        localStorage.setItem('mad_sale_' + new Date().toDateString(), 'seen');
        clearInterval(timerInterval);
    }

    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            const diff = new Date().setHours(23, 59, 59) - new Date();
            if (diff <= 0) { 
                closeSale(); 
                document.getElementById('reopen-sale').style.display = 'none';
                clearInterval(timerInterval);
                return;
            }
            const h = Math.floor(diff/3600000).toString().padStart(2,'0');
            const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
            const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
            document.getElementById('sale-timer').textContent = `${h}:${m}:${s}`;
        }, 1000);
    }

    function lead(ev, name) {
        if(window.fbq) fbq('track', 'Contact', {content_name: ev, branch: name});
        if(window.ttq) ttq.track('Contact', {content_name: ev});
    }

    function initDailySale() {
        const saleKey = 'mad_sale_' + new Date().toDateString();
        const t = TXT[lang];
        
        const whatsappMsg = lang === 'ar' 
            ? 'مرحباً، أريد الحصول على عرض اليوم الخاص بفرع ' + STATE.branch.name_ar 
            : 'שלום, אשמח לקבל את ההטבה היומית של סניף ' + STATE.branch.name_he;

        const saleLink = document.getElementById('sale-wa-link');
        saleLink.textContent = t.offer;
        saleLink.href = `https://wa.me/${STATE.branch.phone}?text=${encodeURIComponent(whatsappMsg)}`;
        
        saleLink.onclick = () => lead('Daily_Offer_Click', STATE.branch.name_ar);

        if (localStorage.getItem(saleKey)) {
            document.getElementById('reopen-sale').style.display = 'flex';
        } else {
            setTimeout(openSale, 3000);
        }
    }

    // --- تشغيل البيانات ---

    async function init() {
        document.getElementById('txt-cs').textContent = TXT[lang].cs;
        document.getElementById('txt-wa').textContent = TXT[lang].wa;
        document.getElementById('txt-shop').textContent = TXT[lang].shop;

        try {
            const res = await fetch('branches.json?v=' + Date.now());
            const data = await res.json();
            const branches = data.branches;

            // إذا وجد برامتر فرع في الرابط، نحدث STATE
            const urlParams = new URLSearchParams(window.location.search);
            const bId = urlParams.get('branch');
            if(bId) {
                const b = branches.find(x => x.id == bId);
                if(b) STATE.branch = b;
            }

            renderBranches(branches);
            initDailySale(); // تشغيل البوب أب
            document.body.style.opacity = "1";
        } catch(e) { document.body.style.opacity = "1"; }
    }

    function renderBranches(list) {
        const container = document.getElementById('branchesList');
        container.innerHTML = '';
        list.forEach(b => {
            const card = document.createElement('div');
            card.className = 'branch-card';
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between">
                    <div style="font-weight:800; color:var(--gold)">${b['name_'+lang]}</div>
                </div>
                <div class="btn-group">
                    <a href="https://wa.me/${b.phone}" class="btn" style="background:var(--wa-green)"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://ul.waze.com/ul?ll=${b.lat},${b.lng}&navigate=yes" class="btn" style="background:var(--waze-blue)"><i class="fab fa-waze"></i></a>
                    <a href="?branch=${b.id}" class="btn" style="background:#444"><i class="fas fa-door-open"></i></a>
                </div>
            `;
            container.appendChild(card);
        });
    }

    init();
</script>
</body>
</html>
