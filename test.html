<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAD PARFUMEUR | Official Elite Portal</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Assistant:wght@400;700&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">

    <script>
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1072283127290819'); fbq('track', 'PageView');
    </script>

    <script async src="https://analytics.tiktok.com/i18n/pixel/events.js?sdkid=D2D02JBC77U4ENLN9SBG"></script>
    <script>
    window.ttq = window.ttq || [];
    function trackLead(name) {
        fbq('track', 'Lead', {content_name: name});
        if(window.ttq && typeof window.ttq.track === 'function') {
            ttq.track('Contact', {content_name: name});
        }
    }
    </script>

    <style>
        :root { --gold: #D4AF37; --black: #080808; --card: #121212; --wa: #25D366; --live-red: #ff4444; }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background: var(--black); color: #fff; font-family: 'Assistant', 'Cairo', sans-serif; overflow-x: hidden; padding-bottom: 120px; direction: rtl; }

        /* العناصر الثابتة */
        .top-wa-bar { background: var(--wa); color: #fff; text-align: center; padding: 12px; font-weight: 900; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; position: sticky; top: 0; z-index: 2001; }
        .agent-button { background: linear-gradient(45deg, #1a1a1a, #333); color: var(--gold); text-align: center; padding: 15px; margin: 10px 15px; border-radius: 12px; border: 1.5px solid var(--gold); text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 15px; font-weight: 700; }

        header { text-align: center; padding: 40px 20px; background: linear-gradient(rgba(0,0,0,0.8), #000), url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover; border-bottom: 2px solid var(--gold); }
        .logo-img { max-width: 120px; margin-bottom: 20px; }
        .staff-wrapper { position: relative; width: 100px; height: 100px; margin: 0 auto 15px; }
        .staff-img { width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--gold); object-fit: cover; }

        .social-bar { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .social-bar a { width: 45px; height: 45px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; border-radius: 50%; color: #fff; font-size: 1.3rem; border: 1px solid rgba(255,255,255,0.2); transition: 0.3s; text-decoration: none; }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; max-width: 400px; margin: 0 auto; }
        .action-item { background: rgba(0,0,0,0.6); border: 1px solid rgba(212,175,55,0.3); padding: 15px; border-radius: 15px; text-decoration: none; color: white; text-align: center; }

        .cats-wrapper { position: sticky; top: 48px; z-index: 1000; background: rgba(8, 8, 8, 0.98); border-bottom: 1px solid #222; display: flex; align-items: center; overflow: hidden; height: 80px; }
        .cats-container { display: flex; gap: 10px; overflow-x: auto; padding: 10px 15px; scrollbar-width: none; width: 100%; }
        .cat-pill { background: #1a1a1a; border: 1px solid #333; padding: 8px 18px; border-radius: 50px; cursor: pointer; white-space: nowrap; }
        .cat-pill.active { background: var(--gold); color: #000; font-weight: 900; }

        .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 15px; }
        .p-card { background: var(--card); border-radius: 15px; overflow: hidden; border: 1px solid #1a1a1a; display: flex; flex-direction: column; }
        .p-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .p-info { padding: 12px; text-align: center; flex-grow: 1; }
        .add-btn { background: var(--gold); color: #000; border: none; padding: 10px; border-radius: 8px; font-weight: 900; width: 100%; margin-top: 10px; }

        /* Floating UI */
        #cart-fab { position: fixed; bottom: 100px; right: 20px; width: 60px; height: 60px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 2000; }
        #cart-count { position: absolute; top: -2px; right: -2px; background: var(--live-red); color: #fff; width: 22px; height: 22px; border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: 900; border: 2px solid #000; }
        
        .drawer { position: fixed; bottom: -100%; left: 0; width: 100%; height: 75%; background: #0a0a0a; border-top: 3px solid var(--gold); z-index: 10001; transition: 0.3s; padding: 25px; border-radius: 25px 25px 0 0; }
        .drawer.open { bottom: 0; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 10005; }
        .sale-box { width: 90%; max-width: 380px; background: #000; border: 2px solid var(--gold); border-radius: 20px; overflow: hidden; position: relative; }
    </style>
</head>
<body>

    <a href="https://wa.me/972509787730" class="top-wa-bar" onclick="trackLead('Top WA Bar')">
        <i class="fab fa-whatsapp"></i> <span>تواصل معنا مباشرة عبر الواتساب</span>
    </a>

    <a href="https://wa.me/972509787730?text=أرغب في الاستفسار عن وكالة" class="agent-button" onclick="trackLead('Agent Button')">
        <i class="fas fa-handshake"></i> <span>كن وكيلاً جديداً لشركة MAD - اطلب الآن</span>
    </a>

    <header>
        <img src="logo.png" class="logo-img" width="120" height="auto">
        <div class="staff-wrapper">
            <img src="https://madperfume.ps/upload/01-2026/page/6966930e9af7f.png" class="staff-img" loading="lazy">
        </div>
        <div class="social-bar">
            <a href="https://facebook.com/MADPARFUMEURISRAEL/" target="_blank"><i class="fab fa-facebook-f"></i></a>
            <a href="https://instagram.com/perfume.mad/" target="_blank"><i class="fab fa-instagram"></i></a>
            <a href="https://tiktok.com/@mad.perfume" target="_blank"><i class="fab fa-tiktok"></i></a>
        </div>
        <div class="action-grid">
            <a href="tel:*9935" class="action-item" onclick="trackLead('Call CS')">
                <i class="fas fa-phone-alt"></i>
                <div style="font-weight:900; color:var(--gold);">*9935</div>
                <small>خدمة العملاء</small>
            </a>
            <a href="https://wa.me/972509787730" class="action-item" onclick="trackLead('WA Corporate')">
                <i class="fab fa-whatsapp"></i>
                <div style="font-weight:900; color:var(--gold);">0509787730</div>
                <small>واتساب الشركة</small>
            </a>
        </div>
    </header>

    <div class="cats-wrapper"><div id="cats-box" class="cats-container"></div></div>
    <main id="main-grid" class="shop-grid"></main>

    <div id="cart-fab" onclick="toggleCart(true)"><i class="fas fa-shopping-bag" style="color:#000; font-size:1.6rem"></i><div id="cart-count">0</div></div>

    <div id="cart-drawer" class="drawer">
        <h2 style="color:var(--gold); text-align:center; margin-bottom:20px;">سلة المشتريات</h2>
        <div id="cart-list" style="overflow-y:auto; max-height:60%;"></div>
        <button class="add-btn" style="padding:20px; font-size:1.1rem; background:var(--wa); color:#fff;" onclick="sendOrder()">إرسال الطلب</button>
    </div>

    <div id="sale-popup" class="modal-overlay">
        <div class="sale-box">
            <span onclick="toggleSale(false)" style="position:absolute; top:10px; right:20px; font-size:2rem; color:#fff; cursor:pointer;">&times;</span>
            <img src="sale.png" style="width:100%;">
            <div id="timer" style="background:var(--gold); color:#000; text-align:center; padding:10px; font-weight:900; font-size:1.5rem;">00:00:00</div>
            <button class="add-btn" style="margin:0; border-radius:0;" onclick="trackLead('Offer Click'); toggleSale(false)">اطلب العرض الآن</button>
        </div>
    </div>

    <script defer>
    const lang = navigator.language.startsWith('ar') ? 'ar' : 'he';
    let STATE = { products: [], cart: [] };

    // ✅ تشغيل الكود بعد تحميل الواجهة بالكامل لضمان السرعة
    window.addEventListener('load', () => {
        init();
        setTimeout(() => toggleSale(true), 4000);
    });

    async function init() {
        try {
            // ✅ جلب المنتجات بشكل خلفي (Async)
            const res = await fetch('products.csv');
            const text = await res.text();
            parseCSV(text);
            renderCats();
            renderGrid('all');
            startTimer();
        } catch(e) { console.warn("CSV not ready"); }
    }

    function parseCSV(text) {
        const lines = text.split('\n');
        const catIdx = lang === 'ar' ? 11 : 10;
        for(let i=1; i<lines.length; i++) {
            const c = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if(!c[0]) continue;
            STATE.products.push({ id: i, title: c[0].replace(/"/g,'').trim(), img: c[3]?.trim() || 'logo.png', price: c[9]?.replace('ILS','').trim()+' ₪', cat: c[catIdx]?.trim() || '' });
        }
    }

    function renderCats() {
        const cats = [...new Set(STATE.products.map(p => p.cat))].filter(Boolean);
        const data = [{name: 'الكل'}, ...cats.map(c => ({name: c}))];
        document.getElementById('cats-box').innerHTML = data.map(c => `<div class="cat-pill" onclick="filterCats(this, '${c.name}')">${c.name}</div>`).join('');
        document.getElementById('cats-box').children[0].classList.add('active');
    }

    function filterCats(el, name) {
        document.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
        el.classList.add('active');
        renderGrid(name === 'الكل' ? 'all' : name);
    }

    function renderGrid(f) {
        const g = document.getElementById('main-grid'); g.innerHTML = '';
        const list = f === 'all' ? STATE.products : STATE.products.filter(p => p.cat === f);
        list.forEach(p => {
            g.innerHTML += `<div class="p-card"><img src="${p.img}" loading="lazy"><div class="p-info"><div style="font-weight:700; font-size:0.85rem; height:2.5em; overflow:hidden;">${p.title}</div><div style="color:var(--gold); font-weight:900;">${p.price}</div><button class="add-btn" onclick="addToCart(${p.id})">إضافة للسلة</button></div></div>`;
        });
    }

    function addToCart(id) {
        const p = STATE.products.find(x => x.id === id);
        if(!STATE.cart.includes(p)) STATE.cart.push(p);
        document.getElementById('cart-count').textContent = STATE.cart.length;
        updateCartUI();
    }

    function updateCartUI() {
        const list = document.getElementById('cart-list'); list.innerHTML = '';
        STATE.cart.forEach(i => {
            list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #222;"><span>${i.title}</span><span>${i.price}</span></div>`;
        });
    }

    function toggleCart(s) { document.getElementById('cart-drawer').classList.toggle('open', s); }
    function toggleSale(s) { document.getElementById('sale-popup').style.display = s ? 'flex' : 'none'; }

    function sendOrder() {
        trackLead('Checkout');
        let m = "طلب جديد:\n"; STATE.cart.forEach(i => m += `- ${i.title}\n`);
        window.open(`https://wa.me/972509787730?text=${encodeURIComponent(m)}`);
    }

    function startTimer() {
        setInterval(() => {
            const d = new Date().setHours(23,59,59) - new Date();
            if(d<0) return;
            const h = Math.floor(d/3600000).toString().padStart(2,'0'), m = Math.floor((d%3600000)/60000).toString().padStart(2,'0'), s = Math.floor((d%60000)/1000).toString().padStart(2,'0');
            document.getElementById('timer').textContent = `${h}:${m}:${s}`;
        }, 1000);
    }
    </script>
</body>
</html>
