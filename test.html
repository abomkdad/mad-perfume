<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD Parfumeur - Amazon Style Offers</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #EAEDED;
        }
        .amazon-orange { color: #FF9900; }
        .amazon-bg-navy { background-color: #131921; }
        .amazon-bg-yellow { background-color: #FFD814; }
        .amazon-bg-yellow:hover { background-color: #F7CA00; }
        .amazon-btn-border { border: 1px solid #FCD200; }
        .star-filled { fill: #FFA41C; color: #FFA41C; }
        .star-empty { fill: transparent; color: #FFA41C; }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>

    <!-- Pixel Tracking Scripts -->
    <script>
        const PIXELS = {
            facebook: "1072283127290819",
            tiktok: "D2D02JBC77U4ENLN9SBG",
            snapchat: "b143822e-1c3c-40ff-93f7-edadee74e626"
        };

        // Facebook Pixel
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
        n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
        document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', PIXELS.facebook);
        fbq('track', 'PageView');
        fbq('track', 'ViewContent');

        // TikTok Pixel
        !function (w, d, t) { w.ttq = w.ttq || []; w.ttq.methods = ["page", "track", "identify", "instances", "debug", "on", "off", "once", "ready", "alias", "group", "aliasWithContext", "setAndLog", "set", "get", "getAndLog", "setContext", "getContext", "getPlugin", "setPlugin", "deletePlugin", "setInstance", "getInstance", "setEventSettings", "getEventSettings", "setGlobalSettings", "getGlobalSettings", "setAndGetGlobalSettings", "getAndSetGlobalSettings", "setAndGetEventSettings", "getAndSetEventSettings", "setAndGetInstances", "getAndSetInstances", "setAndGetInstancesWithContext", "getAndSetInstancesWithContext", "setAndGetEventSettingsWithContext", "getAndSetEventSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext", "setAndGetGlobalSettingsWithContext", "getAndSetGlobalSettingsWithContext"]; w.ttq.setAndLog = function (t, e) { w.ttq.set(t, e); w.ttq.log(t, e) }; w.ttq.set = function (t, e) { w.ttq[t] = e }; w.ttq.get = function (t) { return w.ttq[t] }; w.ttq.instances = []; w.ttq.load = function (e, t) { var n = "https://analytics.tiktok.com/i18n/pixel/events.js"; w.ttq._i = w.ttq._i || {}; w.ttq._i[e] = []; w.ttq._i[e]._u = n; w.ttq._t = w.ttq._t || {}; w.ttq._t[e] = +new Date; w.ttq._o = w.ttq._o || {}; w.ttq._o[e] = t || {}; w.ttq._v = w.ttq._v || "1.0.11"; var r = d.createElement("script"); r.type = "text/javascript"; r.async = !0; r.src = n + "?sdkid=" + e + "&lib=ttq"; var i = d.getElementsByTagName("script")[0]; i.parentNode.insertBefore(r, i) }; w.ttq.load(PIXELS.tiktok); w.ttq.page(); w.ttq.track('ViewContent'); }(window, document, 'ttq');

        // Snapchat Pixel
        (function(e,t,n,a,r,i,s){if(!e[i]){e[i]=e[r]=function(){e[r].handleRequest?e[r].handleRequest.apply(e[r],arguments):e[r].queue.push(arguments)};e[r].queue=[];i=t.createElement(n);i.async=!0;i.src=a;s=t.getElementsByTagName(n)[0];s.parentNode.insertBefore(i,s)}})(window,document,"script","https://sc-static.net/scevent.min.js","snaptr","snaptr");
        snaptr('init', PIXELS.snapchat);
        snaptr('track', 'PAGE_VIEW');
        snaptr('track', 'VIEW_CONTENT');
    </script>
</head>
<body class="text-[#0F1111]">

    <!-- Amazon Header -->
    <header class="amazon-bg-navy text-white p-3 sticky top-0 z-50 shadow-md">
        <div class="max-w-6xl mx-auto flex items-center justify-between gap-4">
            <div class="text-2xl font-bold">MAD<span class="amazon-orange">.</span></div>
            
            <div class="flex-1 max-w-xl hidden md:block">
                <div class="relative">
                    <input type="text" id="search-input" class="w-full py-2 px-4 rounded-lg text-black focus:outline-[#FF9900]" placeholder="البحث في العروض...">
                    <div class="absolute left-0 top-0 h-full bg-[#FEBD69] px-4 rounded-l-lg flex items-center cursor-pointer hover:bg-[#F3A847]">
                        <i data-lucide="search" class="text-black w-5 h-5"></i>
                    </div>
                </div>
            </div>

            <button onclick="toggleLang()" class="flex items-center gap-1 border border-transparent hover:border-white p-2 rounded transition-all">
                <i data-lucide="globe" class="w-5 h-5"></i>
                <span id="lang-text" class="text-sm font-bold">עברית</span>
            </button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto py-6 px-4">
        <!-- Offers Grid -->
        <div id="offers-container" class="grid grid-cols-1 gap-6 mb-12">
            <!-- سيتم ملؤه بواسطة JS -->
        </div>

        <!-- Reviews Section -->
        <div class="bg-white border border-gray-200 p-6 md:p-10 rounded-sm">
            <div class="flex flex-col lg:flex-row gap-12">
                <!-- Sidebar -->
                <div class="w-full lg:w-1/3">
                    <h2 id="reviews-header" class="text-2xl font-bold mb-4">مراجعات العملاء</h2>
                    <div class="flex items-center gap-2 mb-2">
                        <div id="main-stars" class="flex"></div>
                        <span class="text-lg font-bold">4.9 <span id="out-of-text">من 5</span></span>
                    </div>
                    <p id="global-rating-text" class="text-sm text-gray-500 mb-6">تقييم عالمي</p>

                    <!-- Star Bars -->
                    <div id="star-bars" class="space-y-2 mb-10">
                        <!-- تم إنشاؤها ديناميكياً لتشبه أمازون -->
                    </div>
                    
                    <div class="mt-10 pt-6 border-t border-gray-200">
                        <h4 id="write-review-title" class="font-bold mb-2">مراجعة هذا المنتج</h4>
                        <p id="share-thoughts-text" class="text-sm mb-4">شارك أفكارك مع العملاء الآخرين</p>
                        <button id="toggle-form-btn" onclick="toggleForm()" class="w-full border border-gray-300 rounded-lg py-2 text-sm font-medium hover:bg-gray-50 shadow-sm transition-all">كتابة مراجعة</button>
                        
                        <div id="review-form" class="hidden mt-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <div class="mb-4 text-center">
                                <label class="block text-xs font-bold mb-1 uppercase">تقييمك</label>
                                <div id="form-stars" class="flex justify-center gap-1 cursor-pointer"></div>
                            </div>
                            <input id="new-title" type="text" placeholder="عنوان المراجعة" class="w-full p-2 mb-3 text-sm border border-gray-300 rounded focus:outline-[#FF9900]">
                            <textarea id="new-comment" placeholder="ما هو رأيك؟" class="w-full p-2 mb-4 text-sm border border-gray-300 rounded h-24 focus:outline-[#FF9900]"></textarea>
                            <div class="flex gap-2">
                                <button onclick="submitReview()" class="flex-1 amazon-bg-yellow py-2 rounded-lg text-xs font-bold shadow-sm">نشر المراجعة</button>
                                <button onclick="toggleForm()" class="px-4 py-2 text-xs font-bold text-gray-500">إلغاء</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reviews List -->
                <div class="flex-1">
                    <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-100">
                        <span id="top-reviews-text" class="font-bold text-sm uppercase">أحدث المراجعات</span>
                        <div class="flex items-center gap-1 text-xs text-gray-500">
                            <span id="sort-text">ترتيب حسب</span>: <span class="font-bold">أحدث</span>
                        </div>
                    </div>
                    <div id="reviews-list" class="space-y-10">
                        <!-- سيتم ملؤه بواسطة JS -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-20 py-10 border-t border-gray-300 bg-white text-center">
        <div class="text-2xl font-black mb-8">MAD<span class="amazon-orange">.</span></div>
        <div class="flex justify-center gap-8 text-gray-500 mb-8">
            <a href="#" class="hover:text-[#C7511F] transition-all"><i data-lucide="instagram"></i></a>
            <a href="#" class="hover:text-[#C7511F] transition-all"><i data-lucide="facebook"></i></a>
            <a href="#" class="hover:text-[#C7511F] transition-all"><i data-lucide="message-circle"></i></a>
        </div>
        <p id="footer-text" class="text-[10px] text-gray-500">جميع الحقوق محفوظة © 2024 - MAD Parfumeur</p>
    </footer>

    <!-- WhatsApp Button -->
    <a href="https://wa.me/972524033442" class="fixed bottom-6 left-6 w-14 h-14 bg-[#25D366] text-white rounded-full flex items-center justify-center shadow-xl hover:scale-110 transition-transform">
        <i data-lucide="message-circle" class="w-8 h-8 fill-current"></i>
    </a>

    <script>
        // --- البيانات والحالة ---
        let currentLang = 'ar';
        let userRating = 5;
        let userReviews = [];

        const content = {
            ar: {
                search: "البحث في العروض...",
                langBtn: "עברית",
                badge: "الأكثر مبيعاً",
                deal: "عرض لفترة محدودة",
                cta: "مشاهدة العرض وتفاصيل المنتج",
                available: "متوفر حالياً - عروض حصرية أونلاين",
                reviewsHeader: "مراجعات العملاء",
                outOf: "من 5",
                global: "تقييم عالمي",
                write: "كتابة مراجعة",
                share: "شارك أفكارك مع العملاء الآخرين",
                submit: "نشر المراجعة",
                cancel: "إلغاء",
                latest: "أحدث المراجعات",
                sort: "ترتيب حسب",
                verified: "مشتري مؤكد",
                helpful: "مفيد",
                report: "إبلاغ",
                footer: "جميع الحقوق محفوظة © 2024 - MAD Parfumeur",
                you: "أنت (مراجعة خاصة)",
                now: "الآن"
            },
            he: {
                search: "חיפוש במבצעים...",
                langBtn: "عربي",
                badge: "הנמכר ביותר",
                deal: "דיל לזמן מוגבל",
                cta: "צפה במבצע ופרטי המוצר",
                available: "זמין כעת - מבצעים בלעדיים אונליין",
                reviewsHeader: "ביקורות לקוחות",
                outOf: "מתוך 5",
                global: "דירוג גלובלי",
                write: "כתוב ביקורת",
                share: "שתף את המחשבות שלך עם לקוחות אחרים",
                submit: "פרסם ביקורת",
                cancel: "ביטול",
                latest: "ביקורות אחרונות",
                sort: "מיין לפי",
                verified: "רכישה מאומתת",
                helpful: "מועיל",
                report: "דווח",
                footer: "כל הזכויות שמורות © 2024 - מד פרפומר",
                you: "אתה (ביקורת פרטית)",
                now: "עכשיו"
            }
        };

        const offers = [
            { key: 1, img: "https://www.mad-parfumeur.com/assets/hero/1.webp", title: { ar: "العرض الأول: باقة النخبة", he: "מבצע 1: מארז עילית" }, subtitle: { ar: "تتضمن 3 عطور نيش فاخرة مع علبة خشبية", he: "כולל 3 בשמי נישה יוקרתיים עם מארז עץ" }, rating: 4.9, count: "1,240" },
            { key: 2, img: "https://www.mad-parfumeur.com/assets/hero/2.webp", title: { ar: "العرض الثاني: الثنائي الساحر", he: "מבצע 2: הצמד הקסום" }, subtitle: { ar: "عطر رجالي وعطر نسائي بتركيز عالٍ", he: "בושם לגבר ובושם לאישה בריכוז גבוה" }, rating: 4.8, count: "850" },
            { key: 3, img: "https://www.mad-parfumeur.com/assets/hero/3.webp", title: { ar: "العرض الثالث: مجموعة الصيف", he: "מבצע 3: קולקציית קיץ" }, subtitle: { ar: "روائح منعشة تدوم لأكثر من 24 ساعة", he: "ריחות רעננים שמחזיקים מעל 24 שעות" }, rating: 5.0, count: "2,100" },
            { key: 4, img: "https://www.mad-parfumeur.com/assets/hero/4.webp", title: { ar: "العرض الرابع: زيوت ماد النقية", he: "מבצע 4: שמני מד טהורים" }, subtitle: { ar: "مجموعة من 5 زيوت عطرية مركزة", he: "ערכה של 5 שמני בושם מרוכזים" }, rating: 4.7, count: "430" },
            { key: 5, img: "https://www.mad-parfumeur.com/assets/hero/5.webp", title: { ar: "العرض الخامس: الإصدار المحدود", he: "מבצע 5: מהדורה מוגבלת" }, subtitle: { ar: "عطر ليلي بلمسات العود والزعفران", he: "בושם לילה עם נגיעות עוד וזעפרן" }, rating: 4.9, count: "1,560" },
            { key: 6, img: "https://www.mad-parfumeur.com/assets/hero/6.webp", title: { ar: "العرض السادس: كلاسيكيات ماد", he: "מבצע 6: קלאסיקות מד" }, subtitle: { ar: "أفضل 3 عطور مبيعاً في تاريخنا", he: "3 הבשמים הנמכרים ביותר בהיסטוריה שלנו" }, rating: 4.8, count: "920" },
            { key: 7, img: "https://www.mad-parfumeur.com/assets/hero/7.webp", title: { ar: "العرض السابع: مجموعة السبا", he: "מבצע 7: ערכת ספא" }, subtitle: { ar: "عطور زيتية وشموع فواحة للمنزل", he: "שמני בושם ונרות ריחניים לבית" }, rating: 4.6, count: "310" },
            { key: 8, img: "https://www.mad-parfumeur.com/assets/hero/8.webp", title: { ar: "العرض الثامن: ثقة الرجال", he: "מבצע 8: ביטחון גברי" }, subtitle: { ar: "عطور خشبية قوية وجذابة", he: "בשמים עציים חזקים ומושכים" }, rating: 4.9, count: "740" },
            { key: 9, img: "https://www.mad-parfumeur.com/assets/hero/9.webp", title: { ar: "العرض التاسع: لمسة الأنوثة", he: "מבצע 9: נגיעה נשית" }, subtitle: { ar: "باقة من الزهور والفواكه المنعشة", he: "מארז פרחים ופירות רעננים" }, rating: 5.0, count: "1,050" },
            { key: 10, img: "https://www.mad-parfumeur.com/assets/hero/10.webp", title: { ar: "العرض العاشر: بكج المسك", he: "מבצע 10: מארז מושק" }, subtitle: { ar: "أفخر أنواع المسك الأبيض والملكي", he: "מיטב סוגי המושק הלבן והמלכותי" }, rating: 4.9, count: "1,800" }
        ];

        const poolOfReviews = [
            { name: {ar: "أحمد منصور", he: "אחמד מנסור"}, title: {ar: "العطر نار اخوي", he: "בושם פצצה אחי"}, text: { ar: "العطر نار اخوي، الثبات ولا غلطة والكل سألني شو حاطط.", he: "הבושם פצצה אחי, העמידות מעולה וכולם שאלו אותי מה שמתי." }, rating: 5, date: "قبل ساعة", likes: 84 },
            { name: {ar: "إياد وتد", he: "איאד ותד"}, title: {ar: "احسن شركة عطور", he: "חברת הבשמים הכי טובה"}, text: { ar: "احسن شركة عطور اقسم بالله، جربت W183 وفعلاً بجنن وبنصح الكل فيه.", he: "חברת הבשמים הכי טובה נשבע לכם, ניסיתי את W183 וזה באמת מדהים." }, rating: 5, date: "قبل ساعتين", likes: 32 },
            { name: {ar: "שרה ل.", he: "שרה ל."}, title: {ar: "تسلم عمي محمد", he: "תודה דוד מוחמד"}, text: { ar: "تسلم عمي محمد احلا شركه، دايماً بتعامل معكم والخدمة توب التوب.", he: "תודה דוד מוחמד החברה הכי טובה, תמיד קונה מכם והשירות הכי טוב שיש." }, rating: 5, date: "اليوم", likes: 19 },
            { name: {ar: "ميخائيل م.", he: "מיכאל מ."}, title: {ar: "فرع يافا", he: "סניף יפו"}, text: { ar: "اليوم اشتريت من فرع يافا العطور نار خاصه W183، بنصحكم تروحوا لهناك.", he: "היום קניתי מסניף יפו הבשמים אש במיוחד W183, ממליץ לכם ללכת לשם." }, rating: 5, date: "قبل 3 ساعات", likes: 47 },
            { name: {ar: "فادي جبارين", he: "פאדי ג'בארין"}, title: {ar: "ثبات خرافي", he: "עמידות מטורפת"}, text: { ar: "ريحة العطر بتضل يومين عواعيي حتى بعد الغسيل! روعة.", he: "ריח הבושם נשאר יומיים על הבגדים גם אחרי כביסה! מדהים." }, rating: 5, date: "أمس", likes: 12 },
            { name: {ar: "נועה ברק", he: "נועה ברק"}, title: {ar: "מומלץ בחום", he: "מומלץ בחום"}, text: { ar: "בשמים ברמה הכי גבוהה בארץ. השירות VIP.", he: "בשמים ברמה הכי גבוהה בארץ. השירות VIP." }, rating: 5, date: "أمس", likes: 25 },
            { name: {ar: "يوسف حاج", he: "יוסף חאג'"}, title: {ar: "بكج النخبة", he: "מארז העילית"}, text: { ar: "البكج وصلني مغلف بطريقة بتبيض الوجه كهدية. المسك عندكم فنان.", he: "המארז הגיע ארוזה בצורה יפה מאוד כמתנה. המושק אצלכם אליפות." }, rating: 5, date: "قبل يومين", likes: 63 },
            { name: {ar: "دانا ס.", he: "דנה ס."}, title: {ar: "W183 إدمان", he: "W183 ממכר"}, text: { ar: "صارلي شهر بستخدم W183 وما بقدر أغيره، ريحة فخامة.", he: "כבר חודש אני משתמשת ב-W183 ולא יכולה להחליף אותו, ריח יוקרתי." }, rating: 5, date: "قبل يومين", likes: 41 },
            { name: {ar: "رنا سلامة", he: "רנא סלאמה"}, title: {ar: "أفضل تجربة", he: "החוויה הכי טובה"}, text: { ar: "تعامل محترم وتوصيل سريع للناصرة، شكراً ماد بارفيوم.", he: "יחס מכבד ומשלוח מהיר לנצרת, תודה מד פרפומר." }, rating: 5, date: "قبل 3 أيام", likes: 55 },
            { name: {ar: "يوحاي ل.", he: "יוחאי ל."}, title: {ar: "ريحة فخمة", he: "ריח יוקרתי"}, text: { ar: "عطور بمستوى عالي جداً والريحة بتجنن.", he: "בשמים ברמה גבוהה מאוד והריח מדהים." }, rating: 5, date: "قبل 4 أيام", likes: 18 },
            { name: {ar: "منى وتد", he: "מונא ותד"}, title: {ar: "W183 نار", he: "W183 אש"}, text: { ar: "اليوم وصلني W183 وفعلاً نار، يسلموا إيديكم.", he: "היום הגיע לי W183 ובאמת אש, תודה רבה." }, rating: 5, date: "قبل ساعة", likes: 15 },
            { name: {ar: "إياد بشارة", he: "איאד בשארה"}, title: {ar: "مصداقية وأمانة", he: "אמינות ויושרה"}, text: { ar: "دايماً بطلب منكم، عطور أصلية وبوصل الطلب بسرعة.", he: "תמיד מזמין מכם, בשמים מקוריים וההזמנה מגיעה מהר." }, rating: 5, date: "قبل أسبوع", likes: 37 },
            { name: {ar: "خالد وتد", he: "ח'אלד ותד"}, title: {ar: "سعر مناسب جداً", he: "מחיר הוגן מאוד"}, text: { ar: "عطور بتنافس الماركات العالمية بسعر رخيص.", he: "בשמים שמתחרים במותגים בינלאומיים במחיר זול." }, rating: 4, date: "8 فبراير 2024", likes: 8 },
            { name: {ar: "ياسر م.", he: "יאסר מ."}, title: {ar: "توصيل سريع", he: "משלוח מהיר"}, text: { ar: "الطلب وصلني خلال يوم واحد للبيت.", he: "ההזמנה הגיעה תוך יום אחד עד הבית." }, rating: 5, date: "قبل أسبوعين", likes: 10 },
            { name: {ar: "ليان حبيب", he: "ליאן חביב"}, title: {ar: "ريحة فواحة", he: "ריח דומיננטי"}, text: { ar: "ريحة النظافة بكل العطور، تجربة ممتازة.", he: "ריח של ניקיון בכל הבשמים, חוויה מצוינת." }, rating: 5, date: "أمس", likes: 36 },
            { name: {ar: "سامر خوري", he: "סאמר ח'ורי"}, title: {ar: "أحلى هدية", he: "המתנה הכי יפה"}, text: { ar: "أخذت بكج المسك لمرتي وكثير انبسطت عليه.", he: "לקחתי מארז מושק לאשתי והיא מאוד שמחה." }, rating: 5, date: "قبل أسبوع", likes: 21 },
            { name: {ar: "جمانة أسدي", he: "ג'ומאנה אסדי"}, title: {ar: "أفضل شركة بالبلاد", he: "החברה הכי טובה בארץ"}, text: { ar: "كل عطر أحلى من الثاني، المسك الملكي خيال.", he: "כל בושם יותר יפה מהשני, המושק המלכותי דמיוני." }, rating: 5, date: "قبل شهر", likes: 48 },
            { name: {ar: "איתן סלע", he: "איתן סלע"}, title: {ar: "תמורה למחיר", he: "תמורה למחיר"}, text: { ar: "محירים فجز وبشמים ברמה של מותגים كببر.", he: "מחירים פגז ובשמים ברמה של מותגים גדולים." }, rating: 5, date: "قبل شهرين", likes: 71 },
            { name: {ar: "فرح س.", he: "פרח ס."}, title: {ar: "عطور فخمة", he: "בשמים יוקרתיים"}, text: { ar: "روائح كلاسيكية راقية جداً.", he: "ריחות קלאסיים ויוקרתיים מאוד." }, rating: 5, date: "قبل يومين", likes: 5 },
            { name: {ar: "أحمد جبارين", he: "אחמד ג'בארין"}, title: {ar: "تغليف رهيب", he: "אריזה מדהימה"}, text: { ar: "وصلتني الطلبية مغلفة بطريقة كتير مرتبة وفخمة.", he: "ההזמנה הגיעה ארוזה בצורה מאוד מסודרת ויוקרתית." }, rating: 5, date: "أمس", likes: 14 }
        ];

        // --- وظائف المساعدة ---
        function getStars(rating, size=18) {
            let stars = '';
            for (let i = 0; i < 5; i++) {
                const isFilled = i < Math.floor(rating);
                stars += `<i data-lucide="star" class="w-4 h-4 ${isFilled ? 'star-filled' : 'star-empty'}"></i>`;
            }
            return stars;
        }

        function renderOffers() {
            const container = document.getElementById('offers-container');
            container.innerHTML = offers.map(off => `
                <div class="bg-white border border-gray-200 p-4 rounded-sm flex flex-col md:flex-row gap-6 hover:shadow-md transition-shadow">
                    <div class="w-full md:w-1/3 aspect-square relative">
                        <img src="${off.img}" alt="${off.title[currentLang]}" class="w-full h-full object-contain">
                        <div class="absolute top-2 right-2 bg-[#CC0C39] text-white text-[10px] font-bold px-2 py-1 rounded-sm">
                            ${content[currentLang].deal}
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col justify-start items-start text-right">
                        <div class="bg-[#E47911] text-white text-[10px] font-bold px-2 py-0.5 rounded-sm mb-2">
                            ${content[currentLang].badge}
                        </div>
                        <h3 class="text-xl font-medium mb-1 hover:text-[#C7511F] cursor-pointer">
                            ${off.title[currentLang]}
                        </h3>
                        <div class="flex items-center gap-2 mb-3">
                            <div class="flex">${getStars(off.rating, 16)}</div>
                            <span class="text-[#007185] text-sm hover:text-[#C7511F] cursor-pointer">${off.count}</span>
                        </div>
                        <p class="text-gray-600 text-sm mb-6">${off.subtitle[currentLang]}</p>
                        <div class="mt-auto w-full">
                            <p class="text-xs text-green-700 font-bold mb-3">${content[currentLang].available}</p>
                            <a href="https://www.mad-parfumeur.com/landing/sale${off.key}.html" target="_blank" class="w-full md:w-64 amazon-bg-yellow amazon-btn-border py-2 rounded-full text-center text-sm font-bold shadow-sm active:scale-95 transition-all flex items-center justify-center gap-2">
                                <i data-lucide="shopping-bag" class="w-4 h-4"></i>
                                ${content[currentLang].cta}
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderReviews() {
            const hourIndex = new Date().getHours() % (poolOfReviews.length - 5);
            const displayed = poolOfReviews.slice(hourIndex, hourIndex + 6);
            const list = document.getElementById('reviews-list');
            
            // دمج التعليقات الجديدة مع المعروضة
            const allToDisplay = [...userReviews, ...displayed];

            list.innerHTML = allToDisplay.map(rev => `
                <div class="flex flex-col gap-2 p-4 rounded-lg transition-all ${rev.isUserGenerated ? 'bg-[#fffdf0] border-r-4 border-[#FFA41C]' : ''}">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center ${rev.isUserGenerated ? 'bg-[#FFA41C] text-white' : 'bg-gray-200 text-gray-400'}">
                            <i data-lucide="user" class="w-5 h-5"></i>
                        </div>
                        <span class="text-sm font-medium">${rev.name[currentLang] || rev.name}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="flex">${getStars(rev.rating, 14)}</div>
                        <span class="font-bold text-sm">${rev.title[currentLang]}</span>
                    </div>
                    <div class="text-xs text-gray-500">تمت المراجعة في ${rev.date}</div>
                    <div class="flex items-center gap-2">
                       <span class="text-[#C45500] text-xs font-bold underline cursor-default">${content[currentLang].verified}</span>
                       ${rev.isUserGenerated ? `<span class="text-[10px] bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full font-bold">مراجعتك</span>` : ''}
                    </div>
                    <p class="text-sm leading-relaxed my-2">${rev.text[currentLang]}</p>
                    <div class="flex items-center gap-4 mt-2">
                      <button class="border border-gray-300 shadow-sm px-6 py-1 rounded-lg text-xs hover:bg-gray-50 active:bg-gray-100">${content[currentLang].helpful}</button>
                      <span class="text-gray-300 text-sm">|</span>
                      <button class="text-gray-500 text-xs hover:text-[#C7511F]">${content[currentLang].report}</button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderStarBars() {
            const bars = [
                { stars: 5, pct: '88%' },
                { stars: 4, pct: '10%' },
                { stars: 3, pct: '1%' },
                { stars: 2, pct: '1%' },
                { stars: 1, pct: '0%' }
            ];
            document.getElementById('star-bars').innerHTML = bars.map(b => `
                <div class="flex items-center gap-3 mb-2 text-sm text-[#007185] hover:text-[#C7511F] cursor-pointer group">
                    <span class="w-12">${b.stars} ${currentLang === 'ar' ? 'نجوم' : 'כוכבים'}</span>
                    <div class="flex-1 h-5 bg-[#F0F2F2] rounded-sm overflow-hidden border border-gray-200">
                        <div class="h-full bg-[#FFA41C] border-r border-[#DE7921]" style="width: ${b.pct}"></div>
                    </div>
                    <span class="w-8 text-left">${b.pct}</span>
                </div>
            `).join('');
        }

        function toggleLang() {
            currentLang = currentLang === 'ar' ? 'he' : 'ar';
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-text').innerText = content[currentLang].langBtn;
            document.getElementById('search-input').placeholder = content[currentLang].search;
            document.getElementById('reviews-header').innerText = content[currentLang].reviewsHeader;
            document.getElementById('out-of-text').innerText = content[currentLang].outOf;
            document.getElementById('global-rating-text').innerText = content[currentLang].global;
            document.getElementById('write-review-title').innerText = content[currentLang].write;
            document.getElementById('share-thoughts-text').innerText = content[currentLang].share;
            document.getElementById('toggle-form-btn').innerText = content[currentLang].write;
            document.getElementById('top-reviews-text').innerText = content[currentLang].latest;
            document.getElementById('sort-text').innerText = content[currentLang].sort;
            document.getElementById('footer-text').innerText = content[currentLang].footer;
            
            renderOffers();
            renderReviews();
            renderStarBars();
        }

        function toggleForm() {
            const form = document.getElementById('review-form');
            form.classList.toggle('hidden');
        }

        function renderFormStars() {
            const container = document.getElementById('form-stars');
            container.innerHTML = '';
            for(let i = 1; i <= 5; i++) {
                const star = document.createElement('i');
                star.setAttribute('data-lucide', 'star');
                star.className = `w-6 h-6 ${i <= userRating ? 'star-filled' : 'star-empty'}`;
                star.onclick = () => { userRating = i; renderFormStars(); };
                container.appendChild(star);
            }
            lucide.createIcons();
        }

        function submitReview() {
            const title = document.getElementById('new-title').value;
            const comment = document.getElementById('new-comment').value;
            if(!title || !comment) return;

            const nameStr = content[currentLang].you;
            const review = {
                name: { ar: nameStr, he: nameStr },
                title: { ar: title, he: title },
                text: { ar: comment, he: comment },
                rating: userRating,
                date: content[currentLang].now,
                likes: 0,
                isUserGenerated: true
            };

            userReviews.unshift(review);
            document.getElementById('new-title').value = '';
            document.getElementById('new-comment').value = '';
            toggleForm();
            renderReviews();
        }

        // --- تهيئة الصفحة ---
        window.onload = () => {
            renderOffers();
            renderReviews();
            renderStarBars();
            renderFormStars();
            document.getElementById('main-stars').innerHTML = getStars(4.9, 22);
            lucide.createIcons();
        };

        // تحديث المراجعات كل ساعة
        setInterval(renderReviews, 3600000);
    </script>
</body>
</html>
