<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAD | INSTANT</title>

    <script>
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1072283127290819'); fbq('init', '365261313317768'); fbq('track', 'PageView');
        !function(w,d,t){w.TTPixel=w.TTPixel||[];var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=r+"?sdkid="+e+"&lib=ttq";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(a,s)};
        ttq.load('D2D02JBC77U4ENLN9SBG'); ttq.load('CR6S9CBCJ9B8B0Q6U30G'); ttq.page();
    }(window, document, 'ttq');
    
    function trackLead(name) {
        if(window.fbq) fbq('track', 'Lead', {content_name: name});
        if(window.ttq) ttq.track('Contact', {content_name: name});
    }
    </script>

    <style>
        :root { --blue: #0046be; --gold: #d4af37; --wa: #25D366; --bg: #ffffff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
        body { background: #f4f7fa; color: #1a1a1a; padding-bottom: 140px; }

        /* الأيقونات SVG مدمجة لسرعة 0 ثانية */
        .icon { width: 22px; height: 22px; fill: currentColor; vertical-align: middle; }
        
        .top-wa { background: var(--wa); color: #fff; text-align: center; padding: 12px; font-weight: 800; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        header { background: linear-gradient(135deg, var(--blue), #002d7a); color: #fff; text-align: center; padding: 30px 15px; border-bottom: 3px solid var(--gold); border-radius: 0 0 35px 35px; }
        .logo-img { width: 80px; margin-bottom: 10px; }
        .staff-img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #fff; object-fit: cover; margin: 10px auto; display: block; }

        .soc { display: flex; justify-content: center; gap: 15px; margin: 15px 0; }
        .soc a { transition: transform 0.1s; }
        .fb { color: #1877F2; } .ig { color: #E4405F; } .tk { color: #000; background: #fff; border-radius: 50%; } .wz { color: #33CCFF; } .sc { color: #FFFC00; filter: drop-shadow(0 0 1px #000); }

        .cats { display: flex; overflow-x: auto; padding: 12px; gap: 10px; background: #fff; border-bottom: 1px solid #ddd; sticky: top; top: 46px; z-index: 900; scrollbar-width: none; }
        .cats::-webkit-scrollbar { display: none; }
        .cat { padding: 8px 18px; background: #f0f2f5; border-radius: 50px; font-size: 14px; font-weight: bold; white-space: nowrap; cursor: pointer; border: 1px solid transparent; }
        .cat.active { background: var(--blue); color: #fff; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .card { background: #fff; border-radius: 15px; border: 1px solid #eee; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #f9f9f9; }
        .card-body { padding: 12px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .btn-add { background: var(--blue); color: #fff; border: none; padding: 10px; border-radius: 10px; font-weight: 800; width: 100%; cursor: pointer; margin-top: 5px; }
        .btn-add.in { background: #eef2f7; color: var(--blue); }

        /* Floating Assets */
        #cart-fab { position: fixed; bottom: 85px; right: 20px; width: 60px; height: 60px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1500; box-shadow: 0 5px 20px rgba(0,0,0,0.3); color: #fff; }
        #badge { position: absolute; top: 0; right: 0; background: var(--gold); color: #000; width: 22px; height: 22px; border-radius: 50%; font-size: 11px; font-weight: 900; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; }
        #sale-fab { position: fixed; bottom: 85px; left: 20px; width: 60px; height: 60px; background: #fff; border-radius: 50%; border: 3px solid var(--gold); display: flex; align-items: center; justify-content: center; z-index: 1500; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} }

        /* Fragrantica Sticky */
        .frag-sticky { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 2px solid var(--gold); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; box-shadow: 0 -4px 10px rgba(0,0,0,0.05); }
        .frag-btn { background: var(--gold); color: #000; padding: 8px 18px; border-radius: 20px; font-weight: 800; border: none; font-size: 12px; cursor: pointer; }

        .drawer { position: fixed; bottom: -100%; left: 0; width: 100%; height: 75%; background: #fff; border-top: 5px solid var(--blue); z-index: 2000; transition: 0.3s cubic-bezier(0, 0, 0, 1); border-radius: 30px 30px 0 0; padding: 20px; }
        .drawer.open { bottom: 0; }
        .order-btn { background: var(--wa); color: #fff; border: none; width: 100%; padding: 18px; border-radius: 12px; font-weight: 800; font-size: 18px; margin-top: 10px; cursor: pointer; }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 1800; }

        .sale-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .sale-box { width: 100%; max-width: 360px; background: #fff; border-radius: 25px; overflow: hidden; position: relative; border: 2px solid var(--gold); }
    </style>
</head>
<body>

<a id="wa-top" href="#" class="top-wa" onclick="trackLead('Top_WhatsApp')">
    <svg class="icon" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766 0-3.18-2.587-5.771-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.522-2.961-2.638-.086-.117-.718-.952-.718-1.81 0-.857.453-1.277.614-1.45.16-.174.349-.217.466-.217.117 0 .234.001.334.005.109.004.258-.041.404.308.144.347.498 1.217.541 1.304.044.087.073.189.014.305-.06.115-.09.189-.176.29-.086.1-.183.224-.263.303-.09.087-.183.181-.079.359.103.178.461.761.988 1.231.679.605 1.25.794 1.428.883.178.086.28.073.383-.044.103-.116.444-.517.564-.693.118-.178.239-.144.404-.087.164.058 1.043.491 1.222.581.179.087.299.129.344.204.045.076.045.438-.099.843z"/></svg>
    <span id="top-txt">دبرو معنا واتساب</span>
</a>

<header>
    <img src="logo.png" class="logo-img">
    <img src="https://madperfume.ps/upload/01-2026/page/6966930e9af7f.png" class="staff-img">
    <h1 id="b-name" style="font-family:'Cinzel', serif; font-size:1.6rem; color:var(--gold); margin-bottom:5px;">MAD</h1>
    <div id="b-status" style="font-weight:800; font-size:0.9rem;"></div>
    <div id="b-soc" class="soc"></div>
</header>

<div id="cats" class="cats"></div>
<main id="p-grid" class="grid"></main>

<div id="cart-fab" onclick="toggleCart(true)"><svg class="icon" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg><div id="badge">0</div></div>
<div id="sale-fab" onclick="toggleSale(true)"><svg class="icon" style="fill:var(--gold)" viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.62 0-2.98 1.28-3 2.88l-.01-.01c-.01-1.6-1.38-2.87-3-2.87-1.66 0-3 1.34-3 3 0 .35.07.69.18 1h-2.19c-1.1 0-2 .9-2 2v2c0 .55.45 1 1 1h1v10c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-10h1c.55 0 1-.45 1-1v-2c0-1.1-.9-2-2-2zm-8 15h-7v-10h7v10zm0-12h-7v-2h7v2zm9 12h-7v-10h7v10zm0-12h-7v-2h7v2z"/></svg></div>

<div class="frag-sticky">
    <div style="text-align:right">
        <h5 id="f-h" style="color:var(--blue); font-size:13px; font-weight:800;">MAD العالمية</h5>
        <p id="f-p" style="font-size:10px; color:#666;">الأعلى تقييماً في Fragrantica</p>
    </div>
    <button id="f-b" class="frag-btn" onclick="window.open('https://www.fragrantica.com/designers/Mad-Parfumeur.html')">استكشف</button>
</div>

<div id="cart-drawer" class="drawer">
    <h3 style="text-align:center; color:var(--blue); margin-bottom:15px;" id="c-title">سلة المشتريات</h3>
    <div id="cart-list" style="overflow-y:auto; height:calc(100% - 120px);"></div>
    <div id="total" style="text-align:center; font-weight:900; padding:15px; font-size:1.3rem; border-top:1px solid #eee;"></div>
    <button class="order-btn" onclick="order()">إرسال الطلب عبر واتساب</button>
</div>

<div id="sale-modal" class="sale-modal">
    <div class="sale-box">
        <span style="position:absolute; top:10px; right:15px; font-size:2rem; cursor:pointer;" onclick="toggleSale(false)">&times;</span>
        <img src="sale.png" style="width:100%; display:block;">
        <div id="timer" style="background:var(--gold); text-align:center; padding:12px; font-size:1.8rem; font-weight:900;">00:00:00</div>
        <button class="order-btn" style="margin:0; border-radius:0; padding:15px;" onclick="order()">احصل على العرض</button>
    </div>
</div>

<div id="overlay" onclick="toggleCart(false)"></div>

<script>
const bID = new URLSearchParams(window.location.search).get('branch') || 1;
const isHe = !navigator.language.startsWith('ar');
let DB = { b: null, p: [], cart: [] };

async function init() {
    try {
        const [brs, prs] = await Promise.all([
            fetch('branches.json').then(r => r.json()),
            fetch('products.csv').then(r => r.text())
        ]);
        DB.b = brs.branches.find(x => x.id == bID) || brs.branches[0];
        
        const rows = prs.split('\n');
        const cIdx = isHe ? 10 : 11;
        for(let i=1; i<rows.length; i++) {
            const c = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if(c[0]) DB.p.push({ id:i, n:c[0].replace(/"/g,''), img:c[3]?.trim(), p:parseFloat(c[9]?.replace(/[^\d.]/g,''))||0, ps:c[9]?.replace('ILS','').trim()+' ₪', cat:c[cIdx]?.trim() });
        }
        render();
        setInterval(() => { const d = new Date().setHours(23,59,59) - new Date(); document.getElementById('timer').innerText = new Date(d).toISOString().substr(11, 8); }, 1000);
    } catch(e) { console.log("Load Error"); }
}

function render() {
    const b = DB.b;
    document.getElementById('b-name').innerText = isHe ? b.name_he : b.name_ar;
    document.getElementById('wa-top').href = `https://wa.me/972${b.phone.substring(1)}`;
    document.getElementById('c-title').innerText = isHe ? 'סל קניות' : 'سلة المشتريات';
    document.getElementById('f-h').innerText = isHe ? 'MAD העולמית' : 'MAD العالمية';
    document.getElementById('f-p').innerText = isHe ? 'הכי מדורג ב-Fragrantica' : 'الأعلى تقييماً في Fragrantica';
    document.getElementById('f-b').innerText = isHe ? 'גלה' : 'استكشف';

    // SVG Icons Real Colors
    const icons = {
        facebook: { c:'#1877F2', p:'M12 2.04c-5.5 0-10 4.5-10 10 0 5 3.66 9.12 8.44 9.88v-6.99h-2.54v-2.89h2.54V9.85c0-2.51 1.49-3.89 3.77-3.89 1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.89h-2.33v6.99c4.78-.76 8.44-4.88 8.44-9.88 0-5.5-4.5-10-10-10z' },
        instagram: { c:'#E4405F', p:'M12 2.16c3.2 0 3.58.01 4.85.07 3.25.15 4.77 1.69 4.92 4.92.06 1.27.07 1.65.07 4.85s-.01 3.58-.07 4.85c-.15 3.23-1.66 4.77-4.92 4.92-1.27.06-1.65.07-4.85.07s-3.58-.01-4.85-.07c-3.26-.15-4.77-1.7-4.92-4.92-.06-1.27-.07-1.65-.07-4.85s.01-3.58.07-4.85c.15-3.23 1.66-4.77 4.92-4.92 1.27-.06 1.65-.07 4.85-.07zm0-2.16c-3.26 0-3.67.01-4.95.07-4.35.2-6.78 2.62-6.98 6.98-.06 1.28-.07 1.69-.07 4.95s.01 3.67.07 4.95c.2 4.36 2.62 6.78 6.98 6.98 1.28.06 1.69.07 4.95.07s3.67-.01 4.95-.07c4.35-.2 6.78-2.62 6.98-6.98.06-1.28.07-1.69.07-4.95s-.01-3.67-.07-4.95c-.2-4.37-2.62-6.79-6.98-6.98-1.28-.06-1.69-.07-4.95-.07zm0 5.84c-3.4 0-6.16 2.76-6.16 6.16s2.76 6.16 6.16 6.16 6.16-2.76 6.16-6.16-2.76-6.16-6.16-6.16zm0 10.16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm6.41-11.57c.79 0 1.44-.64 1.44-1.44s-.64-1.44-1.44-1.44-1.44.64-1.44 1.44.64 1.44 1.44 1.44z' },
        waze: { c:'#33CCFF', p:'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14.5h-2v-2h2v2zm0-4h-2v-5h2v5z' },
        tiktok: { c:'#000', p:'M12.53.02C13.84 0 15.14.01 16.44 0c.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.06-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.59-5.71-.29-4.37 3.27-8.23 7.64-8.26.45-.02.91.01 1.35.11v4.03c-.44-.13-.92-.19-1.38-.13-1.22.14-2.31.91-2.86 2.01-.58 1.1-.57 2.53.11 3.59.67 1.05 1.89 1.71 3.12 1.58 1.15-.07 2.19-.78 2.68-1.81.27-.55.38-1.15.38-1.75V.02z' }
    };
    let sH = '';
    Object.entries(b.social || {}).forEach(([k,v]) => { if(v && icons[k]) sH += `<a href="${v}" target="_blank" style="color:${icons[k].c}; margin:0 8px;"><svg class="icon" viewBox="0 0 24 24"><path d="${icons[k].p}"/></svg></a>`; });
    document.getElementById('b-soc').innerHTML = sH;

    const now = new Date(); const day = ['sun','mon','tue','wed','thu','fri','sat'][now.getDay()];
    const time = now.getHours() * 60 + now.getMinutes(); let open = false;
    if(b.schedule?.[day]) b.schedule[day].forEach(s => { if(time >= parseInt(s[0].split(':')[0])*60 && time < parseInt(s[1].split(':')[0])*60) open = true; });
    const st = document.getElementById('b-status');
    st.innerText = open ? (isHe?'פתוח עכשיו':'مفتوح الآن') : (isHe?'סגור כעת':'مغلق حالياً');
    st.style.color = open ? '#2ecc71' : '#e74c3c';

    const cats = [isHe?'הכל':'الكل', ...new Set(DB.p.map(x => x.cat))].filter(Boolean);
    document.getElementById('cats').innerHTML = cats.map(c => `<div class="cat ${c===(isHe?'הכל':'الكل')?'active':''}" onclick="filter(this, '${c}')">${c}</div>`).join('');
    grid(isHe?'הكل':'الكل');
}

function filter(el, c) { document.querySelectorAll('.cat').forEach(x => x.classList.remove('active')); el.classList.add('active'); grid(c); }
function grid(f) {
    const list = f === (isHe?'הכל':'الكل') ? DB.p : DB.p.filter(x => x.cat === f);
    document.getElementById('p-grid').innerHTML = list.map(p => {
        const inC = DB.cart.some(x => x.id === p.id);
        return `<div class="card"><img src="${p.img}" loading="lazy"><div class="card-body"><div><div style="font-size:12px; font-weight:700; height:32px; overflow:hidden;">${p.n}</div><div style="color:var(--blue); font-weight:900; margin:4px 0;">${p.ps}</div></div><button class="btn-add ${inC?'in':''}" onclick="add(${p.id}, this)">${inC?(isHe?'בסל':'في السلة'):(isHe?'הוסף':'إضافة')}</button></div></div>`;
    }).join('');
}

function add(id, btn) {
    if(DB.cart.some(x => x.id === id)) return;
    DB.cart.push(DB.p.find(x => x.id === id));
    btn.classList.add('in'); btn.innerText = isHe?'בסל':'في السلة';
    update();
}

function update() {
    document.getElementById('badge').innerText = DB.cart.length; let tot = 0;
    document.getElementById('cart-list').innerHTML = DB.cart.map(x => { tot += x.p; return `<div style="display:flex; align-items:center; gap:10px; padding:10px; border-bottom:1px solid #eee;"><img src="${x.img}" style="width:35px; border-radius:5px;"><div style="flex-grow:1; font-size:12px; font-weight:700;">${x.n}</div><div>${x.ps}</div></div>`; }).join('');
    document.getElementById('total').innerText = (isHe?'סה"כ: ':'المجموع: ') + tot + ' ₪';
}

function toggleCart(s) { document.getElementById('cart-drawer').classList.toggle('open', s); document.getElementById('overlay').style.display = s ? 'block' : 'none'; }
function toggleSale(s) { document.getElementById('sale-modal').style.display = s ? 'flex' : 'none'; }
function order() { let m = "*Order:*\n"; DB.cart.forEach((x, i) => m += `${i+1}. ${x.n}\n`); window.open(`https://wa.me/972${DB.b.phone.substring(1)}?text=${encodeURIComponent(m)}`, '_blank'); }

init();
</script>
</body>
</html>
