<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAD | INSTANT</title>

    <script>
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1072283127290819'); fbq('init', '365261313317768'); fbq('track', 'PageView');
    </script>

    <style>
        :root { --blue: #0046be; --gold: #d4af37; --wa: #25D366; --bg: #ffffff; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #1a1a1a; line-height: 1.4; padding-bottom: 60px; }

        /* SVG Icons Inline for Zero Loading Time */
        .icon { width: 24px; height: 24px; fill: currentColor; vertical-align: middle; }
        
        .top-wa { background: var(--wa); color: #fff; text-align: center; padding: 12px; font-weight: 800; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; position: sticky; top: 0; z-index: 1000; font-size: 14px; }
        
        header { background: linear-gradient(135deg, var(--blue), #002d7a); color: #fff; text-align: center; padding: 25px 15px; border-bottom: 3px solid var(--gold); border-radius: 0 0 30px 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .logo-box { width: 75px; height: 75px; background: #fff; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--gold); overflow: hidden; }
        .logo-box img { width: 80%; }
        
        .staff-img { width: 70px; height: 70px; border-radius: 50%; border: 2px solid #fff; object-fit: cover; margin-bottom: 5px; }

        .soc { display: flex; justify-content: center; gap: 15px; margin: 15px 0; }
        .fb { color: #1877F2; } .ig { color: #E4405F; } .tk { color: #000; } .wz { color: #33CCFF; } .sc { color: #FFFC00; }

        .cats { display: flex; overflow-x: auto; padding: 10px; gap: 8px; sticky: top; top: 43px; background: #fff; z-index: 900; border-bottom: 1px solid #eee; }
        .cat { padding: 6px 14px; background: #f0f2f5; border-radius: 20px; font-size: 13px; font-weight: 700; white-space: nowrap; cursor: pointer; }
        .cat.active { background: var(--blue); color: #fff; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: #fff; border-radius: 12px; border: 1px solid #eee; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #fafafa; }
        .card-body { padding: 10px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .btn-add { background: var(--blue); color: #fff; border: none; padding: 8px; border-radius: 8px; font-weight: 800; width: 100%; font-size: 13px; margin-top: 5px; }
        .btn-add.in { background: #eef2f7; color: var(--blue); }

        #cart-fab { position: fixed; bottom: 75px; right: 20px; width: 55px; height: 55px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1500; box-shadow: 0 5px 15px rgba(0,0,0,0.3); color: #fff; }
        #count { position: absolute; top: 0; right: 0; background: var(--gold); color: #000; width: 18px; height: 18px; border-radius: 50%; font-size: 10px; font-weight: 900; display: flex; align-items: center; justify-content: center; }

        .drawer { position: fixed; bottom: -100%; left: 0; width: 100%; height: 75%; background: #fff; border-top: 4px solid var(--blue); z-index: 2000; transition: 0.3s; padding: 20px; border-radius: 25px 25px 0 0; }
        .drawer.open { bottom: 0; }
        .order-btn { background: var(--wa); color: #fff; border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: 800; font-size: 17px; margin-top: 10px; }
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 1800; }
    </style>
</head>
<body>

<a id="wa-top" href="#" class="top-wa">
    <svg class="icon" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766 0-3.18-2.587-5.771-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.522-2.961-2.638-.086-.117-.718-.952-.718-1.81 0-.857.453-1.277.614-1.45.16-.174.349-.217.466-.217.117 0 .234.001.334.005.109.004.258-.041.404.308.144.347.498 1.217.541 1.304.044.087.073.189.014.305-.06.115-.09.189-.176.29-.086.1-.183.224-.263.303-.09.087-.183.181-.079.359.103.178.461.761.988 1.231.679.605 1.25.794 1.428.883.178.086.28.073.383-.044.103-.116.444-.517.564-.693.118-.178.239-.144.404-.087.164.058 1.043.491 1.222.581.179.087.299.129.344.204.045.076.045.438-.099.843z"/></svg>
    <span id="top-txt">דברו איתנו בוואטסאפ</span>
</a>

<header>
    <div class="logo-box"><img src="https://abomkdad.github.io/Digital-Business-Card/logo.png" alt="MAD"></div>
    <img src="https://madperfume.ps/upload/01-2026/page/6966930e9af7f.png" class="staff-img">
    <h1 id="b-name" style="font-size:1.4rem; color:var(--gold);">MAD PARFUMEUR</h1>
    <p id="b-status" style="font-weight:800; font-size:0.9rem;"></p>
    <div id="b-soc" class="soc"></div>
</header>

<div id="cats" class="cats"></div>
<main id="grid" class="grid"></main>

<div id="cart-fab" onclick="toggleCart(true)">
    <svg class="icon" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
    <div id="count">0</div>
</div>

<div id="cart-drawer" class="drawer">
    <h3 style="text-align:center; color:var(--blue); margin-bottom:15px;" id="c-title">سلة المشتريات</h3>
    <div id="cart-list" style="overflow-y:auto; height:calc(100% - 120px);"></div>
    <div id="cart-total" style="text-align:center; font-weight:900; padding:15px; border-top:1px solid #eee;"></div>
    <button class="order-btn" onclick="send()">إرسال الطلب عبر واتساب</button>
</div>

<div id="overlay" onclick="toggleCart(false)"></div>

<script>
const bID = new URLSearchParams(window.location.search).get('branch') || 1;
const isHe = !navigator.language.startsWith('ar');
let DB = { b: null, p: [], cart: [] };

async function init() {
    try {
        const [brs, prs] = await Promise.all([
            fetch('branches.json').then(r => r.json()),
            fetch('products.csv').then(r => r.text())
        ]);
        DB.b = brs.branches.find(x => x.id == bID) || brs.branches[0];
        
        const rows = prs.split('\n');
        const cIdx = isHe ? 10 : 11;
        for(let i=1; i<rows.length; i++) {
            const c = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if(c[0]) DB.p.push({ id:i, n:c[0].replace(/"/g,''), img:c[3]?.trim(), p:parseFloat(c[9]?.replace(/[^\d.]/g,''))||0, ps:c[9]?.replace('ILS','').trim()+' ₪', cat:c[cIdx]?.trim() });
        }
        render();
    } catch(e) { console.log("Load Error"); }
}

function render() {
    const b = DB.b;
    document.getElementById('b-name').innerText = isHe ? b.name_he : b.name_ar;
    document.getElementById('wa-top').href = `https://wa.me/972${b.phone.substring(1)}`;
    document.getElementById('c-title').innerText = isHe ? 'סל קניות' : 'سلة المشتريات';
    
    // Real Colors SVG Icons
    const icons = {
        facebook: { c:'fb', p:'M12 2.04c-5.5 0-10 4.5-10 10 0 5 3.66 9.12 8.44 9.88v-6.99h-2.54v-2.89h2.54V9.85c0-2.51 1.49-3.89 3.77-3.89 1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.89h-2.33v6.99c4.78-.76 8.44-4.88 8.44-9.88 0-5.5-4.5-10-10-10z' },
        instagram: { c:'ig', p:'M12 2.16c3.2 0 3.58.01 4.85.07 3.25.15 4.77 1.69 4.92 4.92.06 1.27.07 1.65.07 4.85s-.01 3.58-.07 4.85c-.15 3.23-1.66 4.77-4.92 4.92-1.27.06-1.65.07-4.85.07s-3.58-.01-4.85-.07c-3.26-.15-4.77-1.7-4.92-4.92-.06-1.27-.07-1.65-.07-4.85s.01-3.58.07-4.85c.15-3.23 1.66-4.77 4.92-4.92 1.27-.06 1.65-.07 4.85-.07zm0-2.16c-3.26 0-3.67.01-4.95.07-4.35.2-6.78 2.62-6.98 6.98-.06 1.28-.07 1.69-.07 4.95s.01 3.67.07 4.95c.2 4.36 2.62 6.78 6.98 6.98 1.28.06 1.69.07 4.95.07s3.67-.01 4.95-.07c4.35-.2 6.78-2.62 6.98-6.98.06-1.28.07-1.69.07-4.95s-.01-3.67-.07-4.95c-.2-4.37-2.62-6.79-6.98-6.98-1.28-.06-1.69-.07-4.95-.07zm0 5.84c-3.4 0-6.16 2.76-6.16 6.16s2.76 6.16 6.16 6.16 6.16-2.76 6.16-6.16-2.76-6.16-6.16-6.16zm0 10.16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm6.41-11.57c.79 0 1.44-.64 1.44-1.44s-.64-1.44-1.44-1.44-1.44.64-1.44 1.44.64 1.44 1.44 1.44z' },
        waze: { c:'wz', p:'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14.5h-2v-2h2v2zm0-4h-2v-5h2v5z' }
    };
    let sH = '';
    Object.entries(b.social||{}).forEach(([k,v]) => { if(v && icons[k]) sH += `<a href="${v}" target="_blank" class="${icons[k].c}" style="margin:0 8px;"><svg class="icon" viewBox="0 0 24 24"><path d="${icons[k].p}"/></svg></a>`; });
    document.getElementById('b-soc').innerHTML = sH;

    // Status
    const now = new Date(); const day = ['sun','mon','tue','wed','thu','fri','sat'][now.getDay()];
    const time = now.getHours() * 60 + now.getMinutes(); let open = false;
    if(b.schedule?.[day]) b.schedule[day].forEach(s => { if(time >= parseInt(s[0].split(':')[0])*60 && time < parseInt(s[1].split(':')[0])*60) open = true; });
    const st = document.getElementById('b-status');
    st.innerText = open ? (isHe?'פתוח עכשיו':'مفتوح الآن') : (isHe?'סגור كעת':'مغلق حالياً');
    st.style.color = open ? '#2ecc71' : '#e74c3c';

    // Cats
    const cats = [isHe?'הכל':'الكل', ...new Set(DB.p.map(x => x.cat))].filter(Boolean);
    document.getElementById('cats').innerHTML = cats.map(c => `<div class="cat ${c===(isHe?'הכל':'الكل')?'active':''}" onclick="filter(this, '${c}')">${c}</div>`).join('');
    grid(isHe?'הכל':'الكل');
}

function filter(el, c) {
    document.querySelectorAll('.cat').forEach(x => x.classList.remove('active'));
    el.classList.add('active'); grid(c);
}

function grid(f) {
    const list = f === (isHe?'הכל':'الكل') ? DB.p : DB.p.filter(x => x.cat === f);
    document.getElementById('grid').innerHTML = list.map(p => {
        const inC = DB.cart.some(x => x.id === p.id);
        return `<div class="card"><img src="${p.img}" loading="lazy"><div class="card-body"><div><div style="font-size:12px; font-weight:700; height:32px; overflow:hidden;">${p.n}</div><div style="color:var(--blue); font-weight:900; margin:4px 0;">${p.ps}</div></div><button class="btn-add ${inC?'in':''}" onclick="add(${p.id}, this)">${inC?(isHe?'בסל':'في السلة'):(isHe?'הוסף':'إضافة')}</button></div></div>`;
    }).join('');
}

function add(id, btn) {
    if(DB.cart.some(x => x.id === id)) return;
    DB.cart.push(DB.p.find(x => x.id === id));
    btn.classList.add('in'); btn.innerText = isHe?'בסל':'في السلة';
    update();
}

function update() {
    document.getElementById('count').innerText = DB.cart.length;
    let tot = 0;
    document.getElementById('cart-list').innerHTML = DB.cart.map(x => {
        tot += x.p;
        return `<div style="display:flex; align-items:center; gap:10px; padding:10px; border-bottom:1px solid #eee;"><img src="${x.img}" style="width:35px;"><div style="flex-grow:1; font-size:12px; font-weight:700;">${x.n}</div><div>${x.ps}</div></div>`;
    }).join('');
    document.getElementById('cart-total').innerText = (isHe?'סה"כ: ':'المجموع: ') + tot + ' ₪';
}

function toggleCart(s) { document.getElementById('cart-drawer').classList.toggle('open', s); document.getElementById('overlay').style.display = s ? 'block' : 'none'; }

function send() {
    let m = "*Order:*\n"; DB.cart.forEach((x, i) => m += `${i+1}. ${x.n}\n`);
    window.open(`https://wa.me/972${DB.b.phone.substring(1)}?text=${encodeURIComponent(m)}`, '_blank');
}

init();
</script>
</body>
</html>
