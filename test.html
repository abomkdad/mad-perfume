<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD PARFUMEUR</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <style>
        :root{--bg:#0a0a0a;--card:#141414;--gold:#d4af37;--text:#fff;--muted:#aaa}
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--text);font-family:'Cairo','Heebo',sans-serif;padding-bottom:90px}
        header{text-align:center;padding:40px 15px;border-bottom:2px solid var(--gold)}
        .logo img{width:80px;margin:auto; display: block;}
        .brand{color:var(--gold);font-weight:800;margin-top:15px; font-size: 14px; letter-spacing: 1px;}
        .branch-name{font-size:28px;font-weight:800; margin: 10px 0;}
        .status{margin-top:5px;padding:6px 18px;border-radius:25px;font-weight:700;font-size:14px;display:inline-block}
        .open{background:rgba(37,211,102,.15);color:#25D366}
        .socials{display:flex;justify-content:center;gap:15px;margin-top:25px}
        .socials a{width:40px;height:40px;border-radius:50%;border:1px solid var(--gold);display:flex;align-items:center;justify-content:center;color:var(--gold);font-size:18px;text-decoration:none}
        
        #categories{display:flex;gap:10px;overflow-x:auto;padding:20px 15px; scrollbar-width: none;}
        .cat{border:none;padding:10px 20px;border-radius:12px;background:var(--gold);color:#000;font-weight:800;cursor:pointer; white-space: nowrap;}
        
        /* ØªØ³ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† */
        .popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:9999}
        .popup{width:90%;max-width:380px;background:#000;border:1px solid var(--gold);border-radius:20px;padding:20px;position:relative; text-align: center;}
        .popup img{width:100%; border-radius:15px; margin-bottom: 15px; aspect-ratio: 1/1; object-fit: cover;}
        .popup-close{position:absolute;top:-15px;right:-15px;cursor:pointer;font-size:20px;background:var(--gold);color:#000;width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold; border: 2px solid #000;}
        .timer{color:var(--gold); font-family: monospace; font-size: 16px; margin: 10px 0; font-weight: bold;}
        .popup-cta{background:#25D366;color:#fff;padding:15px;border-radius:12px;font-weight:800;cursor:pointer; font-size: 18px; text-decoration: none; display: block;}
        
        .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;padding:15px}
        .card{background:var(--card);border-radius:16px;padding:12px;text-align:center}
        .card img{width:100%;border-radius:12px; aspect-ratio: 1/1; object-fit: cover;}
    </style>
</head>
<body>

<header>
    <div class="logo"><img src="https://abomkdad.github.io/Digital-Business-Card/logo.png"></div>
    <div class="brand">MAD PARFUMEUR</div>
    <div id="branchName" class="branch-name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <div id="status"><div class="status open">Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†</div></div>
    <div class="socials" id="socials"></div>
</header>

<div id="categories"></div>
<div class="products" id="products"></div>

<div class="popup-overlay" id="popup">
    <div class="popup">
        <div class="popup-close" onclick="closePopup()">âœ•</div>
        <img src="sale.png" onerror="this.src='https://via.placeholder.com/400x400/000000/d4af37?text=HOT+SALE'">
        <div class="timer" id="timer">00:00:00</div>
        <div class="popup-cta" onclick="popupWhatsApp()">ğŸ”¥ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…</div>
    </div>
</div>

<script>
const branchID = new URLSearchParams(location.search).get("branch");
let phone = "";

function closePopup() {
    document.getElementById("popup").style.display = "none";
}

function startTimer() {
    const timerEl = document.getElementById("timer");
    setInterval(() => {
        const now = new Date();
        const end = new Date();
        end.setHours(23, 59, 59);
        const diff = end - now;
        if (diff <= 0) return;
        const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
        const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
        const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
        timerEl.textContent = `ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø®Ù„Ø§Ù„: ${h}:${m}:${s}`;
    }, 1000);
}

// Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
fetch("test.json").then(r => r.json()).then(d => {
    const b = d.branches.find(x => String(x.id) === String(branchID));
    if (!b) return;

    document.getElementById("branchName").textContent = b.name_ar;
    phone = "972" + b.phone.replace(/^0/, "");

    const s = b.social || {};
    const icons = [
        {id: "envelope", link: s.email ? `mailto:${s.email}` : null, type: "fas"},
        {id: "facebook-f", link: s.facebook, type: "fab"},
        {id: "tiktok", link: s.tiktok, type: "fab"},
        {id: "instagram", link: s.instagram, type: "fab"},
        {id: "whatsapp", link: `https://wa.me/${phone}`, type: "fab"},
        {id: "location-dot", link: s.waze, type: "fas"}
    ];

    document.getElementById("socials").innerHTML = icons.filter(i => i.link).map(i => `
        <a href="${i.link}" target="_blank">
            <i class="${i.type} fa-${i.id}"></i>
        </a>`).join("");

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„ÙØ­Øµ
    setTimeout(() => {
        document.getElementById("popup").style.display = "flex";
        startTimer();
    }, 800);
});

// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
Papa.parse("products.csv", {
    download: true,
    header: true,
    complete: function(results) {
        const products = results.data.filter(p => String(p.BranchID) === String(branchID));
        const container = document.getElementById("products");
        const catContainer = document.getElementById("categories");
        
        const categories = [...new Set(products.map(p => p.Category))];
        catContainer.innerHTML = `<button class="cat">Ø§Ù„ÙƒÙ„</button>` + 
            categories.map(c => c ? `<button class="cat" style="background:transparent; color:white; border:1px solid var(--gold)">${c}</button>` : '').join('');

        container.innerHTML = products.map(p => `
            <div class="card">
                <img src="${p.Image}" onerror="this.src='https://via.placeholder.com/150'">
                <div style="margin:10px 0; font-weight:600;">${p.Title}</div>
                <div style="color:var(--gold); font-weight:800;">â‚ª ${p.Price}</div>
            </div>
        `).join('');
    }
});

function popupWhatsApp() {
    window.open(`https://wa.me/${phone}?text=Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…`, "_blank");
}
</script>

</body>
</html>
