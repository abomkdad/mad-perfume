<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>MAD PARFUMEUR | Fast Ads Page</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Assistant:wght@400;700&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Meta Pixel -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window,document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init','1072283127290819');
fbq('track','PageView');
</script>

<!-- TikTok Pixel -->
<script>
!function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];
ttq.methods=["page","track"];ttq.setAndDefer=function(t,e){
t[e]=function(){t.push([e].concat([].slice.call(arguments,0)))}};
for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
ttq.load=function(e){var s=d.createElement("script");
s.async=!0;s.src="https://analytics.tiktok.com/i18n/pixel/events.js?sdkid="+e;
var x=d.getElementsByTagName("script")[0];x.parentNode.insertBefore(s,x)};
ttq.load('D2D02JBC77U4ENLN9SBG');ttq.page();
}(window,document,'ttq');
function trackLead(n){
if(window.fbq)fbq('track','Lead',{content_name:n});
if(window.ttq)ttq.track('Contact',{content_name:n});
}
</script>

<style>
:root{--g:#D4AF37;--b:#080808;--wa:#25D366;--r:#ff0000;--gr:#00ff00}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--b);color:#fff;font-family:Assistant,Cairo,sans-serif;padding-bottom:120px}
.top-wa{position:sticky;top:0;z-index:1000;background:var(--wa);color:#fff;
text-align:center;padding:12px;font-weight:900;text-decoration:none}
header{text-align:center;padding:25px 15px;border-bottom:2px solid var(--g)}
.logo{max-width:110px}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:15px}
.card{background:#111;border-radius:14px;overflow:hidden}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover}
.info{padding:10px;text-align:center}
.btn{background:var(--g);color:#000;border:none;width:100%;padding:10px;
border-radius:8px;font-weight:900}
.btn.added{background:#333;color:#fff}
.fab{position:fixed;bottom:90px;right:20px;width:60px;height:60px;
background:var(--g);border-radius:50%;display:flex;
align-items:center;justify-content:center;z-index:2000}
.count{position:absolute;top:-5px;right:-5px;background:var(--r);
width:22px;height:22px;border-radius:50%;font-size:11px;
display:flex;align-items:center;justify-content:center}
</style>
</head>

<body>

<a id="waTop" class="top-wa" target="_blank" onclick="trackLead('Top WhatsApp')">
<i class="fab fa-whatsapp"></i> واتساب مباشر
</a>

<header>
<img src="logo.png" class="logo" loading="eager">
<h2 id="branchName" style="color:var(--g);margin-top:10px"></h2>
<div id="openState" style="font-weight:900"></div>
</header>

<main id="grid" class="grid"></main>

<div class="fab" onclick="sendOrder()">
<i class="fas fa-shopping-bag" style="color:#000;font-size:22px"></i>
<div id="c" class="count">0</div>
</div>

<script>
const q=new URLSearchParams(location.search);
const bid=parseInt(q.get('branch'))||1;
const lang=navigator.language.startsWith('ar')?'ar':'he';
let B=null,P=[],C=[];

fetch('branches.json').then(r=>r.json()).then(b=>{
B=b.branches.find(x=>x.id===bid)||b.branches[0];
document.getElementById('branchName').textContent=
(lang==='ar'?'فرع ':'סניף ')+(lang==='ar'?B.name_ar:B.name_he);
document.getElementById('waTop').href=
`https://api.whatsapp.com/send/?phone=972${B.phone.substring(1)}`;
});

fetch('products.csv').then(r=>r.text()).then(t=>{
const l=t.split('\n');
for(let i=1;i<l.length;i++){
const c=l[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
if(!c[0])continue;
P.push({id:i,t:c[0].replace(/"/g,''),
img:c[3]||'logo.png',
p:c[9]||''});
}
draw();
});

function draw(){
const g=document.getElementById('grid');
g.innerHTML=P.map(p=>`
<div class="card">
<img src="${p.img}" loading="lazy">
<div class="info">
<div style="font-size:13px;font-weight:700">${p.t}</div>
<div style="color:var(--g);font-weight:900">${p.p}</div>
<button class="btn" onclick="add(${p.id},this)">إضافة</button>
</div></div>`).join('');
}

function add(id,b){
if(C.includes(id))return;
C.push(id);b.classList.add('added');b.textContent='في السلة';
document.getElementById('c').textContent=C.length;
}

function sendOrder(){
trackLead('Checkout');
location.href=
`https://api.whatsapp.com/send/?phone=972${B.phone.substring(1)}&text=Order`;
}
</script>

</body>
</html>
