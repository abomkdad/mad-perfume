<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAD | INSTANT</title>

    <script>
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1072283127290819'); fbq('init', '365261313317768'); fbq('track', 'PageView');
        !function(w,d,t){w.TTPixel=w.TTPixel||[];var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.load=function(e,n){ttq.instance(e).load(e,n)};ttq.load('D2D02JBC77U4ENLN9SBG'); ttq.load('CR6S9CBCJ9B8B0Q6U30G'); ttq.page();}(window,document,'ttq');
    </script>

    <style>
        :root { --blue: #0046be; --gold: #d4af37; --wa: #25D366; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, system-ui, sans-serif; }
        body { background: #f0f2f5; color: #1a1a1a; padding-bottom: 60px; }

        /* الأيقونات كـ SVG مدمج للسرعة */
        .icon { width: 24px; height: 24px; vertical-align: middle; fill: currentColor; }
        
        .top-bar { background: var(--wa); color: #fff; text-align: center; padding: 12px; font-weight: bold; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px; position: sticky; top: 0; z-index: 1000; }
        
        header { background: linear-gradient(135deg, var(--blue), #002d7a); color: #fff; text-align: center; padding: 30px 15px; border-bottom: 3px solid var(--gold); border-radius: 0 0 30px 30px; }
        .logo-box { width: 80px; height: 80px; background: #fff; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 2px solid var(--gold); }
        .logo-box img { width: 85%; }

        .soc-grid { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
        .soc-grid a { text-decoration: none; transition: transform 0.1s; }
        
        /* ألوان الأيقونات الأصلية */
        .fb { color: #1877F2; } .ig { color: #E4405F; } .tk { color: #000; } .wz { color: #33CCFF; } .sc { color: #FFFC00; }

        .cats { display: flex; overflow-x: auto; padding: 10px; gap: 8px; sticky: top; top: 44px; background: #fff; z-index: 900; border-bottom: 1px solid #ddd; }
        .cat { padding: 8px 16px; background: #eee; border-radius: 20px; font-size: 14px; white-space: nowrap; cursor: pointer; font-weight: bold; }
        .cat.active { background: var(--blue); color: #fff; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: #fff; border-radius: 12px; overflow: hidden; border: 1px solid #ddd; display: flex; flex-direction: column; }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #f9f9f9; }
        .card-p { padding: 10px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        
        .btn-add { background: var(--blue); color: #fff; border: none; padding: 10px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; }
        .btn-add.in { background: #eef2f7; color: var(--blue); }

        #cart-fab { position: fixed; bottom: 70px; right: 20px; width: 60px; height: 60px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); color: #fff; }
        #badge { position: absolute; top: 0; right: 0; background: var(--gold); color: #000; width: 22px; height: 22px; border-radius: 50%; font-size: 12px; font-weight: 900; display: flex; align-items: center; justify-content: center; }

        .drawer { position: fixed; bottom: -100%; left: 0; width: 100%; height: 70%; background: #fff; border-top: 5px solid var(--blue); z-index: 2000; transition: 0.3s cubic-bezier(0,0,0,1); border-radius: 20px 20px 0 0; padding: 20px; }
        .drawer.open { bottom: 0; }
    </style>
</head>
<body>

<a id="wa-top" href="#" class="top-bar">
    <svg class="icon" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766 0-3.18-2.587-5.771-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.522-2.961-2.638-.086-.117-.718-.952-.718-1.81 0-.857.453-1.277.614-1.45.16-.174.349-.217.466-.217.117 0 .234.001.334.005.109.004.258-.041.404.308.144.347.498 1.217.541 1.304.044.087.073.189.014.305-.06.115-.09.189-.176.29-.086.1-.183.224-.263.303-.09.087-.183.181-.079.359.103.178.461.761.988 1.231.679.605 1.25.794 1.428.883.178.086.28.073.383-.044.103-.116.444-.517.564-.693.118-.178.239-.144.404-.087.164.058 1.043.491 1.222.581.179.087.299.129.344.204.045.076.045.438-.099.843z"/></svg>
    <span id="wa-btn-txt">דברו איתנו בוואטסאפ</span>
</a>

<header>
    <div class="logo-box"><img src="https://abomkdad.github.io/Digital-Business-Card/logo.png" alt="MAD"></div>
    <div id="staff"><img src="https://madperfume.ps/upload/01-2026/page/6966930e9af7f.png" class="staff-img"></div>
    <h1 id="branch-name" style="margin:10px 0; color:var(--gold); font-size:1.5rem;">MAD PARFUMEUR</h1>
    <p id="status" style="font-weight:bold;"></p>
    <div id="socials" class="soc-grid"></div>
</header>

<div id="cats" class="cats"></div>
<main id="main-grid" class="grid"></main>

<div id="cart-fab" onclick="toggleCart(true)">
    <svg class="icon" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
    <div id="badge">0</div>
</div>

<div id="cart-drawer" class="drawer">
    <h3 style="text-align:center; color:var(--blue); margin-bottom:15px;">סל קניות</h3>
    <div id="cart-list" style="overflow-y:auto; height: calc(100% - 120px);"></div>
    <div id="total" style="text-align:center; font-weight:900; padding:15px; font-size:1.2rem;"></div>
    <button onclick="order()" style="background:var(--wa); color:#fff; border:none; width:100%; padding:15px; border-radius:10px; font-weight:bold; font-size:18px;">שלח הזמנה בוואטסאפ</button>
</div>

<div id="overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; z-index:1500;" onclick="toggleCart(false)"></div>

<script>
const params = new URLSearchParams(window.location.search);
const bID = params.get('branch') || 1;
const isHe = !navigator.language.startsWith('ar');

let DATA = { b: null, p: [], cart: [] };

async function init() {
    try {
        const [brs, prs] = await Promise.all([
            fetch('branches.json').then(r => r.json()),
            fetch('products.csv').then(r => r.text())
        ]);
        DATA.b = brs.branches.find(x => x.id == bID) || brs.branches[0];
        
        // تحليل المنتجات (فائق السرعة)
        const rows = prs.split('\n');
        const cIdx = isHe ? 10 : 11;
        for(let i=1; i<rows.length; i++) {
            const c = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if(c[0]) DATA.p.push({ id:i, n:c[0].replace(/"/g,''), img:c[3]?.trim(), p:parseFloat(c[9]?.replace(/[^\d.]/g,''))||0, ps:c[9]?.replace('ILS','').trim()+' ₪', cat:c[cIdx]?.trim() });
        }
        render();
    } catch(e) { console.log("Speed Error"); }
}

function render() {
    const b = DATA.b;
    document.getElementById('branch-name').innerText = isHe ? b.name_he : b.name_ar;
    document.getElementById('wa-top').href = `https://wa.me/972${b.phone.substring(1)}`;
    
    // أيقونات فورية ملونة
    let sH = '';
    const icons = { 
        facebook: { c:'fb', p:'M12 2.04c-5.5 0-10 4.5-10 10 0 5 3.66 9.12 8.44 9.88v-6.99h-2.54v-2.89h2.54V9.85c0-2.51 1.49-3.89 3.77-3.89 1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.89h-2.33v6.99c4.78-.76 8.44-4.88 8.44-9.88 0-5.5-4.5-10-10-10z' },
        instagram: { c:'ig', p:'M12 2.16c3.2 0 3.58.01 4.85.07 3.25.15 4.77 1.69 4.92 4.92.06 1.27.07 1.65.07 4.85s-.01 3.58-.07 4.85c-.15 3.23-1.66 4.77-4.92 4.92-1.27.06-1.65.07-4.85.07s-3.58-.01-4.85-.07c-3.26-.15-4.77-1.7-4.92-4.92-.06-1.27-.07-1.65-.07-4.85s.01-3.58.07-4.85c.15-3.23 1.66-4.77 4.92-4.92 1.27-.06 1.65-.07 4.85-.07zm0-2.16c-3.26 0-3.67.01-4.95.07-4.35.2-6.78 2.62-6.98 6.98-.06 1.28-.07 1.69-.07 4.95s.01 3.67.07 4.95c.2 4.36 2.62 6.78 6.98 6.98 1.28.06 1.69.07 4.95.07s3.67-.01 4.95-.07c4.35-.2 6.78-2.62 6.98-6.98.06-1.28.07-1.69.07-4.95s-.01-3.67-.07-4.95c-.2-4.37-2.62-6.79-6.98-6.98-1.28-.06-1.69-.07-4.95-.07zm0 5.84c-3.4 0-6.16 2.76-6.16 6.16s2.76 6.16 6.16 6.16 6.16-2.76 6.16-6.16-2.76-6.16-6.16-6.16zm0 10.16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm6.41-11.57c.79 0 1.44-.64 1.44-1.44s-.64-1.44-1.44-1.44-1.44.64-1.44 1.44.64 1.44 1.44 1.44z' },
        waze: { c:'wz', p:'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 14.5h-2v-2h2v2zm0-4h-2v-5h2v5z' }
    };
    Object.entries(b.social || {}).forEach(([k,v]) => { if(v && icons[k]) sH += `<a href="${v}" target="_blank" class="${icons[k].c}"><svg class="icon" viewBox="0 0 24 24"><path d="${icons[k].p}"/></svg></a>`; });
    document.getElementById('socials').innerHTML = sH;

    // الدوام
    const now = new Date();
    const day = ['sun','mon','tue','wed','thu','fri','sat'][now.getDay()];
    const time = now.getHours() * 60 + now.getMinutes();
    let open = false;
    if(b.schedule?.[day]) b.schedule[day].forEach(s => { if(time >= parseInt(s[0].split(':')[0])*60 && time < parseInt(s[1].split(':')[0])*60) open = true; });
    const st = document.getElementById('status');
    st.innerText = open ? (isHe?'פתוח עכשיו':'مفتوح الآن') : (isHe?'סגור כעת':'مغلق حالياً');
    st.style.color = open ? '#4ade80' : '#ff4d4d';

    // التصنيفات
    const cats = [isHe?'הכל':'الكل', ...new Set(DATA.p.map(x => x.cat))].filter(Boolean);
    document.getElementById('cats').innerHTML = cats.map(c => `<div class="cat ${c==(isHe?'הكل':'الكل')?'active':''}" onclick="filter(this, '${c}')">${c}</div>`).join('');
    grid(isHe?'הكل':'الكل');
}

function filter(el, c) {
    document.querySelectorAll('.cat').forEach(x => x.classList.remove('active'));
    el.classList.add('active');
    grid(c);
}

function grid(f) {
    const list = f === (isHe?'הכל':'الكل') ? DATA.p : DATA.p.filter(x => x.cat === f);
    document.getElementById('main-grid').innerHTML = list.map(p => {
        const inC = DATA.cart.some(x => x.id === p.id);
        return `<div class="card"><img src="${p.img}" loading="lazy"><div class="card-p"><div><div style="font-size:12px; font-weight:bold; height:32px; overflow:hidden;">${p.n}</div><div style="color:var(--blue); font-weight:900; margin:5px 0;">${p.ps}</div></div><button class="btn-add ${inC?'in':''}" onclick="add(${p.id}, this)">${inC?(isHe?'בסל':'في السلة'):(isHe?'הוסף':'إضافة')}</button></div></div>`;
    }).join('');
}

function add(id, btn) {
    if(DATA.cart.some(x => x.id === id)) return;
    const p = DATA.p.find(x => x.id === id);
    DATA.cart.push(p);
    btn.classList.add('in'); btn.innerText = isHe?'בסל':'في السلة';
    update();
}

function update() {
    document.getElementById('badge').innerText = DATA.cart.length;
    let tot = 0;
    document.getElementById('cart-list').innerHTML = DATA.cart.map(x => {
        tot += x.p;
        return `<div style="display:flex; align-items:center; gap:10px; padding:10px; border-bottom:1px solid #eee;"><img src="${x.img}" style="width:35px;"><div style="flex-grow:1; font-size:12px; font-weight:bold;">${x.n}</div><div>${x.ps}</div></div>`;
    }).join('');
    document.getElementById('total').innerText = (isHe?'סה"כ: ':'المجموع: ') + tot + ' ₪';
}

function toggleCart(s) { document.getElementById('cart-drawer').classList.toggle('open', s); document.getElementById('overlay').style.display = s ? 'block' : 'none'; }

function order() {
    let m = "*New Order:*\n";
    DATA.cart.forEach((x, i) => m += `${i+1}. ${x.n}\n`);
    window.open(`https://wa.me/972${DATA.b.phone.substring(1)}?text=${encodeURIComponent(m)}`, '_blank');
}

init();
</script>
</body>
</html>
