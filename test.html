<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<!-- META PIXEL -->
<script>
!function(f,b,e,v,n,t,s){
 if(f.fbq)return;
 n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};
 if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
 n.queue=[];
 t=b.createElement(e);t.async=!0;
 t.src=v;
 s=b.getElementsByTagName(e)[0];
 s.parentNode.insertBefore(t,s)
}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init','1072283127290819');
fbq('track','PageView');
</script>

<style>
:root{
 --bg:#0a0a0a;--card:#141414;--gold:#d4af37;--text:#fff;--muted:#aaa
}
*{box-sizing:border-box}
body{
 margin:0;background:var(--bg);color:var(--text);
 font-family:'Cairo','Heebo',sans-serif;padding-bottom:90px
}
header{
 padding:30px 15px;text-align:center;border-bottom:3px solid var(--gold)
}
.brand{color:var(--gold);font-weight:800;letter-spacing:2px}
.branch-name{font-size:24px;font-weight:800;margin-top:5px}
.status{margin-top:10px;font-weight:700}
.open{color:#25D366}
.closed{color:#ff4444}

.products{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
 gap:15px;padding:15px
}
.card{
 background:var(--card);border-radius:14px;padding:10px;text-align:center
}
.card img{width:100%;border-radius:12px}
.price{color:var(--gold);font-weight:700}

.btn{
 display:block;margin-top:8px;
 background:#25D366;color:#fff;
 padding:10px;border-radius:8px;
 text-decoration:none;font-weight:700
}

.popup{
 position:fixed;inset:0;
 background:rgba(0,0,0,.6);
 display:none;align-items:center;justify-content:center;
 z-index:999
}
.popup-box{
 background:#111;border:2px solid var(--gold);
 border-radius:16px;padding:15px;
 width:90%;max-width:360px;
 text-align:center;position:relative
}
.popup-box img{width:100%;border-radius:12px}
.popup-close{
 position:absolute;top:8px;left:8px;
 color:#fff;font-size:14px;cursor:pointer
}
.popup-title{color:var(--gold);font-weight:800;margin:10px 0}
</style>
</head>

<body>

<header>
 <div class="brand">MAD PARFUMEUR</div>
 <div class="branch-name" id="branchName"></div>
 <div class="status" id="status"></div>
</header>

<div class="products" id="products"></div>

<!-- POPUP -->
<div class="popup" id="popup">
 <div class="popup-box">
  <div class="popup-close" onclick="closePopup()">âœ• Ø¥ØºÙ„Ø§Ù‚</div>
  <div class="popup-title" id="popupTitle"></div>
  <img src="sale.png" alt="Sale">
  <a id="popupWa" class="btn" target="_blank">ðŸ”¥ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶</a>
 </div>
</div>

<script>
const lang=navigator.language.startsWith("he")?"he":"ar";
document.documentElement.lang=lang;

const T={
 ar:{open:"Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†",closed:"Ù…ØºÙ„Ù‚ Ø§Ù„Ø¢Ù†",today:"Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙŠÙˆÙ…"},
 he:{open:"×¤×ª×•×— ×¢×›×©×™×•",closed:"×¡×’×•×¨ ×¢×›×©×™×•",today:"×ž×‘×¦×¢ ×”×™×•×"}
};

const params=new URLSearchParams(location.search);
const branchID=params.get("branch");
let branch=null;

function trackLead(name){
 if(typeof fbq==="function")fbq("track","Lead",{action:name,branch:branch?.id})
}

function isOpenNow(schedule){
 const d=new Date();
 const days=["sun","mon","tue","wed","thu","fri","sat"];
 const day=schedule[days[d.getDay()]];
 if(!day||!day.length)return false;
 const now=d.getHours()*60+d.getMinutes();
 return day.some(r=>{
  const s=parseInt(r[0].split(":")[0])*60+parseInt(r[0].split(":")[1]);
  const e=parseInt(r[1].split(":")[0])*60+parseInt(r[1].split(":")[1]);
  return now>=s && now<=e;
 });
}

async function init(){
 const res=await fetch("test.json");
 const data=await res.json();
 branch=data.branches.find(b=>String(b.id)===branchID);
 if(!branch)return;

 document.getElementById("branchName").textContent=
  lang==="he"?branch.name_he:branch.name_ar;

 const open=isOpenNow(branch.schedule);
 document.getElementById("status").innerHTML=
  `<span class="${open?'open':'closed'}">${open?T[lang].open:T[lang].closed}</span>`;

 loadProducts();
 setupPopup();
}

function loadProducts(){
 Papa.parse("products.csv",{
  download:true,header:true,
  complete:r=>{
   const grid=document.getElementById("products");
   r.data.forEach(p=>{
    if(!p.Title)return;
    let phone=branch.phone.replace(/^0/,"972");
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
     <img src="${p.Image}">
     <div>${p.Title}</div>
     <div class="price">${p.Price}</div>
     <a class="btn" target="_blank"
      href="https://wa.me/${phone}?text=${encodeURIComponent(p.Title)}"
      onclick="trackLead('product_whatsapp')">ÙˆØ§ØªØ³Ø§Ø¨</a>`;
    grid.appendChild(div);
   })
  }
 });
}

function setupPopup(){
 document.getElementById("popupTitle").textContent=T[lang].today;
 let phone=branch.phone.replace(/^0/,"972");
 const wa=document.getElementById("popupWa");
 wa.href=`https://wa.me/${phone}?text=${encodeURIComponent(T[lang].today)}`;
 wa.onclick=()=>trackLead("popup_offer");
 setTimeout(()=>document.getElementById("popup").style.display="flex",1000);
}

function closePopup(){
 document.getElementById("popup").style.display="none";
}

init();
</script>
</body>
</html>
