<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR</title>

<!-- FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">

<!-- META PIXEL -->
<script>
!function(f,b,e,v,n,t,s){
if(f.fbq)return;n=f.fbq=function(){
n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)
}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init','YOUR_META_PIXEL_ID');
fbq('track','PageView');
</script>

<!-- TIKTOK PIXEL -->
<script>
!function(w,d,t){
w.TiktokAnalyticsObject=t;
var ttq=w[t]=w[t]||[];
ttq.methods=["page","track"];
ttq.setAndDefer=function(t,e){t[e]=function(){
t.push([e].concat(Array.prototype.slice.call(arguments,0))) }};
for(var i=0;i<ttq.methods.length;i++)
ttq.setAndDefer(ttq,ttq.methods[i]);
ttq.load=function(e){
var i=d.createElement("script");
i.type="text/javascript";i.async=!0;
i.src="https://analytics.tiktok.com/i18n/pixel/events.js?sdkid="+e;
var n=d.getElementsByTagName("script")[0];
n.parentNode.insertBefore(i,n)};
ttq.load('YOUR_TIKTOK_PIXEL_ID');
ttq.page();
}(window,document,'ttq');
</script>

<style>
:root{
--gold:#c9a24d;
--black:#0b0b0b;
--green:#25D366;
}
body{
margin:0;
background:var(--black);
color:#fff;
font-family:'Heebo','Cairo',sans-serif;
}
header{
text-align:center;
padding:20px;
}
.logo{
font-weight:800;
font-size:28px;
letter-spacing:2px;
color:var(--gold);
}
.branch-name{
margin-top:6px;
font-size:18px;
}
.status{
display:inline-block;
margin-top:8px;
padding:4px 12px;
border-radius:20px;
font-size:14px;
}
.open{background:#1f8f4a}
.closed{background:#8f1f1f}

.socials{
display:flex;
justify-content:center;
gap:16px;
margin-top:16px;
}
.socials a{
color:var(--gold);
font-size:22px;
text-decoration:none;
}

.filters{
display:flex;
overflow-x:auto;
gap:10px;
padding:10px;
justify-content:center;
}
.filters button{
background:none;
border:1px solid var(--gold);
color:var(--gold);
padding:6px 14px;
border-radius:20px;
cursor:pointer;
}
.filters button.active{
background:var(--gold);
color:#000;
}

.products{
display:grid;
grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
gap:16px;
padding:16px;
}
.card{
background:#111;
border-radius:12px;
overflow:hidden;
text-align:center;
}
.card img{
width:100%;
aspect-ratio:1/1;
object-fit:cover;
}
.card h3{
font-size:14px;
margin:8px;
}
.card .price{
color:var(--gold);
margin-bottom:6px;
}
.card button{
background:var(--green);
border:none;
width:90%;
margin-bottom:10px;
padding:8px;
border-radius:20px;
color:#000;
cursor:pointer;
}

#popup{
position:fixed;
inset:0;
background:rgba(0,0,0,.8);
display:none;
align-items:center;
justify-content:center;
z-index:999;
}
.popup-box{
background:#111;
padding:16px;
border-radius:16px;
width:90%;
max-width:360px;
text-align:center;
}
.popup-box img{
width:100%;
aspect-ratio:1/1;
object-fit:cover;
border-radius:12px;
}
.timer{
margin:10px 0;
color:var(--gold);
}
.popup-box button{
background:var(--green);
border:none;
padding:10px 20px;
border-radius:20px;
cursor:pointer;
}
.close{
position:absolute;
top:20px;
right:20px;
font-size:24px;
cursor:pointer;
color:#fff;
}
</style>
</head>

<body>

<header>
<div class="logo">MAD PARFUMEUR</div>
<div class="branch-name" id="branchName"></div>
<div class="status" id="status"></div>
<div class="socials" id="socials"></div>
</header>

<div class="filters" id="filters"></div>
<div class="products" id="products"></div>

<!-- DAILY OFFER POPUP -->
<div id="popup">
<div class="close" onclick="closePopup()">×</div>
<div class="popup-box">
<img src="sale.png">
<div class="timer" id="timer"></div>
<button onclick="popupWhatsApp()">WhatsApp</button>
</div>
</div>

<script>
const params=new URLSearchParams(location.search);
const branchID=parseInt(params.get('branch'));
const lang=navigator.language.startsWith('ar')?'ar':'he';
document.documentElement.lang=lang;
document.documentElement.dir=lang==='ar'?'rtl':'ltr';

function track(type,label){
fbq('track','Lead');
ttq.track('SubmitForm',{action:type,branch:branchID,label});
}

fetch('test.json').then(r=>r.json()).then(data=>{
const branch=data.branches.find(b=>b.id===branchID);
if(!branch)return;

document.getElementById('branchName').textContent=
lang==='ar'?branch.name_ar:branch.name_he;

const now=new Date();
const day=['sun','mon','tue','wed','thu','fri','sat'][now.getDay()];
const minutes=now.getHours()*60+now.getMinutes();
let open=false;

(branch.schedule[day]||[]).forEach(r=>{
const s=r[0].split(':');const e=r[1].split(':');
const sm=+s[0]*60+ +s[1];
const em=+e[0]*60+ +e[1];
if(minutes>=sm && minutes<=em)open=true;
});

const st=document.getElementById('status');
st.textContent=open?(lang==='ar'?'مفتوح':'פתוח'):(lang==='ar'?'مغلق':'סגור');
st.className='status '+(open?'open':'closed');

const soc=document.getElementById('socials');
Object.entries(branch.social).forEach(([k,v])=>{
if(!v)return;
const a=document.createElement('a');
a.href=k==='email'?'mailto:'+v:v;
a.target='_blank';
a.innerHTML='<i class="fa fa-'+k+'"></i>';
a.onclick=()=>track('social',k);
soc.appendChild(a);
});
});

fetch('products.csv').then(r=>r.text()).then(t=>{
const rows=t.split('\n').slice(1);
const data=rows.map(r=>r.split(','));
const prods=data.filter(p=>+p[0]===branchID);
const cats=[...new Set(prods.map(p=>p[1]))];
cats.unshift('All');

const filters=document.getElementById('filters');
cats.forEach(c=>{
const b=document.createElement('button');
b.textContent=c;
b.onclick=()=>render(c);
filters.appendChild(b);
});

function render(cat){
document.querySelectorAll('.filters button').forEach(b=>b.classList.remove('active'));
[...filters.children].find(b=>b.textContent===cat).classList.add('active');
const grid=document.getElementById('products');
grid.innerHTML='';
prods.filter(p=>cat==='All'||p[1]===cat).forEach(p=>{
const d=document.createElement('div');
d.className='card';
d.innerHTML=`
<img src="${p[4]}">
<h3>${p[2]}</h3>
<div class="price">₪ ${p[3]}</div>
<button>WhatsApp</button>`;
d.querySelector('button').onclick=()=>{
track('product',p[2]);
window.open(`https://wa.me/?text=${encodeURIComponent(p[2])}`);
};
grid.appendChild(d);
});
}
render('All');
});

// POPUP
const today=new Date().toDateString();
if(!localStorage.getItem('offer_'+today)){
document.getElementById('popup').style.display='flex';
localStorage.setItem('offer_'+today,true);
}

function closePopup(){
document.getElementById('popup').style.display='none';
}
function popupWhatsApp(){
track('popup','daily-offer');
window.open('https://wa.me/');
}

setInterval(()=>{
const now=new Date();
const end=new Date();
end.setHours(23,59,59);
const diff=end-now;
if(diff<=0)document.getElementById('popup').style.display='none';
const h=Math.floor(diff/36e5);
const m=Math.floor(diff%36e5/6e4);
const s=Math.floor(diff%6e4/1000);
document.getElementById('timer').textContent=`${h}:${m}:${s}`;
},1000);
</script>

</body>
</html>
