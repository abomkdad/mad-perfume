<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª MAD - × ×™×”×•×œ ×”×–×× ×•×ª</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        :root {
            --primary: #60a5fa;
            --accent: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --card-dark: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --input-bg: #0f172a;
            --cancel-bg: #450a0a;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­Ø³Ù† */
        #notification-toast {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--warning);
            color: #000;
            padding: 18px 35px;
            border-radius: 50px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            z-index: 10000;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: top 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            font-size: 18px;
            border: 2px solid #fff;
        }
        #notification-toast.show { top: 30px; }

        .header-ui {
            width: 100%; max-width: 600px; background: #1e293b;
            padding: 15px; box-sizing: border-box;
            position: sticky; top: 0; z-index: 900;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„ØµØ±ÙŠØ­ */
        .audio-activation-wrap {
            background: #27272a;
            border: 1px solid #3f3f46;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 12px;
            text-align: center;
        }
        .audio-btn {
            background: var(--success);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            width: 100%;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .search-input {
            width: 100%; padding: 12px; border: 1px solid #334155;
            border-radius: 12px; font-size: 16px; margin-bottom: 10px;
            box-sizing: border-box; outline: none; text-align: right;
            background: var(--input-bg); color: white;
        }

        .tabs-container { display: flex; gap: 8px; }
        .tab-btn {
            flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #334155;
            background: #334155; font-size: 12px; font-weight: bold; cursor: pointer; color: var(--text-muted);
        }
        .tab-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        .container { width: 95%; max-width: 500px; margin-top: 15px; }

        .order-card {
            background: var(--card-dark); border-radius: 16px; padding: 15px;
            margin-bottom: 15px; border-right: 8px solid #475569;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        
        .status-waiting { border-right-color: var(--warning); }
        .status-contacted { border-right-color: var(--primary); }
        .status-delivered { border-right-color: var(--success); }
        .status-canceled { border-right-color: var(--danger); background: var(--cancel-bg); opacity: 0.8; }

        .check-green { color: var(--success); font-weight: bold; margin-left: 8px; font-size: 20px; }
        .x-red { color: var(--danger); font-weight: bold; margin-left: 8px; font-size: 20px; }

        .delivery-box {
            margin-top: 10px; padding: 10px; background: #ffffff; border-radius: 10px; border: 2px solid var(--primary);
        }
        .delivery-label { font-size: 11px; color: #1e293b; font-weight: bold; margin-bottom: 5px; display: block; }
        .delivery-select {
            width: 100%; background: transparent; color: #000000; border: none; font-size: 15px; font-weight: bold; outline: none; cursor: pointer;
        }

        .actions-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 12px; }
        .btn-op {
            padding: 10px 4px; border-radius: 8px; font-size: 11px;
            font-weight: bold; border: none; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            background: #334155; color: white;
        }
        .btn-wa { background: #065f46; color: #a7f3d0; }
        .btn-print { background: #1e3a8a; color: #bfdbfe; }
        .btn-contact { background: #1e40af; color: white; }
        .btn-cancel { background: #7f1d1d; color: #fecaca; }

        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; max-width: 600px;
            background: #1e293b; display: flex; box-shadow: 0 -4px 10px rgba(0,0,0,0.3); z-index: 1000;
        }
        .nav-item { flex: 1; padding: 15px; text-align: center; border: none; background: none; font-weight: bold; color: var(--text-muted); cursor: pointer; }
        .nav-item.active { color: var(--primary); border-top: 3px solid var(--primary); background: #0f172a; }

        #print-container { display: none; }
        @media print {
            body { background: white !important; color: black !important; }
            #app-ui, .bottom-nav, .header-ui, #notification-toast { display: none !important; }
            #print-container { display: block !important; width: 100%; }
            .print-page { display: block !important; page-break-after: always; margin: 0 auto; background: white !important; color: black !important; }
            .invoice-size { width: 210mm; min-height: 297mm; padding: 15mm; box-sizing: border-box; }
            .sticker-size { width: 100mm; height: 100mm; padding: 5mm; box-sizing: border-box; }
            @page { margin: 0; }
            svg { display: inline-block !important; }
        }
    </style>
</head>
<body>

<div id="notification-toast">
    <span>ğŸ””</span> ×™×© ×œ×š ×”×–×× ×” ×—×“×©×”! (ÙˆØµÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯)
</div>

<div id="app-ui">
    <div class="header-ui">
        <!-- Ù‚Ø³Ù… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
        <div id="audioActivation" class="audio-activation-wrap">
            <button class="audio-btn" onclick="activateRingingSystem()">
                <span>ğŸ”Š</span> ×œ×—×¥ ×›×Ù† ×œ×”×¤×¢×œ×ª ×¨× ×™×Ÿ ×”×–×× ×•×ª (ØªÙØ¹ÙŠÙ„ Ø¬Ø±Ø³ Ø§Ù„Ø·Ù„Ø¨Ø§Øª)
            </button>
        </div>
        
        <input type="text" class="search-input" id="searchInput" placeholder="×—×¤×© ×œ×¤×™ ×©× ××• ×˜×œ×¤×•×Ÿ..." oninput="handleFilter()">
        
        <div class="tabs-container">
            <button class="tab-btn active" id="tab-all" onclick="setFilter('all')">20 ××—×¨×•× ×•×ª</button>
            <button class="tab-btn" id="tab-new" onclick="setFilter('new')">×××ª×™×Ÿ ×œ×©×™×—×”</button>
            <button class="tab-btn" id="tab-prep" onclick="setFilter('prep')">×‘×•×¦×¢×” ×©×™×—×”</button>
        </div>
    </div>
    <div class="container" id="mainContainer">
        <div id="ordersList"><p style="text-align:center; padding:20px; color:var(--text-muted);">×˜×•×¢×Ÿ × ×ª×•× ×™×... (Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„)</p></div>
    </div>
</div>

<div class="bottom-nav">
    <button class="nav-item active" onclick="location.reload()">×”×–×× ×•×ª</button>
</div>

<div id="print-container"></div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw2QxGHOxMv7_uNbMulwO60IHOcKj16rbBJRfoltkwcdb2Bg4zrVjyMt_lf9KgnyyXl/exec";
    let allData = [];
    let currentTab = 'all';
    let localSessionStore = {}; 
    let localDeliveryStore = {}; 
    
    let lastOrderCount = 0;
    let isFirstLoad = true;
    let ringingEnabled = false;
    let audioContext;

    // ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ù†ÙŠÙ† Ø¹Ø¨Ø± ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function activateRingingSystem() {
        ringingEnabled = true;
        document.getElementById('audioActivation').style.display = 'none';
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ AudioContext ÙˆØªÙØ¹ÙŠÙ„Ù‡ ÙÙˆØ±Ø§Ù‹
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        if (audioContext.state === 'suspended') audioContext.resume();
        
        // Ø§Ø®ØªØ¨Ø§Ø± Ø±Ù†Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„ØªØ£ÙƒØ¯
        playRingtone(2); 
    }

    async function fetchOrders() {
        try {
            const res = await fetch(`${SCRIPT_URL}?action=get&t=${Date.now()}`);
            const data = await res.json();
            
            // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø³Ø§Ø¨Ù‚)
            if (!isFirstLoad && data.length > lastOrderCount) {
                notifyNewOrder();
            }
            
            lastOrderCount = data.length;
            isFirstLoad = false;
            allData = data;
            handleFilter();
        } catch(e) { console.error("Fetch Error"); }
    }

    function notifyNewOrder() {
        // 1. Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ
        const toast = document.getElementById('notification-toast');
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 9000);

        // 2. Ø§Ù„Ø±Ù†ÙŠÙ† Ø§Ù„ØµÙˆØªÙŠ
        if (ringingEnabled) {
            playRingtone(5); // Ø±Ù†ÙŠÙ† Ù„Ù…Ø¯Ø© 5 Ø¯ÙˆØ±Ø§Øª
        }

        // 3. Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² (Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)
        if (navigator.vibrate) {
            navigator.vibrate([500, 200, 500, 200, 500]);
        }
    }

    // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ù†ØºÙ…Ø© Ø±Ù†ÙŠÙ† ØªØ´Ø¨Ù‡ Ø§Ù„Ù‡Ø§ØªÙ
    function playRingtone(repeats) {
        if (!audioContext) return;
        
        let startTime = audioContext.currentTime;
        for (let i = 0; i < repeats; i++) {
            const time = startTime + (i * 1.2);
            
            // Ø§Ù„Ù†ØºÙ…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
            createTone(660, time, 0.4);
            // Ø§Ù„Ù†ØºÙ…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
            createTone(440, time + 0.2, 0.4);
        }
    }

    function createTone(freq, start, duration) {
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, start);
        osc.frequency.exponentialRampToValueAtTime(freq / 2, start + duration);
        
        gain.gain.setValueAtTime(0.3, start);
        gain.gain.exponentialRampToValueAtTime(0.01, start + duration);
        
        osc.connect(gain);
        gain.connect(audioContext.destination);
        
        osc.start(start);
        osc.stop(start + duration);
    }

    function setFilter(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + tab).classList.add('active');
        handleFilter();
    }

    function handleFilter() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        let filtered = [...allData].reverse();

        filtered.forEach(o => {
            const uniqueKey = o.orderId || o.phone;
            if(localSessionStore[uniqueKey]) o.status = localSessionStore[uniqueKey];
        });

        if (currentTab === 'new') filtered = filtered.filter(o => !o.status || o.status.includes('Processing') || o.status.includes('×××ª×™×Ÿ'));
        else if (currentTab === 'prep') filtered = filtered.filter(o => o.status === '×‘×•×¦×¢×” ×©×™×—×”');
        else filtered = filtered.slice(0, 20);

        if (query) {
            filtered = filtered.filter(o => (o.name && o.name.toLowerCase().includes(query)) || (o.phone && o.phone.includes(query)));
        }
        renderOrders(filtered);
    }

    function renderOrders(orders) {
        const list = document.getElementById('ordersList');
        list.innerHTML = '';
        if (orders.length === 0) {
            list.innerHTML = '<p style="text-align:center; padding:30px; color:var(--text-muted);">××™×Ÿ ×”×–×× ×•×ª ×œ×”×¦×’×” (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª)</p>';
            return;
        }

        orders.forEach(o => {
            const uniqueKey = o.orderId || o.phone;
            let status = o.status || '×××ª×™×Ÿ ×œ×©×™×—×”';
            if (status === 'Processing...') status = '×××ª×™×Ÿ ×œ×©×™×—×”';
            
            const isContacted = status === '×‘×•×¦×¢×” ×©×™×—×”' || status.includes('Delivered');
            const isDone = status.includes('Delivered');
            const isCanceled = status.includes('××‘×•×˜×œ');
            
            const card = document.createElement('div');
            let statusClass = "status-waiting";
            if (isContacted) statusClass = "status-contacted";
            if (isDone) statusClass = "status-delivered";
            if (isCanceled) statusClass = "status-canceled";

            card.className = `order-card ${statusClass}`;
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <b style="font-size:17px; color:${isCanceled ? '#64748b' : 'var(--text-main)'}; ${isCanceled ? 'text-decoration:line-through;' : ''}">
                        ${isContacted && !isCanceled ? '<span class="check-green">âœ”</span>' : ''}
                        ${isCanceled ? '<span class="x-red">âŒ</span>' : ''}
                        ${o.name}
                    </b>
                    <span style="font-size:10px; background:#334155; padding:2px 6px; border-radius:4px; font-weight:bold; color:var(--text-muted);">${status}</span>
                </div>
                <div style="font-size:13px; margin:5px 0; color:var(--text-muted);">ğŸ“ ${o.phone} | ğŸ“ ${o.city || '-'}</div>
                <div style="background:#0f172a; padding:8px; border-radius:8px; font-size:12px; border:1px solid #334155; color:var(--text-main);"><b>×”×–×× ×”:</b> ${o.offer}</div>

                <div class="delivery-box" style="${isDone || isCanceled ? 'opacity:0.4; pointer-events:none;' : ''}">
                    <span class="delivery-label">×—×‘×¨×ª ××©×œ×•×—×™× / Ø´Ø±ÙƒØ© Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                    <select class="delivery-select" onchange="updateDeliveryLocal('${uniqueKey}', this.value)">
                        <option value="" ${localDeliveryStore[uniqueKey]?.company === "" ? "selected" : ""}>×‘×—×¨ ×—×‘×¨×” / Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙƒØ©</option>
                        <option value="Ù‡Ø§ÙŠ Ø§ÙƒØ³Ø¨Ø±Ø³" ${localDeliveryStore[uniqueKey]?.company === "Ù‡Ø§ÙŠ Ø§ÙƒØ³Ø¨Ø±Ø³" ? "selected" : ""}>Ù‡Ø§ÙŠ Ø§ÙƒØ³Ø¨Ø±Ø³</option>
                        <option value="Ù„Ù…Ù‰" ${localDeliveryStore[uniqueKey]?.company === "Ù„Ù…Ù‰" ? "selected" : ""}>Ù„Ù…Ù‰</option>
                        <option value="Ù…Ø±ÙˆÙ‡" ${localDeliveryStore[uniqueKey]?.company === "Ù…Ø±ÙˆÙ‡" ? "selected" : ""}>Ù…Ø±ÙˆÙ‡</option>
                        <option value="Ø¹Ø±ÙŠÙ†" ${localDeliveryStore[uniqueKey]?.company === "Ø¹Ø±ÙŠÙ†" ? "selected" : ""}>Ø¹Ø±ÙŠÙ†</option>
                        <option value="Ø¢Ø®Ø±" ${localDeliveryStore[uniqueKey]?.company === "Ø¢Ø®Ø±" ? "selected" : ""}>Ø¢Ø®Ø± (××¤×•×¨×˜)</option>
                    </select>
                </div>

                <div class="actions-grid" style="${isDone || isCanceled ? 'opacity: 0.3; pointer-events: none;' : ''}">
                    <button class="btn-op btn-invoice" onclick="generatePDF('invoice', ${JSON.stringify(o).replace(/"/g, '&quot;')})">ğŸ“„ ×—×©×‘×•× ×™×ª PDF</button>
                    <button class="btn-op btn-print" onclick="generatePDF('sticker', ${JSON.stringify(o).replace(/"/g, '&quot;')})">ğŸ–¨ï¸ ××“×‘×§×”</button>
                    <button class="btn-op btn-wa" onclick="sendInvoiceWA('${o.phone}', '${o.name}', '${o.offer}', '${o.orderId}', '${o.city}', '${uniqueKey}')">ğŸ’¬ ×•×•××˜×¡××¤</button>
                    <button class="btn-op ${isContacted ? '' : 'btn-contact'}" onclick="updateStatusLocal('${uniqueKey}', '${o.rowIndex}', '×‘×•×¦×¢×” ×©×™×—×”')">
                        ${isContacted ? 'âœ… ×‘×•×¦×¢×” ×©×™×—×”' : 'ğŸ“ ×‘×•×¦×¢ ×©×™×—×”'}
                    </button>
                    <button class="btn-op btn-cancel" onclick="updateStatusLocal('${uniqueKey}', '${o.rowIndex}', '××‘×•×˜×œ âŒ')">âŒ ×‘×™×˜×•×œ</button>
                    <button class="btn-op" style="background:var(--success); color:white;" onclick="updateStatusLocal('${uniqueKey}', '${o.rowIndex}', 'Delivered âœ…')">âœ… × ××¡×¨</button>
                </div>
            `;
            list.appendChild(card);
        });
    }

    function updateDeliveryLocal(idKey, val) {
        if (!localDeliveryStore[idKey]) localDeliveryStore[idKey] = { company: "", custom: "" };
        localDeliveryStore[idKey].company = val;
    }

    async function updateStatusLocal(idKey, row, s) {
        if(s === '××‘×•×˜×œ âŒ' && !confirm("×”×× ×œ×‘×˜×œ ×”×–×× ×” ×–×•? (Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ØŸ)")) return;
        localSessionStore[idKey] = s;
        handleFilter();
        try { fetch(`${SCRIPT_URL}?action=updateStatus&row=${row}&status=${encodeURIComponent(s)}`); } catch(e) {}
    }

    function sendInvoiceWA(phone, name, offer, id, city, idKey) {
        const delData = localDeliveryStore[idKey] || { company: "-", custom: "" };
        const deliveryName = delData.company || "×‘×˜×™×¤×•×œ";
        const msg = `*×ª×•×“×” ×¨×‘×” ××›×œ ×”×œ×‘ - MAD SYSTEM* â¤ï¸\n\n×©×œ×•× *${name}*,\n×× ×• ××•×“×™× ×œ×š ×××•×“ ×¢×œ ×‘×—×™×¨×ª×š ×‘× ×•! ×œ×”×œ×Ÿ ×¤×¨×˜×™ ×”×”×–×× ×” ×©×œ×š:\n\nğŸ“„ *×—×©×‘×•× ×™×ª:* ${id || "MAD-SYS"}\nğŸ“¦ *×”×¤×¨×™×˜:* ${offer}\nğŸ“ *×›×ª×•×‘×ª:* ${city || "-"}\nğŸšš *×—×‘×¨×ª ××©×œ×•×—×™×:* ${deliveryName}\nğŸ’° *×¡×”"×› ×œ×ª×©×œ×•×:* â‚ª150.00\n\n×ª×•×“×” ×©×•×‘ ×¢×œ ×”×××•×Ÿ ×©×œ×š! âœ¨\n*×©×™×¨×•×ª ×œ×§×•×—×•×ª: 9935**`;
        const cp = phone.startsWith('0') ? '972' + phone.substring(1) : phone;
        window.open(`https://wa.me/${cp.replace(/\D/g, '')}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function generatePDF(type, o) {
        const container = document.getElementById('print-container');
        container.innerHTML = '';
        const date = new Date().toLocaleDateString('he-IL');
        const uniqueKey = o.orderId || o.phone;
        const delData = localDeliveryStore[uniqueKey] || { company: "-", custom: "" };
        const deliveryName = delData.company;

        if (type === 'invoice') {
            document.title = `Invoice_${o.name}`;
            container.innerHTML = `
                <div class="print-page invoice-size" dir="rtl">
                    <div class="inv-header"><h1 style="font-size:26pt; color:#1e3a8a; margin:0;">××¢×¨×›×ª MAD ×œ× ×™×”×•×œ ×”×–×× ×•×ª</h1><p style="font-size:14pt; color:#444;">××œ×’× ×˜×™×•×ª ×•×“×™×•×§ ×‘×›×œ ×”×–×× ×”</p></div>
                    <div style="display:flex; justify-content:space-between; font-weight:bold; color:black;"><div>××¡×¤×¨ ×”×–×× ×”: ${o.orderId || 'MAD-NEW'}</div><div>×ª××¨×™×š ×”× ×¤×§×”: ${date}</div></div>
                    <div class="inv-client-box"><b>×—×©×‘×•× ×™×ª ×¢×‘×•×¨:</b><br>×©×: ${o.name}<br>×›×ª×•×‘×ª: ${o.address || o.city || "-"}<br>×˜×œ×¤×•×Ÿ: ${o.phone}<br>×—×‘×¨×ª ××©×œ×•×—×™×: ${deliveryName || "-"}</div>
                    <table class="inv-table"><thead><tr style="background:#f1f5f9;"><th>×ª×™××•×¨ ×•××•×¦×¨</th><th>×¡×˜×˜×•×¡</th><th>××—×™×¨</th></tr></thead><tbody><tr><td><b>${o.offer}</b></td><td>×‘×˜×™×¤×•×œ</td><td><b>â‚ª 150.00</b></td></tr></tbody></table>
                    <div style="border:1.5px solid #b91c1c; padding:10px; text-align:center; color:#b91c1c; font-weight:bold;">** ×ª× ××™ ×”×—×œ×¤×”: ×”×—×œ×¤×” ×ª×ª×‘×¦×¢ ××š ×•×¨×§ ×‘×ª× ××™ ×©××¨×™×–×ª ×”× ×™×™×œ×•×Ÿ ×œ× × ×¤×ª×—×”.</div>
                    <div style="margin-top:20px; font-size:11pt; color:black;">×‘×˜×™×¤×•×œ. ×”×—×©×‘×•× ×™×ª ×ª×™×©×œ×— ×‘××™×™×œ ×œ××—×¨ ×§×‘×œ×ª ×”××©×œ×•×—. × × ×œ×©×œ×•×— ××ª ×›×ª×•×‘×ª ×”××™×™×œ ×œ×©×™×¨×•×ª ×”×œ×§×•×—×•×ª.</div>
                    <div style="text-align:center; margin-top:50px;"><svg id="bp"></svg><br><b>×©×™×¨×•×ª ×œ×§×•×—×•×ª: *9935</b></div>
                </div>`;
        } else {
            document.title = `Sticker_${o.name}`;
            container.innerHTML = `
                <div class="print-page sticker-size" dir="rtl">
                    <div style="text-align:center; border-bottom:2px solid #000; font-weight:bold; font-size:18pt;">××¢×¨×›×ª MAD</div>
                    <div style="font-size:12pt; line-height:1.5; margin:10px 0;">×©×: ${o.name}<br>×›×ª×•×‘×ª: ${o.address || o.city || "-"}<br>×˜×œ×¤×•×Ÿ: ${o.phone}<br>××©×œ×•×—: ${deliveryName || "-"}</div>
                    <div style="border:2.2px solid #000; padding:8px; background:#f9f9f9;">×ª×™××•×¨: ${o.offer}</div>
                    <div style="font-size:8.5pt; border:1.1px solid red; color:red; text-align:center; font-weight:bold; padding:4px; margin-top:10px;">×”×—×œ×¤×” ××š ×•×¨×§ ×‘×ª× ××™ ×©×”× ×™×™×œ×•×Ÿ ×œ× × ×¤×ª×—</div>
                    <div style="text-align:center; margin-top:10px;"><svg id="bp"></svg></div>
                </div>`;
        }
        JsBarcode("#bp", o.phone, { format: "CODE128", width: 2, height: 40, displayValue: false });
        setTimeout(() => { window.print(); document.title = "××¢×¨×›×ª MAD"; }, 600);
    }

    // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    window.onload = fetchOrders;
    setInterval(fetchOrders, 30000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
</script>
</body>
</html>
