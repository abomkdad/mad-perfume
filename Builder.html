<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAD Builder V66 - Final Fix ğŸ› ï¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest" defer></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&family=Tajawal:wght@200..900&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@100..900&display=swap');
    
    [x-cloak] { display:none !important; }
    body { font-family:'Cairo', sans-serif; background:#f1f5f9; height:100vh; overflow:hidden; }
    .app-layout { display:flex; height:100vh; flex-direction:row-reverse; }
    .editor-sidebar { width:450px; background:#fff; border-left:1px solid #cbd5e1; overflow-y:auto; padding:20px; flex-shrink:0; box-shadow:-5px 0 15px rgba(0,0,0,0.05); }
    .preview-area { flex:1; background:#cbd5e1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; overflow: hidden; }
    
    .iphone { width:375px; height:750px; background:#000; border-radius:45px; border:12px solid #1e293b; overflow:hidden; position:relative; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5); background-color:#fff; transition:transform 0.3s; transform-origin: center; }
    .iphone iframe { width:100%; height:100%; border:none; background:#fff; }
    .iphone-notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #1e293b; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; z-index: 20; }
    
    .section-box { background:#f8fafc; border:1px solid #e2e8f0; border-radius:12px; padding:15px; margin-bottom:15px; }
    .section-title { font-weight:900; font-size:0.85rem; color:#1e293b; margin-bottom:10px; display:flex; align-items:center; gap:5px; text-transform: uppercase; }
    
    input, textarea, select { width:100%; padding:8px 12px; border:1px solid #cbd5e1; border-radius:8px; font-size:12px; outline:none; transition:0.2s; background: white; color: black; }
    input:focus, textarea:focus { border-color:#3b82f6; box-shadow: 0 0 0 2px rgba(59,130,246,0.1); }
    
    .btn-grid { display:grid; grid-template-columns:repeat(2, 1fr); gap:8px; }
    .btn-add { background:#fff; border:1px solid #e2e8f0; padding:10px; border-radius:8px; font-size:11px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:5px; transition:0.2s; }
    .btn-add:hover { background:#f1f5f9; border-color:#3b82f6; color:#3b82f6; }
    
    .btn-action { width:100%; padding:14px; border-radius:12px; font-weight:900; margin-top:10px; cursor:pointer; text-align:center; transition: 0.2s; }
    .zoom-controls { position:fixed; bottom:20px; right:20px; background:rgba(30,41,59,0.9); padding:8px 16px; border-radius:99px; display:flex; gap:15px; color:white; z-index:50; align-items:center; font-size:14px; backdrop-blur: sm; }
  </style>
</head>
<body>

<div class="app-layout" x-data="builderApp()" x-init="init()" x-cloak>
  <aside class="editor-sidebar">
    <div class="flex items-center justify-between mb-6 text-black">
      <h1 class="text-xl font-black text-slate-800 tracking-tighter">MAD <span class="text-rose-500">FULL SUITE</span></h1>
      <div class="flex bg-slate-100 p-1 rounded-lg">
        <button @click="editLang='ar'; update()" :class="editLang==='ar'?'bg-white shadow text-black':'text-gray-500'" class="px-3 py-1 rounded text-[10px] font-bold transition">AR</button>
        <button @click="editLang='he'; update()" :class="editLang==='he'?'bg-white shadow text-black':'text-gray-500'" class="px-3 py-1 rounded text-[10px] font-bold transition">HE</button>
      </div>
    </div>

    <!-- Configuration -->
    <div class="section-box border-rose-100 bg-rose-50/30 text-black">
      <span class="section-title text-rose-700">ğŸ’° Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ø¹Ø±</span>
      <div class="flex gap-2">
        <input type="text" x-model="config.productName" @input="update()" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input type="number" x-model="config.price" @input="update()" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="w-1/3">
      </div>
    </div>

    <div class="section-box border-blue-100 bg-blue-50/30 text-black">
      <span class="section-title text-blue-700">ğŸ”— Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
      <input type="text" x-model="config.sheetUrl" class="mb-2 font-mono text-[10px]" placeholder="Ø±Ø§Ø¨Ø· Google Sheet" @input="update()">
      <input type="text" x-model="config.zapierUrl" class="mb-2 font-mono text-[10px] border-orange-200 bg-orange-50" placeholder="Ø±Ø§Ø¨Ø· Zapier Webhook" @input="update()">
      <div class="flex gap-2">
        <input type="text" x-model="config.adminPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯ÙŠØ± 972" class="font-bold" @input="update()">
        <input type="color" x-model="config.bgColor" @input="update()" class="w-12 h-10 p-1 border-0 bg-transparent cursor-pointer">
      </div>
    </div>

    <!-- Floating WhatsApp Config -->
    <div class="section-box border-green-100 bg-green-50/30 text-black">
      <span class="section-title text-green-700 flex justify-between">
        <span>ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ø§Ø¦Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
        <input type="checkbox" x-model="config.floatingWhatsapp.enabled" @change="update()" class="w-4 h-4">
      </span>
      <div x-show="config.floatingWhatsapp.enabled" class="space-y-2 mt-2">
        <input type="text" x-model="config.floatingWhatsapp.phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (972...)" @input="update()" class="font-mono text-xs">
        <input type="text" x-model="config.floatingWhatsapp.message[editLang]" placeholder="Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠØ©" @input="update()">
      </div>
    </div>

    <!-- Content Blocks List -->
    <div class="section-box text-black">
      <span class="section-title">ğŸ§± Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
      <div class="space-y-4 mb-6">
        <template x-for="(block, index) in blocks" :key="block.id">
          <div class="border-2 p-3 rounded-xl relative transition shadow-sm"
               :class="{
                 'bg-blue-50 border-blue-200': block.type === 'text',
                 'bg-slate-50 border-slate-200': ['image','video','video_carousel'].includes(block.type),
                 'bg-rose-50 border-rose-200': block.type === 'form',
                 'bg-green-100 border-green-300': block.type === 'whatsapp',
                 'bg-indigo-50 border-indigo-200': block.type === 'carousel' || block.type === 'catalog',
                 'bg-yellow-50 border-yellow-200': block.type === 'testimonials'
               }">
            <div class="flex justify-between items-center mb-3">
               <span class="text-[10px] font-black px-2 py-1 rounded uppercase" 
                     :class="{
                       'bg-blue-200 text-blue-800': block.type === 'text',
                       'bg-slate-200 text-slate-800': ['image','video','video_carousel'].includes(block.type),
                       'bg-rose-200 text-rose-800': block.type === 'form',
                       'bg-green-600 text-white': block.type === 'whatsapp',
                       'bg-indigo-200 text-indigo-800': block.type === 'carousel',
                       'bg-indigo-600 text-white': block.type === 'catalog',
                       'bg-yellow-200 text-yellow-800': block.type === 'testimonials'
                     }"
                     x-text="block.type === 'video_carousel' ? 'REELS' : (block.type === 'catalog' ? 'CATALOG LINK' : block.type.toUpperCase())"></span>
               <div class="flex gap-2">
                 <button @click="moveBlock(index, -1)" class="text-slate-400 hover:text-blue-500 font-bold">â†‘</button>
                 <button @click="moveBlock(index, 1)" class="text-slate-400 hover:text-blue-500 font-bold">â†“</button>
                 <button @click="removeBlock(index)" class="text-rose-400 hover:text-rose-600 font-bold">âœ•</button>
               </div>
            </div>

            <template x-if="block.type === 'text'">
               <div>
                  <div class="flex items-center gap-2 mb-2">
                     <label class="text-[9px] font-bold">Ù„ÙˆÙ† Ø§Ù„Ù†Øµ:</label>
                     <input type="color" x-model="block.style.color" @input="update()" class="w-8 h-6 p-0 border-0 bg-transparent cursor-pointer">
                  </div>
                  <textarea x-model="block.content[editLang]" @input="update()" class="h-16 text-[11px] font-bold text-black"></textarea>
               </div>
            </template>

            <template x-if="['image','video'].includes(block.type)">
               <input type="text" x-model="block.url" @input="update()" placeholder="URL" class="text-[11px] text-black">
            </template>

            <!-- ÙƒØ±ÙŠØ³ÙˆÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø°ÙƒÙŠ -->
            <template x-if="block.type === 'carousel'">
              <div class="space-y-3">
                <template x-for="(item, iIdx) in (block.items || [])" :key="'carousel-item-'+iIdx">
                   <div class="bg-white p-2 rounded border border-gray-200">
                     <div class="flex justify-between items-center mb-1">
                        <span class="text-[9px] font-bold text-slate-500">Ø´Ø±ÙŠØ­Ø©</span>
                        <button @click="block.items.splice(iIdx,1); update()" class="text-red-500 font-bold text-[10px]">x</button>
                     </div>
                     <input x-model="item.url" @input="update()" class="text-[10px] w-full mb-1 text-black font-mono" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
                     <input x-model="item.name" @input="update()" class="text-[10px] w-full text-black font-bold" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶">
                   </div>
                </template>
                <button @click="if(!block.items) block.items=[]; block.items.push({url:'', name:''}); update()" class="w-full py-2 text-[10px] bg-indigo-600 text-white rounded font-bold">+ Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯</button>
              </div>
            </template>

            <!-- ÙƒØ±ÙŠØ³ÙˆÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø¹Ø§Ù…ÙˆØ¯ÙŠØ© -->
            <template x-if="block.type === 'video_carousel'">
              <div class="space-y-2">
                <p class="text-[10px] text-gray-500 mb-1">Ø¶Ø¹ Ø±ÙˆØ§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª (ÙŠÙØ¶Ù„ Ø¹Ø§Ù…ÙˆØ¯ÙŠØ© 9:16)</p>
                <template x-for="(vid, iIdx) in (block.items || [])" :key="'vid-'+iIdx">
                   <div class="flex gap-1">
                     <input x-model="block.items[iIdx]" @input="update()" class="text-[10px] flex-1 text-black" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (mp4)">
                     <button @click="block.items.splice(iIdx,1); update()" class="text-red-500 font-bold">x</button>
                   </div>
                </template>
                <button @click="if(!block.items) block.items=[]; block.items.push(''); update()" class="w-full py-2 text-[10px] bg-slate-600 text-white rounded font-bold">+ ÙÙŠØ¯ÙŠÙˆ (Reel)</button>
              </div>
            </template>

            <!-- ÙƒØ±ÙŠØ³ÙˆÙ„ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (ØµÙˆØ±) -->
            <template x-if="block.type === 'testimonials'">
              <div class="space-y-2">
                <p class="text-[10px] text-gray-500 mb-1">ØµÙˆØ± Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª)</p>
                <template x-for="(img, iIdx) in (block.items || [])" :key="'testi-img-'+iIdx">
                   <div class="flex gap-1">
                     <input x-model="block.items[iIdx]" @input="update()" class="text-[10px] flex-1 text-black" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø±Ø£ÙŠ">
                     <button @click="block.items.splice(iIdx,1); update()" class="text-red-500 font-bold">x</button>
                   </div>
                </template>
                <button @click="if(!block.items) block.items=[]; block.items.push(''); update()" class="w-full py-2 text-[10px] bg-yellow-500 text-white rounded font-bold">+ ØµÙˆØ±Ø© Ø±Ø£ÙŠ Ø¬Ø¯ÙŠØ¯Ø©</button>
              </div>
            </template>

            <template x-if="block.type === 'form'">
               <p class="text-[10px] text-rose-700 font-bold bg-rose-100 p-2 rounded-lg text-center">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø´Ø±Ø§Ø¡ âœ…</p>
            </template>

            <!-- Ø²Ø± Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
            <template x-if="block.type === 'catalog'">
               <div class="space-y-2">
                  <div class="flex items-center gap-2">
                     <span class="text-[10px] font-bold">Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬:</span>
                     <input type="text" x-model="block.url" @input="update()" placeholder="https://wa.me/c/..." class="text-[11px] font-mono text-black font-bold w-full">
                  </div>
                  <input type="text" x-model="block.content[editLang]" @input="update()" placeholder="Ù†Øµ Ø§Ù„Ø²Ø± (Ù…Ø«Ù„: ØªØµÙØ­ Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬)" class="text-[11px] text-black">
               </div>
            </template>

            <template x-if="block.type === 'whatsapp'">
               <div class="space-y-2">
                  <div class="flex items-center gap-2">
                     <span class="text-[10px] font-bold">Ø§Ù„Ø±Ù‚Ù…:</span>
                     <input type="text" x-model="block.url" @input="update()" placeholder="972..." class="text-[11px] font-mono text-black font-bold w-full">
                  </div>
                  <input type="text" x-model="block.content[editLang]" @input="update()" placeholder="Ù†Øµ Ø§Ù„Ø²Ø±" class="text-[11px] text-black">
                  <div class="block bg-green-200/50 p-2 rounded">
                    <span class="text-[10px] font-bold block mb-1">ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©:</span>
                    <input type="text" x-model="block.productImg" @input="update()" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" class="text-[10px] font-mono text-black">
                  </div>
               </div>
            </template>
          </div>
        </template>
      </div>

      <!-- Toolbar -->
      <div class="btn-grid">
        <button class="btn-add border-blue-500 text-blue-600" @click="addBlock('text')">ğŸ“ Ù†Øµ</button>
        <button class="btn-add border-indigo-500 text-indigo-600 font-bold" @click="addBlock('carousel')">ğŸ“¸ Ø¹Ø±ÙˆØ¶ Ø°ÙƒÙŠØ©</button>
        <button class="btn-add border-slate-600 text-slate-700 font-bold" @click="addBlock('video_carousel')">ğŸ¥ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª (Reels)</button>
        <button class="btn-add border-yellow-500 text-yellow-600 font-bold" @click="addBlock('testimonials')">â­ Ø¢Ø±Ø§Ø¡ (ØµÙˆØ±)</button>
        <button class="btn-add border-green-500 text-white bg-green-500 hover:bg-green-600" @click="addBlock('whatsapp')">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="btn-add border-indigo-700 text-white bg-indigo-700 hover:bg-indigo-800 font-bold" @click="addBlock('catalog')">ğŸ›ï¸ ÙƒØªØ§Ù„ÙˆØ¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="btn-add border-rose-500 text-white bg-rose-500 hover:bg-rose-600 col-span-2" @click="addBlock('form')">ğŸš€ Ù†Ù…ÙˆØ°Ø¬ Ø´Ø±Ø§Ø¡</button>
      </div>
    </div>

    <button class="btn-action bg-black text-white hover:bg-slate-900 shadow-xl" @click="downloadHTML()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</button>
    <button class="btn-action bg-slate-100 text-slate-700" @click="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  </aside>

  <main class="preview-area">
    <div class="zoom-controls text-white">
      <button @click="zoom = Math.max(0.3, zoom - 0.1)">-</button>
      <span x-text="Math.round(zoom*100)+'%'"></span>
      <button @click="zoom = Math.min(1.2, zoom + 0.1)">+</button>
      <button @click="update()" class="border-r border-white/20 pr-3 mr-1">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
    </div>
    <div class="iphone" :style="`transform: scale(${zoom})`">
        <div class="iphone-notch"></div>
        <iframe id="preview-frame"></iframe>
    </div>
  </main>
</div>

<script>
function builderApp() {
  return {
    editLang: 'ar', zoom: 0.85, timeout: null,
    config: {
      bgColor: '#0e0302',
      logoUrl: 'https://www.mad-parfumeur.com/assets/hero/logo.png',
      heroTitle: { ar: 'Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­ØµØ±ÙŠØ©', he: '×”××‘×¦×¢×™× ×”×‘×œ×¢×“×™×™× ×‘×™×•×ª×¨' },
      productName: 'Ø¹Ø±Ø¶ Ø®Ø§Øµ', price: '500', adminPhone: '972524033442',
      sheetUrl: 'https://script.google.com/macros/s/AKfycbxzFuJvnf5QWAam798ZfTrAbINGLCeY52WVz56NtyC7lY-VrlbzC0gsp8ZBY2cT3rLU-g/exec',
      zapierUrl: 'https://hooks.zapier.com/hooks/catch/14790106/ue4uy7j/',
      fbPixel: '1072283127290819', ttPixel: 'D2D02JBC77U4ENLN9SBG', snapPixel: 'b143822e-1c3c-40ff-93f7-edadee74e626',
      floatingWhatsapp: { enabled: false, phone: '', message: { ar: 'Ù…Ø±Ø­Ø¨Ø§ØŒ Ù„Ø¯ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±', he: '×”×™×™, ×™×© ×œ×™ ×©××œ×”' } }
    },
    blocks: [],
    init() { 
      this.addBlock('carousel');
      this.addBlock('catalog');
      this.addBlock('video_carousel');
      this.addBlock('testimonials');
      this.addBlock('whatsapp');
      this.addBlock('form'); 
      setTimeout(() => this.update(), 500); 
    },
    update() {
      clearTimeout(this.timeout);
      this.timeout = setTimeout(() => {
        const frame = document.getElementById('preview-frame');
        if (frame) frame.srcdoc = this.generateFinalHTML(this.editLang, false);
      }, 300);
    },
    addBlock(type) {
      let b = { 
        id: Date.now() + Math.random(),
        type,
        content:{ ar: 'MAD PERFUME', he: 'MAD PERFUME' }, 
        url: '', align: 'center', btnText: { ar: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨', he: '××™×©×•×¨ ×”×–×× ×”' }, 
        style: { color: '#ffffff', size: 'text-lg', font: 'Cairo', weight: 'font-bold' },
        openingMessage: { ar: '', he: '' },
        productImg: '',
        items: []
      };
      
      if (type === 'carousel') {
        b.items = [
          { url: 'https://www.mad-parfumeur.com/assets/hero/8.webp', name: 'Ø¨ÙƒØ¬ Ø§Ù„Ø¹ÙŠØ¯' },
          { url: 'https://www.mad-parfumeur.com/assets/hero/2.webp', name: 'Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙÙŠØ±' }
        ];
      }
      if (type === 'video_carousel') {
        b.items = ['https://www.w3schools.com/html/mov_bbb.mp4', 'https://www.w3schools.com/html/movie.mp4'];
      }
      if (type === 'testimonials') {
        b.items = [
          'https://placehold.co/300x400/png?text=Review+1',
          'https://placehold.co/300x400/png?text=Review+2'
        ];
      }
      if (type === 'whatsapp') {
        b.url = this.config.adminPhone;
        b.content = { ar: 'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨', he: '×“×‘×¨×• ××™×ª× ×• ×‘×•×•××˜×¡××¤' };
        b.openingMessage = { ar: 'Ù…Ø±Ø­Ø¨Ø§ØŒ Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ø¹Ø±Ø¶...', he: '×”×™×™, ××©××— ×œ×¤×¨×˜×™× × ×•×¡×¤×™×...' };
        b.productImg = 'https://www.mad-parfumeur.com/assets/hero/8.webp'; 
      }
      if (type === 'catalog') {
        b.url = 'https://wa.me/c/15558106988';
        b.content = { ar: 'ØªØµÙØ­ Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„ÙƒØ§Ù…Ù„ ğŸ›ï¸', he: '×¦×¤×” ×‘×§×˜×œ×•×’ ×”××œ× ğŸ›ï¸' };
      }
      
      this.blocks.push(b); this.update();
    },
    removeBlock(i) { this.blocks.splice(i, 1); this.update(); },
    moveBlock(i, d) {
      const ni = i + d;
      if (ni >= 0 && ni < this.blocks.length) { [this.blocks[i], this.blocks[ni]] = [this.blocks[ni], this.blocks[i]]; this.update(); }
    },
    async copyCode() {
      const html = this.generateFinalHTML(null, true);
      try { await navigator.clipboard.writeText(html); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!'); } 
      catch (err) { const t = document.createElement("textarea"); t.value = html; document.body.appendChild(t); t.select(); document.execCommand('copy'); document.body.removeChild(t); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!'); }
    },
    downloadHTML() {
      const html = this.generateFinalHTML(null, true);
      const blob = new Blob([html], { type: 'text/html' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'MAD_Landing_Final.html'; a.click();
    },
    generateFinalHTML(forcedLang=null, forExport=false) {
      const bStr = JSON.stringify(this.blocks).replace(/</g, '\\u003c');
      const cStr = JSON.stringify(this.config).replace(/</g, '\\u003c');
      const initArg = forcedLang ? `'${forcedLang}'` : 'null';

      const waBlock = this.blocks.find(b => b.type === 'whatsapp' && b.productImg);
      const ogImage = waBlock ? waBlock.productImg : (this.blocks.find(b => b.type === 'image')?.url || this.config.logoUrl);

      return `<!DOCTYPE html>
<html x-data="app()" x-init="init(${initArg})" :lang="lang" dir="rtl">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="${this.config.heroTitle.ar}" />
  <meta property="og:description" content="${this.config.productName}">
  <meta property="og:image" content="${ogImage}" />
  <meta property="og:type" content="website" />

  <script src="https://cdn.tailwindcss.com"><\/script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer><\/script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;900&family=Heebo:wght@400;900&display=swap" rel="stylesheet">
  <style>
    body {
      background: radial-gradient(900px circle at 50% -200px, rgba(255,255,255,.10), transparent 55%), radial-gradient(700px circle at 10% 40%, rgba(255,255,255,.06), transparent 60%), linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.15) 45%, rgba(0,0,0,.85)), ${this.config.bgColor};
      font-family: 'Cairo', 'Heebo', sans-serif;
      overflow-x: hidden; min-height: 100vh; color: #fff;
    }
    .inp { width: 100%; padding: 15px; background: #f8fafc; border: 1px solid #ddd; border-radius: 12px; margin-bottom: 10px; font-weight: bold; text-align: center; color: black; }
    .btn-main { background: #10b981; color: #fff; width: 100%; padding: 18px; border-radius: 14px; font-weight: 900; font-size: 1.2rem; animation: pulse 2s infinite; cursor: pointer; border:none; box-shadow: 0 6px 18px rgba(16,185,129,0.35); }
    .btn-main:hover { filter: brightness(1.05); } .btn-main:active { transform: scale(0.99); }
    @keyframes wiggle { 0%, 100% { transform: rotate(-1deg); } 50% { transform: rotate(1deg) scale(1.02); } }
    .animate-wiggle { animation: wiggle 1s ease-in-out infinite; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    .progress-container { margin-bottom: 15px; }
    .progress-track { height: 6px; background: rgba(0,0,0,0.1); border-radius: 99px; overflow: hidden; }
    .progress-fill { height: 100%; background: #10b981; width: 85%; }
    .mad-radio-box { border: 2px solid #e5e7eb; border-radius: 12px; padding: 12px; text-align: center; background: white; font-weight: 700; cursor: pointer; transition: 0.2s; color: black; }
    input:checked + .mad-radio-box { border-color: #10b981; background: #f0fdf4; color: #047857; transform: scale(1.02); }
    .recommended::after { content: 'â˜…'; position: absolute; top: -8px; right: -8px; background: #10b981; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; display: flex; align-items: center; justify-content: center; }
    .float-container { position: fixed; bottom: 20px; left: 20px; z-index: 100; display: flex; flex-direction: column; align-items: center; gap: 8px; }
    [dir="ltr"] .float-container { left: auto; right: 20px; }
    .float-wa { background: #25d366; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; box-shadow: 2px 2px 10px rgba(0,0,0,0.2); animation: pulse 2s infinite; text-decoration: none; }
    .float-thumb { width: 50px; height: 50px; border-radius: 12px; overflow: hidden; border: 2px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.3); animation: wiggle 3s infinite; background: white; }
    .float-thumb img { width: 100%; height: 100%; object-cover: cover; }
  </style>
  <script>
    function formatE164(p) { if(!p) return ''; let d = String(p).replace(/[^0-9]/g, ''); if(d.startsWith('05') && d.length === 10) d = '972' + d.slice(1); if(d.startsWith('00')) d = d.slice(2); return '+' + d; }
    function loadPixels(cfg) { if(window._px_f) return; window._px_f = true; if(cfg.fbPixel) { !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)n=f.fbq;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'); fbq('init', cfg.fbPixel); fbq('track', 'PageView'); } if(cfg.ttPixel) { !function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"];ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{};ttq._i[e]=[];ttq._i[e]._u=r;ttq._t=ttq._t||{};ttq._t[e]=+new Date;ttq._o=ttq._o||{};ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript";o.async=!0;o.src=r+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};ttq.load(cfg.ttPixel);ttq.page();}(window,document,'ttq'); } if(cfg.snapPixel) { (function(e,t,n){if(e.snaptr)return;var a=e.snaptr=function(){a.handleRequest?a.handleRequest.apply(a,arguments):a.queue.push(arguments)};a.queue=[];var s='script';var r=t.createElement(s);r.async=!0;r.src=n;var u=t.getElementsByTagName(s)[0];u.parentNode.insertBefore(r,u)})(window,document,'https://sc-static.net/scevent.min.js'); snaptr('init', cfg.snapPixel); snaptr('track', 'PAGE_VIEW'); } }
  <\/script>
</head>
<body class="pb-20">
  <nav class="p-4 flex justify-center bg-white/15 backdrop-blur sticky top-0 z-50 border-b border-white/10"><img src="${this.config.logoUrl}" class="h-10 object-contain"></nav>
  <header class="text-center py-8 px-4 text-white"><h1 class="text-3xl font-black" x-text="c.heroTitle[lang]"></h1></header>

  <main class="max-w-md mx-auto">
    <template x-for="(b, idx) in (blocks || [])" :key="b.id">
      <div class="my-6 px-4" :class="b.type==='carousel'?'!px-0':'px-4'">
        <template x-if="b.type==='text'"><p class="whitespace-pre-wrap leading-relaxed font-black text-center" :style="{ color: b.style.color || '#fff', fontSize: '1.25rem' }" x-text="b.content[lang]"></p></template>
        <template x-if="b.type==='image'"><img :src="b.url" class="rounded-2xl mx-auto shadow-lg w-full"></template>
        <template x-if="b.type==='video'"><video :src="b.url" controls class="w-full rounded-2xl shadow-lg"></video></template>
        
        <!-- âœ… ÙƒØ±ÙŠØ³ÙˆÙ„ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¹Ø§Ù…ÙˆØ¯ÙŠØ© (Reels) -->
        <template x-if="b.type==='video_carousel'">
          <div class="w-full" x-data="{ curr: 0, total: (b.items || []).length }">
            <h3 class="text-center text-white font-bold mb-3 text-lg" x-text="lang==='he'?'×œ×§×•×—×•×ª ×××œ×™×¦×™×':'Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (ÙÙŠØ¯ÙŠÙˆ)'"></h3>
            <div class="flex overflow-x-auto gap-3 p-2 snap-x hide-scrollbar pb-6">
               <template x-for="(vid, i) in b.items" :key="'vid-c-'+i">
                 <div class="min-w-[260px] w-[260px] snap-center rounded-2xl overflow-hidden shadow-2xl border-2 border-white/20 relative aspect-[9/16] bg-black">
                   <video :src="vid" controls class="w-full h-full object-cover"></video>
                 </div>
               </template>
            </div>
          </div>
        </template>

        <!-- âœ… ÙƒØ±ÙŠØ³ÙˆÙ„ Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (ØµÙˆØ±) -->
        <template x-if="b.type==='testimonials'">
          <div class="w-full">
            <h3 class="text-center text-white font-black text-lg mb-4" x-text="lang==='he'?'××” ×”×œ×§×•×—×•×ª ××•××¨×™×?':'Ù…Ø§Ø°Ø§ ÙŠÙ‚ÙˆÙ„ Ø¹Ù…Ù„Ø§Ø¤Ù†Ø§ØŸ'"></h3>
            <div class="flex overflow-x-auto gap-3 p-2 snap-x hide-scrollbar pb-6">
               <template x-for="(img, i) in b.items" :key="'testi-img-'+i">
                 <div class="min-w-[200px] w-[200px] snap-center rounded-xl overflow-hidden shadow-lg border border-white/20 relative">
                   <img :src="img" class="w-full h-auto object-cover">
                 </div>
               </template>
            </div>
          </div>
        </template>

        <!-- âœ… ÙƒØ±ÙŠØ³ÙˆÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø°ÙƒÙŠ -->
        <template x-if="b.type==='carousel'">
          <div class="w-full" 
               x-data="{ curr: 0, total: (b.items || []).length }" 
               x-init="$watch('curr', val => { if(b.items[val]) { selectedOffer = b.items[val].name; selectedImage = b.items[val].url; } }); 
                       if(b.items[0]) { selectedOffer = b.items[0].name; selectedImage = b.items[0].url; }">
            
            <h3 class="text-center text-white font-black text-lg mb-2" x-text="lang==='he'?'×‘×—×¨ ×”×¦×¢×”':'Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ:'"></h3>

            <div class="relative overflow-hidden rounded-2xl shadow-2xl mb-4 bg-black">
               <template x-for="(item, i) in (b.items || [])" :key="'ci-'+i">
                 <div class="w-full relative transition-opacity duration-300" x-show="curr===i" x-transition:enter="opacity-0" x-transition:enter-end="opacity-100">
                   <img :src="item.url" class="w-full object-cover">
                   <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent p-4 pt-12 text-center">
                      <p class="text-white font-black text-xl" x-text="item.name"></p>
                   </div>
                 </div>
               </template>
               <button @click="curr = (curr - 1 + total) % total" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/40 text-white p-3 rounded-full backdrop-blur-md transition shadow-lg">â®</button>
               <button @click="curr = (curr + 1) % total" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/40 text-white p-3 rounded-full backdrop-blur-md transition shadow-lg">â¯</button>
            </div>

            <div class="flex gap-2 justify-center overflow-x-auto pb-2 px-1">
               <template x-for="(item, i) in b.items" :key="'thumb-'+i">
                 <div class="w-16 h-16 rounded-lg overflow-hidden cursor-pointer border-2 transition-all transform hover:scale-105 shrink-0"
                      :class="curr === i ? 'border-green-400 shadow-[0_0_10px_rgba(74,222,128,0.7)] scale-105' : 'border-transparent opacity-60'"
                      @click="curr = i">
                    <img :src="item.url" class="w-full h-full object-cover">
                 </div>
               </template>
            </div>

            <div class="text-center mt-1">
               <span class="inline-block bg-green-600 text-white px-4 py-1 rounded-full text-[10px] font-bold animate-pulse" x-show="selectedOffer">
                 âœ… <span x-text="lang==='he'?'×”×”×¦×¢×” × ×‘×—×¨×”':'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ø±Ø¶'"></span>
               </span>
            </div>
          </div>
        </template>

        <!-- âœ… Ø²Ø± Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ -->
        <template x-if="b.type==='catalog'">
          <div class="my-6">
            <a :href="b.url" target="_blank"
               class="block w-full bg-indigo-600 text-white p-4 rounded-xl shadow-lg text-center font-black text-xl transform transition hover:scale-105 flex items-center justify-center gap-2 no-underline">
               <span class="text-2xl">ğŸ›ï¸</span>
               <span x-text="b.content[lang]"></span>
            </a>
          </div>
        </template>

        <!-- âœ… ÙˆØ§ØªØ³Ø§Ø¨ Ù‡Ø²Ø§Ø² -->
        <template x-if="b.type==='whatsapp'">
          <div class="my-6">
            <template x-if="b.productImg">
              <div class="mb-3 rounded-2xl overflow-hidden shadow-lg border-2 border-white/20">
                <img :src="b.productImg" class="w-full h-auto object-cover block">
              </div>
            </template>
            <a :href="'https://wa.me/' + (b.url ? b.url.replace(/[^0-9]/g,'').replace(/^05/, '9725') : '') + '?text=' + encodeURIComponent((b.openingMessage[lang] || '') + (selectedOffer ? ('\\n ' + (lang==='he'?'×”×¦×¢×”: ':'Ø¹Ø±Ø¶: ') + selectedOffer) : '') + '\\n' + window.location.href)" 
               target="_blank"
               class="block w-full bg-[#25D366] text-white p-4 rounded-xl shadow-lg text-center font-black text-xl transform transition hover:scale-105 flex items-center justify-center gap-2 animate-wiggle no-underline relative overflow-hidden">
               <svg class="w-7 h-7 fill-current" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.355-5.032c0-5.437 4.411-9.865 9.869-9.865 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.438-4.415 9.868-9.865 9.868"/></svg>
               <span x-text="b.content[lang]"></span>
            </a>
          </div>
        </template>

        <template x-if="b.type==='form'">
<div class="bg-white p-6 rounded-[24px] shadow-sm text-right border-2 border-gray-100 mt-4" id="order">
  <div x-show="selectedOffer" class="bg-indigo-50 border border-indigo-200 text-indigo-800 p-3 rounded-xl mb-4 text-center font-black text-sm transition-all duration-300 transform scale-100">
    <span x-text="lang==='he'?'×”×”×¦×¢×” ×©× ×‘×—×¨×”: ':'Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ØªØ§Ø±: '"></span>
    <span x-text="selectedOffer" class="text-lg block mt-1 text-green-700"></span>
  </div>
  <div class="flex gap-2 mb-4">
    <div class="flex-1 rounded-full py-2 text-center text-[12px] font-black bg-slate-100 text-slate-600 border border-slate-200" x-text="lang==='he' ? '××—×¨×™×•×ª ×”×—×œ×¤×”' : 'Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„'"></div>
    <div class="flex-1 rounded-full py-2 text-center text-[12px] font-black bg-amber-100 text-amber-700 border border-amber-200" x-text="lang==='he' ? '××©×œ×•×— ××”×™×¨' : 'ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹'"></div>
    <div class="flex-1 rounded-full py-2 text-center text-[12px] font-black bg-emerald-100 text-emerald-700 border border-emerald-200" x-text="lang==='he' ? '×ª×©×œ×•× ×‘××©×œ×•×—' : 'Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…'"></div>
  </div>
  <div class="progress-container">
    <div class="progress-text flex justify-between text-[10px] font-bold mb-1 text-gray-400">
      <span x-text="lang==='he'?'×¤×¨×˜×™ ××©×œ×•×—':'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†'"></span>
      <span x-text="lang==='he'?'×©×œ×‘ ××—×¨×•×Ÿ':'Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©'"></span>
    </div>
    <div class="progress-track"><div class="progress-fill"></div></div>
  </div>
  <h2 class="text-xl font-black text-center mb-4 text-gray-800" x-text="lang==='he'?'×”×–××™× ×• ×¢×›×©×™×•':'Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†'"></h2>
  <form @submit.prevent="submitForm">
    <input type="text" x-model="f.name" @input="trackInput()" class="inp" :placeholder="lang==='he'?'×©× ××œ×':'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„'" required>
    <input type="tel" x-model="f.phone" @input="trackInput()" class="inp" :placeholder="lang==='he'?'×˜×œ×¤×•×Ÿ':'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'" dir="ltr" required>
    <input type="text" x-model="f.address" class="inp" :placeholder="lang==='he'?'×›×ª×•×‘×ª ××œ××”':'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„'" required>
    <div class="grid grid-cols-2 gap-3 mb-4">
      <label class="cursor-pointer"><input type="radio" x-model="f.payment" value="Cash" class="hidden"><div class="mad-radio-box recommended"><span x-text="lang==='he'?'××–×•××Ÿ ğŸ’µ':'Ù†Ù‚Ø¯ ğŸ’µ'"></span><div class="text-[9px] text-green-600 font-normal" x-text="lang==='he'?'××•××œ×¥':'Ù…ÙˆØµÙ‰ Ø¨Ù‡'"></div></div></label>
      <label class="cursor-pointer"><input type="radio" x-model="f.payment" value="Visa" class="hidden"><div class="mad-radio-box"><span x-text="lang==='he'?'××©×¨××™ ğŸ’³':'ÙÙŠØ²Ø§ ğŸ’³'"></span></div></label>
    </div>
    <div class="grid grid-cols-2 gap-3 mb-6">
      <label class="cursor-pointer"><input type="radio" x-model="f.process" value="Direct" class="hidden"><div class="mad-radio-box recommended"><span class="text-xs" x-text="lang==='he'?'×©×œ×— ×”×–×× ×”':'Ø§Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨'"></span><div class="text-[9px] text-blue-600 font-normal" x-text="lang==='he'?'×”×›×™ ××”×™×¨':'ğŸš€ Ø£Ø³Ø±Ø¹'"></div></div></label>
      <label class="cursor-pointer"><input type="radio" x-model="f.process" value="Contact" class="hidden"><div class="mad-radio-box"><span class="text-xs" x-text="lang==='he'?'×¦×•×¨ ×§×©×¨':'ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ'"></span></div></label>
    </div>
    <button type="submit" class="btn-main mt-2 w-full" x-text="loading?'...':(lang==='he'?'××™×©×•×¨ ×”×–×× ×”':'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨')" :disabled="loading"></button>
  </form>
</div>
        </template>
      </div>
    </template>
  </main>

  <template x-if="c.floatingWhatsapp && c.floatingWhatsapp.enabled">
    <div class="float-container">
      <div class="float-thumb" x-show="selectedImage"><img :src="selectedImage"></div>
      <a :href="'https://wa.me/' + (c.floatingWhatsapp.phone ? c.floatingWhatsapp.phone.replace(/[^0-9]/g,'').replace(/^05/, '9725') : '') + '?text=' + encodeURIComponent((c.floatingWhatsapp.message[lang] || '') + (selectedOffer ? ('\\n ' + (lang==='he'?'×”×¦×¢×”: ':'Ø¹Ø±Ø¶: ') + selectedOffer) : '') + '\\n' + window.location.href)" target="_blank" class="float-wa">
         <svg class="w-8 h-8 fill-current" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.355-5.032c0-5.437 4.411-9.865 9.869-9.865 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.438-4.415 9.868-9.865 9.868"/></svg>
      </a>
    </div>
  </template>

  <div x-show="loading" class="fixed inset-0 z-50 bg-black/90 flex flex-col items-center justify-center text-white" style="display:none">
    <div class="text-5xl mb-4 animate-bounce">ğŸš€</div>
    <h2 class="text-xl font-bold" x-text="lang==='he'?'×©×•×œ×— ×”×–×× ×”...':'ÙŠØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...'"></h2>
  </div>

  <div x-show="submitted" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center text-center text-white" style="display:none">
    <div class="bg-white text-black p-10 rounded-3xl max-w-xs shadow-2xl mx-4">
      <div class="text-6xl mb-4">âœ…</div>
      <h3 class="text-2xl font-black mb-2" x-text="lang==='he'?'×”×”×–×× ×” ×”×ª×§×‘×œ×”!':'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!'"></h3>
      <p class="font-bold text-gray-600 mb-6" x-text="lang==='he'?'×”×”×–×× ×” ×‘×•×¦×¢×” ×‘×”×¦×œ×”! × ×©×œ×— ×œ×š ×”×•×“×¢×ª ×•×•××˜×¡××¤ ×‘×§×¨×•×‘. ×”××¡×¤×§×” ×ª×•×š 5 ×™××™ ×¢×¡×§×™×.':'ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„'"></p>
      <button @click="submitted=false" class="w-full bg-black text-white py-4 rounded-xl font-bold mt-4 transition active:scale-95" x-text="lang==='he'?'×¡×’×•×¨':'Ø¥ØºÙ„Ø§Ù‚'"></button>
    </div>
  </div>

<script>
function app() {
  return {
    lang: 'ar', loading: false, submitted: false, selectedOffer: '', selectedImage: '',
    blocks: ${bStr}, c: ${cStr}, f: {name:'', phone:'', address:'', payment:'Cash', process:'Direct'},
    time: 900, hasStartedTyping: false,
    
    init(forcedLang) {
      const qs = new URLSearchParams(window.location.search);
      const urlLang = qs.get('lang');
      const autoLang = navigator.language.startsWith('he') ? 'he' : 'ar';
      this.lang = forcedLang || ((urlLang==='he'||urlLang==='ar') ? urlLang : autoLang);
      loadPixels(this.c);
    },

    trackInput() { if(!this.hasStartedTyping && this.f.name.length>2){ this.hasStartedTyping=true; this.track('AddToCart'); } },
    track(ev) {
      const cfg = this.c; let ph = formatE164(this.f.phone);
      if(window.ttq){ if(ph.length>=10) ttq.identify({phone_number:ph, name:this.f.name}); ttq.track(ev==='AddToCart'?'AddToCart':'CompletePayment', {content_id:cfg.productName, value:Number(cfg.price), currency:'ILS', content_type:'product'}); }
      if(window.fbq) fbq('track', ev, {value:Number(cfg.price), currency:'ILS', content_ids:[cfg.productName], content_type:'product'});
      if(window.snaptr) { if(ph.length>=10) snaptr('init', cfg.snapPixel, {user_phone_number:ph}); if(ev==='AddToCart') snaptr('track','ADD_CART',{item_ids:[cfg.productName]}); if(ev==='Purchase') snaptr('track','PURCHASE',{currency:'ILS', price:Number(cfg.price)}); }
    },
    async submitForm() {
      this.loading = true; 
      this.track('Purchase');
      const cfg = this.c;
      const zapUrl = '${this.config.zapierUrl || "https://hooks.zapier.com/hooks/catch/14790106/ue4uy7j/"}';
      const finalProduct = this.selectedOffer ? this.selectedOffer : cfg.productName;
      const msg = \`Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ \${this.f.name} ÙÙŠ Ø¹Ø§Ù„Ù… MAD Parfumeur ğŸ–¤ ÙŠØ³Ø¹Ø¯Ù†Ø§ ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ù…Ù…ÙŠØ²! Ø¥Ù„ÙŠÙƒ Ø§Ù„ØªÙØ§ØµÙŠÙ„:
ğŸ’ Ø§Ù„Ø¹Ø·Ø±: \${finalProduct} ğŸ’° Ø§Ù„Ø¯ÙØ¹: \${this.f.payment} (\${cfg.price}) ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: \${this.f.address} ğŸ“¦ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: \${this.f.process}
Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØ¬Ù‡ÙŠØ² Ø´Ø­Ù†ØªÙƒ ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø®Ù„Ø§Ù„ 3-5 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„. ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¨ÙƒÙ„ Ù„Ø§Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø§ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ğŸ“ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†: *9935 Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø±Ùƒ Ø§Ù„ØªÙ…ÙŠØ² âœ¨\`;

      let zapFd = new FormData();
      Object.keys(this.f).forEach(k => zapFd.append(k, this.f[k]));
      zapFd.append('product', finalProduct);
      zapFd.append('price', cfg.price);
      zapFd.append('generated_message', msg);
      fetch(zapUrl, { method: 'POST', body: zapFd, mode: 'no-cors' }).catch(e => console.error('Zapier Error:', e));

      let fd = new FormData();
      Object.keys(this.f).forEach(k => fd.append(k, this.f[k]));
      fd.append('offer', finalProduct);
      fd.append('price', cfg.price);
      fd.append('lang', this.lang);

      try {
        await fetch(cfg.sheetUrl, { method: 'POST', body: fd, mode: 'no-cors' });
        this.submitted = true;
      } catch (e) { alert('Error'); } finally { this.loading = false; }
    }
  }
}
<\/script>
</body>
</html>`;
    }   // âœ… Ù†Ù‡Ø§ÙŠØ© generateFinalHTML
  }     // âœ… Ù†Ù‡Ø§ÙŠØ© return object
}       // âœ… Ù†Ù‡Ø§ÙŠØ© builderApp()
</script>
</body>
</html>
