<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD Builder - Advanced Pixel</title>
    <style>
        :root { --primary: #d97706; --bg: #0f172a; --panel: #1e293b; --text: #f1f5f9; --border: #334155; --danger: #ef4444; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        
        .main-layout { display: flex; height: 100vh; flex-direction: row-reverse; }
        .preview-pane { flex: 1; background: #020617; display: flex; justify-content: center; align-items: center; border-right: 1px solid var(--border); padding: 20px; overflow: hidden; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; }
        .editor-pane { width: 550px; background: var(--panel); padding: 30px; overflow-y: auto; box-shadow: -5px 0 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 20px; }

        .iphone-mockup { width: 375px; height: 812px; background: #000; border-radius: 40px; border: 12px solid #2d2d2d; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; transform: scale(0.9); flex-shrink: 0; }
        .iphone-notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #2d2d2d; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; z-index: 100; }
        .iphone-screen { width: 100%; height: 100%; background: #fff; border: none; display: block; }

        @media (max-width: 768px) {
            .main-layout { flex-direction: column; height: auto; overflow: auto; }
            .preview-pane { display: none; }
            .editor-pane { width: 100%; height: auto; box-shadow: none; }
            body { overflow: auto; }
        }

        h1 { color: var(--primary); margin: 0 0 10px 0; font-size: 1.5rem; text-align: center; }
        h2 { font-size: 1rem; color: #94a3b8; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 25px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; margin-bottom: 5px; color: #cbd5e1; }
        input[type="text"], textarea, select { width: 100%; padding: 10px; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 6px; box-sizing: border-box; outline: none; font-size: 0.9rem; }
        input[type="color"] { width: 100%; height: 40px; border: none; padding: 0; cursor: pointer; border-radius: 6px; }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); }

        .lang-toggle { display: flex; background: #0f172a; border-radius: 8px; padding: 4px; margin-bottom: 20px; border: 1px solid var(--border); }
        .lang-btn { flex: 1; background: transparent; color: #64748b; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; font-family: inherit; }
        .lang-btn.active { background: var(--primary); color: black; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .toggle-wrapper { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--border); }
        .toggle-label { font-weight: bold; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--primary); cursor: pointer; }
        
        .section-settings { padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px; margin-top: 5px; border-left: 2px solid var(--primary); display: none; }
        input[type="checkbox"]:checked ~ .section-settings { display: block; }

        .btn-action { background: var(--primary); color: #000; font-weight: 900; padding: 15px; border-radius: 8px; border: none; cursor: pointer; width: 100%; font-size: 1.1rem; margin-top: 20px; transition: 0.2s; }
        .btn-secondary { background: transparent; border: 1px dashed var(--border); color: var(--primary); padding: 8px; border-radius: 6px; cursor: pointer; width: 100%; transition: 0.2s; text-align: center; }
        .btn-secondary:hover { background: rgba(217,119,6,0.1); }
        .btn-delete { background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; }

        .dynamic-row { display: grid; grid-template-columns: 1fr 1fr 30px; gap: 5px; align-items: center; margin-bottom: 8px; }
        .block-item { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .block-head { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
        .img-list { display: flex; flex-wrap: gap: 5px; margin-top: 5px; }
        .img-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid var(--border); }
        .img-wrap { position: relative; }
        .img-del { position: absolute; top: -5px; right: -5px; background: var(--danger); width: 15px; height: 15px; border-radius: 50%; color: white; font-size: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; }
        
        .url-input-group { display: flex; gap: 5px; margin-top: 5px; }
        .or-divider { text-align: center; font-size: 0.8rem; color: #64748b; margin: 5px 0; }
        .input-label-sm { font-size: 0.75rem; color: #94a3b8; margin-bottom: 3px; display: block; }
        
        /* New Color Grid */
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="editor-pane">
        <h1>MAD Builder ğŸ’</h1>
        <div class="lang-toggle">
            <button class="lang-btn active" onclick="setMode('ar')" id="btn-ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (AR)</button>
            <button class="lang-btn" onclick="setMode('he')" id="btn-he">×¢×‘×¨×™×ª (HE)</button>
        </div>

        <h2>1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø©</h2>
        <div class="form-group"><label>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© (Page Background)</label><input type="color" id="bgColor" value="#ab5c12" oninput="updateCommon('bgColor', this.value)"></div>
        <div class="form-group">
            <label>Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Logo)</label>
            <input type="text" id="logoUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø± (URL)" value="https://madperfume.ps/upload/01-2026/page/69735b87d92ef.png" oninput="updateCommon('logo', this.value)">
            <input type="file" id="logoInput" accept="image/*" style="margin-top:5px">
        </div>
        <div class="form-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ù„Ø³Ø¹Ø±)</label><input type="text" id="price" oninput="updateData('price', this.value)"></div>
        <div class="form-group"><label>Ø§Ù„Ø¨Ø§Ø¯Ø¬ (Ø§Ù„Ø¹Ø±Ø¶)</label><input type="text" id="offer" oninput="updateData('offer', this.value)"></div>
        
        <!-- Sticky Button Toggle -->
        <div class="form-group">
            <div class="toggle-wrapper">
                <span class="toggle-label">ğŸ”˜ Ø²Ø± Ø¹Ø§Ø¦Ù… (Sticky Button)</span>
                <input type="checkbox" id="showFloatingBtn" onchange="updateCommon('showFloatingBtn', this.checked)">
                <div class="section-settings">
                    <label>Ù†Øµ Ø§Ù„Ø²Ø±</label>
                    <input type="text" id="ctaText" oninput="updateData('ctaText', this.value)">
                </div>
            </div>
        </div>

        <!-- NEW: Design & Fonts Section -->
        <h2>2. Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ù…Ø¸Ù‡Ø±</h2>
        <div class="form-group">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø· (Font Family)</label>
            <select id="fontFamily" onchange="updateCommon('fontFamily', this.value)">
                <option value="Inter">Inter (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
                <option value="Cairo">Cairo (ÙƒØ§ÙŠØ±Ùˆ)</option>
                <option value="Tajawal">Tajawal (ØªØ¬ÙˆØ§Ù„)</option>
                <option value="Almarai">Almarai (Ø§Ù„Ù…Ø±Ø§Ø¹ÙŠ)</option>
                <option value="Amiri">Amiri (Ø£Ù…ÙŠØ±ÙŠ)</option>
            </select>
        </div>
        <div class="form-group">
            <label>Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Form)</label>
            <div class="color-grid">
                <div><label class="input-label-sm">Ø®Ù„ÙÙŠØ© Ø§Ù„ÙÙˆØ±Ù…</label><input type="color" id="formBg" value="#000000" oninput="updateCommon('formBg', this.value)"></div>
                <div><label class="input-label-sm">Ù†ØµÙˆØµ Ø§Ù„ÙÙˆØ±Ù…</label><input type="color" id="formColor" value="#ffffff" oninput="updateCommon('formColor', this.value)"></div>
            </div>
        </div>
        <div class="form-group">
            <label>Ø£Ù„ÙˆØ§Ù† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ (Buttons)</label>
            <div class="color-grid">
                <div><label class="input-label-sm">Ø®Ù„ÙÙŠØ© Ø§Ù„Ø²Ø±</label><input type="color" id="btnBg" value="#15b76b" oninput="updateCommon('btnBg', this.value)"></div>
                <div><label class="input-label-sm">Ù†Øµ Ø§Ù„Ø²Ø±</label><input type="color" id="btnTxt" value="#000000" oninput="updateCommon('btnTxt', this.value)"></div>
            </div>
        </div>

        <h2>3. Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Manifesto)</h2>
        <div class="form-group">
            <div class="toggle-wrapper">
                <span class="toggle-label">âš–ï¸ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…</span>
                <input type="checkbox" id="showManifesto" checked onchange="updateCommon('showManifesto', this.checked)">
                <div class="section-settings">
                    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label><input type="text" id="maniT" oninput="updateData('maniT', this.value)">
                    <label>Ø§Ù„ÙˆØµÙ Ø§Ù„ÙØ±Ø¹ÙŠ</label><input type="text" id="maniS" oninput="updateData('maniS', this.value)">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px; margin-top:5px; margin-bottom:10px;">
                        <div><label>MAD (Ù†Ø­Ù†)</label><input type="text" id="maniM" oninput="updateData('maniM', this.value)"></div>
                        <div><label>Others (Ø§Ù„ØºÙŠØ±)</label><input type="text" id="maniO" oninput="updateData('maniO', this.value)"></div>
                    </div>
                    <label>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©)</label>
                    <div id="maniRows"></div>
                    <button class="btn-secondary" onclick="addManiRow()">+ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù…Ù‚Ø§Ø±Ù†Ø©</button>
                </div>
            </div>
        </div>

        <h2>4. Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h2>
        <!-- Google Sheet Config -->
        <div class="toggle-wrapper">
            <span class="toggle-label">ğŸ“ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ (Google Sheet)</span>
            <input type="checkbox" id="showForm" checked onchange="updateCommon('showForm', this.checked)">
            <div class="section-settings">
                <label>Ø±Ø§Ø¨Ø· Ø³ÙƒØ±Ø¨Øª ØºÙˆØºÙ„ (Web App URL)</label>
                <input type="text" id="googleScript" value="https://script.google.com/macros/s/AKfycbzEEzQCP1xVJ9U1E15hh43sok6uRIir866l9daol-rUqXrp6dwnXusc3h9_B6miqqtE/exec" oninput="updateCommon('googleScript', this.value)">
                <label>ØµÙØ­Ø© Ø§Ù„Ø´ÙƒØ± (Ø±Ø§Ø¨Ø· ØªÙˆØ¬ÙŠÙ‡)</label>
                <input type="text" id="tyPage" value="/thank-you.html" oninput="updateCommon('tyPage', this.value)">
            </div>
        </div>

        <div class="toggle-wrapper">
            <span class="toggle-label">ğŸŸ¢ WhatsApp</span>
            <input type="checkbox" id="showWa" checked onchange="updateCommon('showWa', this.checked)">
            <div class="section-settings">
                <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø¹ Ø§Ù„Ø¯ÙˆÙ„Ø©)</label><input type="text" id="waNum" value="972509787730" oninput="updateCommon('waNum', this.value)">
                <label>Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø¨Ù‚Ø©</label><input type="text" id="waText" oninput="updateData('waText', this.value)">
                <label>Ù†Øµ Ø§Ù„Ø²Ø±</label><input type="text" id="waLabel" oninput="updateData('waLabel', this.value)">
            </div>
        </div>
        <div class="toggle-wrapper">
            <span class="toggle-label">ğŸ“ Ø§ØªØµØ§Ù„ Ù‡Ø§ØªÙÙŠ</span>
            <input type="checkbox" id="showCall" checked onchange="updateCommon('showCall', this.checked)">
            <div class="section-settings">
                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input type="text" id="callNum" value="*9935" oninput="updateCommon('callNum', this.value)">
                <label>Ù†Øµ Ø§Ù„Ø²Ø±</label><input type="text" id="callLabel" oninput="updateData('callLabel', this.value)">
            </div>
        </div>
        <div class="toggle-wrapper">
            <span class="toggle-label">ğŸŒ Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹</span>
            <input type="checkbox" id="showWeb" onchange="updateCommon('showWeb', this.checked)">
            <div class="section-settings">
                <label>Ø§Ù„Ø±Ø§Ø¨Ø·</label><input type="text" id="webUrl" placeholder="https://..." oninput="updateCommon('webUrl', this.value)">
                <label>Ù†Øµ Ø§Ù„Ø²Ø±</label><input type="text" id="webLabel" oninput="updateData('webLabel', this.value)">
            </div>
        </div>

        <h2>5. Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ÙˆØ§Ù„Ø¨Ù„ÙˆÙƒØ§Øª</h2>
        <div class="form-group" style="background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; border:1px solid #334155">
            <label style="color:var(--primary); margin-bottom:8px;">Ø®Ù„ÙÙŠØ© Ø§Ù„Ù‡ÙŠØ¯Ø±</label>
            <select id="heroType" onchange="updateCommon('heroType', this.value)" style="margin-bottom:10px;">
                <option value="video">ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø± (MP4)</option>
                <option value="youtube">ÙŠÙˆØªÙŠÙˆØ¨ (YouTube)</option>
                <option value="image">ØµÙˆØ±Ø© Ø«Ø§Ø¨ØªØ© (Image)</option>
            </select>
            <input type="text" id="vid" value="https://madparfumeurglobal.com/wp-content/uploads/2025/10/download.mp4" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·..." oninput="updateCommon('vid', this.value)">
        </div>

        <div class="form-group">
            <label>ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ (Carousel)</label>
            <input type="file" id="heroInput" accept="image/*" style="display:none">
            <button class="btn-secondary" onclick="document.getElementById('heroInput').click()">+ Ø±ÙØ¹ ØµÙˆØ±Ø©</button>
            <div class="or-divider">- Ø£Ùˆ -</div>
            <div class="url-input-group">
                <input type="text" id="heroUrlInput" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© URL">
                <button class="btn-secondary" style="width:auto;" onclick="addHeroFromUrl()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
            <div id="heroList" class="img-list"></div>
        </div>

        <div id="blockList"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px; margin-top:10px;">
            <button class="btn-secondary" onclick="addBlock('text')">Ù†Øµ</button>
            <button class="btn-secondary" onclick="addBlock('image')">ØµÙˆØ±Ø© + Ù†Øµ</button>
            <button class="btn-secondary" onclick="addBlock('video')">ÙÙŠØ¯ÙŠÙˆ</button>
            <button class="btn-secondary" onclick="addBlock('embed')">HTML</button>
        </div>

        <h2>6. Ø§Ù„ØªØªØ¨Ø¹</h2>
        <div class="form-group"><label>Facebook Pixel</label><input type="text" id="fbPixel" value="1072283127290819" oninput="updateCommon('fb', this.value)"></div>
        <div class="form-group"><label>TikTok Pixel</label><input type="text" id="ttPixel" value="D2D02JBC77U4ENLN9SBG" oninput="updateCommon('tt', this.value)"></div>

        <button class="btn-action" onclick="download()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</button>
    </div>

    <div class="preview-pane">
        <div class="iphone-mockup">
            <div class="iphone-notch"></div>
            <iframe id="preview" class="iphone-screen"></iframe>
        </div>
    </div>
</div>

<script>
    let mode = 'ar';
    const common = {
        bgColor: "#ab5c12",
        fontFamily: "Inter",
        formBg: "#000000",
        formColor: "#ffffff",
        btnBg: "#15b76b",
        btnTxt: "#000000",
        
        heroType: 'video', 
        logo: "https://madperfume.ps/upload/01-2026/page/69735b87d92ef.png",
        vid: "https://madparfumeurglobal.com/wp-content/uploads/2025/10/download.mp4",
        heroes: ["https://madperfume.ps/upload/01-2026/page/6971495c69e7c.png"],
        blocks: [
            {
                id: 1769167825001,
                type: "text",
                val: "",
                text: {
                    ar: "DEPENDENCE â€“ Ù…Ø³ØªÙˆØ­Ù‰ Ù…Ù† Bitter Peach (Tom Ford)\n\nDEPENDENCE Ù‡Ùˆ Ø¹Ø·Ø± Ø¬Ø±ÙŠØ¡ØŒ Ø­Ø³ÙŠ ÙˆÙ…ÙÙ„ÙØªØŒ ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø­Ù„Ø§ÙˆØ© Ø§Ù„ÙØ§ÙƒÙ‡ÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø© ÙˆÙ„Ù…Ø³Ø© ÙØ§Ø®Ø±Ø© Ø¬Ø°Ø§Ø¨Ø©.\nÙ…Ø³ØªÙˆØ­Ù‰ Ù…Ù† Bitter Peach Ù…Ù† Tom Ford Ù„ÙŠÙ…Ù†Ø­Ùƒ ØªØ¬Ø±Ø¨Ø© Ø¹Ø·Ø±ÙŠØ© Ù‚ÙˆÙŠØ© ØªØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø§Ù„Ø¬Ø±Ø£Ø©ØŒ Ø§Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù„Ø§ÙØª.\n\nğŸ‘ Ø§ÙØªØªØ§Ø­ÙŠØ© Ø®ÙˆØ®ÙŠØ© Ø¬Ø°Ø§Ø¨Ø©\nğŸ”¥ Ø¹Ù…Ù‚ Ø¯Ø§ÙØ¦ Ù…Ø«ÙŠØ±\nğŸ’ ØªÙˆÙ‚ÙŠØ¹ Ø¹Ø·Ø±ÙŠ ÙØ§Ø®Ø± Ø¨Ø·Ø§Ø¨Ø¹ Ø¹ØµØ±ÙŠ",
                    he: "DEPENDENCE â€“ Inspired by Bitter Peach (Tom Ford)\n\nDEPENDENCE ×”×•× × ×™×—×•×— × ×•×¢×–, ×—×•×©× ×™ ×•×××›×¨, ×”××©×œ×‘ ××ª×™×§×•×ª ×¤×™×¨×•×ª×™×ª ×¢××•×§×” ×¢× ××œ×’× ×˜×™×•×ª ×™×•×§×¨×ª×™×ª.\n×”×©×¨××” ×Ö¾Bitter Peach ×©×œ Tom Ford ×™×•×¦×¨×ª ×—×•×•×™×” ×—×•×©×™×ª ×¢×•×¦××ª×™×ª, ××•×©×œ××ª ×œ××™ ×©××—×¤×© × ×•×›×—×•×ª ×‘×•×œ×˜×ª ×•×¡×˜×™×™×œ ×‘×œ×ª×™ × ×©×›×—.\n\nğŸ‘ ×¤×ª×™×—×” ×¢×¡×™×¡×™×ª ×•××ª×•×§×”\nğŸ”¥ ×¢×•××§ ×—××™× ×•××¤×ª×”\nğŸ’ ×—×ª×™××” ×™×•×§×¨×ª×™×ª ×¢× ××•×¤×™ ××•×“×¨× ×™"
                }
            },
            {
                id: 1769176873684,
                type: "video",
                val: "https://madperfume.ps/upload/01-2026/page/Dependence%20madperfume.mp4#t=0.02",
                text: { ar: "", he: "" }
            },
            {
                id: 1769176890534,
                type: "text",
                val: "",
                text: {
                    ar: "Ø§Ù„Ù†ÙˆØªØ§Øª Ø§Ù„Ø¹Ø·Ø±ÙŠØ©\n\nØ§Ù„Ù†ÙˆØªØ§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ (Top Notes):\nØ®ÙˆØ® Ù…Ø±ØŒ ÙÙˆØ§ÙƒÙ‡ Ø¹ØµÙŠØ±ÙŠØ©\n\nÙ†ÙˆØªØ§Øª Ø§Ù„Ù‚Ù„Ø¨ (Heart Notes):\nÙØ§Ù†ÙŠÙ„ÙŠØ§ØŒ ØªÙˆØ§Ø¨Ù„ Ø¯Ø§ÙØ¦Ø©ØŒ Ù„Ù…Ø³Ø§Øª Ø²Ù‡Ø±ÙŠØ©\n\nØ§Ù„Ù†ÙˆØªØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Base Notes):\nØ¹Ù†Ø¨Ø±ØŒ Ø£Ø®Ø´Ø§Ø¨ Ø¯Ø§ÙØ¦Ø©ØŒ Ù…Ø³Ùƒ",
                    he: "×ª×•×•×™ × ×™×—×•×— (Notes)\n\n×ª×•×•×™ ×¤×ª×™×—×” (Top Notes):\n××¤×¨×¡×§ ××¨×™×¨, ×¤×™×¨×•×ª ×¢×¡×™×¡×™×™×\n\n×ª×•×•×™ ×œ×‘ (Heart Notes):\n×•× ×™×œ, ×ª×‘×œ×™× ×™× ×—××™×, ×¤×¨×—×™× ×¢×“×™× ×™×\n\n×ª×•×•×™ ×‘×¡×™×¡ (Base Notes):\n×¢× ×‘×¨, ×¢×¦×™× ×—××™×, ××•×©×§"
                }
            }
        ],
        fb: "1072283127290819", tt: "D2D02JBC77U4ENLN9SBG",
        googleScript: "https://script.google.com/macros/s/AKfycbzEEzQCP1xVJ9U1E15hh43sok6uRIir866l9daol-rUqXrp6dwnXusc3h9_B6miqqtE/exec",
        tyPage: "/thank-you.html",
        showForm: true, showManifesto: true, showWa: true, showCall: true, showWeb: false, showFloatingBtn: false,
        waNum: "972509787730", callNum: "*9935", webUrl: "https://madparfumeur.com"
    };

    const db = {
        ar: {
            price: "240 â‚ª Ø´Ø§Ù…Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„", offer: "350 â‚ª Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚", ctaText: "Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†",
            maniT: "THE MANIFESTO", maniS: "Ù„Ù…Ø§Ø°Ø§ MADØŸ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¹Ù„Ù…ÙŠØ©", maniM: "Ø¹Ø·ÙˆØ±  MAD", maniO: "Ø¹Ø·ÙˆØ± ØªØ±ÙƒÙŠØ§ Ø¯Ø¨ÙŠ Ø§Ù„Ø²ÙŠÙˆØª ÙˆØ§Ù„Ø¨Ø¯Ø§Ø¦Ù„",
            waLabel: "Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨", waText: "Ø¯ÙŠØ¨Ù†Ø³",
            callLabel: "Ø§ØªØµÙ„ Ù„Ù„Ø·Ù„Ø¨", webLabel: "Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹",
            formTitle: "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹", name: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„", phone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", city: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)", notes: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
            submit: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ âœ…", sending: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...", ok: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…", fail: "Ø­ØµÙ„ Ø®Ø·Ø£ØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.",
            compItems: [
                {mad: "Ø¢Ù…Ù†Ø© 100% Ù…Ø¹ØªÙ…Ø¯Ø©", local: "Ù…Ø¬Ù‡ÙˆÙ„Ø© Ø§Ù„Ù…ØµØ¯Ø±"},
                {mad: "ØªØ·Ø§Ø¨Ù‚ Ø¬Ø²ÙŠØ¦ÙŠ Ø¯Ù‚ÙŠÙ‚", local: "Ø®Ù„Ø· ÙŠØ¯ÙˆÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ"},
                {mad: "Ø®Ù„Ø§ØµØ§Øª Ø£ÙˆØ±ÙˆØ¨ÙŠØ©", local: "Ø²ÙŠÙˆØª ØªØ¬Ø§Ø±ÙŠØ© Ø±Ø®ÙŠØµØ©"},
                {mad: "Ø«Ø¨Ø§Øª +24 Ø³Ø§Ø¹Ø©", local: "ÙŠØ®ØªÙÙŠ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø©"},
                {mad: "41 ÙØ±Ø¹ ÙÙŠ Ø§Ù„Ø¨Ù„Ø§Ø¯", local: "Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†"},
                {mad: "Ø®Ø¯Ù…Ø© Ø²Ø¨Ø§Ø¦Ù† *9935", local: " Ø­Ø¸Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡"},
                {mad: "Ù…ØµØ§Ø¯Ù‚Ø§Øª Ø§ÙŠÙŠØ²Ùˆ ÙˆÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ù‡", local: "ØºÙŠØ± Ù…ÙØ­ÙˆØµÙ‡"}
            ]
        },
        he: {
            price: "240â‚ª ×›×•×œ×œ ××©×œ×•×—", offer: "350 â‚ª ××—×™×¨ ×§×•×“×", ctaText: "×”×–××Ÿ ×¢×›×©×™×•",
            maniT: "THE MANIFESTO", maniS: "×œ××” MAD? ×”×©×•×•××” ××“×¢×™×ª", maniM: "×‘×©××™ MAD", maniO: "×—×™×§×•×™×™× ×“×•×‘×™ ×˜×•×¨×§×™×” ×“×™×•×¤×™× ×©×× ×™×",
            waLabel: "×”×–××Ÿ ×‘×•×•××˜×¡××¤", waText: "DEPENDENCE",
            callLabel: "×—×™×™×’ ×œ×”×–×× ×”", webLabel: "×‘×§×¨ ×‘××ª×¨",
            formTitle: "×˜×•×¤×¡ ×”×–×× ×” ××”×™×¨", name: "×©× ××œ×", phone: "×˜×œ×¤×•×Ÿ", city: "×¢×™×¨ (××•×¤×¦×™×•× ×œ×™)", notes: "×”×¢×¨×•×ª (××•×¤×¦×™×•× ×œ×™)",
            submit: "×©×œ×— ×”×–×× ×” âœ…", sending: "×©×•×œ×—...", ok: "×”×”×–×× ×” × ×©×œ×—×” ×‘×”×¦×œ×—×” âœ…", fail: "×©×’×™××”, × ×¡×• ×©×•×‘.",
            compItems: [
                {mad: "×‘×˜×•×— 100% ×××•×©×¨", local: "××§×•×¨ ×œ× ×™×“×•×¢"},
                {mad: "×”×ª×××” ××•×œ×§×•×œ×¨×™×ª", local: "×¢×¨×‘×•×‘ ××§×¨××™"},
                {mad: "×ª××¦×™×•×ª ××™×¨×•×¤××™×•×ª", local: "×©×× ×™× ××¡×—×¨×™×™×"},
                {mad: "×¢××™×“×•×ª 24+ ×©×¢×•×ª", local: "× ×¢×œ× ××”×¨"},
                {mad: "41 ×¡× ×™×¤×™× ×‘××¨×¥", local: " ××•× ×œ×™×™×Ÿ"},
                {mad: "×©×™×¨×•×ª ×œ×§×•×—×•×ª *9935", local: "× ×¢×œ××™× ××—×¨ ×”×”×–×× ×”"},
                {mad: "×ª×§×Ÿ ××™×™×–×• - ××©×¨×“ ×‘×¨×™××•×ª", local: " ×œ× × ×‘×“×§ ××¡×•×›×Ÿ"}
            ]
        }
    };

    function escapeHtml(text) {
        if (!text) return "";
        return text.replace(/\\/g, '\\\\')
                   .replace(/"/g, '\\"')
                   .replace(/'/g, "\\'")
                   .replace(/`/g, '\\`')
                   .replace(/</g, '&lt;')
                   .replace(/>/g, '&gt;')
                   .replace(/\$/g, '\\$');
    }

    function setMode(lang) {
        mode = lang;
        document.getElementById('btn-ar').className = lang === 'ar' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('btn-he').className = lang === 'he' ? 'lang-btn active' : 'lang-btn';
        ['price', 'offer', 'ctaText', 'maniT', 'maniS', 'maniM', 'maniO', 'waLabel', 'waText', 'callLabel', 'webLabel'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.value = db[lang][id] || '';
        });
        renderManiRows(); updateBlockUI(); render(); 
    }

    function updateData(key, val) { db[mode][key] = val; render(); }
    function updateCommon(key, val) { common[key] = val; render(); }

    function renderManiRows() {
        const div = document.getElementById('maniRows'); div.innerHTML = '';
        db[mode].compItems.forEach((item, i) => {
            div.innerHTML += `<div class="dynamic-row">
                <input type="text" placeholder="MAD" value="${escapeHtml(item.mad)}" oninput="updateManiItem(${i}, 'mad', this.value)">
                <input type="text" placeholder="Others" value="${escapeHtml(item.local)}" oninput="updateManiItem(${i}, 'local', this.value)">
                <button class="btn-delete" onclick="removeManiRow(${i})">X</button>
            </div>`;
        });
    }
    function updateManiItem(i, f, v) { db[mode].compItems[i][f] = v; render(); }
    function addManiRow() { db[mode].compItems.push({mad:'', local:''}); renderManiRows(); render(); }
    function removeManiRow(i) { db[mode].compItems.splice(i, 1); renderManiRows(); render(); }

    const logoInput = document.getElementById('logoInput');
    if(logoInput) logoInput.addEventListener('change', e => handleFile(e, res => { common.logo = res; render(); }));
    
    const heroInput = document.getElementById('heroInput');
    if(heroInput) heroInput.addEventListener('change', e => handleFile(e, res => { common.heroes.push(res); updateHeroUI(); render(); }));

    function handleFile(e, cb) {
        if(e.target.files[0]) {
            const r = new FileReader();
            r.onload = evt => cb(evt.target.result);
            r.readAsDataURL(e.target.files[0]);
        }
    }
    
    function addHeroFromUrl() {
        const urlInp = document.getElementById('heroUrlInput');
        if(urlInp && urlInp.value.trim()){
            common.heroes.push(urlInp.value.trim());
            updateHeroUI(); render();
            urlInp.value = '';
        }
    }

    function updateHeroUI() {
        const div = document.getElementById('heroList'); div.innerHTML = '';
        common.heroes.forEach((src, i) => {
            div.innerHTML += `<div class="img-wrap"><img src="${src}" class="img-thumb"><button class="img-del" onclick="delHero(${i})">x</button></div>`;
        });
    }
    function delHero(i) { common.heroes.splice(i,1); updateHeroUI(); render(); }

    function addBlock(t) { 
        common.blocks.push({ id: Date.now(), type: t, val: '', text: { ar: '', he: '' } }); 
        updateBlockUI(); render(); 
    }
    function delBlock(id) { common.blocks = common.blocks.filter(b => b.id !== id); updateBlockUI(); render(); }
    
    function setBlockVal(id, v) { common.blocks.find(b=>b.id===id).val = v; render(); }
    
    function setBlockText(id, v) { 
        const b = common.blocks.find(b=>b.id===id);
        if(!b.text) b.text = { ar: '', he: '' };
        b.text[mode] = v;
        render(); 
    }

    function handleBlockImg(id, input) { handleFile({target:input}, res => { setBlockVal(id, res); updateBlockUI(); }); }

    function updateBlockUI() {
        const div = document.getElementById('blockList'); div.innerHTML = '';
        common.blocks.forEach((b) => {
            let f = '';
            const safeVal = escapeHtml(b.val);
            const currentText = (b.text && b.text[mode]) ? escapeHtml(b.text[mode]) : '';
            const langName = mode === 'ar' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : '×¢×‘×¨×™×ª';

            if(b.type === 'text') {
                f = `<label class="input-label-sm">Ø§Ù„Ù†Øµ (${langName})</label>
                     <textarea oninput="setBlockText(${b.id},this.value)" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§...">${currentText}</textarea>`;
            } else if(b.type === 'video') {
                f = `<input type="text" oninput="setBlockVal(${b.id},this.value)" value="${safeVal}" placeholder="Ø±Ø§Ø¨Ø· MP4">`;
            } else if(b.type === 'embed') {
                f = `<textarea oninput="setBlockVal(${b.id},this.value)" placeholder="ÙƒÙˆØ¯ HTML...">${safeVal}</textarea>`;
            } else if(b.type === 'image') {
                f = `
                <input type="file" onchange="handleBlockImg(${b.id},this)">
                <div class="or-divider">- Ø£Ùˆ -</div>
                <input type="text" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©" value="${b.val.startsWith('data:') ? '' : safeVal}" oninput="setBlockVal(${b.id},this.value)">
                ${b.val ? '<img src="'+b.val+'" style="height:40px;margin-top:5px;object-fit:contain" referrerpolicy="no-referrer">' : ''}
                <div style="margin-top:8px">
                    <label class="input-label-sm">Ù†Øµ ØªØ­Øª Ø§Ù„ØµÙˆØ±Ø© (${langName})</label>
                    <input type="text" value="${currentText}" oninput="setBlockText(${b.id},this.value)" placeholder="ÙˆØµÙ Ø§Ø®ØªÙŠØ§Ø±ÙŠ...">
                </div>
                `;
            }
            div.innerHTML += `<div class="block-item"><div class="block-head"><span>${b.type.toUpperCase()}</span><button class="btn-delete" onclick="delBlock(${b.id})">x</button></div>${f}</div>`;
        });
    }

    function safeJSON(obj) {
        return JSON.stringify(obj).replace(/</g, '\\u003c');
    }

    function getHTML(dl = false) {
        const jsonCommon = safeJSON(common);
        const jsonDB = safeJSON(db);
        
        const vidUrl = common.vid;
        const hType = common.heroType;
        let heroHtml = '';

        if (hType === 'youtube') {
            const ytMatch = vidUrl.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?|shorts)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
            const vidId = ytMatch ? ytMatch[1] : '';
            heroHtml = vidId ? `<div class="hero-wrapper"><iframe src="https://www.youtube.com/embed/${vidId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${vidId}&playsinline=1&rel=0&showinfo=0&modestbranding=1" class="hero-vid-iframe" allow="autoplay; encrypted-media" frameborder="0"></iframe></div>` : `<div class="hero-wrapper" style="background:#333;"></div>`;
        } else if (hType === 'image') {
            heroHtml = `<img src="${vidUrl}" class="hero-vid" alt="Background" referrerpolicy="no-referrer">`;
        } else {
            heroHtml = `<video src="${vidUrl}" autoplay loop muted playsinline class="hero-vid"></video>`;
        }

        const sOpen = '<' + 'script';
        const sClose = '<' + '/script>';

        const pixels = dl ? `
        ${sOpen}>
            !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)n=f.fbq;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', '${common.fb}'); fbq('track', 'PageView');
            !function (w, d, t) { w.TiktokAnalyticsObject=t; var ttq=w[t]=w[t]||[]; ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"]; ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}; for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]); ttq.load=function(e,n){ var r="https://analytics.tiktok.com/i18n/pixel/events.js"; var o=n&&n.partner; ttq._i=ttq._i||{}; ttq._i[e]=[]; ttq._i[e]._u=r; ttq._t=ttq._t||{}; ttq._t[e]=+new Date; ttq._o=ttq._o||{}; ttq._o[e]=n||{}; n=document.createElement("script"); n.type="text/javascript"; n.async=!0; n.src=r+"?sdkid="+e+"&lib="+t; e=document.getElementsByTagName("script")[0]; e.parentNode.insertBefore(n,e) }; ttq.load('${common.tt}'); ttq.page(); }(window, document, 'ttq');
            
            // MAD Tracking Logic
            window.MAD_TRACKING_SPEC = {
             project_name: "MAD Conversion Tracking System",
             platforms: ["Facebook Pixel", "TikTok Pixel"],
             currency: "ILS",
             landing_page: { allowed_events_only: ["PageView", "Contact"], do_not_fire_purchase_event: true },
             thank_you_page: {
               facebook: { event: "Purchase", value: 500, currency: "ILS" },
               tiktok: { event: "CompletePayment", value: 500, currency: "ILS" },
               rules: { fire_event_only_once_per_session: true, prevent_manual_access: true, do_not_trigger_on_refresh: true }
             }
            };
            window.MAD_KEYS = { ORDER_OK: "MAD_ORDER_OK_V1", PURCHASE_LOCK: "MAD_PURCHASE_LOCK_V1" };
            window.MAD_MARK_ORDER_SUBMITTED = function(meta){
             try {
               sessionStorage.setItem(window.MAD_KEYS.ORDER_OK, "1");
               if(meta && typeof meta === "object"){ sessionStorage.setItem("MAD_ORDER_META_V1", JSON.stringify(meta)); }
             } catch(e){}
            };
        ${sClose}` : '';

        // Auto-detect logic for downloaded file
        const autoLang = dl ? `
        const ul = navigator.language || navigator.userLanguage || '';
        this.lang = ul.toLowerCase().startsWith('he') ? 'he' : 'ar';
        ` : '';

        return `<!DOCTYPE html>
<html lang="${mode}" x-data="app()" x-init="init()" :dir="dir">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
${sOpen} src="https://cdn.tailwindcss.com">${sClose}
${sOpen} src="https://unpkg.com/lucide@latest">${sClose}
${sOpen} src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer>${sClose}
${pixels}
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,900;1,400;1,900&family=Inter:wght@300;400;700;900&family=Amiri:wght@400;700&family=Assistant:wght@300;400;700;800&family=Cairo:wght@400;700&family=Tajawal:wght@400;700&family=Almarai:wght@400;700&display=swap');
body{background:${common.bgColor};color:${common.formColor};font-family:'${common.fontFamily}',sans-serif}
.glass-nav { position: fixed; top: 0; left: 0; width: 100%; z-index: 50; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.6); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.1); }
.nav-logo { height: 35px; object-fit: contain; }
.lang-btn-nav { font-size: 11px; font-weight: bold; color: rgba(255,255,255,0.6); margin: 0 5px; transition:0.2s; }
.lang-btn-nav.active { color: #d97706; }
.hero-vid, .hero-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100vh; overflow: hidden; z-index: -1; object-fit: cover; filter: brightness(0.6); }
.hero-vid-iframe { width: 300%; height: 150%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; }
@media (min-aspect-ratio: 16/9) { .hero-vid-iframe { width: 100%; height: 300%; } }
.badge{background:linear-gradient(to right,#d97706,#fbbf24);color:black;padding:5px 20px;border-radius:50px;font-weight:900;display:inline-block;margin-bottom:10px}
.carousel{position:relative;height:400px;display:flex;align-items:center;justify-content:center}
.c-img{max-height:100%;max-width:100%;filter:drop-shadow(0 20px 40px rgba(0,0,0,0.8))}
.c-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.5);color:#d97706;border:1px solid #333;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer}
.comp-row{display:grid;grid-template-columns:1fr 1fr;gap:2px;background:rgba(255,255,255,.05);border-radius:15px;overflow:hidden;margin-bottom:10px;border:1px solid rgba(255,255,255,.05)}
.c-side{padding:15px;font-size:13px;display:flex;flex-direction:column;justify-content:center}
.c-mad{background:linear-gradient(to right,rgba(217,119,6,.1),rgba(217,119,6,.05));text-align:right}
.c-alt{background:rgba(0,0,0,.4);text-align:right;opacity:.7}
.sticky-cta { position: fixed; bottom: 20px; left: 0; width: 100%; z-index: 50; padding: 0 20px; pointer-events: none; }
.sticky-btn { display: block; max-width: 500px; margin: 0 auto; background: #d97706; color: black; text-align: center; padding: 16px; border-radius: 99px; font-weight: 900; text-decoration: none; box-shadow: 0 10px 25px rgba(0,0,0,0.5); pointer-events: auto; transition: 0.2s; animation: pulse 2s infinite; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
.order-grid { display: grid; gap: 10px; margin-bottom: 20px; max-width: 500px; margin-left: auto; margin-right: auto; }
.btn-order { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 12px; border-radius: 10px; font-weight: bold; text-decoration: none; transition: 0.2s; }
.btn-wa { background: #25D366; color: white; } .btn-wa:hover { background: #1ebc57; }
.btn-call { background: #3b82f6; color: white; } .btn-call:hover { background: #2563eb; }
.btn-web { background: #64748b; color: white; } .btn-web:hover { background: #475569; }
/* Form Styles */
.form-card { max-width:520px; margin:0 auto; background:${common.formBg}; border:1px solid rgba(255,255,255,.10); border-radius:22px; padding:16px; box-shadow:0 20px 80px rgba(0,0,0,.45); text-align: right; }
.inp { width:100%; padding:12px 12px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); outline:none; color:${common.formColor}; }
.inp:focus { border-color: rgba(217,119,6,.7); box-shadow:0 0 0 3px rgba(217,119,6,.18); }
.submit-btn { width:100%; padding:14px 14px; border-radius:16px; font-weight:900; color:${common.btnTxt}; background:${common.btnBg}; border:none; box-shadow:0 14px 50px rgba(0,0,0,.35); cursor:pointer; }
.submit-btn:disabled { opacity:0.6; cursor:not-allowed; }
.tiny { font-size:12px; color:rgba(255,255,255,.70); margin-top:10px; text-align:center; }
</style>
${sOpen}>
function app(){
return {
    c:${jsonCommon}, db:${jsonDB},
    lang:'${mode}', idx:0,
    isThankYou: false,
    f:{name:"",phone:"",city:"",notes:""}, ui:{loading:false,msg:"",ok:false},
    trackingSpec: (window.MAD_TRACKING_SPEC || null),
    
    get t() { return this.db[this.lang] },
    get dir() { return this.lang=='ar'?'rtl':'ltr' },
    get offerName() { try{ return decodeURIComponent(location.pathname.split("/").pop().replace(".html","")) || "MAD Offer"; }catch(e){ return "MAD Offer"; } },
    
    init(){ 
        ${autoLang}
        if(window.lucide) lucide.createIcons();
        if(this.c.heroes.length>1) setInterval(()=>this.next(),3000);
        
        this.isThankYou = /thank/i.test(location.pathname);
        if(this.isThankYou){ this.fireThankYouPurchaseIfAllowed(); }
    },
    tog(l){ this.lang=l; },
    next(){ this.idx = (this.idx===this.c.heroes.length-1)?0:this.idx+1 },
    prev(){ this.idx = (this.idx===0)?this.c.heroes.length-1:this.idx-1 },
    
    // Pixel & Form Logic
    fireThankYouPurchaseIfAllowed(){
         try{
             if(sessionStorage.getItem(window.MAD_KEYS.ORDER_OK)!=="1") return;
             if(sessionStorage.getItem(window.MAD_KEYS.PURCHASE_LOCK)==="1") return;
             sessionStorage.setItem(window.MAD_KEYS.PURCHASE_LOCK,"1");
             if(typeof fbq!=="undefined") fbq("track","Purchase",{value:500,currency:"ILS"});
             if(typeof ttq!=="undefined") ttq.track("CompletePayment",{value:500,currency:"ILS"});
         }catch(e){}
    },
    trackContact(s){ 
        if(typeof fbq!=="undefined") fbq("track","Contact",{source:s});
        if(typeof ttq!=="undefined") ttq.track("Contact",{source:s});
    },
    async submitOrder(){
        if(this.ui.loading) return;
        if(!this.f.name || !this.f.phone){ this.ui.msg = (this.lang==="he")?"× × ×œ××œ× ×©× ×•×˜×œ×¤×•×Ÿ":"ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ"; return; }
        
        this.ui.loading=true; this.ui.msg="";
        const fd = new FormData();
        fd.append("order_id", "MAD-"+Date.now());
        fd.append("lang", this.lang);
        fd.append("name", this.f.name);
        fd.append("phone", this.f.phone);
        fd.append("city", this.f.city);
        fd.append("notes", this.f.notes);
        fd.append("offer", this.offerName);
        
        try{
            await fetch(this.c.googleScript, {method:"POST", body:fd, mode:"no-cors"});
            window.MAD_MARK_ORDER_SUBMITTED({order_id: "MAD-"+Date.now()});
            this.trackContact("form_submit");
            if(typeof fbq!=="undefined") fbq("track","Lead");
            if(typeof ttq!=="undefined") ttq.track("Lead");
            
            setTimeout(()=>{
                window.location.href = this.c.tyPage + "?ty=1";
            }, 1000);
            
            this.ui.ok=true;
            this.ui.msg = this.t.ok;
        }catch(e){
            this.ui.loading=false;
            this.ui.msg = this.t.fail;
        }
    }
}}
${sClose}
</head>
<body>

<nav class="glass-nav">
    <div class="flex gap-2">
        <button @click="tog('ar')" class="lang-btn-nav" :class="lang=='ar'?'active':''">AR</button>
        <button @click="tog('he')" class="lang-btn-nav" :class="lang=='he'?'active':''">HE</button>
    </div>
    <img :src="c.logo" class="nav-logo" alt="Logo" referrerpolicy="no-referrer">
    <div class="w-8"><i data-lucide="shopping-bag" style="color:white; width:20px;"></i></div>
</nav>

<section class="relative h-screen flex flex-col justify-center items-center text-center px-4">
    ${heroHtml}
    <div class="badge" x-text="t.offer"></div>
    <h1 class="text-6xl font-serif italic mb-6" x-text="t.price"></h1>
    <a href="#shop" class="bg-amber-600 text-black px-8 py-3 rounded-full font-bold" x-text="t.ctaText"></a>
</section>

<section id="shop" class="py-16 px-4 text-center">
    <div class="carousel mb-10">
        <template x-for="(src,i) in c.heroes"><img :src="src" x-show="idx===i" class="c-img" x-transition.opacity referrerpolicy="no-referrer"></template>
        <template x-if="c.heroes.length>1"><div><button class="c-btn" style="left:0" @click="prev"><</button><button class="c-btn" style="right:0" @click="next">></button></div></template>
    </div>

    <div class="space-y-8 max-w-2xl mx-auto mb-10">
        <template x-for="block in c.blocks">
            <div>
                <template x-if="block.type=='text'"><div class="text-gray-300 whitespace-pre-wrap" x-text="block.text[lang]"></div></template>
                <template x-if="block.type=='image'">
                    <div>
                        <img :src="block.val" class="w-full rounded-xl" referrerpolicy="no-referrer">
                        <p class="text-gray-400 text-sm mt-2 font-bold" x-show="block.text && block.text[lang]" x-text="block.text[lang]"></p>
                    </div>
                </template>
                <template x-if="block.type=='video'"><video :src="block.val" controls class="w-full rounded-xl"></video></template>
                <template x-if="block.type=='embed'"><div x-html="block.val"></div></template>
            </div>
        </template>
    </div>

    <template x-if="c.showManifesto">
    <div class="max-w-2xl mx-auto mb-16 text-right">
        <h2 class="text-3xl font-serif italic mb-2 text-white text-center" x-text="t.maniT"></h2>
        <p class="text-gray-400 text-center mb-6 text-sm" x-text="t.maniS"></p>
        <template x-for="item in t.compItems">
            <div class="comp-row"><div class="c-side c-mad"><div class="flex items-center justify-end gap-2 mb-1"><span class="text-[10px] font-bold text-amber-500 uppercase" x-text="t.maniM"></span><i data-lucide="check-circle" class="w-3 h-3 text-amber-500"></i></div><p class="text-white font-bold" x-text="item.mad"></p></div><div class="c-side c-alt"><div class="flex items-center justify-end gap-2 mb-1"><span class="text-[10px] font-bold text-red-400 uppercase" x-text="t.maniO"></span><i data-lucide="x-circle" class="w-3 h-3 text-red-500"></i></div><p class="text-gray-400" x-text="item.local"></p></div></div>
        </template>
    </div>
    </template>

    <template x-if="c.showForm">
        <div class="form-card text-right mb-10">
            <div class="flex items-center justify-between mb-3"><h3 class="font-black text-lg" x-text="t.formTitle"></h3><span class="text-[11px] px-3 py-1 rounded-full bg-black/30 border border-white/10" x-text="offerName"></span></div>
            <form @submit.prevent="submitOrder()" class="grid gap-3">
                <input class="inp" type="text" x-model="f.name" :placeholder="t.name" required>
                <input class="inp" type="tel" x-model="f.phone" :placeholder="t.phone" required>
                <input class="inp" type="text" x-model="f.city" :placeholder="t.city">
                <textarea class="inp" rows="3" x-model="f.notes" :placeholder="t.notes"></textarea>
                <button class="submit-btn" type="submit" :disabled="ui.loading"><span x-show="!ui.loading" x-text="t.submit"></span><span x-show="ui.loading" x-text="t.sending"></span></button>
                <div class="tiny text-center" :class="ui.ok?'text-green-200':'text-rose-200'" x-show="ui.msg" x-text="ui.msg"></div>
            </form>
        </div>
    </template>

    <div class="order-grid">
        <template x-if="c.showWa"><a :href="'https://wa.me/'+c.waNum+'?text='+encodeURIComponent(t.waText)" target="_blank" class="btn-order btn-wa" @click="trackContact('whatsapp')"><i data-lucide="message-circle"></i> <span x-text="t.waLabel"></span></a></template>
        <template x-if="c.showCall"><a :href="'tel:'+c.callNum" class="btn-order btn-call" @click="trackContact('phone')"><i data-lucide="phone"></i> <span x-text="t.callLabel"></span></a></template>
        <template x-if="c.showWeb"><a :href="c.webUrl" target="_blank" class="btn-order btn-web" @click="track('ViewContent')"><i data-lucide="globe"></i> <span x-text="t.webLabel"></span></a></template>
    </div>

    <template x-if="c.showFloatingBtn"><div class="sticky-cta"><a href="#shop" class="sticky-btn" x-text="t.ctaText"></a></div></template>
</section>

<footer class="py-6 text-center text-xs text-gray-600">Â© 2026 MAD PARFUMEUR</footer>
</body></html>`;
    }

    function render() {
        const frame = document.getElementById('preview');
        const doc = frame.contentWindow.document;
        doc.open();
        doc.write(getHTML(false));
        doc.close();
    }

    function download() {
        const link = document.createElement('a');
        link.href = URL.createObjectURL(new Blob([getHTML(true)], {type:'text/html'}));
        link.download = 'mad-landing-page.html';
        link.click();
    }

    // Init
    setMode('ar');
    updateHeroUI();
</script>

</body>
</html>
