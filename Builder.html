<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAD Builder V66 - Professional Bilingual Edition ğŸ›¡ï¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest" defer></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&family=Tajawal:wght@200..900&display=swap');
    [x-cloak] { display:none !important; }
    body { font-family:'Cairo', sans-serif; background:#f1f5f9; height:100vh; overflow:hidden; }
    .app-layout { display:flex; height:100vh; flex-direction:row-reverse; }
    .editor-sidebar { width:450px; background:#fff; border-left:1px solid #cbd5e1; overflow-y:auto; padding:20px; flex-shrink:0; box-shadow:-5px 0 15px rgba(0,0,0,0.05); }
    .preview-area { flex:1; background:#cbd5e1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; overflow: hidden; }
    .iphone { width:375px; height:750px; background:#000; border-radius:45px; border:12px solid #1e293b; overflow:hidden; position:relative; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5); background-color:#fff; transition:transform 0.3s; transform-origin: center; }
    .iphone iframe { width:100%; height:100%; border:none; background:#fff; }
    .section-box { background:#f8fafc; border:1px solid #e2e8f0; border-radius:12px; padding:15px; margin-bottom:15px; }
    .section-title { font-weight:900; font-size:0.85rem; color:#1e293b; margin-bottom:10px; display:flex; align-items:center; gap:5px; text-transform: uppercase; }
    input, textarea, select { width:100%; padding:8px 12px; border:1px solid #cbd5e1; border-radius:8px; font-size:12px; outline:none; transition:0.2s; background: white; color: black; }
    input:focus, textarea:focus { border-color:#3b82f6; box-shadow: 0 0 0 2px rgba(59,130,246,0.1); }
    .btn-grid { display:grid; grid-template-columns:repeat(2, 1fr); gap:8px; }
    .btn-add { background:#fff; border:1px solid #e2e8f0; padding:10px; border-radius:8px; font-size:11px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:5px; transition:0.2s; }
    .btn-add:hover { background:#f1f5f9; border-color:#3b82f6; color:#3b82f6; }
    .btn-action { width:100%; padding:14px; border-radius:12px; font-weight:900; margin-top:10px; cursor:pointer; text-align:center; transition: 0.2s; }
    .zoom-controls { position:fixed; bottom:20px; right:20px; background:rgba(30,41,59,0.9); padding:8px 16px; border-radius:99px; display:flex; gap:15px; color:white; z-index:50; align-items:center; font-size:14px; backdrop-blur: sm; }
  </style>
</head>
<body>

<div class="app-layout" x-data="builderApp()" x-init="init()" x-cloak>
  <aside class="editor-sidebar">
    <div class="flex items-center justify-between mb-6 text-black">
      <h1 class="text-xl font-black text-slate-800 tracking-tighter">MAD <span class="text-rose-500">AE BILINGUAL</span></h1>
      <div class="flex bg-slate-100 p-1 rounded-lg">
        <button @click="editLang='ar'; update()" :class="editLang==='ar'?'bg-white shadow text-black':'text-gray-500'" class="px-3 py-1 rounded text-[10px] font-bold transition">AR</button>
        <button @click="editLang='he'; update()" :class="editLang==='he'?'bg-white shadow text-black':'text-gray-500'" class="px-3 py-1 rounded text-[10px] font-bold transition">HE</button>
      </div>
    </div>

    <!-- Configuration -->
    <div class="section-box border-rose-100 bg-rose-50/30 text-black">
      <span class="section-title text-rose-700">ğŸ’° Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ø¹Ø±</span>
      <div class="flex gap-2">
        <input type="text" x-model="config.productName" @input="update()" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input type="number" x-model="config.price" @input="update()" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="w-1/3">
      </div>
    </div>

    <div class="section-box border-blue-100 bg-blue-50/30 text-black">
      <span class="section-title text-blue-700">ğŸ”— Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
      <input type="text" x-model="config.sheetUrl" class="mb-2 font-mono text-[10px]" placeholder="Ø±Ø§Ø¨Ø· Google Sheet" @input="update()">
      <div class="flex gap-2">
        <input type="text" x-model="config.adminPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯ÙŠØ± 972" class="font-bold" @input="update()">
        <input type="color" x-model="config.bgColor" @input="update()" class="w-12 h-10 p-1 border-0 bg-transparent cursor-pointer">
      </div>
    </div>

    <div class="section-box border-emerald-100 bg-emerald-50/30 text-black">
      <span class="section-title text-emerald-700">ğŸ“Š Ø¨ÙƒØ³Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ (Advanced Match)</span>
      <div class="space-y-2">
        <input type="text" x-model="config.ttPixel" placeholder="TikTok Pixel" @input="update()">
        <input type="text" x-model="config.fbPixel" placeholder="Facebook Pixel" @input="update()">
        <input type="text" x-model="config.snapPixel" placeholder="Snapchat Pixel" @input="update()">
      </div>
    </div>

    <!-- Content Blocks List -->
    <div class="section-box text-black">
      <span class="section-title">ğŸ§± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ§Ù„ØªØ­ÙƒÙ… (ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ)</span>
      <div class="space-y-4 mb-6">
        <template x-for="(block, index) in blocks" :key="block.id">
          <div class="border-2 p-3 rounded-xl relative transition shadow-sm"
               :class="{
                 'bg-blue-50 border-blue-200': block.type === 'text',
                 'bg-slate-50 border-slate-200': ['image','video','iframe','carousel'].includes(block.type),
                 'bg-rose-50 border-rose-200': block.type === 'form',
                 'bg-amber-50 border-amber-200': block.type === 'comparison',
                 'bg-purple-50 border-purple-200': block.type === 'faq',
                 'bg-green-50 border-green-200': block.type === 'fragrantica',
                 'bg-yellow-50 border-yellow-200': block.type === 'interactive_rating'
               }">
            <div class="flex justify-between items-center mb-3">
               <span class="text-[10px] font-black px-2 py-1 rounded uppercase" 
                     :class="{
                       'bg-blue-200 text-blue-800': block.type === 'text',
                       'bg-slate-200 text-slate-800': ['image','video','iframe','carousel'].includes(block.type),
                       'bg-rose-200 text-rose-800': block.type === 'form',
                       'bg-amber-200 text-amber-800': block.type === 'comparison',
                       'bg-purple-200 text-purple-800': block.type === 'faq',
                       'bg-green-200 text-green-800': block.type === 'fragrantica',
                       'bg-yellow-200 text-yellow-800': block.type === 'interactive_rating'
                     }"
                     x-text="block.type"></span>
               <div class="flex gap-2">
                 <button @click="moveBlock(index, -1)" class="text-slate-400 hover:text-blue-500 font-bold">â†‘</button>
                 <button @click="moveBlock(index, 1)" class="text-slate-400 hover:text-blue-500 font-bold">â†“</button>
                 <button @click="removeBlock(index)" class="text-rose-400 hover:text-rose-600 font-bold">âœ•</button>
               </div>
            </div>

            <template x-if="block.type === 'text'">
               <div>
                  <div class="flex items-center gap-2 mb-2">
                     <label class="text-[9px] font-bold">Ù„ÙˆÙ† Ø§Ù„Ù†Øµ:</label>
                     <input type="color" x-model="block.style.color" @input="update()" class="w-8 h-6 p-0 border-0 bg-transparent cursor-pointer">
                  </div>
                  <textarea x-model="block.content[editLang]" @input="update()" class="h-16 text-[11px] font-bold text-black"></textarea>
               </div>
            </template>

            <template x-if="['image','video','iframe'].includes(block.type)">
               <input type="text" x-model="block.url" @input="update()" placeholder="URL" class="text-[11px] text-black">
            </template>

            <template x-if="block.type === 'carousel'">
              <div class="space-y-2">
                <template x-for="(img, iIdx) in (block.images || [])" :key="'carousel-img-'+iIdx">
                   <div class="flex gap-1"><input x-model="block.images[iIdx]" @input="update()" class="text-[10px] flex-1 text-black"><button @click="block.images.splice(iIdx,1); update()" class="text-red-500 font-bold">x</button></div>
                </template>
                <button @click="if(!block.images) block.images=[]; block.images.push(''); update()" class="w-full py-1 text-[9px] bg-slate-600 text-white rounded">+ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
              </div>
            </template>

            <template x-if="block.type === 'form'">
               <p class="text-[10px] text-rose-700 font-bold bg-rose-100 p-2 rounded-lg text-center">Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¨Ø±Ù…Ø¬ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù„ØºØ© âœ…</p>
            </template>

            <template x-if="block.type === 'faq' || block.type === 'comparison'">
              <p class="text-[10px] font-bold p-2 rounded-lg text-center"
                 :class="block.type === 'faq' ? 'text-purple-700 bg-purple-100' : 'text-amber-700 bg-amber-100'">
                 ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 6 Ø¨Ù†ÙˆØ¯ Ù…ØªØ±Ø¬Ù…Ø© Ø¨Ø§Ø­ØªØ±Ø§ÙÙŠØ© âœ…
              </p>
            </template>
          </div>
        </template>
      </div>

      <!-- Toolbar -->
      <div class="btn-grid">
        <button class="btn-add border-blue-500 text-blue-600" @click="addBlock('text')">ğŸ“ MADPERFUME</button>
        <button class="btn-add border-slate-500 text-slate-600" @click="addBlock('image')">ğŸ–¼ï¸ ØµÙˆØ±Ø©</button>
        <button class="btn-add border-slate-900 text-slate-900 font-black" @click="addBlock('carousel')">ğŸ“¸ ÙƒØ±ÙŠØ³ÙˆÙ„Ø© 4Ø«</button>
        <button class="btn-add border-slate-800 text-slate-900" @click="addBlock('video')">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ</button>
        <button class="btn-add border-rose-500 text-rose-600 font-bold" @click="addBlock('form')">ğŸ“‹ Ù†Ù…ÙˆØ°Ø¬ AE</button>
        <button class="btn-add border-amber-500 text-amber-600 font-bold" @click="addBlock('comparison')">âš–ï¸ Ù…Ù‚Ø§Ø±Ù†Ø§Øª MAD</button>
        <button class="btn-add border-purple-500 text-purple-600 font-bold" @click="addBlock('faq')">â“ 6 Ø£Ø³Ø¦Ù„Ø©</button>
        <button class="btn-add border-green-600 text-green-600" @click="addBlock('fragrantica')">ğŸŒ¿ ÙØ±Ø§ØºØ±Ø§Ù†ØªÙŠÙƒØ§</button>
        <button class="btn-add border-yellow-500 text-yellow-600" @click="addBlock('interactive_rating')">â­ ØªÙ‚ÙŠÙŠÙ… ØªÙØ§Ø¹Ù„ÙŠ</button>
      </div>
    </div>

    <button class="btn-action bg-black text-white hover:bg-slate-900 shadow-xl" @click="downloadHTML()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</button>
    <button class="btn-action bg-slate-100 text-slate-700" @click="copyCode()">ğŸ“‹ Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„ØµÙØ­Ø©</button>
  </aside>

  <main class="preview-area">
    <div class="zoom-controls text-white">
      <button @click="zoom = Math.max(0.3, zoom - 0.1)">-</button>
      <span x-text="Math.round(zoom*100)+'%'"></span>
      <button @click="zoom = Math.min(1.2, zoom + 0.1)">+</button>
      <button @click="update()" class="border-r border-white/20 pr-3 mr-1">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
    </div>
    <div class="iphone" :style="`transform: scale(${zoom})`"><iframe id="preview-frame"></iframe></div>
  </main>
</div>

<script>
function builderApp() {
  return {
    editLang: 'ar', zoom: 0.85, timeout: null,
    config: {
      // âœ… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© (ØºØ§Ù…Ù‚ ÙØ®Ù…)
      bgColor: '#0e0302',
      logoUrl: 'https://www.mad-parfumeur.com/assets/hero/logo.png',
      heroTitle: { ar: 'Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­ØµØ±ÙŠØ©', he: '×”××‘×¦×¢×™× ×”×‘×œ×¢×“×™×™× ×‘×™×•×ª×¨' },
      productName: 'big-sale', price: '500', adminPhone: '972509787730',
      sheetUrl: 'https://script.google.com/macros/s/AKfycbw7m6OCcTnH6CILpTo2TVRZIXXy5cui-zhKsCq3k491yaun5Hd5b_QECTjCrpCytkndDg/exec',
      fbPixel: '1072283127290819', ttPixel: 'D2D02JBC77U4ENLN9SBG', snapPixel: 'b143822e-1c3c-40ff-93f7-edadee74e626'
    },
    blocks: [],
    init() { 
      this.addBlock('text'); 
      this.addBlock('carousel');
      this.addBlock('form'); 
      setTimeout(() => this.update(), 500); 
    },
    update() {
      clearTimeout(this.timeout);
      this.timeout = setTimeout(() => {
        const frame = document.getElementById('preview-frame');
        // âœ… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ØªØªØ¨Ø¹ Ù„ØºØ© Ø§Ù„ØªØ­Ø±ÙŠØ± (AR/HE)
        if (frame) frame.srcdoc = this.generateFinalHTML(this.editLang, false);
      }, 300);
    },
    addBlock(type) {
      let b = { 
        id: Date.now() + Math.random(),
        type,
        content:{ ar: 'MAD PERFUME', he: 'MAD PERFUME' }, 
        url: '', align: 'center', btnText: { ar: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨', he: '××™×©×•×¨ ×”×–×× ×”' }, 
        items: [], images: [], score: '4.9 / 5', 
        style: { color: '#ffffff', size: 'text-lg', font: 'Cairo', weight: 'font-bold' } 
      };
      if (type === 'carousel') {
        b.images = ['https://www.mad-parfumeur.com/assets/hero/8.webp', 'https://www.mad-parfumeur.com/assets/hero/2.webp'];
      }
      if (type === 'comparison') {
        b.items = [
          { mad: {ar:'Ø£ØµÙ„ÙŠ ÙˆÙ…Ø¶Ù…ÙˆÙ† 100% Ù…Ø§Ø±ÙƒØ© MAD âœ…',he:'××•×¦×¨ ××§×•×¨×™ ×•××•×‘×˜×— 100% ××‘×™×ª MAD âœ…'}, other: {ar:'Ù…Ù‚Ù„Ø¯ ÙˆÙ…Ø¬Ù‡ÙˆÙ„ Ø§Ù„Ù…ØµØ¯Ø± ÙˆØ¶Ø§Ø± âŒ',he:'××•×¦×¨×™× ××–×•×™×¤×™× ×××§×•×¨ ×œ× ×™×“×•×¢ âŒ'} },
          { mad: {ar:'Ø«Ø¨Ø§Øª Ø¬Ø¨Ø§Ø± ÙŠØªØ¬Ø§ÙˆØ² 48 Ø³Ø§Ø¹Ø© âœ…',he:'×¢××™×“×•×ª ×¢×•×¦××ª×™×ª ××¢×œ 48 ×©×¢×•×ª âœ…'}, other: {ar:'Ø±Ø§Ø¦Ø­Ø© ØªØ®ØªÙÙŠ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚ âŒ',he:'×¨×™×— ×©× ×¢×œ× ×ª×•×š ×“×§×•×ª ×¡×¤×•×¨×•×ª âŒ'} },
          { mad: {ar:'Ø²ÙŠÙˆØª Ù†ÙŠØ´ ÙØ±Ù†Ø³ÙŠØ© ÙØ§Ø®Ø±Ø© Ø¬Ø¯Ø§Ù‹ âœ…',he:'×©×× ×™× ×¦×¨×¤×ª×™×™× ×™×•×§×¨×ª×™×™× âœ…'}, other: {ar:'Ø±Ø§Ø¦Ø­Ø© ÙƒØ­ÙˆÙ„ Ø±Ø®ÙŠØµØ© ÙˆÙ…Ø²Ø¹Ø¬Ø© âŒ',he:'×¨×™×— ××œ×›×•×”×•×œ ×–×•×œ ×•××¦×™×§ âŒ'} },
          { mad: {ar:'Ø¢Ù…Ù† ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆÙ„Ø§ ÙŠØ³Ø¨Ø¨ Ø­Ø³Ø§Ø³ÙŠØ© âœ…',he:'×‘×˜×•×— ×œ×—×œ×•×˜×™×Ÿ ×•×œ× ×’×•×¨× ×œ××œ×¨×’×™×•×ª âœ…'}, other: {ar:'ÙŠØ³Ø¨Ø¨ ØµØ¯Ø§Ø¹ ÙˆØ¶ÙŠÙ‚ ØªÙ†ÙØ³ âŒ',he:'×’×•×¨× ×œ×›××‘×™ ×¨××© ×•×§×•×¦×¨ × ×©×™××” âŒ'} },
          { mad: {ar:'ØªØºÙ„ÙŠÙ ÙØ®Ù… ÙŠÙ„ÙŠÙ‚ Ø¨Ùƒ ÙˆØ¨Ù…Ù‚Ø§Ù…Ùƒ âœ…',he:'××¨×™×–×ª VIP ×™×•×§×¨×ª×™×ª ×©××ª××™××” ×œ×š âœ…'}, other: {ar:'ØªØºÙ„ÙŠÙ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙˆØ´ØºÙ„ Ø´ÙˆØ§Ø±Ø¹ âŒ',he:'××¨×™×–×” ×¤×©×•×˜×” ×•×–×•×œ×” âŒ'} },
          { mad: {ar:'Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆØ®Ø¯Ù…Ø© Ø²Ø¨Ø§Ø¦Ù† âœ…',he:'××—×¨×™×•×ª ×”×—×œ×¤×” ×××™×ª×™×ª ×•×©×™×¨×•×ª ×œ×§×•×—×•×ª âœ…'}, other: {ar:'Ø¨ØªØ´ØªØ±ÙŠ ÙˆØ¨ØªØªÙˆÙ‡ ÙˆÙ…Ø§ Ø­Ø¯ Ø¨Ø±Ø¯ Ø¹Ù„ÙŠÙƒ âŒ',he:'×§×•× ×™× ×•× ×ª×§×¢×™×, ××™×Ÿ ××¢× ×” âŒ'} }
        ];
      }
      if (type === 'faq') {
        b.items = [
          { q: {ar:'Ù‡Ù„ Ø§Ù„Ø¹Ø·ÙˆØ± Ø£ØµÙ„ÙŠØ©ØŸ',he:'×”×× ×”×‘×©××™× ××§×•×¨×™×™×?'}, a: {ar:'Ù†Ø¹Ù…ØŒ Ø¬Ù…ÙŠØ¹ Ø¹Ø·ÙˆØ±Ù†Ø§ Ø£ØµÙ„ÙŠØ© 100% ÙˆÙ…ØµØ§Ø¯Ù‚ Ø¹Ù„ÙŠÙ‡Ø§.',he:'×›×Ÿ, ×›×œ ×”×‘×©××™× ×©×œ× ×• ××§×•×¨×™×™× 100% ×•×××•×©×¨×™× Ø¹Ù„Ù‰ ×™×“×™ ××©×¨×“ ×”×‘×¨×™××•×ª.'} },
          { q: {ar:'ÙƒÙ… ØªØ³ØªØºØ±Ù‚ Ù…Ø¯Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ØŸ',he:'×›××” ×–××Ÿ ×œ×•×§×— ×”××©×œ×•×—?'}, a: {ar:'Ø®Ù„Ø§Ù„ 2-3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚.',he:'××¡×¤×§×” ××”×™×¨×” ×ª×•×š 2-3 ×™××™ ×¢×¡×§×™× ×œ×›×œ ×”××¨×¥.'} },
          { q: {ar:'Ù‡Ù„ Ø§Ù„Ø±Ø§Ø¦Ø­Ø© Ø«Ø§Ø¨ØªØ©ØŸ',he:'×”×× ×”×¨×™×— × ×©××¨ ×œ××•×¨×š ×–××Ÿ?'}, a: {ar:'Ù†Ø¹Ù…ØŒ ØªØ±ÙƒÙŠØ² Ù†ÙŠØ´ ÙŠØ¶Ù…Ù† Ø«Ø¨Ø§ØªØ§Ù‹ ÙŠØªØ¬Ø§ÙˆØ² 24 Ø³Ø§Ø¹Ø©.',he:'×‘×”×—×œ×˜, ×¨×™×›×•×– ×”×‘×©××™× ×’×‘×•×” ×××•×“ (× ×™×©×”) ×œ×”×‘×˜×—×ª ×¢××™×“×•×ª ××¢×œ 24 ×©×¢×•×ª.'} },
          { q: {ar:'Ù‡Ù„ ÙŠØªÙˆÙØ± Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…ØŸ',he:'×™×© ××¤×©×¨×•×ª ×œ×ª×©×œ×•× ×‘××–×•××Ÿ?'}, a: {ar:'Ù†Ø¹Ù…ØŒ Ù†ÙˆÙØ± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.',he:'×›×Ÿ, ×× ×• ××¦×™×¢×™× ×ª×©×œ×•× ×‘××–×•××Ÿ ×‘×¢×ª ××¡×™×¨×ª ×”×”×–×× ×”.'} },
          { q: {ar:'Ø£ÙŠÙ† ØªÙ‚Ø¹ ÙØ±ÙˆØ¹ÙƒÙ…ØŸ',he:'××™×¤×” × ××¦××™× ×”×¡× ×™×¤×™× ×©×œ×›×?'}, a: {ar:'Ù„Ø¯ÙŠÙ†Ø§ Ø£ÙƒØ«Ø± Ù…Ù† 40 ÙØ±Ø¹ ÙÙŠ ÙƒØ§ÙØ© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚.',he:'×™×© ×œ× ×• ××¢×œ 40 ×¡× ×™×¤×™× ×”×¤×¨×•×¡×™× ×‘×›×œ ×¨×—×‘×™ ×”××¨×¥ ×œ×©×™×¨×•×ª×›×.'} },
          { q: {ar:'Ù…Ø§Ø°Ø§ Ù„Ùˆ Ù„Ù… ÙŠØ¹Ø¬Ø¨Ù†ÙŠ Ø§Ù„Ø¹Ø·Ø±ØŸ',he:'××” ×× ×œ× ××”×‘×ª×™ ××ª ×”×‘×•×©×?'}, a: {ar:'Ù†Ø­Ù† Ù†Ø¶Ù…Ù† Ø±Ø¶Ø§Ùƒ Ø¨Ø³ÙŠØ§Ø³Ø© Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ø±Ù†Ø©.',he:'×× ×—× ×• ××‘×˜×™×—×™× ×©×‘×™×¢×•×ª ×¨×¦×•×Ÿ ××œ××”, × ×™×ª×Ÿ ×œ×”×—×œ×™×£ ××ª ×”×‘×•×©× ×‘×§×œ×•×ª.'} }
        ];
      }
      this.blocks.push(b); this.update();
    },
    removeBlock(i) { this.blocks.splice(i, 1); this.update(); },
    moveBlock(i, d) {
      const ni = i + d;
      if (ni >= 0 && ni < this.blocks.length) { [this.blocks[i], this.blocks[ni]] = [this.blocks[ni], this.blocks[i]]; this.update(); }
    },
    async copyCode() {
      // âœ… Ø§Ù„Ù†Ø³Ø®: Ù…Ù„Ù Ù†Ù‡Ø§Ø¦ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ù„ØºØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const html = this.generateFinalHTML(null, true);
      try { await navigator.clipboard.writeText(html); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!'); } 
      catch (err) { const t = document.createElement("textarea"); t.value = html; document.body.appendChild(t); t.select(); document.execCommand('copy'); document.body.removeChild(t); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!'); }
    },
    downloadHTML() {
      // âœ… Ø§Ù„ØªØ­Ù…ÙŠÙ„: Ù…Ù„Ù Ù†Ù‡Ø§Ø¦ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ù„ØºØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const html = this.generateFinalHTML(null, true);
      const blob = new Blob([html], { type: 'text/html' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'MAD_Landing_Final.html'; a.click();
    },
    generateFinalHTML(forcedLang=null, forExport=false) {
      const bStr = JSON.stringify(this.blocks).replace(/</g, '\\u003c');
      const cStr = JSON.stringify(this.config).replace(/</g, '\\u003c');
      const initArg = forcedLang ? `'${forcedLang}'` : 'null';

      return `<!DOCTYPE html>
<html x-data="app()" x-init="init(${initArg})" :lang="lang" :dir="lang==='he'?'ltr':'rtl'">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"><\/script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer><\/script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;900&display=swap" rel="stylesheet">
  <style>
    body {
      background:
        radial-gradient(900px circle at 50% -200px, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(700px circle at 10% 40%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.15) 45%, rgba(0,0,0,.85)),
        ${this.config.bgColor};
      font-family: 'Cairo', sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
      color: #fff;
    }

    .inp { width: 100%; padding: 15px; background: #f8fafc; border: 1px solid #ddd; border-radius: 12px; margin-bottom: 10px; font-weight: bold; text-align: center; color: black; }

    /* âœ… Ø²Ø± Ø§Ù„Ø·Ù„Ø¨ Ø£Ø®Ø¶Ø± */
    .btn-main { background: #10b981; color: #fff; width: 100%; padding: 18px; border-radius: 14px; font-weight: 900; font-size: 1.2rem; animation: pulse 2s infinite; cursor: pointer; border:none; box-shadow: 0 6px 18px rgba(16,185,129,0.35); }
    .btn-main:hover { filter: brightness(1.05); }
    .btn-main:active { transform: scale(0.99); }

    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    .progress-container { margin-bottom: 15px; }
    .progress-track { height: 6px; background: rgba(0,0,0,0.1); border-radius: 99px; overflow: hidden; }
    .progress-fill { height: 100%; background: #10b981; width: 85%; }
    .mad-radio-box { border: 2px solid #e5e7eb; border-radius: 12px; padding: 12px; text-align: center; background: white; font-weight: 700; cursor: pointer; transition: 0.2s; color: black; }
    input:checked + .mad-radio-box { border-color: #10b981; background: #f0fdf4; color: #047857; transform: scale(1.02); }
    .recommended::after { content: 'â˜…'; position: absolute; top: -8px; right: -8px; background: #10b981; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; display: flex; align-items: center; justify-content: center; }
  </style>
  <script>
    function formatE164(p) { if(!p) return ''; let d = String(p).replace(/[^0-9]/g, ''); if(d.startsWith('05') && d.length === 10) d = '972' + d.slice(1); if(d.startsWith('00')) d = d.slice(2); return '+' + d; }

    function loadPixels(cfg) {
      if(window._px_f) return; window._px_f = true;
      if(cfg.fbPixel) { !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)n=f.fbq;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'); fbq('init', cfg.fbPixel); fbq('track', 'PageView'); }
      if(cfg.ttPixel) { !function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"];ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{};ttq._i[e]=[];ttq._i[e]._u=r;ttq._t=ttq._t||{};ttq._t[e]=+new Date;ttq._o=ttq._o||{};ttq._o[e]=n||{};var o=document.createElement("script");o.type="text/javascript";o.async=!0;o.src=r+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};ttq.load(cfg.ttPixel);ttq.page();}(window,document,'ttq'); }
      if(cfg.snapPixel) { (function(e,t,n){if(e.snaptr)return;var a=e.snaptr=function(){a.handleRequest?a.handleRequest.apply(a,arguments):a.queue.push(arguments)};a.queue=[];var s='script';var r=t.createElement(s);r.async=!0;r.src=n;var u=t.getElementsByTagName(s)[0];u.parentNode.insertBefore(r,u)})(window,document,'https://sc-static.net/scevent.min.js'); snaptr('init', cfg.snapPixel); snaptr('track', 'PAGE_VIEW'); }
    }
  <\/script>
</head>
<body class="pb-20">
  <nav class="p-4 flex justify-center bg-white/15 backdrop-blur sticky top-0 z-50 border-b border-white/10"><img src="${this.config.logoUrl}" class="h-10 object-contain"></nav>
  <header class="text-center py-8 px-4 text-white"><h1 class="text-3xl font-black" x-text="c.heroTitle[lang]"></h1></header>

  <main class="max-w-md mx-auto">
    <template x-for="(b, idx) in (blocks || [])" :key="b.id">
      <div class="my-6 px-4" :class="b.type==='carousel'?'!px-0':'px-4'">
        <template x-if="b.type==='text'"><p class="whitespace-pre-wrap leading-relaxed font-black text-center" :style="{ color: b.style.color || '#fff', fontSize: '1.25rem' }" x-text="b.content[lang]"></p></template>
        <template x-if="b.type==='image'"><img :src="b.url" class="rounded-2xl mx-auto shadow-lg w-full"></template>
        <template x-if="b.type==='video'"><video :src="b.url" controls class="w-full rounded-2xl shadow-lg"></video></template>
        
        <template x-if="b.type==='carousel'">
          <div class="relative w-full overflow-hidden" x-data="{ curr: 0, total: b.images.length }" x-init="if(total>1) setInterval(()=>{curr=(curr+1)%total}, 4000)">
            <div class="flex transition-transform duration-700 ease-in-out" :style="'transform: translateX(' + (lang === 'he' ? (curr * -100) : (curr * 100)) + '%)'">
               <template x-for="(img, i) in b.images" :key="'ci-'+i"><div class="min-w-full w-full"><img :src="img" class="w-full object-cover shadow-xl"></div></template>
            </div>
            <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2" x-show="total > 1">
               <template x-for="(img, i) in b.images" :key="'ind-'+i"><div class="w-2 h-2 rounded-full transition-all duration-300" :class="curr === i ? 'bg-white w-6' : 'bg-white/40'"></div></template>
            </div>
          </div>
        </template>

<!-- âœ… Ù‚Ø³Ù… ÙØ±Ø§ØºØ±Ø§Ù†ØªÙŠÙƒØ§ (ÙƒØ§Ù…Ù„) -->
<template x-if="b.type==='fragrantica'">
  <a :href="b.url" target="_blank"
     class="block w-full max-w-[320px] bg-[#3f5a31] text-white p-5 rounded-[24px] shadow-xl relative overflow-hidden mx-auto no-underline text-right mt-4">

    <div class="flex justify-between items-center mb-3">
      <span class="text-[10px] font-black uppercase tracking-widest text-white/60"
            x-text="lang==='he' ? '×‘×™×§×•×¨×•×ª' : 'REVIEWS'"></span>

      <div class="flex text-amber-400 gap-0.5">
        <template x-for="i in 5">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
        </template>
      </div>
    </div>

    <div class="flex items-end gap-2">
      <span class="text-4xl font-black" x-text="b.score || '4.9 / 5'"></span>
      <span class="text-xs opacity-60 mb-1" x-text="lang==='he' ? '×“×™×¨×•×’' : 'Rating'"></span>
    </div>

    <p class="text-[11px] font-black text-white/90 mt-1"
       x-text="lang==='he' ? '×“×™×¨×•×’ ×œ×§×•×—×•×ª ×©× ×™×¡×• ×œ×¤× ×™×š' : 'ØªÙ‚ÙŠÙŠÙ… Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø±Ù‘Ø¨ÙˆØ§ Ø§Ù„Ø¹Ø·Ø± Ù‚Ø¨Ù„ÙÙƒ'"></p>

    <p class="text-[10px] font-bold mt-2 text-white/80"
       x-text="b.content && b.content[lang] ? b.content[lang] : (lang==='he' ? '××‘×•×¡×¡ ×¢×œ ×‘×™×§×•×¨×•×ª ×œ×§×•×—×•×ª ×××™×ª×™×•×ª' : 'Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¹Ù…Ù„Ø§Ø¡ Ø­Ù‚ÙŠÙ‚ÙŠÙŠÙ†')"></p>
  </a>
</template>

<!-- âœ… ØªÙ‚ÙŠÙŠÙ… ØªÙØ§Ø¹Ù„ÙŠ + Ø¹Ù†ÙˆØ§Ù† ÙÙˆÙ‚ Ø§Ù„Ù†Ø¬ÙˆÙ… (Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø©) -->
<template x-if="b.type==='interactive_rating'">
  <div class="bg-white border-2 border-amber-100 rounded-2xl p-5 shadow-sm text-center mt-4" x-data="{ r: 0 }">
    <div class="flex items-center justify-center gap-2 mb-3">
      <span class="text-amber-500 text-xl">â˜…</span>
      <h3 class="text-[18px] font-black text-slate-900" x-text="b.content && b.content[lang] ? b.content[lang] : (lang==='he' ? '× ×™×¡×™×ª ××ª ×”×‘×•×©×? ×“×¨×’ ××•×ª× ×•' : 'Ø¬Ø±Ù‘Ø¨Øª Ø§Ù„Ø¹Ø·Ø±ØŸ Ù‚ÙŠÙ‘Ù…Ù†Ø§')"></h3>
    </div>

    <div class="flex justify-center gap-2 mb-2" x-show="r===0">
      <template x-for="i in 5">
        <button @click="r=i" class="text-3xl text-gray-200 hover:text-amber-400 transition">â˜…</button>
      </template>
    </div>

    <div x-show="r>0" class="text-emerald-600 font-bold mt-2">
      <p class="text-sm" x-text="lang==='he' ? '×ª×•×“×” ×¨×‘×” ×¢×œ ×”×“×™×¨×•×’!' : 'Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ! â­'"></p>
    </div>
  </div>
</template>

        <template x-if="b.type==='comparison'">
          <div class="mt-4">
            <div class="grid grid-cols-2 gap-1 mb-2 px-1 text-right">
              <div class="text-center font-black text-white text-[10px] uppercase bg-black/20 py-1 rounded-t-lg">MAD</div>
              <div class="text-center font-black text-white/70 text-[10px] uppercase bg-black/10 py-1 rounded-t-lg" x-text="lang==='he'?'××—×¨×™×':'Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†'"></div>
            </div>
            <div class="space-y-2 text-right"><template x-for="(row, rIdx) in b.items" :key="'c-'+rIdx"><div class="grid grid-cols-2 gap-1 rounded-xl overflow-hidden shadow-sm"><div class="bg-amber-50 p-4 border-r border-amber-100 text-center font-bold text-[11px] text-black" x-text="row.mad[lang]"></div><div class="bg-white p-4 text-center text-gray-400 text-[11px]" x-text="row.other[lang]"></div></div></template></div>
          </div>
        </template>

        <template x-if="b.type==='faq'"><div class="bg-white rounded-2xl p-4 shadow-sm space-y-2 text-right mt-4"><template x-for="(qa, qIdx) in b.items" :key="'f-'+qIdx"><div class="border-b last:border-0 pb-2" x-data="{open:false}"><button @click="open=!open" class="w-full flex justify-between font-bold text-sm text-gray-800"><span x-text="qa.q[lang]"></span><span x-text="open?'-':'+'"></span></button><p x-show="open" class="text-xs text-gray-500 mt-1 leading-relaxed" x-text="qa.a[lang]"></p></div></template></div></template>

        <template x-if="b.type==='form'">
<div class="bg-white p-6 rounded-[24px] shadow-sm text-right border-2 border-gray-100 mt-4" id="order">

  <div class="flex gap-2 mb-4">
    <div class="flex-1 rounded-full py-2 text-center text-[12px] font-black bg-slate-100 text-slate-600 border border-slate-200"
         x-text="lang==='he' ? '××—×¨×™×•×ª ×”×—×œ×¤×”' : 'Ø¶Ù…Ø§Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„'"></div>

    <div class="flex-1 rounded-full py-2 text-center text-[12px] font-black bg-amber-100 text-amber-700 border border-amber-200"
         x-text="lang==='he' ? '××©×œ×•×— ××”×™×¨' : 'ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹'"></div>

    <div class="flex-1 rounded-full py-2 text-center text-[12px] font-black bg-emerald-100 text-emerald-700 border border-emerald-200"
         x-text="lang==='he' ? '×ª×©×œ×•× ×‘××©×œ×•×—' : 'Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…'"></div>
  </div>

  <div class="progress-container">
    <div class="progress-text flex justify-between text-[10px] font-bold mb-1 text-gray-400">
      <span x-text="lang==='he'?'×¤×¨×˜×™ ××©×œ×•×—':'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†'"></span>
      <span x-text="lang==='he'?'×©×œ×‘ ××—×¨×•×Ÿ':'Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©'"></span>
    </div>
    <div class="progress-track"><div class="progress-fill"></div></div>
  </div>

  <h2 class="text-xl font-black text-center mb-4 text-gray-800" x-text="lang==='he'?'×”×–××™× ×• ×¢×›×©×™×•':'Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†'"></h2>
  <form @submit.prevent="submitForm">
    <input type="text" x-model="f.name" @input="trackInput()" class="inp" :placeholder="lang==='he'?'×©× ××œ×':'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„'" required>
    <input type="tel" x-model="f.phone" @input="trackInput()" class="inp" :placeholder="lang==='he'?'×˜×œ×¤×•×Ÿ':'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'" dir="ltr" required>
    <input type="text" x-model="f.address" class="inp" :placeholder="lang==='he'?'×›×ª×•×‘×ª ××œ××”':'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„'" required>
    <div class="grid grid-cols-2 gap-3 mb-4">
      <label class="cursor-pointer"><input type="radio" x-model="f.payment" value="Cash" class="hidden"><div class="mad-radio-box recommended"><span x-text="lang==='he'?'××–×•××Ÿ ğŸ’µ':'Ù†Ù‚Ø¯ ğŸ’µ'"></span><div class="text-[9px] text-green-600 font-normal" x-text="lang==='he'?'××•××œ×¥':'Ù…ÙˆØµÙ‰ Ø¨Ù‡'"></div></div></label>
      <label class="cursor-pointer"><input type="radio" x-model="f.payment" value="Visa" class="hidden"><div class="mad-radio-box"><span x-text="lang==='he'?'××©×¨××™ ğŸ’³':'ÙÙŠØ²Ø§ ğŸ’³'"></span></div></label>
    </div>
    <div class="grid grid-cols-2 gap-3 mb-6">
      <label class="cursor-pointer"><input type="radio" x-model="f.process" value="Direct" class="hidden"><div class="mad-radio-box recommended"><span class="text-xs" x-text="lang==='he'?'×©×œ×— ×”×–×× ×”':'Ø§Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨'"></span><div class="text-[9px] text-blue-600 font-normal" x-text="lang==='he'?'×”×›×™ ××”×™×¨':'ğŸš€ Ø£Ø³Ø±Ø¹'"></div></div></label>
      <label class="cursor-pointer"><input type="radio" x-model="f.process" value="Contact" class="hidden"><div class="mad-radio-box"><span class="text-xs" x-text="lang==='he'?'×¦×•×¨ ××™×ª×™ ×§×©×¨':'ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ'"></span></div></label>
    </div>
    <button type="submit" class="btn-main mt-2 w-full" x-text="loading?'...':(lang==='he'?'××™×©×•×¨ ×”×–×× ×”':'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨')" :disabled="loading"></button>
  </form>
</div>
        </template>
      </div>
    </template>
  </main>

  <div x-show="loading" class="fixed inset-0 z-50 bg-black/90 flex flex-col items-center justify-center text-white" style="display:none">
    <div class="text-5xl mb-4 animate-bounce">ğŸš€</div>
    <h2 class="text-xl font-bold" x-text="lang==='he'?'×©×•×œ×— ×”×–×× ×”...':'ÙŠØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...'"></h2>
  </div>

  <div x-show="submitted" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center text-center text-white" style="display:none">
    <div class="bg-white text-black p-10 rounded-3xl max-w-xs shadow-2xl mx-4">
      <div class="text-6xl mb-4">âœ…</div>
      <h3 class="text-2xl font-black mb-2" x-text="lang==='he'?'×”×”×–×× ×” ×”×ª×§×‘×œ×”!':'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!'"></h3>
      <p class="font-bold text-gray-600 mb-6" x-text="lang==='he'?'×”×”×–×× ×” ×‘×•×¦×¢×” ×‘×”×¦×œ×”! × ×©×œ×— ×œ×š ×”×•×“×¢×ª ×•×•××˜×¡××¤ ×‘×§×¨×•×‘. ×”××¡×¤×§×” ×ª×•×š 5 ×™××™ ×¢×¡×§×™×.':'ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ØŒ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„'"></p>
      <button @click="submitted=false" class="w-full bg-black text-white py-4 rounded-xl font-bold mt-4 transition active:scale-95" x-text="lang==='he'?'×¡×’×•×¨':'Ø¥ØºÙ„Ø§Ù‚'"></button>
    </div>
  </div>

<script>
function app() {
  return {
    lang: 'ar', loading: false, submitted: false,
    blocks: ${bStr}, c: ${cStr}, f: {name:'', phone:'', address:'', payment:'Cash', process:'Direct'},
    time: 900, hasStartedTyping: false,
    get timer() { const m=Math.floor(this.time/60); const s=this.time%60; return \`\${m}:\${s<10?'0':''}\${s}\`; },

    // âœ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ù„ØºØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… + ÙŠØ¯Ø¹Ù… ?lang=he Ø£Ùˆ ?lang=ar
    init(forcedLang) {
      const qs = new URLSearchParams(window.location.search);
      const urlLang = qs.get('lang');
      const autoLang = navigator.language.startsWith('he') ? 'he' : 'ar';
      this.lang = forcedLang || ((urlLang==='he'||urlLang==='ar') ? urlLang : autoLang);

      loadPixels(this.c);
      setInterval(()=>{if(this.time>0) this.time--}, 1000);
    },

    trackInput() { if(!this.hasStartedTyping && this.f.name.length>2){ this.hasStartedTyping=true; this.track('AddToCart'); } },
    track(ev) {
      const cfg = this.c; let ph = formatE164(this.f.phone);
      if(window.ttq){ if(ph.length>=10) ttq.identify({phone_number:ph, name:this.f.name}); ttq.track(ev==='AddToCart'?'AddToCart':'CompletePayment', {content_id:cfg.productName, value:Number(cfg.price), currency:'ILS', content_type:'product'}); }
      if(window.fbq) fbq('track', ev, {value:Number(cfg.price), currency:'ILS', content_ids:[cfg.productName], content_type:'product'});
      if(window.snaptr) { if(ph.length>=10) snaptr('init', cfg.snapPixel, {user_phone_number:ph}); if(ev==='AddToCart') snaptr('track','ADD_CART',{item_ids:[cfg.productName]}); if(ev==='Purchase') snaptr('track','PURCHASE',{currency:'ILS', price:Number(cfg.price)}); }
    },
    async submitForm() {
      this.loading = true; 
      this.track('Purchase');

      const cfg = this.c;
      let fd = new FormData();
      Object.keys(this.f).forEach(k => fd.append(k, this.f[k]));

      fd.append('offer', cfg.productName);
      fd.append('price', cfg.price);
      fd.append('lang', this.lang);

      try {
        await fetch(cfg.sheetUrl, { method: 'POST', body: fd, mode: 'no-cors' });
        this.submitted = true;
      } catch (e) {
        alert('Error');
      } finally {
        this.loading = false;
      }
    }
  }
}
<\/script>
</body>
</html>`;
    }   // âœ… Ù†Ù‡Ø§ÙŠØ© generateFinalHTML
  }     // âœ… Ù†Ù‡Ø§ÙŠØ© return object
}       // âœ… Ù†Ù‡Ø§ÙŠØ© builderApp()
</script>
</body>
</html>
