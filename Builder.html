<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD Builder - Full Manifesto Edition</title>
    <style>
        :root { --primary: #d4af37; --bg: #0f172a; --panel: #1e293b; --text: #f1f5f9; --border: #334155; --danger: #ef4444; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        
        .main-layout { display: flex; height: 100vh; flex-direction: row-reverse; }
        .preview-pane { flex: 1; background: #020617; display: flex; justify-content: center; align-items: center; border-right: 1px solid var(--border); padding: 20px; overflow: hidden; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; }
        .editor-pane { width: 550px; background: var(--panel); padding: 30px; overflow-y: auto; box-shadow: -5px 0 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 20px; }

        .iphone-mockup { width: 375px; height: 812px; background: #000; border-radius: 40px; border: 12px solid #2d2d2d; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; transform: scale(0.8); flex-shrink: 0; }
        .iphone-notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #2d2d2d; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; z-index: 100; }
        .iphone-screen { width: 100%; height: 100%; background: #0b0b0b; border: none; display: block; overflow-y: auto; }

        @media (max-width: 768px) {
            .main-layout { flex-direction: column; height: auto; overflow: auto; }
            .preview-pane { display: none; }
            .editor-pane { width: 100%; height: auto; box-shadow: none; }
            body { overflow: auto; }
        }

        h1 { color: var(--primary); margin: 0 0 10px 0; font-size: 1.5rem; text-align: center; }
        h2 { font-size: 1rem; color: #94a3b8; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 25px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; margin-bottom: 5px; color: #cbd5e1; }
        input[type="text"], textarea, select { width: 100%; padding: 10px; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 6px; box-sizing: border-box; outline: none; font-size: 0.9rem; }
        input[type="color"] { width: 100%; height: 40px; border: none; padding: 0; cursor: pointer; border-radius: 6px; background: transparent; }
        
        .block-item { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .block-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; color: var(--primary); font-weight: bold; font-size: 0.8rem; }
        .btn-delete { background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; }
        
        .mani-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 10px; }
        .mani-inputs { display: grid; gap: 8px; margin-top: 8px; }
        .btn-action { background: var(--primary); color: #000; font-weight: 900; padding: 15px; border-radius: 8px; border: none; cursor: pointer; width: 100%; font-size: 1.1rem; margin-top: 20px; transition: 0.2s; }
        .btn-add { background: #334155; color: white; border: 1px solid var(--border); padding: 10px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; flex: 1; transition: 0.2s; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="editor-pane">
        <h1>MAD Builder PRO ğŸ’</h1>
        
        <div class="form-group">
            <label>Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙØ¹Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</label>
            <select id="langSelect" onchange="setMode(this.value)">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (AR)</option>
                <option value="he">×¢×‘×¨×™×ª (HE)</option>
            </select>
        </div>

        <h2>ğŸ¨ Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="form-group"><label>Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©</label><input type="color" id="clr-bgBody" oninput="updateDesign('bgBody', this.value)"></div>
            <div class="form-group"><label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label><input type="color" id="clr-primary" oninput="updateDesign('primary', this.value)"></div>
        </div>

        <h2>ğŸ›ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
        <div class="form-group"><label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±</label><input type="text" id="logo" oninput="updateCommon('logo', this.value)"></div>
        <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label><input type="text" id="title" oninput="updateData('title', this.value)"></div>
        <div class="form-group"><label>Ù†Øµ Ø§Ù„Ø´Ø§Ø±Ø© (Badge)</label><input type="text" id="badge" oninput="updateData('badge', this.value)"></div>
        <div class="form-group">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label>Ø§Ù„Ø³Ø¹Ø±</label><input type="text" id="price" oninput="updateData('price', this.value)"></div>
                <div><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…</label><input type="text" id="old" oninput="updateData('old', this.value)"></div>
            </div>
        </div>
        <div class="form-group"><label>Ø§Ù„ÙˆØµÙ</label><textarea id="desc" oninput="updateData('desc', this.value)" rows="2"></textarea></div>
        <div class="form-group"><label>Ø§Ù„Ù†ÙˆØªØ§Øª (HTML)</label><textarea id="notes" oninput="updateData('notes', this.value)" rows="3"></textarea></div>

        <h2>âš–ï¸ Ù‚Ø³Ù… Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Manifesto)</h2>
        <div class="form-group">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ (MAD)</label><input type="text" id="maniHeaderMad" oninput="updateData('maniHeaderMad', this.value)"></div>
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù†ÙŠ</label><input type="text" id="maniHeaderOthers" oninput="updateData('maniHeaderOthers', this.value)"></div>
            </div>
        </div>
        <div id="maniItemsContainer"></div>
        <button class="btn-add" onclick="addManiItem()">+ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù…Ù‚Ø§Ø±Ù†Ø©</button>

        <h2>ğŸ§© Ø§Ù„Ø¹Ù†Ø§ØµØ± (ØµÙˆØ± / ÙÙŠØ¯ÙŠÙˆ)</h2>
        <div id="blocksContainer"></div>
        <div style="display:flex; gap:5px;">
            <button class="btn-add" onclick="addBlock('carousel')">+ ÙƒØ±Ø³ÙˆÙ„</button>
            <button class="btn-add" onclick="addBlock('video')">+ ÙÙŠØ¯ÙŠÙˆ</button>
            <button class="btn-add" onclick="addBlock('text')">+ Ù†Øµ</button>
        </div>

        <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ‚Ù†ÙŠØ© ÙˆØªØªØ¨Ø¹</h2>
        <div class="form-group"><label>Ø±Ø§Ø¨Ø· Ø³ÙƒØ±Ø¨Øª Ø¬ÙˆØ¬Ù„</label><input type="text" id="googleScript" oninput="updateCommon('googleScript', this.value)"></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="form-group"><label>Facebook Pixel ID</label><input type="text" id="fbPixel" oninput="updateCommon('fb', this.value)"></div>
            <div class="form-group"><label>TikTok Pixel ID</label><input type="text" id="ttPixel" oninput="updateCommon('tt', this.value)"></div>
        </div>

        <button class="btn-action" onclick="download()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ğŸ“¥</button>
    </div>

    <div class="preview-pane">
        <div class="iphone-mockup">
            <div class="iphone-notch"></div>
            <iframe id="preview" class="iphone-screen"></iframe>
        </div>
    </div>
</div>

<script>
    let mode = 'ar';
    const design = { bgBody: "#0b0b0b", primary: "#d4af37", bgForm: "#161616", btnBg: "#d4af37", btnText: "#000000" };
    
    const common = {
        logo: "https://abomkdad.github.io/Digital-Business-Card/logo.png",
        googleScript: "https://script.google.com/macros/s/AKfycbyx0rxHpN9Csv2OV_9D_EIF_pqMlNEmF2rDi_s7ZFo6feB7r9Ohb2eHuxEM4gGfDuLu/exec",
        fb: "1072283127290819", tt: "D2D02JBC77U4ENLN9SBG",
        maniItems: [
            { id: 1, icon: 'shield-check', labelAr:'Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØªØ±Ø§Ø®ÙŠØµ Ø§Ù„ØµØ­Ø©', labelHe:'×‘×˜×™×—×•×ª ×•×¨×™×©×™×•× ×•×ª ×‘×¨×™××•×ª', madAr:'Ø¢Ù…Ù†Ø© 100%ØŒ Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† IFRA ÙˆÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©ØŒ Ø®Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„ÙƒØ­ÙˆÙ„ Ø§Ù„Ø¶Ø§Ø±.', madHe:'×‘×˜×•×— ×‘-100%, ×××•×©×¨ ×¢"×™ IFRA ×•××©×¨×“ ×”×‘×¨×™××•×ª, ×œ×œ× ××œ×›×•×”×•×œ ××–×™×§.', localAr:'Ø²ÙŠÙˆØª ØµÙ†Ø§Ø¹ÙŠØ© Ù…Ø¬Ù‡ÙˆÙ„Ø© Ø§Ù„Ù…ØµØ¯Ø± Ù…Ù† Ø¯Ø¨ÙŠ/ØªØ±ÙƒÙŠØ§ ØªØ³Ø¨Ø¨ Ø­Ø³Ø§Ø³ÙŠØ© ÙˆØªÙ‡ÙŠØ¬.', localHe:'×©×× ×™× ×¡×™× ×ª×˜×™×™× ×××§×•×¨ ×œ× ×™×“×•×¢ ×”×’×•×¨××™× ×œ××œ×¨×’×™×” ×•×’×™×¨×•×™.' },
            { id: 2, icon: 'flask-conical', labelAr:'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹Ø·Ø±ÙŠØ© (Ø§Ù„ØªØµÙ†ÙŠØ¹)', labelHe:'×”× ×“×¡×ª × ×™×—×•×— (×™×™×¦×•×¨)', madAr:'ØªØ·Ø§Ø¨Ù‚ Ø¬Ø²ÙŠØ¦ÙŠ Ø¯Ù‚ÙŠÙ‚ ÙˆØªØ¹ØªÙŠÙ‚ (Maceration) Ù„Ø£Ø´Ù‡Ø± Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ¬Ø§Ù†Ø³.', madHe:'×”×ª×××” ××•×œ×§×•×œ×¨×™×ª ××“×•×™×§×ª ×•×™×™×©×•×Ÿ (Maceration) ×©×œ ×—×•×“×©×™× ×œ×”×‘×˜×—×ª ××—×™×“×•×ª.', localAr:'Ø®Ù„Ø· ÙŠØ¯ÙˆÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø±Ø¬ Ø§Ù„Ø²Ø¬Ø§Ø¬Ø©) ÙŠØ¤Ø¯ÙŠ Ù„ØªÙÙƒÙƒ Ø§Ù„Ø±Ø§Ø¦Ø­Ø© ÙÙˆØ±Ø§Ù‹.', localHe:'×¢×¨×‘×•×‘ ×™×“× ×™ ××§×¨××™ ×”××•×‘×™×œ ×œ×”×ª×¤×¨×§×•×ª ×”×¨×™×— ×‘××•×¤×Ÿ ××™×™×“×™.' },
            { id: 3, icon: 'droplets', labelAr:'Ù…ØµØ¯Ø± Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ø®Ø§Ù…', labelHe:'××§×•×¨ ×—×•××¨×™ ×”×’×œ×', madAr:'Ø®Ù„Ø§ØµØ§Øª Ø£ÙˆØ±ÙˆØ¨ÙŠØ© "Ù†Ø®Ø¨ Ø£ÙˆÙ„" Ù…ØµÙ…Ù…Ø© Ø®ØµÙŠØµØ§Ù‹ Ù„Ù„Ù…Ø§Ø±ÙƒØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©.', madHe:'×ª××¦×™×•×ª ××™×¨×•×¤××™×•×ª "× ×‘×—×¨×•×ª" ×”××™×•×¦×¨×•×ª ×‘××™×•×—×“ ×œ××•×ª×’×™× ×¢×•×œ××™×™×.', localAr:'Ø²ÙŠÙˆØª ØªØ¬Ø§Ø±ÙŠØ© Ø±Ø®ÙŠØµØ© ØªÙØ¨Ø§Ø¹ Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ ÙÙŠ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚ Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©.', localHe:'×©×× ×™× ××¡×—×¨×™×™× ×–×•×œ×™× ×”× ××›×¨×™× ×œ×¤×™ ×§×™×œ×• ×‘×©×•×•×§×™× ×¢×××™×™×.' },
            { id: 4, icon: 'activity', labelAr:'Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„ØµØ­ÙŠ', labelHe:'×”×©×¤×¢×” ×‘×¨×™××•×ª×™×ª', madAr:'Ù…ÙƒÙˆÙ†Ø§Øª Ù…Ø¶Ø§Ø¯Ø© Ù„Ù„Ø­Ø³Ø§Ø³ÙŠØ© (Hypoallergenic) Ù„Ø§ ØªØ³Ø¨Ø¨ Ø§Ù„ØµØ¯Ø§Ø¹.', madHe:'×¨×›×™×‘×™× ×”×™×¤×•××œ×¨×’× ×™×™× ×©××™× × ×’×•×¨××™× ×œ×›××‘×™ ×¨××©.', localAr:'Ù…Ø°ÙŠØ¨Ø§Øª ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ© Ø±Ø®ÙŠØµØ© ØªØ³Ø¨Ø¨ Ø§Ù„ØµØ¯Ø§Ø¹ Ø§Ù„Ù†ØµÙÙŠ ÙˆØ¶ÙŠÙ‚ Ø§Ù„ØªÙ†ÙØ³.', localHe:'×××™×¡×™× ×›×™××™×™× ×–×•×œ×™× ×”×’×•×¨××™× ×œ×›××‘×™ ×¨××© ×•×§×•×¦×¨ × ×©×™××”.' },
            { id: 5, icon: 'timer', labelAr:'Ø§Ù„Ø«Ø¨Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡', labelHe:'×¢××™×“×•×ª ×•×‘×™×¦×•×¢×™×', madAr:'ØªØ±ÙƒÙŠØ² Extrait De Parfum Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠØ¯ÙˆÙ… Ù„Ø£ÙƒØ«Ø± Ù…Ù† 24 Ø³Ø§Ø¹Ø©.', madHe:'×¨×™×›×•×– Extrait De Parfum ×××™×ª×™ ×”××—×–×™×§ ××¢××“ ××¢×œ 24 ×©×¢×•×ª.', localAr:'ÙÙˆØ­Ø§Ù† ÙƒØ­ÙˆÙ„ÙŠ Ù…Ø®Ø§Ø¯Ø¹ ÙŠØ®ØªÙÙŠ ØªÙ…Ø§Ù…Ø§Ù‹ Ø¨Ø¹Ø¯ Ù†ØµÙ Ø³Ø§Ø¹Ø©.', localHe:'× ×™×—×•×— ××œ×›×•×”×•×œ×™ ×—×–×§ ×•××˜×¢×” ×©× ×¢×œ× ×œ×—×œ×•×˜×™×Ÿ ××—×¨×™ ×—×¦×™ ×©×¢×”.' },
            { id: 6, icon: 'store', labelAr:'Ø®Ø¯Ù…Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† ÙˆØ§Ù„Ø§Ù†ØªØ´Ø§Ø±', labelHe:'×©×™×¨×•×ª ×œ×§×•×—×•×ª ×•×¤×¨×™×¡×”', madAr:'Ø®Ø¯Ù…Ø© Ø²Ø¨Ø§Ø¦Ù† Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ 41 ÙØ±Ø¹Ø§Ù‹ Ø­ÙˆÙ„ Ø§Ù„Ø¨Ù„Ø§Ø¯ Ù„Ø¶Ù…Ø§Ù† Ø­Ù‚Ùƒ.', madHe:'×©×™×¨×•×ª ×œ×§×•×—×•×ª ××§×¦×•×¢×™ ×¢× 41 ×¡× ×™×¤×™× ×‘×¨×—×‘×™ ×”××¨×¥ ×œ×”×‘×˜×—×ª ×–×›×•×™×•×ª×™×š.', localAr:'Ù…ØªØ§Ø¬Ø± Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…Ø¬Ù‡ÙˆÙ„Ø© Ø¨Ù„Ø§ Ø¹Ù†ÙˆØ§Ù† Ù…Ø§Ø¯ÙŠ Ù„Ù„Ø¶Ù…Ø§Ù†.', localHe:'×—× ×•×™×•×ª ××•× ×œ×™×™×Ÿ ×œ× ×™×“×•×¢×•×ª ×œ×œ× ×›×ª×•×‘×ª ×¤×™×–×™×ª ×œ××—×¨×™×•×ª.' }
        ],
        blocks: [
            { id: 101, type: 'carousel', content: ["https://madperfume.ps/upload/01-2026/page/6971495c69e7c.png", "https://madperfume.co.il/upload/01-2026/product/An8OEZzT1Hor5KozPD5p1pefp9BGkKqc_pmWfEek0RhJ6xxRFisna41ozE5dSAfka2jHZmsDk19wlovU0qVWdKookn1HhYV6h70_PbRMnL7Dat7c37QbzrZ2yo3zgGCaCZzE4g6eFIrt6sPbUatmRbci-8SihYIVkLfP9AkAHq2M_ij1fYO52o0FIEJSYgI8HoNxuU4mMkbn1sSUvH7kw.jpeg"] }
        ]
    };

    const db = {
        ar: { title: "Treasure 100ml", price: "400 â‚ª", old: "350 â‚ª", badge: "Premium Collection", desc: "Ø¹Ø·Ø± Ø´Ø±Ù‚ÙŠ ÙØ§Ø®Ø± Ù„Ù„Ù†Ø³Ø§Ø¡ ÙˆØ§Ù„Ø±Ø¬Ø§Ù„ØŒ ØºÙ†ÙŠ ÙˆØ¯Ø§ÙØ¦ Ø¨Ø·Ø§Ø¨Ø¹ Ø£Ù†ÙŠÙ‚ ÙˆØ¬Ø°Ø§Ø¨.", notes: "<b>Ø§Ù„Ù†ÙˆØªØ§Øª Ø§Ù„Ø¹Ù„ÙŠØ§:</b> Ø§Ù„Ø¨Ø±ØºÙ…ÙˆØªØŒ Ø§Ù„Ù„ÙŠÙ…ÙˆÙ†<br><b>Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ø·Ø±:</b> Ø§Ù„Ù„Ø§ÙÙ†Ø¯Ø±ØŒ Ø§Ù„Ø¹Ø³Ù„<br><b>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø·Ø±:</b> Ø§Ù„ÙØ§Ù†ÙŠÙ„ÙŠØ§", maniTitle: "Ù„Ù…Ø§Ø°Ø§ MAD PARFUMEURØŸ", maniHeaderMad: "MAD", maniHeaderOthers: "Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ ÙˆØ§Ù„Ø²ÙŠÙˆØª", formTitle: "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹", namePh: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„", phonePh: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", addressPh: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†", payTitle: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹", payCash: "Ù†Ù‚Ø¯Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", payVisa: "Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†", submit: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† âœ…", successMsg: "ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ." },
        he: { title: "Treasure 100ml", price: "â‚ª 400", old: "â‚ª 350", badge: "Premium Collection", desc: "×‘×•×©× ××–×¨×—×™ ×™×•×§×¨×ª×™ ×œ× ×©×™× ×•×œ×’×‘×¨×™×, ×¢×©×™×¨ ×•×—× ×¢× × ×•×›×—×•×ª ××œ×’× ×˜×™×ª.", notes: "<b>×ª×•×•×™ ×¤×ª×™×—×”:</b> ×‘×¨×’××•×˜, ×œ×™××•×Ÿ<br><b>×ª×•×•×™ ×œ×‘:</b> ×“×‘×©, ×§×™× ××•×Ÿ<br><b>×ª×•×•×™ ×‘×¡×™×¡:</b> ×•× ×™×œ", maniTitle: "×œ××” MAD PARFUMEUR?", maniHeaderMad: "MAD", maniHeaderOthers: "×—×™×§×•×™×™× ×•×©×× ×™×", formTitle: "×¤×¨×˜×™ ×”×–×× ×”", namePh: "×©× ××œ×", phonePh: "××¡×¤×¨ ×˜×œ×¤×•×Ÿ", addressPh: "×™×™×©×•×‘ ×•×›×ª×•×‘×ª", payTitle: "×××¦×¢×™ ×ª×©×œ×•×", payCash: "××–×•××Ÿ ×œ×©×œ×™×—", payVisa: "×›×¨×˜×™×¡ ××©×¨××™", submit: "××™×©×•×¨ ×•×”×–×× ×” âœ…", successMsg: "×”×”×–×× ×” ×”×ª×§×‘×œ×” ×‘×”×¦×œ×—×”!" }
    };

    function addManiItem() {
        common.maniItems.push({ id: Date.now(), icon: 'star', labelAr: '', labelHe: '', madAr: '', madHe: '', localAr: '', localHe: '' });
        renderManiUI(); render();
    }

    function renderManiUI() {
        const container = document.getElementById('maniItemsContainer');
        if (!container) return;
        container.innerHTML = "";
        common.maniItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'mani-card';
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-size:0.7rem; color:var(--primary)">Ù†Ù‚Ø·Ø© Ù…Ù‚Ø§Ø±Ù†Ø©</span>
                    <button class="btn-delete" onclick="removeMani(${item.id})">Ø­Ø°Ù</button>
                </div>
                <div class="mani-inputs">
                    <input type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù‚Ø·Ø©" value="${mode=='ar'?item.labelAr:item.labelHe}" oninput="updateManiItem(${item.id}, 'label', this.value)">
                    <textarea placeholder="ÙˆØµÙ MAD" oninput="updateManiItem(${item.id}, 'mad', this.value)">${mode=='ar'?item.madAr:item.madHe}</textarea>
                    <textarea placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†Ø§ÙØ³" oninput="updateManiItem(${item.id}, 'local', this.value)">${mode=='ar'?item.localAr:item.localHe}</textarea>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function updateManiItem(id, key, val) {
        const item = common.maniItems.find(i => i.id === id);
        if (item) {
            if(mode === 'ar') item[key+'Ar'] = val; else item[key+'He'] = val;
            render();
        }
    }
    
    function removeMani(id) { common.maniItems = common.maniItems.filter(i=>i.id!==id); renderManiUI(); render(); }

    function addBlock(type) { common.blocks.push({ id: Date.now(), type, content: type === 'carousel' ? [] : "" }); renderBlocksUI(); render(); }
    function removeBlock(id) { common.blocks = common.blocks.filter(b => b.id !== id); renderBlocksUI(); render(); }

    function renderBlocksUI() {
        const container = document.getElementById('blocksContainer');
        if (!container) return;
        container.innerHTML = "";
        common.blocks.forEach(b => {
            const div = document.createElement('div');
            div.className = 'block-item';
            div.innerHTML = `<div class="block-header"><span>${b.type.toUpperCase()}</span><button class="btn-delete" onclick="removeBlock(${b.id})">Ø­Ø°Ù</button></div><input type="text" oninput="common.blocks.find(x=>x.id==${b.id}).content=(this.value.includes(',')?this.value.split(','):this.value); render()" value="${Array.isArray(b.content)?b.content.join(','):b.content}" placeholder="URL">`;
            container.appendChild(div);
        });
    }

    function setMode(l) { 
        mode = l; 
        const fields = ['title', 'price', 'old', 'badge', 'desc', 'notes', 'maniHeaderMad', 'maniHeaderOthers'];
        fields.forEach(f => {
            const el = document.getElementById(f);
            if (el) el.value = db[mode][f] || '';
        });
        renderManiUI(); renderBlocksUI(); render(); 
    }

    function updateData(k, v) { db[mode][k] = v; render(); }
    function updateCommon(k, v) { common[k] = v; render(); }
    function updateDesign(k, v) { design[k] = v; render(); }

    function getHTML(dl = false) {
        const sOpen = '<' + 'script'; const sClose = '<' + '/script>';
        let blocksHTML = "";
        common.blocks.forEach(b => {
            if(b.type === 'carousel') {
                blocksHTML += `<div x-data="{ active: 0, images: ${JSON.stringify(b.content).replace(/"/g, "'")} }" class="relative w-full aspect-square bg-black rounded-3xl overflow-hidden shadow-2xl border border-white/5"><template x-for="(img, idx) in images"><img x-show="active === idx" :src="img" class="absolute inset-0 w-full h-full object-contain" x-transition.opacity></template><button @click="active = (active === 0 ? images.length - 1 : active - 1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/40 p-2 rounded-full text-white/70">â—€</button><button @click="active = (active === images.length - 1 ? 0 : active + 1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/40 p-2 rounded-full text-white/70">â–¶</button></div>`;
            }
            if(b.type === 'video') blocksHTML += `<video src="${b.content}" controls class="w-full rounded-3xl"></video>`;
            if(b.type === 'text') blocksHTML += `<p class="text-center opacity-80 px-4 whitespace-pre-wrap">${b.content}</p>`;
        });

        let maniHTML = "";
        common.maniItems.forEach(item => {
            const label = mode === 'ar' ? item.labelAr : item.labelHe;
            const mad = mode === 'ar' ? item.madAr : item.madHe;
            const local = mode === 'ar' ? item.localAr : item.localHe;
            maniHTML += `<div class="border-t border-white/5 py-5 px-4"><div class="flex items-center gap-2 mb-3 text-[var(--p)]"><i data-lucide="${item.icon || 'star'}" class="w-5 h-5"></i><span class="text-sm font-black uppercase tracking-widest">${label}</span></div><div class="grid grid-cols-2 gap-4"><div class="text-[12px] leading-relaxed text-white font-bold"><span class="block text-[9px] text-[var(--p)] mb-1 opacity-60 uppercase">${db[mode].maniHeaderMad}</span>${mad}</div><div class="text-[12px] leading-relaxed text-slate-500"><span class="block text-[9px] mb-1 opacity-60 uppercase">${db[mode].maniHeaderOthers}</span>${local}</div></div></div>`;
        });

        return `<!DOCTYPE html>
<html lang="${mode}" dir="${mode=='ar'?'rtl':'ltr'}" x-data="app()">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${db[mode].title}</title>
    ${sOpen} src="https://cdn.tailwindcss.com" defer>${sClose}
    ${sOpen} src="https://unpkg.com/lucide@latest" defer>${sClose}
    ${sOpen} src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer>${sClose}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&family=Cairo:wght@400;700;900&display=swap');
        :root { --p: ${design.primary}; --bg: ${design.bgBody}; --f: ${design.bgForm}; }
        body { background: var(--bg); color: white; font-family: 'Heebo', 'Cairo', sans-serif; scroll-behavior: smooth; }
        .gold-gradient { background: linear-gradient(to right, var(--p), #fff, var(--p)); -webkit-background-clip: text; color: transparent; }
        .glass-panel{background:rgba(20,20,20,.6);backdrop-filter:blur(16px);border:1px solid rgba(212,175,55,.15);box-shadow: 0 4px 30px rgba(0,0,0,0.3);}
        input[type="radio"]:checked + div{border-color:var(--p);background-color:rgba(212,175,55,.1)}
        .radio-circle{width:14px;height:14px;border-radius:99px;border:1px solid #555; position:relative;}
        input[type="radio"]:checked + div .radio-circle::after{content:''; position:absolute; inset:2px; background:var(--p); border-radius:99px;}
        .animate-pop{animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);}
        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
    ${dl ? `${sOpen}>
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init','${common.fb}'); fbq('track','PageView');

        !function (w, d, t) { w.TiktokAnalyticsObject = t; var ttq = w[t] = w[t] || []; ttq.methods = ["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"]; ttq.setAndDefer = function(t, e) { t[e] = function() { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }; for (var i = 0; i < ttq.methods.length; i++) { ttq.setAndDefer(ttq, ttq.methods[i]); } ttq.load = function(e) { var i = d.createElement("script"); i.type = "text/javascript"; i.async = true; i.src = "https://analytics.tiktok.com/i18n/pixel/events.js?sdkid=" + e + "&lib=" + t; var n = d.getElementsByTagName("script")[0]; n.parentNode.insertBefore(i, n); }; ttq.load('${common.tt}'); ttq.page(); }(window, document, 'ttq');
    ${sClose}` : ''}
</head>
<body class="min-h-screen pb-32">
    <div class="fixed inset-0 pointer-events-none z-0"><div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[600px] bg-[var(--p)]/5 blur-[120px]"></div></div>
    
    <nav class="fixed top-0 w-full z-50 p-4 flex justify-between items-center bg-black/60 backdrop-blur-xl border-b border-white/10">
        <span class="text-2xl font-black gold-gradient" style="font-family:serif">MAD</span>
        <button @click="lang=(lang=='ar'?'he':'ar'); setTimeout(()=>lucide.createIcons(),50)" class="text-xs font-black" style="color:var(--p)">{{lang=='ar'?'×¢×‘×¨×™×ª':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'}}</button>
    </nav>

    <main class="max-w-md mx-auto px-5 pt-24 space-y-12">
        <section class="text-center space-y-6">
            <h1 class="text-3xl font-bold tracking-tight" x-text="t.title"></h1>
            <div class="flex flex-col items-center"><span class="text-slate-500 line-through text-sm" x-text="t.old"></span><span class="text-5xl font-black gold-gradient" x-text="t.price"></span></div>
            <div class="space-y-8">${blocksHTML}</div>
            <p class="text-slate-300 text-sm" x-text="t.desc"></p>
            <div class="glass-panel p-4 rounded-xl text-xs text-right border-r-2" style="border-color:var(--p)" x-html="t.notes"></div>
            <a href="#order" class="block w-full py-5 rounded-2xl bg-gradient-to-r from-yellow-700 to-[var(--p)] text-black font-black text-xl shadow-2xl" x-text="t.submit"></a>
        </section>

        <section class="space-y-6">
            <div class="text-center"><span class="text-[10px] font-black text-[var(--p)] tracking-widest uppercase">The Manifesto</span><h2 class="text-2xl font-bold mt-1" x-text="t.maniTitle"></h2></div>
            <div class="glass-panel rounded-3xl overflow-hidden">${maniHTML}</div>
        </section>

        <section id="order" class="p-8 rounded-[2.5rem] space-y-6" style="background:var(--f)">
            <h2 class="text-2xl font-black text-center" x-text="t.formTitle"></h2>
            <form @submit.prevent="submitOrder" class="space-y-5">
                <input x-model="f.name" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" :placeholder="t.namePh" required>
                <input x-model="f.phone" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" :placeholder="t.phonePh" required dir="ltr">
                <input x-model="f.address" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" :placeholder="t.addressPh" required>
                
                <div class="space-y-3"><label class="text-[10px] text-slate-400 font-bold uppercase tracking-widest" x-text="t.payTitle"></label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer"><input type="radio" value="Cash" x-model="f.payment" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex flex-col items-center gap-2 bg-black/20"><i data-lucide="banknote" class="w-5 h-5 text-slate-400"></i><span class="text-[10px] font-bold" x-text="t.payCash"></span><div class="radio-circle"></div></div></label>
                        <label class="cursor-pointer"><input type="radio" value="Visa" x-model="f.payment" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex flex-col items-center gap-2 bg-black/20"><i data-lucide="credit-card" class="w-5 h-5 text-slate-400"></i><span class="text-[10px] font-bold" x-text="t.payVisa"></span><div class="radio-circle"></div></div></label>
                    </div>
                </div>

                <button type="submit" class="w-full py-5 rounded-2xl bg-[var(--p)] text-black font-black text-xl" x-text="loading ? '...' : t.submit"></button>
            </form>
        </section>
    </main>

    <div x-show="ui.ok" class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-[#111] border border-[var(--p)]/30 p-8 rounded-3xl max-w-xs w-full text-center shadow-2xl animate-pop">
            <div class="w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-500/30"><i data-lucide="check" class="w-8 h-8 text-green-500"></i></div>
            <h3 class="text-xl font-bold text-white mb-2" x-text="t.successMsg"></h3>
            <button @click="ui.ok=false" class="w-full bg-[#161616] border border-white/10 text-white py-3 rounded-xl hover:bg-[#222] transition-colors font-bold text-sm mt-4">Close</button>
        </div>
    </div>

    ${sOpen}>function app(){return {db:${JSON.stringify(db)},lang:'${mode}',f:{name:'',phone:'',address:'',payment:'Cash',process:'Contact'},loading:false,ui:{ok:false},get t(){return this.db[this.lang]},async submitOrder(){this.loading=true;const fd=new FormData();fd.append('name',this.f.name);fd.append('phone',this.f.phone);fd.append('address',this.f.address);fd.append('payment',this.f.payment);fd.append('offer',this.t.title);fd.append('lang',this.lang);try{await fetch('${common.googleScript}',{method:'POST',body:fd,mode:'no-cors'});if(typeof fbq!=='undefined')fbq('track','Purchase',{value:400,currency:'ILS'});if(typeof ttq!=='undefined')ttq.track('CompletePayment',{value:400,currency:'ILS'});this.ui.ok=true;this.f={name:'',phone:'',address:'',payment:'Cash',process:'Contact'};}catch(e){alert('Error');}finally{this.loading=false;}}}} ${sClose}
    ${sOpen}>window.addEventListener('DOMContentLoaded',()=> { if(window.lucide) lucide.createIcons(); });${sClose}
</body>
</html>`;
    }

    function render() { const f=document.getElementById('preview'); if(f) { const d=f.contentWindow.document; d.open(); d.write(getHTML(false)); d.close(); } }
    function download() { const l=document.createElement('a'); l.href=URL.createObjectURL(new Blob([getHTML(true)],{type:'text/html'})); l.download='mad-manifesto-page.html'; l.click(); }

    function init() {
        const ids = ['logo', 'googleScript', 'fbPixel', 'ttPixel', 'maniHeaderMad', 'maniHeaderOthers'];
        ids.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                if (id === 'logo') el.value = common.logo;
                else if (id === 'googleScript') el.value = common.googleScript;
                else if (id === 'fbPixel') el.value = common.fb;
                else if (id === 'ttPixel') el.value = common.tt;
                else if (id === 'maniHeaderMad') el.value = db[mode].maniHeaderMad;
                else if (id === 'maniHeaderOthers') el.value = db[mode].maniHeaderOthers;
            }
        });
        setMode('ar');
        renderBlocksUI();
    }
    window.addEventListener('load', init);
</script>
</body>
</html>
