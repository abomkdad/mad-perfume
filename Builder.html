<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD Builder - Pro Conversion & Speed Edition</title>
    <style>
        :root { --primary: #d4af37; --bg: #0f172a; --panel: #1e293b; --text: #f1f5f9; --border: #334155; --danger: #ef4444; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        
        .main-layout { display: flex; height: 100vh; flex-direction: row-reverse; }
        .preview-pane { flex: 1; background: #020617; display: flex; justify-content: center; align-items: center; border-right: 1px solid var(--border); padding: 20px; overflow: hidden; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; }
        .editor-pane { width: 550px; background: var(--panel); padding: 30px; overflow-y: auto; box-shadow: -5px 0 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 20px; }

        .iphone-mockup { width: 375px; height: 812px; background: #000; border-radius: 40px; border: 12px solid #2d2d2d; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; transform: scale(0.85); flex-shrink: 0; }
        .iphone-notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #2d2d2d; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; z-index: 100; }
        .iphone-screen { width: 100%; height: 100%; background: #0b0b0b; border: none; display: block; overflow-y: auto; }

        @media (max-width: 768px) {
            .main-layout { flex-direction: column; height: auto; overflow: auto; }
            .preview-pane { display: none; }
            .editor-pane { width: 100%; height: auto; box-shadow: none; }
            body { overflow: auto; }
        }

        h1 { color: var(--primary); margin: 0 0 10px 0; font-size: 1.5rem; text-align: center; }
        h2 { font-size: 1rem; color: #94a3b8; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin-top: 25px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; margin-bottom: 5px; color: #cbd5e1; }
        input[type="text"], textarea, select { width: 100%; padding: 10px; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 6px; box-sizing: border-box; outline: none; font-size: 0.9rem; }
        input[type="color"] { width: 100%; height: 40px; border: none; padding: 0; cursor: pointer; border-radius: 6px; background: transparent; }
        
        .block-item { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .block-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; color: var(--primary); font-weight: bold; font-size: 0.8rem; }
        .btn-delete { background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; }
        
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-action { background: var(--primary); color: #000; font-weight: 900; padding: 15px; border-radius: 8px; border: none; cursor: pointer; width: 100%; font-size: 1.1rem; margin-top: 20px; transition: 0.2s; }
        .btn-add { background: #334155; color: white; border: 1px solid var(--border); padding: 10px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; flex: 1; transition: 0.2s; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="editor-pane">
        <h1>MAD Builder PRO ğŸ’</h1>
        
        <div class="form-group">
            <label>Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙØ¹Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</label>
            <select id="langSelect" onchange="setMode(this.value)">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (AR)</option>
                <option value="he">×¢×‘×¨×™×ª (HE)</option>
            </select>
        </div>

        <h2>ğŸ¨ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØµÙ…ÙŠÙ…</h2>
        <div class="color-grid">
            <div class="form-group"><label>Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©</label><input type="color" id="clr-bgBody" oninput="updateDesign('bgBody', this.value)"></div>
            <div class="form-group"><label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label><input type="color" id="clr-primary" oninput="updateDesign('primary', this.value)"></div>
            <div class="form-group"><label>Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</label><input type="color" id="clr-bgForm" oninput="updateDesign('bgForm', this.value)"></div>
            <div class="form-group"><label>Ù„ÙˆÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</label><input type="color" id="clr-btnBg" oninput="updateDesign('btnBg', this.value)"></div>
        </div>

        <h2>ğŸ›ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
        <div class="form-group"><label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±</label><input type="text" id="logo" oninput="updateCommon('logo', this.value)"></div>
        <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label><input type="text" id="title" oninput="updateData('title', this.value)"></div>
        <div class="form-group"><label>Ù†Øµ Ø§Ù„Ø´Ø§Ø±Ø© (Badge)</label><input type="text" id="badge" oninput="updateData('badge', this.value)"></div>
        
        <div class="form-group">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</label><input type="text" id="price" oninput="updateData('price', this.value)"></div>
                <div><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…</label><input type="text" id="old" oninput="updateData('old', this.value)"></div>
            </div>
        </div>
        <div class="form-group"><label>Ø§Ù„ÙˆØµÙ</label><textarea id="desc" oninput="updateData('desc', this.value)" rows="3"></textarea></div>
        <div class="form-group"><label>Ø§Ù„Ù†ÙˆØªØ§Øª (HTML)</label><textarea id="notes" oninput="updateData('notes', this.value)" rows="4"></textarea></div>

        <h2>âš–ï¸ Ù‚Ø³Ù… Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h2>
        <div class="form-group">
            <label>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Ø§ÙØµÙ„ Ø¨Ù€ ,)</label>
            <textarea id="maniPoints" oninput="updateMani(this.value)" rows="3"></textarea>
        </div>

        <h2>ğŸ§© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h2>
        <div id="blocksContainer"></div>
        <div class="block-controls" style="display:flex; gap:10px;">
            <button class="btn-add" onclick="addBlock('carousel')">+ ÙƒØ±Ø³ÙˆÙ„</button>
            <button class="btn-add" onclick="addBlock('text')">+ Ù†Øµ</button>
            <button class="btn-add" onclick="addBlock('video')">+ ÙÙŠØ¯ÙŠÙˆ</button>
        </div>

        <h2>âš™ï¸ Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ø³ÙƒØ±Ø¨ØªØ§Øª</h2>
        <div class="form-group"><label>Ø±Ø§Ø¨Ø· Ø³ÙƒØ±Ø¨Øª Ø¬ÙˆØ¬Ù„</label><input type="text" id="googleScript" oninput="updateCommon('googleScript', this.value)"></div>
        <div class="form-group"><label>Facebook Pixel ID</label><input type="text" id="fbPixel" oninput="updateCommon('fb', this.value)"></div>
        <div class="form-group"><label>TikTok Pixel ID</label><input type="text" id="ttPixel" oninput="updateCommon('tt', this.value)"></div>

        <button class="btn-action" onclick="download()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ğŸ“¥</button>
    </div>

    <div class="preview-pane">
        <div class="iphone-mockup">
            <div class="iphone-notch"></div>
            <iframe id="preview" class="iphone-screen"></iframe>
        </div>
    </div>
</div>

<script>
    let mode = 'ar';
    const design = { bgBody: "#0b0b0b", primary: "#d4af37", bgForm: "#161616", btnBg: "#d4af37", btnText: "#000000" };
    
    const common = {
        logo: "https://abomkdad.github.io/Digital-Business-Card/logo.png",
        googleScript: "https://script.google.com/macros/s/AKfycbyx0rxHpN9Csv2OV_9D_EIF_pqMlNEmF2rDi_s7ZFo6feB7r9Ohb2eHuxEM4gGfDuLu/exec",
        fb: "1072283127290819", 
        tt: "D2D02JBC77U4ENLN9SBG",
        maniRawAr: "Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ, Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹Ø·Ø±ÙŠØ©, Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø£ØµÙ„ÙŠ, Ø§Ù„Ø«Ø¨Ø§Øª",
        maniRawHe: "×‘×˜×™×—×•×ª ×‘×¨×™××•×ª×™×ª, ×”× ×“×¡×ª × ×™×—×•×—, ××§×•×¨ ××§×•×¨×™, ×¢××™×“×•×ª ×œ××•×¨×š ×–××Ÿ",
        blocks: [
            { id: 1, type: 'carousel', content: ["https://madperfume.ps/upload/01-2026/page/6971495c69e7c.png"] }
        ]
    };

    const db = {
        ar: { 
            title: "Treasure 100ml", price: "400 â‚ª", old: "350 â‚ª", badge: "Premium Collection", 
            desc: "Ø¹Ø·Ø± Ø´Ø±Ù‚ÙŠ ÙØ§Ø®Ø± Ù„Ù„Ù†Ø³Ø§Ø¡ ÙˆØ§Ù„Ø±Ø¬Ø§Ù„ØŒ ØºÙ†ÙŠ ÙˆØ¯Ø§ÙØ¦ Ø¨Ø·Ø§Ø¨Ø¹ Ø£Ù†ÙŠÙ‚ ÙˆØ¬Ø°Ø§Ø¨.", 
            notes: "<b>Ø§Ù„Ù†ÙˆØªØ§Øª Ø§Ù„Ø¹Ù„ÙŠØ§:</b> Ø§Ù„Ø¨Ø±ØºÙ…ÙˆØªØŒ Ø§Ù„Ù„ÙŠÙ…ÙˆÙ†<br><b>Ù‚Ù„Ø¨ Ø§Ù„Ø¹Ø·Ø±:</b> Ø§Ù„Ù„Ø§ÙÙ†Ø¯Ø±ØŒ Ø§Ù„Ø¹Ø³Ù„<br><b>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø·Ø±:</b> Ø§Ù„ÙØ§Ù†ÙŠÙ„ÙŠØ§", 
            maniTitle: "Ù„Ù…Ø§Ø°Ø§ MAD PARFUMEURØŸ", maniOthers: "Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ ÙˆØ§Ù„Ø²ÙŠÙˆØª", formTitle: "Order Form", namePh: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„", phonePh: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", addressPh: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", submit: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨", successMsg: "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…" 
        },
        he: { 
            title: "Treasure 100ml", price: "â‚ª 400", old: "â‚ª 350", badge: "Premium Collection", 
            desc: "×‘×•×©× ××–×¨×—×™ ×™×•×§×¨×ª×™ ×œ× ×©×™× ×•×œ×’×‘×¨×™×, ×¢×©×™×¨ ×•×—× ×¢× × ×•×›×—×•×ª ××œ×’× ×˜×™×ª.", 
            notes: "<b>×ª×•×•×™ ×¤×ª×™×—×”:</b> ×‘×¨×’××•×˜, ×œ×™××•×Ÿ<br><b>×ª×•×•×™ ×œ×‘:</b> ×œ×‘× ×“×¨, ×“×‘×©<br><b>×ª×•×•×™ ×‘×¡×™×¡:</b> ×•× ×™×œ", 
            maniTitle: "?×œ××” MAD PARFUMEUR", maniOthers: "×—×™×§×•×™×™× ×•×©×× ×™×", formTitle: "×˜×•×¤×¡ ×”×–×× ×”", namePh: "×©× ××œ×", phonePh: "××¡×¤×¨ ×˜×œ×¤×•×Ÿ", addressPh: "×›×ª×•×‘×ª", submit: "×©×œ×— ×”×–×× ×”", successMsg: "×”×–×× ×” ×”×ª×§×‘×œ×” ×‘×”×¦×œ×—×”! âœ…" 
        }
    };

    function addBlock(type) {
        const id = Date.now();
        common.blocks.push({ id, type, content: type === 'carousel' ? [] : "" });
        renderBlocksUI(); render();
    }

    function removeBlock(id) { common.blocks = common.blocks.filter(b => b.id !== id); renderBlocksUI(); render(); }

    function updateBlockContent(id, value) {
        const block = common.blocks.find(b => b.id === id);
        if(block.type === 'carousel') block.content = value.split(',').map(s => s.trim());
        else block.content = value;
        render();
    }

    function renderBlocksUI() {
        const container = document.getElementById('blocksContainer');
        if(!container) return;
        container.innerHTML = "";
        common.blocks.forEach(block => {
            const div = document.createElement('div');
            div.className = 'block-item';
            let inputField = block.type === 'carousel' ? `<textarea oninput="updateBlockContent(${block.id}, this.value)">${block.content.join(',')}</textarea>` : `<input type="text" oninput="updateBlockContent(${block.id}, this.value)" value="${block.content}">`;
            div.innerHTML = `<div class="block-header"><span>${block.type.toUpperCase()}</span><button class="btn-delete" onclick="removeBlock(${block.id})">Ø­Ø°Ù</button></div>${inputField}`;
            container.appendChild(div);
        });
    }

    function setMode(lang) {
        mode = lang;
        if(document.getElementById('title')) document.getElementById('title').value = db[lang].title;
        if(document.getElementById('badge')) document.getElementById('badge').value = db[lang].badge;
        if(document.getElementById('price')) document.getElementById('price').value = db[lang].price;
        if(document.getElementById('old')) document.getElementById('old').value = db[lang].old;
        if(document.getElementById('desc')) document.getElementById('desc').value = db[lang].desc;
        if(document.getElementById('notes')) document.getElementById('notes').value = db[lang].notes;
        if(document.getElementById('maniPoints')) document.getElementById('maniPoints').value = mode === 'ar' ? common.maniRawAr : common.maniRawHe;
        render();
    }

    function updateData(key, val) { db[mode][key] = val; render(); }
    function updateCommon(key, val) { common[key] = val; render(); }
    function updateDesign(key, val) { design[key] = val; render(); }
    function updateMani(val) { if(mode === 'ar') common.maniRawAr = val; else common.maniRawHe = val; render(); }

    function getHTML(dl = false) {
        const sOpen = '<' + 'script'; const sClose = '<' + '/script>';
        let blocksHTML = "";
        common.blocks.forEach((b, idx) => {
            const lazyAttr = (idx > 0) ? 'loading="lazy"' : '';
            if(b.type === 'text') blocksHTML += `<p class="text-center opacity-80 whitespace-pre-wrap">${b.content}</p>`;
            if(b.type === 'image') blocksHTML += `<img src="${b.content}" class="w-full rounded-2xl shadow-xl" ${lazyAttr}>`;
            if(b.type === 'video') blocksHTML += `<video src="${b.content}" controls class="w-full rounded-2xl" preload="metadata"></video>`;
            if(b.type === 'carousel' && b.content.length > 0) {
                blocksHTML += `<div x-data="{ active: 0, images: ${JSON.stringify(b.content).replace(/"/g, "'")} }" class="relative w-full aspect-square bg-black rounded-2xl overflow-hidden shadow-2xl border border-white/5"><template x-for="(img, idx) in images"><img x-show="active === idx" :src="img" class="absolute inset-0 w-full h-full object-contain" ${lazyAttr}></template><button @click="active = (active === 0 ? images.length - 1 : active - 1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 p-3 rounded-full">â—€</button><button @click="active = (active === images.length - 1 ? 0 : active + 1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 p-3 rounded-full">â–¶</button></div>`;
            }
        });

        const currentMani = mode === 'ar' ? common.maniRawAr : common.maniRawHe;
        const maniItems = currentMani.split(',').map(p => p.trim());
        let maniHTML = `<div class="space-y-3">`;
        maniItems.forEach(item => {
            maniHTML += `<div class="grid grid-cols-2 gap-1 rounded-xl overflow-hidden border border-white/5"><div class="bg-white/5 p-3 text-right text-xs"><span class="text-[var(--p)] font-bold">MAD:</span> ${item}</div><div class="bg-black/40 p-3 text-right text-[10px] opacity-40">${db[mode].maniOthers}</div></div>`;
        });
        maniHTML += `</div>`;

        return `<!DOCTYPE html>
<html lang="${mode}" dir="${mode=='ar'?'rtl':'ltr'}" x-data="app()">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${db[mode].title}</title>
    ${sOpen} src="https://cdn.tailwindcss.com" defer>${sClose}
    ${sOpen} src="https://unpkg.com/lucide@latest" defer>${sClose}
    ${sOpen} src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer>${sClose}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&family=Cairo:wght@400;700;900&display=swap');
        :root { --p: ${design.primary}; --bg: ${design.bgBody}; --f: ${design.bgForm}; --btn: ${design.btnBg}; }
        body { background: var(--bg); color: white; font-family: 'Heebo', 'Cairo', sans-serif; scroll-behavior: smooth; }
        .gold-gradient { background: linear-gradient(to right, var(--p), #fff, var(--p)); -webkit-background-clip: text; color: transparent; }
        .glass-panel{background:rgba(20,20,20,.6);backdrop-filter:blur(16px);border:1px solid rgba(212,175,55,.15);box-shadow: 0 4px 30px rgba(0,0,0,0.3);}
        input[type="radio"]:checked + div{border-color:var(--p);background-color:rgba(212,175,55,.1)}
        .radio-circle{width:12px;height:12px;border-radius:99px;border:1px solid #555;}
        input[type="radio"]:checked + div .radio-circle{background:var(--p);border-color:var(--p);}
        .animate-pop{animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);}
        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
    ${dl ? `${sOpen}>
        // Async Pixel Loader for Speed
        (function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)})(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init','${common.fb}'); fbq('track','PageView');
        (function (w, d, t) { w.TiktokAnalyticsObject = t; var ttq = w[t] = w[t] || []; ttq.methods = ["page","track"]; ttq.setAndDefer = function(t, e) { t[e] = function() { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }; for (var i = 0; i < ttq.methods.length; i++) { ttq.setAndDefer(ttq, ttq.methods[i]); } ttq.load = function(e) { var i = d.createElement("script"); i.type = "text/javascript"; i.async = true; i.src = "https://analytics.tiktok.com/i18n/pixel/events.js?sdkid=" + e + "&lib=" + t; var n = d.getElementsByTagName("script")[0]; n.parentNode.insertBefore(i, n); }; ttq.load('${common.tt}'); ttq.page(); })(window, document, 'ttq');
    ${sClose}` : ''}
</head>
<body class="min-h-screen pb-24">
    <div class="fixed inset-0 pointer-events-none z-0"><div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[600px] bg-[var(--p)]/5 blur-[120px]"></div></div>
    
    <nav class="fixed top-0 w-full z-50 p-4 flex justify-between items-center bg-black/60 backdrop-blur-xl border-b border-white/10">
        <img src="${common.logo}" class="h-8" alt="Logo">
        <button @click="lang=(lang=='ar'?'he':'ar'); setTimeout(()=>lucide.createIcons(),50)" class="text-xs font-black" style="color:var(--p)">{{lang=='ar'?'×¢×‘×¨×™×ª':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'}}</button>
    </nav>

    <main class="max-w-md mx-auto px-5 pt-24 space-y-12">
        <section class="text-center space-y-6">
            <div class="relative inline-block mx-auto group">
                <div class="absolute inset-0 bg-[var(--p)]/20 rounded-[2rem] blur-2xl"></div>
                <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 bg-[var(--p)] text-black text-[10px] font-black uppercase tracking-wider px-3 py-1 rounded-full z-10" x-text="t.badge"></div>
                <div class="relative overflow-hidden rounded-[2rem] border border-white/10 shadow-2xl">${blocksHTML}</div>
            </div>
            <h1 class="text-3xl font-bold tracking-tight" x-text="t.title"></h1>
            <div class="flex flex-col items-center"><span class="text-slate-500 line-through text-sm" x-text="t.old"></span><span class="text-5xl font-black gold-gradient" x-text="t.price"></span></div>
            <p class="text-slate-300 text-sm" x-text="t.desc"></p>
            <div class="glass-panel p-4 rounded-xl text-xs text-right border-r-2" style="border-color:var(--p)" x-html="t.notes"></div>
            <a href="#order" class="block w-full py-4 rounded-xl font-bold text-lg" style="background:var(--btn); color:${design.btnText}" x-text="t.submit"></a>
        </section>
        
        <section class="space-y-6"><h2 class="text-center text-xl font-bold" style="color:var(--p)" x-text="t.maniTitle"></h2>${maniHTML}</section>

        <section id="order" class="p-8 rounded-[2.5rem] space-y-6" style="background:var(--f)">
            <h2 class="text-2xl font-black text-center" x-text="t.formTitle"></h2>
            <form @submit.prevent="submitOrder" class="space-y-4">
                <input x-model="f.name" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" :placeholder="t.namePh" required>
                <input x-model="f.phone" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" :placeholder="t.phonePh" required>
                <input x-model="f.address" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" :placeholder="t.addressPh" required>
                
                <div class="space-y-2 pt-2">
                    <label class="text-xs text-slate-400" x-text="lang=='he'?'×××¦×¢×™ ×ª×©×œ×•×':'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹'"></label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer"><input type="radio" value="Cash" x-model="f.payment" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex flex-col items-center bg-black/20"><span class="text-xs" x-text="lang=='he'?'××–×•××Ÿ ×œ×©Ù„ÙŠ×—':'Ù†Ù‚Ø¯Ù‹Ø§'"></span><div class="radio-circle mt-2"></div></div></label>
                        <label class="cursor-pointer"><input type="radio" value="Visa" x-model="f.payment" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex flex-col items-center bg-black/20"><span class="text-xs" x-text="lang=='he'?'××©×¨×ÙŠ':'Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†'"></span><div class="radio-circle mt-2"></div></div></label>
                    </div>
                </div>

                <div class="space-y-2 pt-2">
                    <label class="text-xs text-slate-400" x-text="lang=='he'?'×ª×”×œ×™×š ×¢×™×‘×•×“':'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨'"></label>
                    <div class="grid grid-cols-1 gap-2">
                        <label class="cursor-pointer"><input type="radio" value="Contact" x-model="f.process" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex justify-between items-center bg-black/20"><span class="text-xs" x-text="lang=='he'?'×¦Ø±Ùˆ ÙƒØ´Ø± Ù„Ø§ÙŠØ´Ø§Ø±':'ØªÙˆØ§ØµÙ„ÙˆØ§ Ù…Ø¹ÙŠ Ù„Ù„ØªØ£ÙƒÙŠØ¯'"></span><div class="radio-circle"></div></div></label>
                        <label class="cursor-pointer"><input type="radio" value="Direct" x-model="f.process" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex justify-between items-center bg-black/20"><span class="text-xs" x-text="lang=='he'?'××©Ù„ÙˆØ­ ÙŠØ´ÙŠØ±':'Ø´Ø­Ù† Ù…Ø¨Ø§Ø´Ø±'"></span><div class="radio-circle"></div></div></label>
                    </div>
                </div>

                <button type="submit" class="w-full py-5 rounded-2xl font-black text-xl shadow-lg active:scale-95 transition-all" style="background:var(--btn); color:${design.btnText}" x-text="loading ? '...' : t.submit"></button>
            </form>
        </section>
        
        <div class="flex justify-center gap-6 opacity-30 grayscale pb-10"><i data-lucide="award"></i><i data-lucide="shield-check"></i><i data-lucide="star"></i></div>
    </main>

    <!-- Success Modal -->
    <div x-show="ui.ok" class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-[#111] border border-[var(--p)]/30 p-8 rounded-3xl max-w-xs w-full text-center shadow-2xl animate-pop">
            <div class="w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-500/30">
                <i data-lucide="check" class="w-8 h-8 text-green-500"></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2" x-text="t.successMsg"></h3>
            <button @click="ui.ok=false" class="w-full bg-[#161616] border border-white/10 text-white py-3 rounded-xl hover:bg-[#222] transition-colors font-bold text-sm mt-4">Close</button>
        </div>
    </div>

    ${sOpen}>
        function app(){
            return {
                db: ${JSON.stringify(db)}, lang: '${mode}', f:{name:'',phone:'',address:'',payment:'Cash',process:'Contact'}, loading:false, ui:{ok:false},
                get t() { return this.db[this.lang] },
                async submitOrder() {
                    this.loading = true;
                    const fd = new FormData();
                    fd.append('name', this.f.name); fd.append('phone', this.f.phone); fd.append('address', this.f.address);
                    fd.append('payment', this.f.payment); fd.append('process', this.f.process);
                    fd.append('offer', this.t.title); fd.append('lang', this.lang);
                    try {
                        await fetch('${common.googleScript}', { method: 'POST', body: fd, mode: 'no-cors' });
                        
                        // Fire Purchase Pixel Events with Error Handling
                        try {
                            if(typeof fbq !== 'undefined') fbq('track', 'Purchase', { value: 400.00, currency: 'ILS' });
                            if(typeof ttq !== 'undefined') ttq.track('CompletePayment', { value: 400.00, currency: 'ILS' });
                        } catch(e) {}
                        
                        this.ui.ok = true; 
                        this.f = {name:'',phone:'',address:'',payment:'Cash',process:'Contact'};
                    } catch(e) { console.error('Error sending order'); } finally { this.loading = false; }
                }
            }
        }
    ${sClose}
    ${sOpen}>window.addEventListener('DOMContentLoaded',()=> { if(window.lucide) lucide.createIcons(); });${sClose}
</body>
</html>`;
    }

    function render() { const f=document.getElementById('preview'); if(f) { const d=f.contentWindow.document; d.open(); d.write(getHTML(false)); d.close(); } }
    function download() { const l=document.createElement('a'); l.href=URL.createObjectURL(new Blob([getHTML(true)],{type:'text/html'})); l.download='mad-landing.html'; l.click(); }

    function init() {
        const logoEl = document.getElementById('logo');
        const scriptEl = document.getElementById('googleScript');
        const fbEl = document.getElementById('fbPixel');
        const ttEl = document.getElementById('ttPixel');
        const notesEl = document.getElementById('notes');

        if(logoEl) logoEl.value = common.logo;
        if(scriptEl) scriptEl.value = common.googleScript;
        if(fbEl) fbEl.value = common.fb;
        if(ttEl) ttEl.value = common.tt;

        for(let k in design){ const el=document.getElementById('clr-'+k); if(el) el.value=design[k]; }
        setMode('ar'); renderBlocksUI();
    }
    window.addEventListener('load', init);
</script>
</body>
</html>
