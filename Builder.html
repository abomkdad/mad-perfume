<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAD Builder PRO v7.0 - CLEAN & STABLE ğŸ’</title>
    <style>
        :root { --primary: #d4af37; --bg: #0f172a; --panel: #1e293b; --text: #f1f5f9; --border: #334155; --danger: #ef4444; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        .main-layout { display: flex; height: 100vh; flex-direction: row-reverse; }
        .preview-pane { flex: 1; background: #020617; display: flex; justify-content: center; align-items: center; border-right: 1px solid var(--border); padding: 20px; overflow: hidden; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; }
        .editor-pane { width: 550px; background: var(--panel); padding: 30px; overflow-y: auto; box-shadow: -5px 0 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 15px; scrollbar-width: thin; }
        .iphone-mockup { width: 375px; height: 812px; background: #000; border-radius: 40px; border: 12px solid #2d2d2d; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; transform: scale(0.7); flex-shrink: 0; }
        .iphone-notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #2d2d2d; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; z-index: 100; }
        .iphone-screen { width: 100%; height: 100%; background: #0b0b0b; border: none; display: block; }
        @media (max-width: 768px) { .main-layout { flex-direction: column; height: auto; overflow: auto; } .preview-pane { display: none; } .editor-pane { width: 100%; height: auto; } }
        h1 { color: var(--primary); margin: 0; font-size: 1.2rem; text-align: center; }
        h2 { font-size: 0.8rem; color: #94a3b8; border-bottom: 1px solid var(--border); padding-bottom: 5px; margin: 15px 0 10px 0; text-transform: uppercase; letter-spacing: 1px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 0.7rem; margin-bottom: 3px; color: #cbd5e1; }
        input, textarea, select { width: 100%; padding: 8px; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 6px; box-sizing: border-box; outline: none; font-size: 0.8rem; }
        input:focus, textarea:focus { border-color: var(--primary); }
        .card-control { background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 10px; position: relative; }
        .btn-delete { background: var(--danger); color: white; border: none; padding: 3px 6px; border-radius: 4px; cursor: pointer; font-size: 0.6rem; position: absolute; top: 8px; left: 8px; z-index: 10; }
        .btn-action { background: var(--primary); color: #000; font-weight: 900; padding: 18px; border-radius: 10px; border: none; cursor: pointer; width: 100%; font-size: 1rem; margin-top: 10px; box-shadow: 0 4px 15px rgba(212,175,55,0.3); }
        .btn-add { background: #334155; color: white; border: 1px solid var(--border); padding: 7px; border-radius: 6px; cursor: pointer; font-size: 0.7rem; flex: 1; transition: 0.2s; }
        .wa-box { border: 1px solid #25d366; background: rgba(37,211,102,0.05); padding: 12px; border-radius: 8px; }
        .user-box { border: 1px solid var(--primary); background: rgba(212,175,55,0.05); padding: 12px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="main-layout">
    <div class="editor-pane">
        <h1>MAD Builder PRO v7.0 ğŸ’</h1>
        
        <!-- WhatsApp Settings -->
        <div class="wa-box">
            <label style="color:#25d366; font-weight:bold;">ğŸŸ¢ ÙˆØ§ØªØ³Ø§Ø¨ (6 Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ±Ø§Øª Ø«Ø§Ø¨ØªØ©)</label>
            <div class="grid-2">
                <div>
                    <label>Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
                    <input type="text" id="waTemplateAr" placeholder="arabic_v3" oninput="updateCommon('waTemplateAr', this.value)">
                </div>
                <div>
                    <label>Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¹Ø¨Ø±ÙŠØ©</label>
                    <input type="text" id="waTemplateHe" placeholder="order_confirmation_he" oninput="updateCommon('waTemplateHe', this.value)">
                </div>
            </div>
        </div>

        <!-- User Auto-Fill -->
        <div class="user-box">
            <label style="color:var(--primary); font-weight:bold;">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø²Ø¨ÙˆÙ†</label>
            <div class="grid-2">
                <input type="text" id="defName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ" oninput="updateCommon('defName', this.value)">
                <input type="text" id="defPhone" placeholder="Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ" oninput="updateCommon('defPhone', this.value)">
            </div>
            <input type="text" id="defAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ" oninput="updateCommon('defAddress', this.value)" style="margin-top:8px">
        </div>

        <div class="form-group">
            <label>1. Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø·Ø± Ø¬Ø§Ù‡Ø²</label>
            <select id="perfumePreset" onchange="applyPreset(this.value)" style="border: 2px solid var(--primary); font-weight: bold;">
                <option value="W183">W183 â€” Creed Aventus</option>
                <option value="X102">X102 â€” Naxos</option>
                <option value="P104">P104 â€” Mr. Sam</option>
                <option value="L102">L102 â€” Ombre Nomade</option>
                <option value="A115">A115 â€” Y Intense</option>
            </select>
        </div>

        <h2>ğŸ¨ Ø§Ù„ØªØµÙ…ÙŠÙ…</h2>
        <div class="grid-2">
            <div><label>Ù„ÙˆÙ† Ø§Ù„ØªÙˆÙ‡Ø¬</label><input type="color" id="clr-primary" oninput="updateDesign('primary', this.value)"></div>
            <div><label>Ø§Ù†Ø­Ù†Ø§Ø¡ px</label><input type="range" min="0" max="50" id="rng-radius" oninput="updateDesign('borderRadius', this.value + 'px')"></div>
        </div>
        <div class="form-group"><input type="checkbox" id="chk-animate" checked onchange="updateDesign('animate', this.checked)"> <label style="display:inline">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø±ÙŠÙƒ</label></div>

        <h2>ğŸ›ï¸ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†ØµÙˆØµ</h2>
        <select id="langSelect" onchange="setMode(this.value)">
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (AR)</option>
            <option value="he">×¢×‘×¨×™×ª (HE)</option>
        </select>
        <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬" oninput="updateData('title', this.value)" style="margin-top:8px">
        <div class="grid-2" style="margin-top:8px">
            <input type="text" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±" oninput="updateData('price', this.value)">
            <input type="text" id="old" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…" oninput="updateData('old', this.value)">
        </div>
        <textarea id="desc" placeholder="Ø§Ù„ÙˆØµÙ" oninput="updateData('desc', this.value)" rows="2" style="margin-top:8px"></textarea>
        <textarea id="notes" placeholder="Ø§Ù„Ù†ÙˆØªØ§Øª (HTML)" oninput="updateData('notes', this.value)" rows="3" style="margin-top:8px"></textarea>
        
        <div class="grid-2" style="margin-top:8px">
            <input type="text" id="badge" placeholder="Ù†Øµ Ø§Ù„Ø´Ø§Ø±Ø©" oninput="updateData('badge', this.value)">
            <input type="text" id="cta" placeholder="Ù†Øµ Ø²Ø± Ø§Ù„Ø´Ø±Ø§Ø¡" oninput="updateData('cta', this.value)">
        </div>

        <h2>âš–ï¸ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Manifesto)</h2>
        <div id="maniItemsContainer"></div>
        <button class="btn-add" onclick="addManiItem()">+ Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù…Ù‚Ø§Ø±Ù†Ø©</button>

        <h2>ğŸ§© Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© - ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹)</h2>
        <div id="blocksContainer"></div>
        <div style="display:flex; gap:5px; flex-wrap: wrap;">
            <button class="btn-add" onclick="addBlock('carousel')">+ ÙƒØ±Ø³ÙˆÙ„</button>
            <button class="btn-add" onclick="addBlock('image')">+ ØµÙˆØ±Ø©</button>
            <button class="btn-add" onclick="addBlock('video')">+ ÙÙŠØ¯ÙŠÙˆ</button>
            <button class="btn-add" onclick="addBlock('html')">+ ÙƒÙˆØ¯ Ø­Ø±</button>
        </div>

        <h2>âš™ï¸ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª</h2>
        <input type="text" id="googleScript" placeholder="Google Script URL" oninput="updateCommon('googleScript', this.value)">
        <div class="grid-2" style="margin-top:8px">
            <input type="text" id="fbPixel" placeholder="FB Pixel" oninput="updateCommon('fb', this.value)">
            <input type="text" id="ttPixel" placeholder="TT Pixel" oninput="updateCommon('tt', this.value)">
        </div>

        <button class="btn-action" onclick="download()">ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØµÙØ­Ø© ğŸ“¥</button>
    </div>

    <div class="preview-pane">
        <div class="iphone-mockup"><div class="iphone-notch"></div><iframe id="preview" class="iphone-screen"></iframe></div>
    </div>
</div>

<script>
    let mode = 'ar';
    const design = { bgBody: "#0b0b0b", primary: "#d4af37", textMain: "#ffffff", borderColor: "rgba(212, 175, 55, 0.15)", bgForm: "#161616", borderRadius: "24px", sectionSpacing: "40px", animate: true };
    const common = { 
        logo: "https://abomkdad.github.io/Digital-Business-Card/logo.png", googleScript: "", fb: "", tt: "",
        waTemplateAr: "arabic_v3", waTemplateHe: "order_confirmation_he",
        defName: "", defPhone: "", defAddress: "",
        maniItems: [
            { id: 1, labelAr:'Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„ØµØ­ÙŠ', labelHe:'×‘×˜×™×—×•×ª ×‘×¨×™××•×ª×™×ª', madAr:'Ø¢Ù…Ù†Ø© 100% ÙˆÙ…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† IFRA.', madHe:'×‘×˜×•×— ×‘-100% ×•×××•×©×¨ ×¢"×™ IFRA.' },
            { id: 2, labelAr:'Ø§Ù„Ø«Ø¨Ø§Øª ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡', labelHe:'×¢××™×“×•×ª ×•×‘×™×¦×•×¢×™×', madAr:'ØªØ±ÙƒÙŠØ² Extrait ÙŠØ¯ÙˆÙ… 24+ Ø³Ø§Ø¹Ø©.', madHe:'×¨×™×›×•×– Extrait ×”××—×–×™×§ 24+ ×©×¢×•×ª.' },
            { id: 3, labelAr:'Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹Ø·Ø±ÙŠØ©', labelHe:'×”× ×“×¡×ª × ×™×—×•×—', madAr:'ØªØ·Ø§Ø¨Ù‚ Ø¬Ø²ÙŠØ¦ÙŠ Ø¯Ù‚ÙŠÙ‚ ÙˆØªØ¹ØªÙŠÙ‚ Ù„Ø£Ø´Ù‡Ø±.', madHe:'×”×ª×××” ××•×œ×§×•×œ×¨×™×ª ×•×™×™×©×•×Ÿ.' },
            { id: 4, labelAr:'Ù…ØµØ¯Ø± Ø§Ù„Ø²ÙŠÙˆØª', labelHe:'××§×•×¨ ×”×©×× ×™×', madAr:'Ø®Ù„Ø§ØµØ§Øª Ø£ÙˆØ±ÙˆØ¨ÙŠØ© Ù†Ø®Ø¨ Ø£ÙˆÙ„.', madHe:'×ª××¦×™×•×ª ××™×¨×•×¤××™×•×ª ××•×‘×—×¨×•×ª.' },
            { id: 5, labelAr:'Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„ØµØ­ÙŠ', labelHe:'×”×©×¤×¢×” ×‘×¨×™××•×ª×™×ª', madAr:'Ù„Ø§ ÙŠØ³Ø¨Ø¨ ØµØ¯Ø§Ø¹ Ø£Ùˆ Ø­Ø³Ø§Ø³ÙŠØ©.', madHe:'××™× ×• ×’×•×¨× ×œ×›××‘×™ ×¨××©.' },
            { id: 6, labelAr:'Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ø¶Ù…Ø§Ù†', labelHe:'×©×™×¨×•×ª ×•××—×¨×™×•×ª', madAr:'Ø®Ø¯Ù…Ø© Ø²Ø¨Ø§Ø¦Ù† Ù…Ø¹ 41 ÙØ±Ø¹Ø§Ù‹ Ù„Ù„Ø¶Ù…Ø§Ù†.', madHe:'×©×™×¨×•×ª ×œ×§×•×—×•×ª ×¢× 41 ×¡× ×™×¤×™×.' }
        ],
        blocks: []
    };
    const db = {
        ar: { title: "W183 â€” Creed Aventus", price: "400 â‚ª", old: "350 â‚ª", badge: "Premium Collection", desc: "Ø±Ø§Ø¦Ø­Ø© Ø±Ø¬ÙˆÙ„ÙŠØ© ÙØ®Ù…Ø© Ø¨Ø·Ø§Ø¨Ø¹ Ø£Ù†Ø§Ù†Ø§Ø³ Ø¯Ø®Ø§Ù†ÙŠ.", notes: "<b>Ø§Ù„Ù†ÙˆØªØ§Øª:</b> Ø£Ù†Ø§Ù†Ø§Ø³ØŒ ØªÙØ§Ø­ØŒ Ù…Ø³Ùƒ", cta: "Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†", maniTitle: "Ù„Ù…Ø§Ø°Ø§ MAD PARFUMEURØŸ", formTitle: "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹", namePh: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„", phonePh: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", addressPh: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†", payTitle: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹", payCash: "Ù†Ù‚Ø¯Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…", payVisa: "Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†", procTitle: "Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨", procContact: "ØªÙˆØ§ØµÙ„ÙˆØ§ Ù…Ø¹ÙŠ Ù„Ù„ØªØ£ÙƒÙŠØ¯", procDirect: "Ø´Ø­Ù† Ù…Ø¨Ø§Ø´Ø±", submit: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† âœ…", successMsg: "ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…" },
        he: { title: "W183 â€” Creed Aventus", price: "â‚ª 400", old: "â‚ª 350", badge: "Premium Collection", desc: "× ×™×—×•×— ×’×‘×¨×™ ×™×•×§×¨×ª×™ ×¢× ××•×¤×™ ×× × ×¡ ××¢×•×©×Ÿ.", notes: "<b>×ª×•×•×™×:</b> ×× × ×¡, ×ª×¤×•×—, ××•×©×§", cta: "×”×–××Ÿ ×¢×›×©×™×•", maniTitle: "?×œ××” MAD PARFUMEUR", formTitle: "×¤×¨×˜×™ ×”×–×× ×” ××”×™×¨×”", namePh: "×©× ××œ×", phonePh: "××¡×¤×¨ ×˜×œ×¤×•×Ÿ", addressPh: "×™×™×©×•×‘ ×•×›×ª×•×‘×ª", payTitle: "×××¦×¢×™ ×ª×©×œ×•×", payCash: "××–×•××Ÿ ×œ×©Ù„ÙŠØ­", payVisa: "×›×¨×˜×™×¡ ××©×¨××™", procTitle: "×©×™×˜×ª ××©×œ×•×—", procContact: "×©×™×—×” Ø·Ù„ÙÙˆÙ†ÙŠØª Ù„Ø§ÙŠ×©×•×¨", procDirect: "××©Ù„ÙˆØ­ ÙŠØ´ÙŠØ±", submit: "×‘×¦×¢ ×”×–×× ×” âœ…", successMsg: "×”×”×–×× ×” ×”×ª×§×‘×œ×” ×‘×”×¦×œØ­Ø©! âœ…" }
    };

    function render() { const f = document.getElementById('preview'); if(f) { const d = f.contentWindow.document; d.open(); d.write(getHTML()); d.close(); } }

    function applyPreset(code) { 
        db.ar.title = code; db.he.title = code;
        setMode(mode);
    }

    function addManiItem() { common.maniItems.push({ id: Date.now(), labelAr: '', labelHe: '', madAr: '' }); renderManiUI(); render(); }
    function renderManiUI() {
        const c = document.getElementById('maniItemsContainer'); if (!c) return; c.innerHTML = "";
        common.maniItems.forEach(item => {
            const div = document.createElement('div'); div.className = 'card-control';
            div.innerHTML = `<button class="btn-delete" onclick="common.maniItems=common.maniItems.filter(i=>i.id!=${item.id}); renderManiUI(); render()">X</button>
            <input type="text" placeholder="Ø¹Ù†ÙˆØ§Ù†" value="${mode=='ar'?item.labelAr:item.labelHe}" oninput="const i=common.maniItems.find(x=>x.id==${item.id}); if(mode=='ar')i.labelAr=this.value; else i.labelHe=this.value; render()">
            <textarea style="margin-top:5px" oninput="const i=common.maniItems.find(x=>x.id==${item.id}); if(mode=='ar')i.madAr=this.value; else i.madHe=this.value; render()">${mode=='ar'?item.madAr:item.madHe}</textarea>`;
            c.appendChild(div);
        });
    }

    function addBlock(type) { common.blocks.push({ id: Date.now(), type, content: "" }); renderBlocksUI(); render(); }
    function removeBlock(id) { common.blocks = common.blocks.filter(b => b.id !== id); renderBlocksUI(); render(); }
    function renderBlocksUI() {
        const c = document.getElementById('blocksContainer'); if (!c) return; c.innerHTML = "";
        common.blocks.forEach(b => {
            const div = document.createElement('div'); div.className = 'block-item';
            div.innerHTML = `<div class="block-header"><span>${b.type.toUpperCase()}</span><button class="btn-delete" onclick="removeBlock(${b.id})">Ø­Ø°Ù</button></div><textarea oninput="common.blocks.find(x=>x.id==${b.id}).content=(this.value.includes(',') && '${b.type}'=='carousel' ?this.value.split(','):this.value); render()">${Array.isArray(b.content)?b.content.join(','):b.content}</textarea>`;
            c.appendChild(div);
        });
    }

    function setMode(l) { 
        mode = l; 
        ['title', 'price', 'old', 'badge', 'desc', 'notes', 'cta', 'maniTitle', 'formTitle', 'payTitle', 'payCash', 'payVisa', 'procTitle', 'procContact', 'procDirect', 'submit', 'successMsg'].forEach(id => {
            const el = document.getElementById(id); if (el) el.value = db[mode][id] || '';
        });
        renderManiUI(); renderBlocksUI(); render(); 
    }

    function updateData(k, v) { db[mode][k] = v; render(); }
    function updateCommon(k, v) { common[k] = v; render(); }
    function updateDesign(k, v) { design[k] = v; render(); }

    function getHTML() {
        const sOpen = '<' + 'script'; const sClose = '<' + '/script>';
        let blocksHTML = "";
        common.blocks.forEach((b) => {
            if(b.type === 'carousel' && b.content.length > 0) blocksHTML += `<div x-data="{ active: 0, images: ${JSON.stringify(b.content).replace(/"/g, "'")} }" class="relative w-full aspect-square bg-black rounded-[var(--br)] overflow-hidden shadow-2xl border border-[var(--brd)]"><template x-for="(img, idx) in images"><img x-show="active === idx" :src="img" class="absolute inset-0 w-full h-full object-contain" ${design.animate ? 'x-transition.opacity' : ''}></template><button @click="active = (active === 0 ? images.length - 1 : active - 1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/40 p-2 rounded-full text-white">â—€</button><button @click="active = (active === images.length - 1 ? 0 : active + 1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/40 p-2 rounded-full text-white">â–¶</button></div>`;
            if(b.type === 'image') blocksHTML += `<img src="${b.content}" class="w-full shadow-2xl border border-[var(--brd)]" style="border-radius:var(--br)">`;
            if(b.type === 'video') blocksHTML += `<video src="${b.content}" controls class="w-full" style="border-radius:var(--br)"></video>`;
            if(b.type === 'html') blocksHTML += `<div class="w-full overflow-hidden" style="border-radius:var(--br)">${b.content}</div>`;
        });
        let maniHTML = "";
        common.maniItems.forEach(item => {
            maniHTML += `<div class="border-t border-white/5 py-4 px-4"><div class="text-[11px] font-bold mb-1 uppercase text-[var(--p)]">${mode=='ar'?item.labelAr:item.labelHe}</div><div class="text-[11px] text-slate-300 leading-relaxed">${mode=='ar'?item.madAr:item.madHe}</div></div>`;
        });
        return `<!DOCTYPE html>
<html x-data="app()" :lang="lang" :dir="lang=='ar'?'rtl':'ltr'">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${db[mode].title}</title>
    ${sOpen} src="https://cdn.tailwindcss.com" defer>${sClose}
    ${sOpen} src="https://unpkg.com/lucide@latest" defer>${sClose}
    ${sOpen} src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer>${sClose}
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&family=Cairo:wght@400;700;900&display=swap');
        :root { --p: ${design.primary}; --bg: ${design.bgBody}; --f: ${design.bgForm}; --txt: ${design.textMain}; --br: ${design.borderRadius}; --sp: ${design.sectionSpacing}; --brd: ${design.borderColor}; }
        body { background: var(--bg); color: var(--txt); font-family: 'Heebo', 'Cairo', sans-serif; scroll-behavior: smooth; }
        .gold-gradient { background: linear-gradient(to right, var(--p), #fff, var(--p)); -webkit-background-clip: text; color: transparent; }
        .glass-panel{background:rgba(20,20,20,.6); backdrop-filter:blur(16px); border:1px solid var(--brd); border-radius: var(--br); box-shadow: 0 4px 30px rgba(0,0,0,0.3);}
        input[type="radio"]:checked + div{border-color:var(--p);background-color:rgba(212,175,55,.1)}
        .radio-circle{width:12px;height:12px;border-radius:99px;border:1px solid #555; position:relative;}
        input[type="radio"]:checked + div .radio-circle::after{content:''; position:absolute; inset:2px; background:var(--p); border-radius:99px;}
        ${design.animate ? `.animate-pop{animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);} @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }` : ''}
    </style>
    ${sOpen}>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init','${common.fb}');fbq('track','PageView');${sClose}
    ${sOpen}>!function (w, d, t) { w.TiktokAnalyticsObject = t; var ttq = w[t] = w[t] || []; ttq.methods = ["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"]; ttq.setAndDefer = function(t, e) { t[e] = function() { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }; for (var i = 0; i < ttq.methods.length; i++) { ttq.setAndDefer(ttq, ttq.methods[i]); } ttq.load = function(e) { var i = d.createElement("script"); i.type = "text/javascript"; i.async = true; i.src = "https://analytics.tiktok.com/i18n/pixel/events.js?sdkid=" + e + "&lib=" + t; var n = d.getElementsByTagName("script")[0]; n.parentNode.insertBefore(i, n); }; ttq.load('${common.tt}'); ttq.page(); }(window, document, 'ttq');${sClose}
</head>
<body class="min-h-screen pb-32">
    <div class="fixed inset-0 pointer-events-none z-0"><div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[600px] bg-[var(--p)]/5 blur-[120px]"></div></div>
    <nav class="fixed top-0 w-full z-50 p-4 flex justify-between items-center bg-black/60 backdrop-blur-xl border-b border-white/10">
        <span class="text-2xl font-black gold-gradient" style="font-family:serif">MAD</span>
        <div class="flex gap-2">
            <button @click="lang='ar'; setTimeout(()=>lucide.createIcons(),50)" class="text-[10px] font-black px-3 py-1 rounded-full border" :class="lang=='ar'?'bg-[var(--p)] text-black border-[var(--p)]':'text-[var(--p)] border-[var(--p)]/30'">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
            <button @click="lang='he'; setTimeout(()=>lucide.createIcons(),50)" class="text-[10px] font-black px-3 py-1 rounded-full border" :class="lang=='he'?'bg-[var(--p)] text-black border-[var(--p)]':'text-[var(--p)] border-[var(--p)]/30'">×¢×‘×¨×™×ª</button>
        </div>
    </nav>
    <main class="max-w-md mx-auto px-5 pt-24" :style="{ gap: 'var(--sp)', display: 'flex', flexDirection: 'column' }">
        <section class="text-center space-y-6 ${design.animate ? 'animate-pop' : ''}">
            <h1 class="text-3xl font-bold tracking-tight" x-text="t.title"></h1>
            <div class="flex flex-col items-center"><span class="text-slate-500 line-through text-sm" x-text="t.old"></span><span class="text-5xl font-black gold-gradient" x-text="t.price"></span></div>
            <div class="space-y-6 animate-pop">${blocksHTML}</div>
            <p class="text-slate-300 text-sm opacity-90" x-text="t.desc"></p>
            <div class="glass-panel p-4 text-xs text-right border-r-2" style="border-color:var(--p)" x-html="t.notes"></div>
            <a href="#order" class="block w-full py-5 text-black font-black text-xl shadow-2xl active:scale-95 transition-all text-center uppercase tracking-widest" :style="{ backgroundColor: 'var(--p)', borderRadius: 'var(--br)' }" x-text="t.cta"></a>
        </section>
        <section class="space-y-6 ${design.animate ? 'animate-pop' : ''}"><div class="text-center"><h2 class="text-2xl font-bold mt-1" x-text="t.maniTitle"></h2></div><div class="glass-panel overflow-hidden">${maniHTML}</div></section>
        <section id="order" class="p-8 space-y-6 shadow-2xl ${design.animate ? 'animate-pop' : ''}" :style="{ background: 'var(--f)', borderRadius: 'var(--br)' }">
            <h2 class="text-2xl font-black text-center" x-text="t.formTitle"></h2>
            <form @submit.prevent="submitOrder" class="space-y-5">
                <input x-model="f.name" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" placeholder="${db.ar.namePh}" required>
                <input x-model="f.phone" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" placeholder="${db.ar.phonePh}" required dir="ltr">
                <input x-model="f.address" class="w-full p-4 rounded-xl bg-black/40 border border-white/10 outline-none focus:border-[var(--p)] text-right" placeholder="${db.ar.addressPh}" required>
                <div class="space-y-3"><label class="text-[10px] text-slate-400 font-bold uppercase" x-text="t.payTitle"></label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="cursor-pointer"><input type="radio" value="Cash" x-model="f.payment" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex flex-col items-center gap-2 bg-black/20 hover:bg-white/5 transition-all"><span class="text-[10px] font-bold" x-text="t.payCash"></span><div class="radio-circle"></div></div></label>
                        <label class="cursor-pointer"><input type="radio" value="Visa" x-model="f.payment" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex flex-col items-center gap-2 bg-black/20 hover:bg-white/5 transition-all"><span class="text-[10px] font-bold" x-text="t.payVisa"></span><div class="radio-circle"></div></div></label>
                    </div>
                </div>
                <div class="space-y-3"><label class="text-[10px] text-slate-400 font-bold uppercase" x-text="t.procTitle"></label>
                    <div class="grid grid-cols-1 gap-2">
                        <label class="cursor-pointer"><input type="radio" value="Contact" x-model="f.process" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex justify-between items-center bg-black/20 transition-all"><span class="text-[10px] font-bold" x-text="t.procContact"></span><div class="radio-circle"></div></div></label>
                        <label class="cursor-pointer"><input type="radio" value="Direct" x-model="f.process" class="hidden"><div class="border border-white/10 rounded-xl p-3 flex justify-between items-center bg-black/20 transition-all"><span class="text-[10px] font-bold" x-text="t.procDirect"></span><div class="radio-circle"></div></div></label>
                    </div>
                </div>
                <button type="submit" class="w-full py-5 text-black font-black text-xl shadow-lg active:scale-95 transition-all" :style="{ backgroundColor: 'var(--p)', borderRadius: 'var(--br)' }" x-text="loading ? '...' : t.submit"></button>
            </form>
        </section>
    </main>
    <div x-show="ui.ok" class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-[#111] border border-[var(--p)]/30 p-8 rounded-3xl max-w-xs w-full text-center shadow-2xl animate-pop">
            <div class="w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-500/30"><i data-lucide="check" class="w-8 h-8 text-green-500"></i></div>
            <h3 class="text-xl font-bold text-white mb-2" x-text="t.successMsg">Success!</h3>
            <button @click="ui.ok=false" class="w-full bg-[#161616] border border-white/10 text-white py-3 rounded-xl hover:bg-[#222] transition-colors font-bold text-sm mt-4">Close</button>
        </div>
    </div>
    ${sOpen}>function app(){return {db:${JSON.stringify(db)},lang:'ar',f:{name:'${common.defName}',phone:'${common.defPhone}',address:'${common.defAddress}',payment:'Cash',process:'Contact'},loading:false,ui:{ok:false},get t(){return this.db[this.lang]},async submitOrder(){this.loading=true;const fd=new FormData();fd.append('name',this.f.name);fd.append('phone',this.f.phone);fd.append('address',this.f.address);fd.append('offer',this.t.title);fd.append('lang',this.lang);fd.append('payment',this.f.payment);fd.append('process',this.f.process);fd.append('wa_template',this.lang=='ar'?'${common.waTemplateAr}':'${common.waTemplateHe}');fd.append('params_count','6');try{await fetch('${common.googleScript}',{method:'POST',body:fd,mode:'no-cors'});if(typeof fbq!=='undefined')fbq('track','Purchase',{value:400,currency:'ILS'});this.ui.ok=true;}catch(e){console.error('Error');}finally{this.loading=false;}}}} ${sClose}
    ${sOpen}>window.addEventListener('DOMContentLoaded',()=> { if(window.lucide) lucide.createIcons(); });${sClose}
</body>
</html>`;
    }

    function download() { const l=document.createElement('a'); l.href=URL.createObjectURL(new Blob([getHTML()],{type:'text/html'})); l.download='index.html'; l.click(); }

    function init() {
        ['logo', 'googleScript', 'fbPixel', 'ttPixel', 'defName', 'defPhone', 'defAddress', 'waTemplateAr', 'waTemplateHe'].forEach(id => {
            const el = document.getElementById(id); if (el) {
                if (common[id] !== undefined) el.value = common[id];
            }
        });
        setMode('ar');
    }
    window.addEventListener('load', init);
</script>
</body>
</html>
