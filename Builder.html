<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAD Builder V54 - AE Template Edition ğŸ›¡ï¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest" defer></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&family=Tajawal:wght@200..900&display=swap');
    [x-cloak] { display:none !important; }
    body { font-family:'Cairo', sans-serif; background:#f1f5f9; height:100vh; overflow:hidden; }
    .app-layout { display:flex; height:100vh; flex-direction:row-reverse; }
    .editor-sidebar { width:420px; background:#fff; border-left:1px solid #cbd5e1; overflow-y:auto; padding:20px; flex-shrink:0; box-shadow:-5px 0 15px rgba(0,0,0,0.05); }
    .preview-area { flex:1; background:#cbd5e1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; overflow: hidden; }
    .iphone { width:375px; height:750px; background:#000; border-radius:45px; border:12px solid #1e293b; overflow:hidden; position:relative; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5); background-color:#fff; transition:transform 0.3s; transform-origin: center; }
    .iphone iframe { width:100%; height:100%; border:none; background:#fff; }
    .section-box { background:#f8fafc; border:1px solid #e2e8f0; border-radius:12px; padding:15px; margin-bottom:15px; }
    .section-title { font-weight:900; font-size:0.85rem; color:#1e293b; margin-bottom:10px; display:flex; align-items:center; gap:5px; text-transform: uppercase; }
    input, textarea, select { width:100%; padding:8px 12px; border:1px solid #cbd5e1; border-radius:8px; font-size:12px; outline:none; transition:0.2s; background: white; }
    input:focus { border-color:#3b82f6; ring: 2px; ring-color: #3b82f6; }
    .btn-grid { display:grid; grid-template-columns:repeat(2, 1fr); gap:8px; }
    .btn-add { background:#fff; border:1px solid #e2e8f0; padding:10px; border-radius:8px; font-size:11px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:5px; transition:0.2s; }
    .btn-add:hover { background:#f1f5f9; border-color:#3b82f6; color:#3b82f6; }
    .btn-action { width:100%; padding:14px; border-radius:12px; font-weight:900; margin-top:10px; cursor:pointer; text-align:center; transition: 0.2s; }
    .zoom-controls { position:fixed; bottom:20px; right:20px; background:rgba(30,41,59,0.9); padding:8px 16px; border-radius:99px; display:flex; gap:15px; color:white; z-index:50; align-items:center; font-size:14px; backdrop-blur: sm; }
  </style>
</head>
<body>

<div class="app-layout" x-data="builderApp()" x-init="init()" x-cloak>
  <aside class="editor-sidebar">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-xl font-black text-slate-800 tracking-tighter">MAD <span class="text-rose-500">BUILDER AE</span></h1>
      <div class="flex bg-slate-100 p-1 rounded-lg">
        <button @click="editLang='ar'; update()" :class="editLang==='ar'?'bg-white shadow text-black':'text-gray-500'" class="px-3 py-1 rounded text-[10px] font-bold transition">AR</button>
        <button @click="editLang='he'; update()" :class="editLang==='he'?'bg-white shadow text-black':'text-gray-500'" class="px-3 py-1 rounded text-[10px] font-bold transition">HE</button>
      </div>
    </div>

    <!-- Product Info -->
    <div class="section-box border-rose-100 bg-rose-50/30">
      <span class="section-title text-rose-700">ğŸ’° Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ø¹Ø± (VSA)</span>
      <div class="flex gap-2">
        <input type="text" x-model="config.productName" @input="update()" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ">
        <input type="number" x-model="config.price" @input="update()" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="w-1/3">
      </div>
    </div>

    <!-- Technical Settings -->
    <div class="section-box border-blue-100 bg-blue-50/30">
      <span class="section-title text-blue-700">ğŸ”— Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„Ù…Ø¯ÙŠØ±</span>
      <input type="text" x-model="config.sheetUrl" class="mb-2 font-mono text-[10px]" placeholder="Google Script URL" @input="update()">
      <div class="flex gap-2">
        <input type="text" x-model="config.adminPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯ÙŠØ± 972" class="font-bold" @input="update()">
        <input type="color" x-model="config.bgColor" @input="update()" class="w-12 h-10 p-1 border-0 bg-transparent cursor-pointer">
      </div>
    </div>

    <!-- Pixels & Advanced Matching -->
    <div class="section-box border-emerald-100 bg-emerald-50/30">
      <span class="section-title text-emerald-700">ğŸ“Š Ø§Ù„ØªØªØ¨Ø¹ (Advanced Matching ğŸ›¡ï¸)</span>
      <div class="space-y-2">
        <input type="text" x-model="config.ttPixel" placeholder="TikTok Pixel ID" @input="update()">
        <input type="text" x-model="config.fbPixel" placeholder="Meta (FB) Pixel ID" @input="update()">
        <input type="text" x-model="config.snapPixel" placeholder="Snapchat Pixel ID" @input="update()">
      </div>
    </div>

    <!-- Blocks List -->
    <div class="section-box">
      <span class="section-title">ğŸ§± Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
      <div class="space-y-3 mb-6">
        <template x-for="(block, index) in blocks" :key="block.id">
          <div class="bg-white border-2 border-slate-100 p-3 rounded-xl relative hover:border-blue-200 transition">
            <div class="flex justify-between items-center mb-2">
               <span class="text-[9px] font-black bg-slate-100 px-2 py-0.5 rounded text-slate-500 uppercase" x-text="block.type"></span>
               <div class="flex gap-2">
                 <button @click="moveBlock(index, -1)" class="text-slate-400 hover:text-blue-500">â†‘</button>
                 <button @click="moveBlock(index, 1)" class="text-slate-400 hover:text-blue-500">â†“</button>
                 <button @click="removeBlock(index)" class="text-rose-400">âœ•</button>
               </div>
            </div>

            <template x-if="block.type === 'text'">
               <textarea x-model="block.content[editLang]" @input="update()" class="h-16 text-[11px]"></textarea>
            </template>

            <template x-if="['image','video','iframe'].includes(block.type)">
               <input type="text" x-model="block.url" @input="update()" placeholder="URL" class="text-[11px]">
            </template>

            <template x-if="block.type === 'form'">
               <div class="space-y-2">
                 <input type="text" x-model="block.content[editLang]" @input="update()" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙˆØ±Ù…" class="text-[11px]">
                 <input type="text" x-model="block.btnText[editLang]" @input="update()" placeholder="Ù†Øµ Ø²Ø± Ø§Ù„Ø·Ù„Ø¨" class="text-[11px] font-bold text-rose-500">
               </div>
            </template>

            <template x-if="block.type === 'comparison' || block.type === 'faq'">
              <p class="text-[10px] text-blue-600 font-bold bg-blue-50 p-2 rounded-lg">ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 6 Ø¹Ù†Ø§ØµØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ…</p>
            </template>
          </div>
        </template>
      </div>

      <!-- Add Buttons -->
      <div class="btn-grid">
        <button class="btn-add border-amber-500 text-amber-600 shadow-sm" @click="addBlock('comparison')">âš–ï¸ +6 Ù…Ù‚Ø§Ø±Ù†Ø§Øª</button>
        <button class="btn-add border-purple-500 text-purple-600 shadow-sm" @click="addBlock('faq')">â“ +6 Ø£Ø³Ø¦Ù„Ø©</button>
        <button class="btn-add" @click="addBlock('text')">ğŸ“ Ù†Øµ</button>
        <button class="btn-add" @click="addBlock('image')">ğŸ–¼ï¸ ØµÙˆØ±Ø©</button>
        <button class="btn-add" @click="addBlock('urgency_box')">ğŸ”¥ Ø§Ø³ØªØ¹Ø¬Ø§Ù„</button>
        <button class="btn-add" @click="addBlock('form')">ğŸ“‹ Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ AE</button>
        <button class="btn-add" @click="addBlock('offers_slider')">ğŸ›’ Ø³Ù„Ø§ÙŠØ¯Ø±</button>
        <button class="btn-add border-emerald-500 text-emerald-600" @click="addBlock('sales_pop')">ğŸ”” Ù…Ø¨ÙŠØ¹Ø§Øª</button>
      </div>
    </div>

    <button class="btn-action bg-black text-white hover:bg-slate-900 shadow-lg" @click="downloadHTML()">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</button>
    <button class="btn-action bg-slate-100 text-slate-700" @click="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  </aside>

  <main class="preview-area">
    <div class="zoom-controls">
      <button @click="zoom = Math.max(0.3, zoom - 0.1)">-</button>
      <span x-text="Math.round(zoom*100)+'%'"></span>
      <button @click="zoom = Math.min(1.2, zoom + 0.1)">+</button>
      <button @click="update()" class="border-r border-white/20 pr-3 mr-1">ğŸ”„</button>
    </div>
    <div class="iphone" :style="`transform: scale(${zoom})`">
      <iframe id="preview-frame"></iframe>
    </div>
  </main>
</div>

<script>
function builderApp() {
  return {
    editLang: 'ar',
    zoom: 0.85,
    timeout: null,
    config: {
      bgColor: '#f07d70',
      logoUrl: 'https://madperfume.ps/upload/01-2026/page/6977cf82b87ef.png',
      heroTitle: { ar: 'Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­ØµØ±ÙŠØ©', he: '×”××‘×¦×¢×™× ×”×‘×œ×¢×“×™×™× ×‘×™×•×ª×¨' },
      productName: 'big-sale',
      price: '500',
      adminPhone: '972525105889',
      sheetUrl: 'https://script.google.com/macros/s/AKfycbw7m6OCcTnH6CILpTo2TVRZIXXy5cui-zhKsCq3k491yaun5Hd5b_QECTjCrpCytkndDg/exec',
      fbPixel: '1072283127290819',
      ttPixel: 'D2D02JBC77U4ENLN9SBG',
      snapPixel: 'b143822e-1c3c-40ff-93f7-edadee74e626'
    },
    blocks: [
      { id: 1, type: 'text', content: { ar: 'ØªÙˆØµÙŠÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚', he: '××©×œ×•×— ×—×™× ×' }, align: 'center', style: { color: '#000', size: 'text-lg', font: 'Cairo', weight: 'font-black' }, btnText: {ar:'',he:''} },
      { id: 2, type: 'form', content: { ar: 'Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†', he: '×”×–×× ×” ××”×™×¨×”' }, btnText: { ar: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨', he: '×©×œ×— ×”×–×× ×”' }, align: 'center' }
    ],

    init() { setTimeout(() => this.update(), 500); },
    update() {
      clearTimeout(this.timeout);
      this.timeout = setTimeout(() => {
        const frame = document.getElementById('preview-frame');
        if (frame) frame.srcdoc = this.generateFinalHTML();
      }, 300);
    },

    addBlock(type) {
      let b = { id: Date.now(), type, content: { ar: 'Ù†Øµ Ø¬Ø¯ÙŠØ¯', he: '×˜×§×¡×˜ ×—×“×©' }, url: '', align: 'center', btnText: { ar: 'Ø§Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨', he: '×©×œ×— ×”×–×× ×”' }, items: [], style: { color: '#000', size: 'text-lg', font: 'Cairo', weight: 'font-bold' } };
      
      if (type === 'comparison') {
        b.items = [
          { mad: {ar:'Ø¨ØµÙ…Ø© Ø£Ù…Ø§Ù† 100% ÙˆÙ…ØµØ§Ø¯Ù‚ Ù…Ù† IFRA',he:'×‘×˜×•×— ×‘-100% ×•×××•×©×¨ ×¢"×™ IFRA'}, other: {ar:'Ø²ÙŠÙˆØª ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ© Ù…Ø¬Ù‡ÙˆÙ„Ø© Ø§Ù„Ù…ØµØ¯Ø±',he:'×©×× ×™× ×××§×•×¨ ×œ× ×™×“×•×¢'} },
          { mad: {ar:'ØªØ·Ø§Ø¨Ù‚ Ø¬Ø²ÙŠØ¦ÙŠ ÙˆØªØ±ÙƒÙŠØ² Ù†ÙŠØ´ Ø­Ù‚ÙŠÙ‚ÙŠ',he:'×”×ª×××” ××•×œ×§×•×œ×¨×™×ª ×•×¨×™×›×•×– × ×™×©×”'}, other: {ar:'Ø®Ù„Ø· ÙŠØ¯ÙˆÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙŠØªÙÙƒÙƒ ÙÙˆØ±Ø§Ù‹',he:'×¢×¨×‘×•×‘ ×™×“× ×™ ××§×¨××™'} },
          { mad: {ar:'Ø«Ø¨Ø§Øª ÙØ§Ø¦Ù‚ ÙŠØªØ¬Ø§ÙˆØ² 24 Ø³Ø§Ø¹Ø©',he:'×¢××™×“×•×ª ××¢×œ 24 ×©×¢×•×ª'}, other: {ar:'ÙŠØ®ØªÙÙŠ Ø¨Ø¹Ø¯ Ø£Ù‚Ù„ Ù…Ù† Ø³Ø§Ø¹Ø©',he:'× ×¢×œ× ××”×¨'} },
          { mad: {ar:'Ù„Ø§ ÙŠØ³Ø¨Ø¨ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ø£Ùˆ Ø§Ù„ØµØ¯Ø§Ø¹',he:'×œ× ×’×•×¨× ×œ××œ×¨×’×™×•×ª ××• ×›××‘×™ ×¨××©'}, other: {ar:'Ù…Ø°ÙŠØ¨Ø§Øª ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ© Ø¶Ø§Ø±Ø©',he:'×××¡×™× ×›×™××™×™× ××–×™×§×™×'} },
          { mad: {ar:'Ø®Ø¯Ù…Ø© Ø²Ø¨Ø§Ø¦Ù† Ùˆ41 ÙØ±Ø¹ ÙÙŠ Ø§Ù„Ø¨Ù„Ø§Ø¯',he:'×©×™×¨×•×ª ×œ×§×•×—×•×ª ×•-41 ×¡× ×™×¤×™× ×‘××¨×¥'}, other: {ar:'Ù…ØªØ§Ø¬Ø± Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø¨Ù„Ø§ Ø¹Ù†ÙˆØ§Ù†',he:'×—× ×•×™×•×ª ××•× ×œ×™×™×Ÿ ×œ×œ× ×›×ª×•×‘×ª'} },
          { mad: {ar:'ØªØ¹ØªÙŠÙ‚ ÙˆØªØµÙÙŠØ© Ù…Ø®Ø¨Ø±ÙŠØ© Ø£ÙˆØ±ÙˆØ¨ÙŠØ©',he:'×™×™×©×•×Ÿ ×•×¡×™× ×•×Ÿ ××¢×‘×“×ª×™ ××™×¨×•×¤××™'}, other: {ar:'Ø²ÙŠÙˆØª ØªØ¬Ø§Ø±ÙŠØ© Ø±Ø®ÙŠØµØ©',he:'×©Ù…× ×™× ××¡×—Ø±ÙŠ×™× ×–×•×œ×™×'} }
        ];
      }

      if (type === 'faq') {
        b.items = [
          { q: {ar:'Ù‡Ù„ Ø§Ù„Ø¹Ø·ÙˆØ± Ø£ØµÙ„ÙŠØ©ØŸ',he:'×”×× ×”×‘×©××™× ××§×•×¨×™×™×?'}, a: {ar:'Ù†Ø¹Ù…ØŒ Ø¬Ù…ÙŠØ¹ Ø¹Ø·ÙˆØ±Ù†Ø§ Ø£ØµÙ„ÙŠØ© 100% ÙˆÙ…ØµØ§Ø¯Ù‚ Ø¹Ù„ÙŠÙ‡Ø§.',he:'×›×Ÿ, ×›×œ ×”×‘×©××™× ×©×œ× ×• ××§×•×¨×™×™×.'} },
          { q: {ar:'ÙƒÙ… Ù…Ø¯Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ØŸ',he:'××” ×–××Ÿ ×”××©×œ×•×—?'}, a: {ar:'Ø§Ù„ØªÙˆØµÙŠÙ„ Ø®Ù„Ø§Ù„ 2-3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚.',he:'××©×œ×•×— ×ª×•×š 2-3 ×™××™ ×¢×¡×§×™×.'} },
          { q: {ar:'Ù‡Ù„ Ø§Ù„Ø±Ø§Ø¦Ø­Ø© Ø«Ø§Ø¨ØªØ©ØŸ',he:'×”×× ×”×¨×™×— ×¢××™×“?'}, a: {ar:'Ù†Ø¹Ù…ØŒ ØªØ±ÙƒÙŠØ² Ø¹Ø·ÙˆØ±Ù†Ø§ Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø£Ù‚ØµÙ‰ Ø«Ø¨Ø§Øª.',he:'×›×Ÿ, ×”×¨×™×— × ×©××¨ ×œ××•×¨×š ×–××Ÿ.'} },
          { q: {ar:'Ù‡Ù„ ÙŠØªÙˆÙØ± Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…ØŸ',he:'×™×© ×ª×©×œ×•× ×‘××–×•××Ÿ?'}, a: {ar:'Ù†Ø¹Ù…ØŒ Ù†ÙˆÙØ± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.',he:'×›×Ÿ, ×ª×©×œ×•× ×‘××–×•××Ÿ ×‘×§×‘×œ×ª ×”××•×¦×¨.'} },
          { q: {ar:'Ø£ÙŠÙ† ÙØ±ÙˆØ¹ÙƒÙ…ØŸ',he:'××™×¤×” ×”×¡× ×™×¤×™×?'}, a: {ar:'Ù„Ø¯ÙŠÙ†Ø§ Ø£ÙƒØ«Ø± Ù…Ù† 40 ÙØ±Ø¹ Ù…Ù†ØªØ´Ø±Ø© ÙÙŠ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ø¨Ù„Ø§Ø¯.',he:'×™×© ×œ× ×• ××¢×œ 40 ×¡× ×™×¤×™×.'} },
          { q: {ar:'Ù…Ø§Ø°Ø§ Ù„Ùˆ Ù„Ù… ÙŠØ¹Ø¬Ø¨Ù†ÙŠ Ø§Ù„Ø¹Ø·Ø±ØŸ',he:'××” ×× ×œ× ××”×‘×ª×™?'}, a: {ar:'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„.',he:'× ×™×ª×Ÿ ×œ×¤× ×•×ª ××œ×™× ×• ×œ×”×—×œ×¤×”.'} }
        ];
      }
      if (type === 'urgency_box') { b.sold = "600"; b.left = "8"; b.visitors = "550"; b.timerMinutes = 15; }
      if (type === 'offers_slider') { b.title = {ar:'Ø¹Ø±ÙˆØ¶ Ù‚Ø¯ ØªØ¹Ø¬Ø¨Ùƒ', he:'××•×¦×¨×™× × ×•×¡×¤×™×'}; b.items = [{img:'https://via.placeholder.com/150', title:{ar:'Ø¹Ø·Ø± Ù…Ø«Ø§Ù„', he:'×‘×•×©× ×œ×“×•×’××”'}, price:'350', link:'#'}]; }
      this.blocks.push(b); this.update();
    },

    removeBlock(i) { this.blocks.splice(i, 1); this.update(); },
    moveBlock(i, d) {
      const ni = i + d;
      if (ni >= 0 && ni < this.blocks.length) { [this.blocks[i], this.blocks[ni]] = [this.blocks[ni], this.blocks[i]]; this.update(); }
    },

    downloadHTML() {
      const blob = new Blob([this.generateFinalHTML()], { type: 'text/html' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'MAD_Landing_AE.html'; a.click();
    },

    copyCode() { navigator.clipboard.writeText(this.generateFinalHTML()); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!'); },

    generateFinalHTML() {
      const blocksJSON = JSON.stringify(this.blocks).replace(/</g, '\\u003c');
      const configJSON = JSON.stringify(this.config).replace(/</g, '\\u003c');
      
      return `<!DOCTYPE html>
<html x-data="app()" x-init="init(null)" :lang="lang" :dir="lang==='he'?'ltr':'rtl'">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAD Landing</title>
  <script src="https://cdn.tailwindcss.com"><\/script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer><\/script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap" rel="stylesheet">
  <style>
    body { background: ${this.config.bgColor}; font-family: 'Cairo', sans-serif; overflow-x: hidden; min-height: 100vh; }
    .inp { width: 100%; padding: 15px; background: #f8fafc; border: 1px solid #ddd; border-radius: 12px; margin-bottom: 10px; font-weight: bold; text-align: center; }
    .btn-main { background: #000; color: #fff; width: 100%; padding: 18px; border-radius: 14px; font-weight: 900; font-size: 1.2rem; animation: pulse 2s infinite; cursor: pointer; border:none; box-shadow: 0 4px 14px rgba(0,0,0,0.2); }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    .progress-container { margin-bottom: 15px; }
    .progress-text { display: flex; justify-content: space-between; font-size: 0.75rem; font-weight: bold; margin-bottom: 5px; opacity: 0.7; }
    .progress-track { height: 6px; background: #e5e7eb; border-radius: 99px; overflow: hidden; }
    .progress-fill { height: 100%; background: #10b981; width: 85%; }
    .mad-radio-box { border: 2px solid #e5e7eb; border-radius: 12px; padding: 12px; text-align: center; background: white; font-weight: 700; cursor: pointer; transition: 0.2s; }
    input:checked + .mad-radio-box { border-color: #10b981; background: #f0fdf4; color: #047857; transform: scale(1.02); }
    .recommended { border-color: #10b981; position: relative; }
    .recommended::after { content: 'â˜…'; position: absolute; top: -8px; right: -8px; background: #10b981; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; display: flex; align-items: center; justify-content: center; }
    .sales-pop { animation: slideIn 0.5s ease-out forwards; }
    @keyframes slideIn { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .no-scrollbar::-webkit-scrollbar { display: none; }
  </style>
  <script>
    // TikTok E.164 normalization with required + sign
    function formatE164(p) {
      if(!p) return '';
      let d = String(p).replace(/[^0-9]/g, '');
      if(d.startsWith('05') && d.length === 10) d = '972' + d.slice(1);
      if(d.startsWith('00')) d = d.slice(2);
      return '+' + d; // Mandatory for TikTok Advanced Matching
    }
    function loadPixels() {
      if(window._px_f) return; window._px_f = true;
      if('${this.config.fbPixel}') {
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)n=f.fbq;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '${this.config.fbPixel}'); fbq('track', 'PageView');
      }
      if('${this.config.ttPixel}') {
        !function(w,d,t){w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];
        ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"];
        ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};
        for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
        ttq.load=function(e,n){ var r="https://analytics.tiktok.com/i18n/pixel/events.js";
        ttq._i=ttq._i||{}; ttq._i[e]=[]; ttq._i[e]._u=r; ttq._t=ttq._t||{}; ttq._t[e]=+new Date;
        ttq._o=ttq._o||{}; ttq._o[e]=n||{}; var o=document.createElement("script");o.type="text/javascript";o.async=!0;o.src=r+"?sdkid="+e+"&lib="+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};
        ttq.load('${this.config.ttPixel}'); ttq.page(); }(window,document,'ttq');
      }
      if('${this.config.snapPixel}') {
        (function(e,t,n){if(e.snaptr)return;var a=e.snaptr=function(){a.handleRequest?a.handleRequest.apply(a,arguments):a.queue.push(arguments)};a.queue=[];var s='script';var r=t.createElement(s);r.async=!0;r.src=n;var u=t.getElementsByTagName(s)[0];u.parentNode.insertBefore(r,u)})(window,document,'https://sc-static.net/scevent.min.js');
        snaptr('init', '${this.config.snapPixel}'); snaptr('track', 'PAGE_VIEW');
      }
    }
  <\/script>
</head>
<body class="pb-20">
  <nav class="p-4 flex justify-center bg-white/40 backdrop-blur sticky top-0 z-50"><img src="${this.config.logoUrl}" class="h-10 object-contain"></nav>
  <header class="text-center py-8 px-4"><h1 class="text-3xl font-black" x-text="c.heroTitle[lang]"></h1></header>

  <main class="max-w-md mx-auto px-4">
    <template x-for="b in blocks">
      <div class="my-6" :class="'text-'+(b.align||'center')">
        <template x-if="b.type==='text'"><p class="whitespace-pre-wrap leading-relaxed font-bold text-lg" x-text="b.content[lang]"></p></template>
        <template x-if="b.type==='image'"><img :src="b.url" class="rounded-2xl mx-auto shadow-lg w-full"></template>
        
        <template x-if="b.type==='urgency_box'">
          <div x-data="{ v: parseInt(b.visitors), s: parseInt(b.left) }" class="bg-white/90 p-5 rounded-2xl shadow-sm border-l-4 border-red-500 text-right">
            <div class="flex justify-between items-center mb-2"><span class="text-[10px] font-black bg-red-600 text-white px-2 py-1 rounded">ğŸ”¥ HOT</span><div class="text-lg font-mono font-black text-red-600" x-text="timer"></div></div>
            <p class="text-xs font-bold text-gray-600">ğŸ‘ï¸ <span x-text="v"></span> Ø²ÙˆØ§Ø± ÙŠØ´Ø§Ù‡Ø¯ÙˆÙ† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</p>
            <div class="w-full bg-gray-200 h-2 rounded-full mt-2 overflow-hidden"><div class="bg-red-500 h-full" :style="'width:'+(s*10)+'%'"></div></div>
          </div>
        </template>

        <template x-if="b.type==='comparison'">
          <div class="space-y-2 mt-4 text-right">
            <template x-for="row in b.items">
              <div class="grid grid-cols-2 gap-1 rounded-xl overflow-hidden shadow-sm">
                <div class="bg-amber-50 p-4 border-r border-amber-100 text-center font-bold text-[11px]" x-text="row.mad[lang]"></div>
                <div class="bg-white p-4 text-center text-gray-400 text-[11px]" x-text="row.other[lang]"></div>
              </div>
            </template>
          </div>
        </template>

        <template x-if="b.type==='faq'">
          <div class="bg-white rounded-2xl p-4 shadow-sm space-y-2 text-right">
            <template x-for="qa in b.items">
              <div class="border-b last:border-0 pb-2" x-data="{open:false}">
                <button @click="open=!open" class="w-full flex justify-between font-bold text-sm text-black">
                  <span x-text="qa.q[lang]"></span><span x-text="open?'-':'+'"></span>
                </button>
                <p x-show="open" class="text-xs text-gray-500 mt-1" x-text="qa.a[lang]"></p>
              </div>
            </template>
          </div>
        </template>

        <template x-if="b.type==='form'">
          <div class="bg-white p-6 rounded-[24px] shadow-sm text-right border-2 border-gray-100" id="order">
            <div class="progress-container">
              <div class="progress-text">
                <span x-text="lang==='he'?'×¤×¨×˜×™ ××©×œ×•×—':'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†'"></span>
                <span x-text="lang==='he'?'×©×œ×‘ ××—×¨×•×Ÿ':'Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©'"></span>
              </div>
              <div class="progress-track"><div class="progress-fill"></div></div>
            </div>
            <h2 class="text-xl font-black text-center mb-4" x-text="b.content[lang]"></h2>
            <form @submit.prevent="submitForm">
              <input type="text" x-model="f.name" @input="trackInput()" class="inp" :placeholder="lang==='he'?'×©× ××œ×':'Ø§Ù„Ø§Ø³Ù…'" required>
              <input type="tel" x-model="f.phone" @input="trackInput()" class="inp" :placeholder="lang==='he'?'×˜×œ×¤×•×Ÿ':'Ø§Ù„Ù‡Ø§ØªÙ'" dir="ltr" required>
              <input type="text" x-model="f.address" class="inp" :placeholder="lang==='he'?'×›×ª×•×‘×ª':'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'" required>
              <div class="grid grid-cols-2 gap-3 mb-4">
                <label class="cursor-pointer"><input type="radio" x-model="f.payment" value="Cash" class="hidden"><div class="mad-radio-box recommended"><span x-text="lang==='he'?'××–×•××Ÿ ğŸ’µ':'Ù†Ù‚Ø¯ ğŸ’µ'"></span><div class="text-[9px] text-green-600 font-normal" x-text="lang==='he'?'××•××œ×¥':'Ù…ÙˆØµÙ‰ Ø¨Ù‡'"></div></div></label>
                <label class="cursor-pointer"><input type="radio" x-model="f.payment" value="Visa" class="hidden"><div class="mad-radio-box"><span x-text="lang==='he'?'××©×¨××™ ğŸ’³':'ÙÙŠØ²Ø§ ğŸ’³'"></span></div></label>
              </div>
              <div class="grid grid-cols-2 gap-3 mb-6">
                <label class="cursor-pointer"><input type="radio" x-model="f.process" value="Direct" class="hidden"><div class="mad-radio-box recommended"><span class="text-xs" x-text="lang==='he'?'×©×œ×— ×”×–×× ×”':'Ø§Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨'"></span><div class="text-[9px] text-blue-600 font-normal">ğŸš€ Ø£Ø³Ø±Ø¹</div></div></label>
                <label class="cursor-pointer"><input type="radio" x-model="f.process" value="Contact" class="hidden"><div class="mad-radio-box"><span class="text-xs" x-text="lang==='he'?'×¦×•×¨ ×§×©×¨':'ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ'"></span></div></label>
              </div>
              <button type="submit" class="btn-main mt-2 w-full" x-text="loading?'...':b.btnText[lang]" :disabled="loading"></button>
            </form>
          </div>
        </template>
      </div>
    </template>
  </main>

  <div x-show="loading" class="fixed inset-0 z-50 bg-black/90 flex flex-col items-center justify-center text-white" style="display:none">
    <div class="text-5xl mb-4 animate-bounce">ğŸš€</div>
    <h2 class="text-xl font-bold" x-text="lang==='he'?'×©×•×œ×— ×”×–×× ×”...':'Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...'"></h2>
  </div>

  <div x-show="submitted" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center text-center" style="display:none">
    <div class="bg-white text-black p-10 rounded-3xl max-w-xs shadow-2xl">
      <div class="text-6xl mb-4">âœ…</div>
      <h3 class="text-2xl font-black mb-2" x-text="lang==='he'?'×”×”×–×× ×” ×”×ª×§×‘×œ×”!':'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!'"></h3>
      <button @click="submitted=false" class="w-full bg-black text-white py-4 rounded-xl font-bold mt-4">Close</button>
    </div>
  </div>

<script>
function app() {
  return {
    lang: 'ar', loading: false, submitted: false, pop: {show:false, msg:''},
    blocks: ${blocksJSON}, c: ${configJSON}, f: {name:'', phone:'', address:'', payment:'Cash', process:'Direct'},
    time: 900, hasStartedTyping: false,
    get timer() { const m=Math.floor(this.time/60); const s=this.time%60; return \`\${m}:\${s<10?'0':''}\${s}\`; },
    init() {
      this.lang = navigator.language.startsWith('he') ? 'he' : 'ar';
      setInterval(() => { if(this.time>0) this.time-- }, 1000);
      loadPixels();
    },
    trackInput() {
      if(!this.hasStartedTyping && this.f.name.length > 2) {
         this.hasStartedTyping = true;
         this.track('AddToCart');
      }
    },
    track(ev) {
      let ph = formatE164(this.f.phone);
      if(window.ttq) {
        // Manual Advanced Matching implementation
        if(ph.length >= 10) ttq.identify({ phone_number: ph, name: this.f.name });
        ttq.track(ev==='AddToCart'?'AddToCart':'CompletePayment', { 
           content_id:this.c.productName, 
           content_type: 'product',
           value: Number(this.c.price), 
           currency:'ILS' 
        });
      }
      if(window.fbq) fbq('track', ev, { value: Number(this.c.price), currency: 'ILS', content_ids: [this.c.productName], content_type: 'product' });
      if(window.snaptr) {
        if(ev==='Purchase') snaptr('track', 'PURCHASE', { currency: 'ILS', price: Number(this.c.price) });
        else if(ev==='AddToCart') snaptr('track', 'ADD_CART', { item_ids: [this.c.productName] });
      }
    },
    async submitForm() {
      this.loading = true; this.track('Purchase');
      let fd = new FormData(); Object.keys(this.f).forEach(k=>fd.append(k, this.f[k]));
      fd.append('offer', this.c.productName); fd.append('price', this.c.price); fd.append('lang', this.lang);
      try {
        await fetch(this.c.sheetUrl, { method: 'POST', body: fd, mode: 'no-cors' });
        this.submitted = true;
      } catch(e) { alert('Error'); } finally { this.loading = false; }
    }
  }
}
<\/script>
</body>
</html>`;
    }
  }
}
</script>
</body>
</html>
