<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>MAD PARFUMEUR | TikTok Special Offer</title>

    <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],ttq.setAndVerifyTTQ=function(t,n){var s=ttq._t;s[t]=n,ttq.setAndVerifyTTQ.checked||ttq.page()};ttq.load=function(e,n){var i="https://analytics.tiktok.com/i18n/pixel/events.js";ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=i,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n;var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=i+'?sdkid='+e+'&lib='+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)};
      ttq.load('D2D02JBC77U4ENLN9SBG');
      ttq.page();
    }(window, document, 'ttq');

    function trackTikTok(eventName, branch, type) {
        ttq.track(eventName, { content_name: branch, content_category: type, currency: 'ILS' });
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --gold: #d4af37; --dark-bg: #0a0a0a; --card-bg: #161616; --wa-green: #25D366; --waze-blue: #33CCFF; --text-main: #ffffff; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--dark-bg); color: var(--text-main); font-family: 'Assistant', 'Cairo', sans-serif; direction: rtl; opacity: 0; transition: opacity 0.5s; }

        header {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.9)), 
                        url('https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg') center/cover;
            padding: 50px 15px 80px; text-align: center; border-bottom: 2px solid var(--gold);
        }
        .logo img { width: 130px; filter: drop-shadow(0 0 15px rgba(212,175,55,0.4)); margin-bottom: 15px; }
        .brand-name { font-size: 26px; font-weight: 900; color: var(--gold); margin-bottom: 5px; }
        .hero-tag { font-size: 16px; font-weight: 700; opacity: 0.8; margin-bottom: 25px; }

        .main-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; max-width: 500px; margin: 0 auto; }
        .info-btn { background: rgba(212, 175, 55, 0.1); border: 1px solid var(--gold); padding: 12px; border-radius: 15px; text-decoration: none; color: white; display: flex; flex-direction: column; align-items: center; font-size: 12px; font-weight: 800; }
        .info-btn i { color: var(--gold); font-size: 20px; margin-bottom: 5px; }

        .container { max-width: 600px; margin: -40px auto 50px; padding: 0 15px; position: relative; z-index: 10; }
        
        .branch-card { background: var(--card-bg); border-radius: 25px; padding: 25px; margin-bottom: 20px; border: 1px solid rgba(212,175,55,0.1); box-shadow: 0 15px 35px rgba(0,0,0,0.6); position: relative; }
        .branch-card.nearest { border: 2px solid var(--gold); }
        .nearest-badge { position: absolute; top: 0; left: 0; background: var(--gold); color: black; padding: 5px 12px; font-size: 10px; font-weight: 900; border-radius: 0 0 15px 0; display: none; }
        .branch-card.nearest .nearest-badge { display: block; }
        
        .br-title { font-size: 22px; font-weight: 800; color: var(--gold); margin-bottom: 5px; }
        .dist-label { color: var(--wa-green); font-weight: 900; font-size: 14px; margin-bottom: 15px; display: block; }

        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 15px 10px; border-radius: 15px; text-decoration: none; color: white; font-weight: 900; font-size: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .bg-wa { background: var(--wa-green); }
        .bg-waze { background: var(--waze-blue); color: black; }

        #offer-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.96); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px; }
        .modal-content { width: 100%; max-width: 400px; background: #111; border: 2px solid var(--gold); border-radius: 30px; overflow: hidden; text-align: center; }
        .modal-timer { background: var(--gold); color: black; padding: 12px; font-weight: 900; font-size: 1.6rem; }
        .modal-btn { display: block; margin: 20px; background: var(--wa-green); color: white; padding: 18px; border-radius: 50px; text-decoration: none; font-weight: 900; font-size: 18px; }
    </style>
</head>
<body>

<header>
    <div class="logo"><img src="https://abomkdad.github.io/Digital-Business-Card/logo.png"></div>
    <div class="brand-name">MAD PARFUMEUR</div>
    <div class="hero-tag">تواصل مع أقرب فرع لك واحصل على عطرك المفضل</div>

    <div class="main-info-grid">
        <a href="tel:*9935" class="info-btn" onclick="trackTikTok('Contact', 'HeadOffice', 'Call')">
            <i class="fas fa-phone-alt"></i> خدمة الزبائن <span>*9935</span>
        </a>
        <a href="mailto:info@madperfume.co.il" class="info-btn" onclick="trackTikTok('Contact', 'HeadOffice', 'Email')">
            <i class="fas fa-envelope"></i> راسلنا <span>Email Us</span>
        </a>
    </div>
</header>

<div class="container" id="branchesList"></div>

<div id="offer-modal">
    <div class="modal-content">
        <div id="modal-timer" class="modal-timer">00:00:00</div>
        <img src="sale.png" style="width: 100%;" alt="Daily Offer">
        <a id="get-offer-btn" href="#" class="modal-btn">احصل على العرض من أقرب فرع</a>
        <div onclick="closeOffer()" style="padding: 15px; cursor: pointer; opacity: 0.6; font-size: 13px; font-weight: bold;">إغلاق / סגור</div>
    </div>
</div>

<script>
    const userLang = navigator.language.startsWith("he") ? "he" : "ar";
    document.documentElement.lang = userLang;
    document.documentElement.dir = (userLang === "ar") ? "rtl" : "ltr";

    const t = {
        ar: { open:"مفتوح الآن", wa:"واتساب الفرع", waze:"خرائط Waze", km:"كم عنك", nearest:"الأقرب إليك", msg:"مرحباً، جئت من التيك توك وأريد الحصول على عرض اليوم من فرعكم!" },
        he: { open:"פתוח עכשיו", wa:"וואטסאפ לסניף", waze:"ניווט Waze", km:'ק"מ ממך', nearest:"הסניף הקרוב אליך", msg:"שלום, הגעתי מהטיקטוק ואשמח לקבל את המבצע מהסניף שלכם!" }
    }[userLang];

    let nearestBranchData = { phone: "972509787730", name: "Main Office" }; // افتراضي الشركة الأم

    async function init() {
        try {
            const res = await fetch('branches.json?v=' + Date.now());
            const data = await res.json();
            let branches = data.branches;

            render(branches);

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const {latitude: uLat, longitude: uLng} = pos.coords;
                    branches.forEach(b => { if(b.lat) b.dist = calcDist(uLat, uLng, b.lat, b.lng); });
                    branches.sort((a,b) => (a.dist || 9999) - (b.dist || 9999));
                    
                    // تحديث أقرب فرع للمنبثقة
                    if(branches.length > 0) {
                        nearestBranchData = {
                            phone: branches[0].phone,
                            name: branches[0][`name_${userLang}`]
                        };
                        updateOfferButton();
                    }
                    
                    render(branches, true);
                }, null, { timeout: 3000 });
            }
        } catch(e) { console.error(e); }
    }

    function updateOfferButton() {
        const btn = document.getElementById('get-offer-btn');
        const link = `https://wa.me/${nearestBranchData.phone}?text=${encodeURIComponent(t.msg)}`;
        btn.href = link;
        btn.onclick = () => trackTikTok('InitiateCheckout', nearestBranchData.name, 'Popup_Click');
    }

    function render(list, hasLoc = false) {
        const container = document.getElementById('branchesList');
        container.innerHTML = '';
        list.forEach((b, i) => {
            const waze = (b.social && b.social.waze) ? b.social.waze : `https://ul.waze.com/ul?ll=${b.lat},${b.lng}&navigate=yes`;
            const card = document.createElement('div');
            card.className = `branch-card ${hasLoc && i === 0 ? 'nearest' : ''}`;
            card.innerHTML = `
                <div class="nearest-badge">${t.nearest}</div>
                <div class="br-title">${b[`name_${userLang}`]}</div>
                <div class="dist-label">${b.dist ? b.dist.toFixed(1) + ' ' + t.km : ''}</div>
                <div class="btn-group">
                    <a href="https://wa.me/${b.phone}?text=${encodeURIComponent(t.msg)}" class="btn bg-wa" onclick="trackTikTok('Contact', '${b.name_ar}', 'WhatsApp')"><i class="fab fa-whatsapp"></i> ${t.wa}</a>
                    <a href="${waze}" target="_blank" class="btn bg-waze" onclick="trackTikTok('Navigate', '${b.name_ar}', 'Waze')"><i class="fab fa-waze"></i> ${t.waze}</a>
                </div>`;
            container.appendChild(card);
        });
    }

    function calcDist(lat1, lon1, lat2, lon2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180, dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    function openOffer() { document.getElementById('offer-modal').style.display = 'flex'; }
    function closeOffer() { document.getElementById('offer-modal').style.display = 'none'; localStorage.setItem('tt_seen', '1'); }
    
    document.addEventListener('DOMContentLoaded', () => {
        document.body.style.opacity = "1";
        updateOfferButton(); // تفعيل الرابط الافتراضي
        if(!localStorage.getItem('tt_seen')) setTimeout(openOffer, 2500);
        setInterval(() => {
            const diff = new Date().setHours(23, 59, 59) - new Date();
            const h = Math.floor(diff/3600000).toString().padStart(2,'0'), m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0'), s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
            document.getElementById('modal-timer').textContent = `${h}:${m}:${s}`;
        }, 1000);
        init();
    });
</script>
</body>
</html>
