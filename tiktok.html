<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MAD PARFUMEUR | Corporate & Daily Sale</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Assistant:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{ --gold:#D4AF37; --black:#000; --card:#111; --white:#fff; --wa:#25D366; --live-red:#ff0000; }
*{box-sizing:border-box; margin:0; padding:0}
body{background:#000; color:#fff; font-family:'Assistant', sans-serif; opacity:0; transition: opacity 0.5s;}

/* Header Section */
header{
    position: relative; text-align:center; padding: 40px 20px;
    background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.9)), url('https://madperfume.ps/upload/01-2026/page/header_bg.jpg') center/cover;
    border-bottom: 2px solid var(--gold);
}
.logo-img { max-width: 150px; margin-bottom: 15px; filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.3)); }
.branch-name{font-family: 'Cinzel', serif; font-size:1.8rem; font-weight:700; color: var(--gold);}

/* Social & Contact Buttons */
.social-bar { display: flex; justify-content: center; gap: 12px; margin: 20px 0; }
.social-bar a { 
    color: white; font-size: 1.2rem; width: 40px; height: 40px; 
    background: #111; display: flex; align-items: center; justify-content: center; 
    border-radius: 50%; border: 1px solid #333; transition: 0.3s;
}
.social-bar a:hover { color: var(--gold); border-color: var(--gold); }

.action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 15px 20px; max-width: 500px; margin: 0 auto; }
.action-item { 
    background: #111; padding: 15px; border-radius: 12px; text-decoration: none; 
    color: #fff; text-align: center; border: 1px solid #222; font-size: 0.9rem;
}
.action-item i { display: block; font-size: 1.5rem; margin-bottom: 5px; color: var(--gold); }

/* Products Navigation */
.cats-wrapper { position: sticky; top: 0; background: rgba(0,0,0,0.95); z-index: 100; border-bottom: 1px solid #222; padding: 10px 0; }
.cats { display: flex; gap: 10px; overflow-x: auto; padding: 0 15px; scrollbar-width: none; }
.cats::-webkit-scrollbar { display: none; }
.cats button { 
    background: #111; color: #ccc; border: 1px solid #333; padding: 8px 20px; 
    border-radius: 50px; cursor: pointer; white-space: nowrap; transition: 0.3s;
}
.cats button.active { background: var(--gold); color: #000; font-weight: 700; border-color: var(--gold); }

/* Products Grid */
.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 15px; }
@media(min-width: 768px){ .grid { grid-template-columns: repeat(4, 1fr); } }
.card { background: #111; border: 1px solid #222; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; }
.img-box { position: relative; width: 100%; aspect-ratio: 1/1; background: #000; }
.img-box img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.5s; }
.img-box img.loaded { opacity: 1; }
.info { padding: 12px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
.product-title { font-size: 0.85rem; height: 2.4em; overflow: hidden; margin-bottom: 8px; line-height: 1.2; }
.price { color: var(--gold); font-weight: 700; font-size: 1.1rem; margin-bottom: 10px; }
.wa-btn { background: var(--wa); color: #fff; text-decoration: none; padding: 10px; border-radius: 8px; font-weight: 700; font-size: 0.9rem; }

/* Popup Sale System */
#popup-sale { position: fixed; inset: 0; background: rgba(0,0,0,0.92); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px; backdrop-filter: blur(5px); }
.sale-box { width: 100%; max-width: 380px; background: #000; border: 2px solid var(--gold); border-radius: 20px; overflow: hidden; position: relative; animation: zoomIn 0.3s ease-out; }
@keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.close-sale { position: absolute; top: 15px; right: 15px; font-size: 2rem; color: #fff; cursor: pointer; z-index: 11; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); border-radius: 50%; }
.countdown-bar { background: var(--gold); color: #000; padding: 12px; text-align: center; font-weight: 900; font-size: 1.5rem; font-family: 'Cinzel', serif; }
.wa-order-btn { display: block; background: var(--wa); color: #fff; text-align: center; padding: 18px; text-decoration: none; font-weight: 900; font-size: 1.2rem; }

/* Floating Sale Widget */
#reopen-sale {
    position: fixed; bottom: 25px; left: 25px; width: 65px; height: 65px;
    background: var(--gold); border-radius: 50%; display: none;
    align-items: center; justify-content: center; z-index: 999;
    cursor: pointer; box-shadow: 0 5px 20px rgba(212, 175, 55, 0.5);
    animation: bounce 2s infinite;
}
@keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-12px);} 60% {transform: translateY(-6px);} }
.sale-badge { position: absolute; top: -5px; right: -5px; background: var(--live-red); color: white; font-size: 10px; padding: 3px 8px; border-radius: 10px; font-weight: bold; border: 1.5px solid #000; }
</style>
</head>

<body dir="rtl">

<header>
    <img src="https://madperfume.ps/upload/01-2026/page/logo.png" class="logo-img">
    <div class="branch-name">MAD PARFUMEUR</div>
    <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 5px;">מטה החברה | الفرع الرئيسي</p>

    <div class="social-bar">
        <a href="https://www.facebook.com/MADPARFUMEURISRAEL/" target="_blank"><i class="fab fa-facebook-f"></i></a>
        <a href="https://www.instagram.com/perfume.mad/" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="https://www.tiktok.com/@mad.perfume" target="_blank"><i class="fab fa-tiktok"></i></a>
        <a href="https://snapchat.com/t/jbtN32Xe" target="_blank"><i class="fab fa-snapchat"></i></a>
        <a href="https://www.youtube.com/watch?v=NVCKAp2-6HM" target="_blank"><i class="fab fa-youtube"></i></a>
    </div>

    <div class="action-grid">
        <a href="tel:*9935" class="action-item">
            <i class="fas fa-phone-alt"></i>
            שירות לקוחות<br><strong>*9935</strong>
        </a>
        <a href="https://wa.me/972509787730" class="action-item">
            <i class="fab fa-whatsapp"></i>
            וואטסאפ חברה<br><strong>WhatsApp</strong>
        </a>
    </div>
</header>

<div class="cats-wrapper">
    <nav id="cats" class="cats"></nav>
</div>

<main id="grid" class="grid"></main>

<div id="popup-sale">
    <div class="sale-box">
        <span class="close-sale" onclick="closeSale()">&times;</span>
        <img src="https://madperfume.ps/upload/01-2026/page/sale.png" style="width:100%; display:block" alt="Daily Sale">
        <div id="sale-timer" class="countdown-bar">00:00:00</div>
        <a id="sale-wa-link" class="wa-order-btn" target="_blank">קבלת ההטבה עכשיו!</a>
    </div>
</div>

<div id="reopen-sale" onclick="openSale()">
    <i class="fas fa-gift" style="color:#000; font-size:1.6rem"></i>
    <span class="sale-badge">מבצע</span>
</div>

<script>
const CONFIG = {
    phone: "972509787730",
    csvUrl: "products.csv",
    lang: {
        order: "הזמנה בוואטסאפ",
        all: "הכל",
        msg: "היי، אני מעוניין במוצר: ",
        saleMsg: "שלום, אשמח לקבל פרטים על המבצע היומי של MAD"
    }
};

let products = [];
let timerInterval;

async function init() {
    try {
        const response = await fetch(CONFIG.csvUrl);
        const text = await response.text();
        parseCSV(text);
        renderCats();
        renderGrid('all');
        initDailySale();
        document.body.style.opacity = "1";
    } catch (e) {
        console.error("Error:", e);
        document.body.style.opacity = "1";
    }
}

function parseCSV(text) {
    const lines = text.split('\n');
    for(let i = 1; i < lines.length; i++) {
        const col = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(!col[1]) continue;
        products.push({
            title: col[1].replace(/"/g,'').trim(),
            img: col[4] ? col[4].trim() : '',
            price: col[10] ? col[10].replace('ILS', '').trim() + ' ₪' : '',
            cat: col[11] ? col[11].trim() : 'General'
        });
    }
}

function renderCats() {
    const nav = document.getElementById('cats');
    const categories = [CONFIG.lang.all, ...new Set(products.map(p => p.cat))];
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.textContent = cat;
        btn.className = cat === CONFIG.lang.all ? 'active' : '';
        btn.onclick = (e) => {
            document.querySelectorAll('.cats button').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            renderGrid(cat === CONFIG.lang.all ? 'all' : cat);
        };
        nav.appendChild(btn);
    });
}

function renderGrid(filter) {
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    const filtered = filter === 'all' ? products : products.filter(p => p.cat === filter);
    
    const observer = new IntersectionObserver(entries => {
        entries.forEach(en => {
            if(en.isIntersecting) {
                const img = en.target;
                img.src = img.dataset.src;
                img.onload = () => img.classList.add('loaded');
                observer.unobserve(img);
            }
        });
    });

    filtered.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div class="img-box"><img data-src="${p.img}" alt="${p.title}"></div>
            <div class="info">
                <div class="product-title">${p.title}</div>
                <div class="price">${p.price}</div>
                <a class="wa-btn" target="_blank" href="https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(CONFIG.lang.msg + p.title)}">
                    <i class="fab fa-whatsapp"></i> ${CONFIG.lang.order}
                </a>
            </div>
        `;
        grid.appendChild(card);
        observer.observe(card.querySelector('img'));
    });
}

// Sale Logic
function initDailySale() {
    const saleKey = 'mad_sale_' + new Date().toDateString();
    document.getElementById('sale-wa-link').href = `https://wa.me/${CONFIG.phone}?text=${encodeURIComponent(CONFIG.lang.saleMsg)}`;

    if (localStorage.getItem(saleKey)) {
        document.getElementById('reopen-sale').style.display = 'flex';
    } else {
        setTimeout(openSale, 2500); // يفتح العرض بعد ثانيتين ونصف من الدخول
    }
}

function openSale() {
    document.getElementById('popup-sale').style.display = 'flex';
    document.getElementById('reopen-sale').style.display = 'none';
    startTimer();
}

function closeSale() {
    document.getElementById('popup-sale').style.display = 'none';
    document.getElementById('reopen-sale').style.display = 'flex';
    localStorage.setItem('mad_sale_' + new Date().toDateString(), 'seen');
    clearInterval(timerInterval);
}

function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        const now = new Date();
        const end = new Date();
        end.setHours(23, 59, 59);
        const diff = end - now;

        if (diff <= 0) {
            clearInterval(timerInterval);
            return;
        }

        const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
        const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
        const s = Math.floor((diff % 60000) / 1000).padStart(2, '0');
        document.getElementById('sale-timer').textContent = `${h}:${m}:${s}`;
    }, 1000);
}

init();
</script>
</body>
</html>
