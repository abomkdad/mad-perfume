<!DOCTYPE html>
<html lang="he" id="html-tag">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MAD PARFUMEUR | Corporate Branch</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Assistant:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{ --gold:#D4AF37; --black:#000; --card:#111; --white:#fff; --wa:#25D366; --live-red:#ff0000; }
*{box-sizing:border-box; margin:0; padding:0}
body{background:#000; color:#fff; font-family:'Assistant', sans-serif; opacity:0; transition: opacity 0.5s;}

/* Header & Identity */
header{
    position: relative; text-align:center; padding: 40px 20px;
    background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.95)), url('header_bg.jpg') center/cover;
    border-bottom: 2px solid var(--gold);
}
.logo-img { max-width: 160px; margin-bottom: 15px; filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.3)); }
.branch-name{font-family: 'Cinzel', serif; font-size:1.8rem; font-weight:700; color: var(--gold); margin-bottom: 5px;}

/* Social & Actions */
.social-bar { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
.social-bar a { color: white; font-size: 1.3rem; width: 45px; height: 45px; background: #111; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid #333; transition: 0.3s; }
.social-bar a:hover { color: var(--gold); border-color: var(--gold); transform: translateY(-3px); }

.action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px 25px; max-width: 550px; margin: 0 auto; }
.action-item { background: #111; padding: 18px 10px; border-radius: 15px; text-decoration: none; color: #fff; text-align: center; border: 1px solid #222; transition: 0.3s; }
.action-item i { display: block; font-size: 1.8rem; margin-bottom: 8px; color: var(--gold); }

/* Navigation & Products */
.cats-wrapper { position: sticky; top: 0; background: rgba(0,0,0,0.95); z-index: 100; border-bottom: 1px solid #222; padding: 12px 0; backdrop-filter: blur(10px); }
.cats { display: flex; gap: 10px; overflow-x: auto; padding: 0 15px; scrollbar-width: none; }
.cats::-webkit-scrollbar { display: none; }
.cats button { background: #111; color: #ccc; border: 1px solid #333; padding: 10px 22px; border-radius: 50px; cursor: pointer; white-space: nowrap; transition: 0.3s; font-weight: 600; }
.cats button.active { background: var(--gold); color: #000; border-color: var(--gold); }

.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 15px; }
@media(min-width: 768px){ .grid { grid-template-columns: repeat(4, 1fr); gap: 20px; } }
.card { background: #111; border: 1px solid #222; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
.img-box { position: relative; width: 100%; aspect-ratio: 1/1; background: #080808; overflow: hidden; }
.img-box img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.6s ease; }
.img-box img.loaded { opacity: 1; }
.info { padding: 15px; text-align: center; flex-grow: 1; }
.product-title { font-size: 0.9rem; height: 2.6em; overflow: hidden; margin-bottom: 10px; color: #eee; }
.price { color: var(--gold); font-weight: 700; font-size: 1.2rem; margin-bottom: 15px; }
.wa-btn { background: var(--wa); color: #fff; text-decoration: none; padding: 12px; border-radius: 8px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px; }

/* Popup & Widget */
#popup-sale { position: fixed; inset: 0; background: rgba(0,0,0,0.94); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px; }
.sale-box { width: 100%; max-width: 400px; background: #000; border: 2px solid var(--gold); border-radius: 20px; overflow: hidden; position: relative; }
.close-sale { position: absolute; top: 15px; right: 15px; font-size: 2rem; color: #fff; cursor: pointer; z-index: 100; background: rgba(0,0,0,0.4); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
.countdown-bar { background: var(--gold); color: #000; padding: 15px; text-align: center; font-weight: 900; font-size: 1.6rem; font-family: 'Cinzel', serif; }
.wa-order-btn { display: block; background: var(--wa); color: #fff; text-align: center; padding: 20px; text-decoration: none; font-weight: 900; font-size: 1.3rem; }

#reopen-sale { position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px; background: var(--gold); border-radius: 50%; display: none; align-items: center; justify-content: center; z-index: 999; cursor: pointer; animation: bounce 2s infinite; }
@keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} }
.sale-badge { position: absolute; top: -5px; right: -5px; background: var(--live-red); color: white; font-size: 10px; padding: 2px 8px; border-radius: 10px; font-weight: bold; border: 1.5px solid #000; }
</style>
</head>

<body id="body-tag">

<header>
    <img src="logo.png" class="logo-img">
    <div class="branch-name">MAD PARFUMEUR</div>
    <div id="sub-title" style="font-size:1rem; opacity:0.8;"></div>

    <div class="social-bar">
        <a href="https://www.facebook.com/MADPARFUMEURISRAEL/" target="_blank"><i class="fab fa-facebook-f"></i></a>
        <a href="https://www.instagram.com/perfume.mad/" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="https://www.tiktok.com/@mad.perfume" target="_blank"><i class="fab fa-tiktok"></i></a>
        <a href="https://snapchat.com/t/jbtN32Xe" target="_blank"><i class="fab fa-snapchat"></i></a>
        <a href="https://www.youtube.com/watch?v=NVCKAp2-6HM" target="_blank"><i class="fab fa-youtube"></i></a>
    </div>

    <div class="action-grid">
        <a href="tel:*9935" class="action-item">
            <i class="fas fa-phone-alt"></i>
            <span id="cs-text"></span><br><strong>*9935</strong>
        </a>
        <a href="https://wa.me/972509787730" class="action-item">
            <i class="fab fa-whatsapp"></i>
            <span id="wa-corp-text"></span><br><strong>WhatsApp</strong>
        </a>
    </div>
</header>

<div class="cats-wrapper"><nav id="cats" class="cats"></nav></div>
<main id="grid" class="grid"></main>

<div id="popup-sale">
    <div class="sale-box">
        <span class="close-sale" onclick="closeSale()">&times;</span>
        <img src="sale.png" style="width:100%; display:block">
        <div id="sale-timer" class="countdown-bar">00:00:00</div>
        <a id="sale-wa-link" class="wa-order-btn"></a>
    </div>
</div>

<div id="reopen-sale" onclick="openSale()">
    <i class="fas fa-gift" style="color:#000; font-size:1.5rem"></i>
    <span id="badge-text" class="sale-badge"></span>
</div>

<script>
// تحديد اللغة بناءً على المتصفح
const userLang = navigator.language.startsWith('ar') ? 'ar' : 'he';
document.getElementById('html-tag').lang = userLang;
document.getElementById('body-tag').dir = 'rtl'; // اللغتان من اليمين لليسار

const TRANSLATIONS = {
    ar: {
        subTitle: "الفرع الرئيسي | مركز الخدمة",
        cs: "خدمة العملاء",
        waCorp: "واتساب الشركة",
        order: "طلب الآن",
        all: "الكل",
        msg: "مرحباً، أنا مهتم بعطر: ",
        saleBtn: "احصل على العرض اليومي الآن",
        saleMsg: "مرحباً، أود الحصول على العرض اليومي الخاص بشركة MAD",
        badge: "عرض"
    },
    he: {
        subTitle: "מטה החברה | מוקד שירות",
        cs: "שירות לקוחות",
        waCorp: "וואטסאפ חברה",
        order: "הזמנה",
        all: "הכל",
        msg: "היי, אני מעוניין בבושם: ",
        saleBtn: "קבלת ההטבה היומית עכשיו",
        saleMsg: "שלום, אשמח לקבל את ההטبة היומית של MAD",
        badge: "מבצע"
    }
};

const T = TRANSLATIONS[userLang];
let products = [];
let timerInterval;

function applyStaticTranslations() {
    document.getElementById('sub-title').textContent = T.subTitle;
    document.getElementById('cs-text').textContent = T.cs;
    document.getElementById('wa-corp-text').textContent = T.waCorp;
    document.getElementById('sale-wa-link').textContent = T.saleBtn;
    document.getElementById('badge-text').textContent = T.badge;
}

async function start() {
    applyStaticTranslations();
    try {
        const res = await fetch('products.csv');
        const text = await res.text();
        parseCSV(text);
        renderCats();
        renderGrid('all');
        initDailySale();
        document.body.style.opacity = "1";
    } catch (e) { console.error(e); document.body.style.opacity = "1"; }
}

function parseCSV(text) {
    const lines = text.split('\n');
    for(let i=1; i<lines.length; i++) {
        const c = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(!c[1]) continue;
        products.push({
            title: c[1].replace(/"/g,'').trim(),
            img: c[4] ? c[4].trim() : '',
            price: c[10] ? c[10].replace('ILS', '').trim() + ' ₪' : '',
            cat: c[11] ? c[11].trim() : 'General'
        });
    }
}

function renderCats() {
    const nav = document.getElementById('cats');
    const categories = [T.all, ...new Set(products.map(p => p.cat))];
    categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.textContent = cat;
        btn.className = cat === T.all ? 'active' : '';
        btn.onclick = (e) => {
            document.querySelectorAll('.cats button').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            renderGrid(cat === T.all ? 'all' : cat);
        };
        nav.appendChild(btn);
    });
}

function renderGrid(f) {
    const g = document.getElementById('grid'); g.innerHTML = '';
    const list = f === 'all' ? products : products.filter(p => p.cat === f);
    const obs = new IntersectionObserver(es => {
        es.forEach(e => {
            if(e.isIntersecting) {
                const img = e.target; img.src = img.dataset.src;
                img.onload = () => img.classList.add('loaded');
                obs.unobserve(img);
            }
        });
    });
    list.forEach(p => {
        const d = document.createElement('div'); d.className = 'card';
        d.innerHTML = `
            <div class="img-box"><img data-src="${p.img}"></div>
            <div class="info">
                <div class="product-title">${p.title}</div>
                <div class="price">${p.price}</div>
                <a class="wa-btn" target="_blank" href="https://wa.me/972509787730?text=${encodeURIComponent(T.msg + p.title)}">
                    <i class="fab fa-whatsapp"></i> ${T.order}
                </a>
            </div>`;
        g.appendChild(d); obs.observe(d.querySelector('img'));
    });
}

function initDailySale() {
    const saleKey = 'mad_sale_v2_' + new Date().toDateString();
    document.getElementById('sale-wa-link').href = `https://wa.me/972509787730?text=${encodeURIComponent(T.saleMsg)}`;
    if (localStorage.getItem(saleKey)) document.getElementById('reopen-sale').style.display = 'flex';
    else setTimeout(openSale, 3000);
}

function openSale() { document.getElementById('popup-sale').style.display = 'flex'; document.getElementById('reopen-sale').style.display = 'none'; startTimer(); }
function closeSale() { document.getElementById('popup-sale').style.display = 'none'; document.getElementById('reopen-sale').style.display = 'flex'; localStorage.setItem('mad_sale_v2_' + new Date().toDateString(), 'seen'); clearInterval(timerInterval); }

function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        const diff = new Date().setHours(23, 59, 59) - new Date();
        const h = Math.floor(diff/3600000).toString().padStart(2,'0');
        const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
        const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
        document.getElementById('sale-timer').textContent = `${h}:${m}:${s}`;
    }, 1000);
}

start();
</script>
</body>
</html>
