<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MAD | Product</title>

<style>
body{margin:0;font-family:system-ui;background:#0b0d10;color:#fff;padding:20px}
.card{max-width:900px;margin:auto;background:#111;border-radius:20px;padding:20px}
img{width:100%;border-radius:16px;margin-bottom:15px}
h1{margin:0 0 10px}
.desc{background:#1a1a1a;padding:15px;border-radius:14px;margin:15px 0;line-height:1.8}
.btn{display:inline-block;padding:12px 16px;border-radius:12px;text-decoration:none;font-weight:700;margin:5px 5px 0 0}
.gold{background:#C5A059;color:#000}
.dark{background:#222;color:#fff}
</style>
</head>

<body>
<div class="card">
<h1 id="title">Loading...</h1>
<img id="img" src="">
<div class="desc" id="desc"></div>

<a id="viewBtn" class="btn gold" target="_blank">شاهد المنتج</a>
<a id="waBtn" class="btn dark" target="_blank">اطلب على واتساب</a>
</div>

<script>
const CSV_URL = "p.csv"; // اسم الملف اللي رفعتَه
const DEFAULT_WA = "972524033442";

function qs(name){
  return new URL(location.href).searchParams.get(name) || "";
}

async function load(){
  const code = qs("code");
  if(!code){
    document.body.innerHTML = "لازم تضيف ?code=XF A.112 بالرابط";
    return;
  }

  const res = await fetch(CSV_URL + "?v=" + Date.now());
  const text = await res.text();
  const rows = text.split("\n").map(r=>r.split(","));
  const headers = rows.shift();

  const idx = (name)=>headers.indexOf(name);

  const CODE = idx("PRODUCT CODE");
  const LINK = idx("LINK");
  const IMG  = idx("FRAG_URL"); // إذا بدك صورة من فراغرانتيكا
  const DESC = idx("DESC_AR");

  const found = rows.find(r => r[CODE] && r[CODE].trim() === code.trim());

  if(!found){
    document.body.innerHTML = "لم يتم العثور على المنتج";
    return;
  }

  document.getElementById("title").innerText = found[CODE];
  document.getElementById("desc").innerText  = found[DESC] || "";

  // صورة من رابط المنتج نفسه (أذكى)
  document.getElementById("img").src = "https://madperfume.co.il/upload/01-2026/product/697baa1c54b65.png";

  document.getElementById("viewBtn").href = found[LINK];

  const msg = `مرحبا، بدي هذا المنتج: ${found[CODE]}\n${found[LINK]}`;
  document.getElementById("waBtn").href =
    `https://wa.me/${DEFAULT_WA}?text=${encodeURIComponent(msg)}`;
}

load();
</script>
</body>
</html>
