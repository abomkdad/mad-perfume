<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MAD | Product</title>

  <style>
    :root{--bg:#0b0d10;--card:#11151c;--muted:#aab3c2;--text:#f2f5fb;--gold:#C5A059;}
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: radial-gradient(1200px 700px at 50% -200px, rgba(197,160,89,.25), transparent 60%),
                  linear-gradient(180deg, #07090c, var(--bg));
      color:var(--text);
      min-height:100vh;
      padding:18px;
    }
    .wrap{max-width:980px;margin:0 auto}
    .top{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      margin-bottom:14px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      font-weight:900;letter-spacing:.3px;
    }
    .brand .dot{width:10px;height:10px;border-radius:999px;background:var(--gold);box-shadow:0 0 18px rgba(197,160,89,.7)}
    .pill{
      color:#0b0d10;background:linear-gradient(90deg,#f6e27a,#c5a059);
      padding:8px 12px;border-radius:999px;font-weight:800;font-size:13px;
    }
    .card{
      background: rgba(17,21,28,.88);
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px;
      box-shadow:0 16px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .grid{display:grid;grid-template-columns: 1.05fr .95fr;gap:0}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    .imgBox{
      background:#0a0c10;
      display:flex;align-items:center;justify-content:center;
      padding:14px;
      min-height:420px;
    }
    .imgBox img{
      max-width:100%;
      width:100%;
      height:auto;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background:#0a0c10;
    }
    .info{padding:18px 18px 20px}
    h1{margin:0 0 10px;font-size:22px;line-height:1.25}
    .code{color:var(--muted);font-weight:700;margin-bottom:10px}
    .desc{
      color:#e9eef9;opacity:.92;
      line-height:1.8;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.06);
      padding:12px 12px;
      border-radius:14px;
      white-space:pre-wrap;
      min-height:120px;
    }

    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{
      appearance:none;border:0;cursor:pointer;
      padding:12px 14px;border-radius:14px;
      font-weight:900;font-size:15px;
      text-decoration:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;
      min-width:160px;
      transition:transform .08s ease, filter .08s ease;
    }
    .btn:active{transform:scale(.98)}
    .b1{background:linear-gradient(90deg,#f6e27a,#c5a059);color:#0b0d10}
    .b2{background:rgba(255,255,255,.10);color:var(--text);border:1px solid rgba(255,255,255,.12)}
    .b3{background:rgba(255,255,255,.06);color:var(--muted);border:1px solid rgba(255,255,255,.10)}
    .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.6}
    .err{
      padding:16px;border-radius:16px;background:rgba(255,0,0,.08);
      border:1px solid rgba(255,0,0,.18); color:#ffd9d9;
    }
    .hint{
      padding:14px;border-radius:16px;background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08); color:var(--muted);
    }
    code{background:rgba(255,255,255,.08);padding:2px 6px;border-radius:10px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand"><span class="dot"></span> MAD Parfumeur</div>
      <div class="pill" id="pill">Product</div>
    </div>

    <div class="card" id="card">
      <div class="grid">
        <div class="imgBox">
          <img id="img" alt="MAD Product" src="" />
        </div>
        <div class="info">
          <h1 id="title">جارٍ تحميل المنتج…</h1>
          <div class="code" id="codeLine"></div>
          <div class="desc" id="desc">...</div>

          <div class="row">
            <a class="btn b1" id="btnView" href="#" target="_blank" rel="noopener">شاهد المنتج</a>
            <a class="btn b2" id="btnWA" href="#" target="_blank" rel="noopener">اطلب الآن على واتساب</a>
            <a class="btn b3" id="btnBack" href="#" target="_blank" rel="noopener">رجوع للواتساب</a>
          </div>

          <div class="small" id="small">
            إذا بدك نضيف زر "ضع في السلة" الحقيقي—لازم تعطيني شكل رابط الإضافة للسلة في موقعك (لأنه يختلف من نظام لنظام).
          </div>
        </div>
      </div>
    </div>

    <div style="height:12px"></div>
    <div class="hint">
      مثال رابط الصفحة: <code>p.html?code=W183&amp;to=972524033442</code>
    </div>
  </div>

<script>
/** ✅ إعدادات سريعة */
const CSV_URL = "p.csv"; // موجود عندك في الريبو
const DEFAULT_WA_TO = "972524033442"; // رقم واتساب الإدارة الافتراضي (غيّره إذا بدك)

function qs(name){
  const u = new URL(location.href);
  return u.searchParams.get(name) || "";
}

function normalizePhone(p){
  return String(p||"").replace(/[^\d]/g,"");
}

function pick(row, keys){
  for(const k of keys){
    if(row[k] !== undefined && row[k] !== null && String(row[k]).trim() !== ""){
      return String(row[k]).trim();
    }
  }
  return "";
}

function parseCSV(text){
  // CSV بسيط (بدون اقتباسات معقّدة). إذا عندك وصف فيه فواصل كثيرة داخل اقتباسات خبرني وبعمله parser أقوى.
  const lines = text.replace(/\r/g,"").split("\n").filter(l => l.trim() !== "");
  const headers = lines.shift().split(",").map(h => h.trim());
  return lines.map(line => {
    const cols = line.split(","); // بسيط
    const obj = {};
    headers.forEach((h,i)=> obj[h] = (cols[i] ?? "").trim());
    return obj;
  });
}

async function load(){
  const code = (qs("code") || "").trim();
  const waTo = normalizePhone(qs("to") || DEFAULT_WA_TO);

  const elTitle = document.getElementById("title");
  const elCode = document.getElementById("codeLine");
  const elDesc = document.getElementById("desc");
  const elImg  = document.getElementById("img");
  const btnView = document.getElementById("btnView");
  const btnWA   = document.getElementById("btnWA");
  const btnBack = document.getElementById("btnBack");
  const pill = document.getElementById("pill");

  pill.textContent = code ? `Code: ${code}` : "Product";

  if(!code){
    document.getElementById("card").innerHTML = `<div class="err">لازم تحط كود المنتج في الرابط مثل: <code>p.html?code=W183</code></div>`;
    return;
  }

  const res = await fetch(CSV_URL, {cache:"no-store"});
  if(!res.ok){
    document.getElementById("card").innerHTML = `<div class="err">مش قادر أفتح <code>${CSV_URL}</code> — تأكد إنه موجود بجذر الريبو.</div>`;
    return;
  }

  const csvText = await res.text();
  const rows = parseCSV(csvText);

  // حاول نلاقي العمود حسب أسماء شائعة عندك
  const found = rows.find(r => {
    const c = pick(r, ["PRODUCT CODE","PRODUCT_CODE","CODE","code","product_code"]);
    return c.toUpperCase() === code.toUpperCase();
  });

  if(!found){
    document.getElementById("card").innerHTML = `<div class="err">لم يتم العثور على المنتج بالكود: <code>${code}</code></div>`;
    return;
  }

  const title = pick(found, ["TITLE","title","NAME","name","PRODUCT","product","ORIGINAL_EN","FRAG_MATCH_NAME","orig_norm","orig_can"]) || `MAD ${code}`;
  const desc  = pick(found, ["DESC_AR","DESCRIPTION","description","DESC","desc"]) || "وصف المنتج غير متوفر.";
  const link  = pick(found, ["LINK","link","URL","url"]) || "#";
  const image = pick(found, ["IMAGE_URL","image_url","IMAGE","image","IMG","img"]) || "";

  document.title = `${title} | MAD`;
  elTitle.textContent = title;
  elCode.textContent = `كود المنتج: ${code}`;
  elDesc.textContent = desc;

  if(image){
    elImg.src = image;
  }else{
    elImg.src = "https://www.mad-parfumeur.com/assets/hero/logo2.webp";
  }

  btnView.href = link !== "#" ? link : "https://www.mad-parfumeur.com";

  // رسالة جاهزة ترجع للواتساب
  const msg = `مرحبا، بدي هذا المنتج: ${code}\n${link !== "#" ? link : ""}`;
  const waLink = `https://wa.me/${waTo}?text=${encodeURIComponent(msg)}`;

  btnWA.href = waLink;
  btnBack.href = waLink;
}

load().catch(err=>{
  document.getElementById("card").innerHTML = `<div class="err">خطأ: ${String(err.message||err)}</div>`;
});
</script>
</body>
</html>
