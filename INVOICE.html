<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Commercial Invoice</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        body {
            font-family: 'Helvetica Neue', 'Helvetica', Arial, sans-serif;
            color: #222;
            background-color: #eef2f5;
            margin: 0;
            padding: 20px;
        }
        
        /* ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ */
        .controls {
            max-width: 850px;
            margin: 0 auto 20px auto;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .controls button, .controls label.file-btn {
            background-color: #004080;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: 0.3s;
            font-weight: bold;
        }
        .controls button:hover, .controls label.file-btn:hover { background-color: #00264d; }
        .controls input[type="file"] { display: none; }
        .controls .lang-toggle { background-color: #218838; }
        .controls .lang-toggle:hover { background-color: #1e7e34; }

        /* ÿ™ÿµŸÖŸäŸÖ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© */
        .invoice-box {
            max-width: 850px;
            margin: auto;
            padding: 40px;
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            border-bottom: 3px solid #004080;
            padding-bottom: 20px;
        }
        .header h1 { margin: 0; font-size: 32px; color: #004080; letter-spacing: 1px;}
        .invoice-details p { margin: 5px 0; text-align: right; font-size: 15px;}
        .company-info { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .company-info div { width: 48%; }
        .company-info h3 { border-bottom: 2px solid #eee; padding-bottom: 5px; color: #444; text-transform: uppercase; font-size: 16px;}
        .company-info p { margin: 5px 0; font-size: 14px; color: #333;}
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        table th, table td { padding: 12px 10px; border: 1px solid #ddd; text-align: left; font-size: 14px; }
        table th { background-color: #f8f9fa; color: #333; font-weight: bold; }
        .right { text-align: right; }
        
        td[contenteditable="true"], span[contenteditable="true"] { outline: none; transition: background 0.2s; }
        td[contenteditable="true"]:hover, span[contenteditable="true"]:hover { background-color: #f1f8ff; border-bottom: 1px dashed #004080; }
        
        .totals-wrapper { display: flex; justify-content: space-between; margin-top: 30px; margin-bottom: 20px; page-break-inside: avoid;}
        .stamp-box { width: 40%; text-align: center; min-height: 120px; border: 2px dashed #bbb; display: flex; align-items: center; justify-content: center; position: relative;}
        .stamp-box img { max-width: 180px; max-height: 120px; display: none; }
        .totals { width: 45%; }
        .totals table { border: none; }
        .totals table td, .totals table th { border: none; border-bottom: 1px solid #eee; padding: 10px;}
        .totals table tr:last-child th, .totals table tr:last-child td { border-bottom: 3px solid #004080; font-weight: bold; font-size: 18px; color: #004080;}
        
        .bank-details { padding: 20px; background-color: #f8f9fa; border-left: 5px solid #004080; page-break-inside: avoid;}
        .bank-details p { margin: 5px 0; font-size: 14px; color: #444;}

        .delete-btn { color: #dc3545; cursor: pointer; font-weight: bold; border: none; background: none; font-size: 16px;}

        /* ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ∑ÿ®ÿßÿπÿ© ŸàÿßŸÑŸÄ PDF ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© */
        @media print {
            .controls, .delete-btn { display: none !important; }
            body { background-color: #fff; padding: 0; }
            .invoice-box { box-shadow: none; padding: 0; border: none; max-width: 100%;}
            .stamp-box { border: none; }
            .stamp-text { display: none; }
        }

        /* ŸÖŸÜÿπ ÿßŸÜŸÇÿ≥ÿßŸÖ ÿßŸÑÿ£ÿ≥ÿ∑ÿ± ÿ®ŸäŸÜ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ Ÿàÿ™ŸÉÿ±ÿßÿ± ÿ±ÿ£ÿ≥ ÿßŸÑÿ¨ÿØŸàŸÑ */
        thead { display: table-header-group; }
        tfoot { display: table-footer-group; }
        tr { page-break-inside: avoid; page-break-after: auto; }
        td { page-break-inside: avoid; page-break-after: auto; }
    </style>
</head>
<body>

<div class="controls no-print">
    <button onclick="addRow()">+ Add Row / ÿ≥ÿ∑ÿ± ÿ¨ÿØŸäÿØ</button>
    <label class="file-btn">
        Import Excel / ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ•ŸÉÿ≥ŸäŸÑ
        <input type="file" id="excelUpload" accept=".xlsx, .xls, .csv" onchange="importExcel(event)">
    </label>
    <label class="file-btn">
        Add Stamp / ÿ•ÿ∂ÿßŸÅÿ© ÿÆÿ™ŸÖ
        <input type="file" id="stampUpload" accept="image/*" onchange="addStamp(event)">
    </label>
    <button class="lang-toggle" onclick="toggleLanguage()">üáπüá∑ / üá¨üáß Language</button>
    <button onclick="exportPDF()" style="background-color: #dc3545; margin-left: auto; font-size: 15px;">üìÑ Export Enterprise PDF</button>
</div>

<div class="invoice-box" id="invoice">
    <div class="header">
        <div>
            <h1 id="lbl-title">COMMERCIAL INVOICE</h1>
        </div>
        <div class="invoice-details">
            <p><strong id="lbl-inv-no">Invoice No:</strong> <span contenteditable="true">UGR2026000000001</span></p>
            <p><strong id="lbl-date">Date:</strong> <span contenteditable="true">11.02.2026</span></p>
            <p><strong id="lbl-currency">Currency:</strong> <span contenteditable="true">USD ($)</span></p>
        </div>
    </div>

    <div class="company-info">
        <div>
            <h3 id="lbl-seller">Seller</h3>
            <p><strong contenteditable="true">UGUR SAHIN TEKSTIL ITHALAT IHRACAT LTD STI</strong></p>
            <p contenteditable="true">Basaksehir Mah. Toros Cad.</p>
            <p contenteditable="true">Arterium AVC No 1 /81</p>
            <p contenteditable="true">Basaksehir / Istanbul - Turkey</p>
            <p><strong id="lbl-tax">Tax No:</strong> <span contenteditable="true">8860874431</span></p>
        </div>
        <div>
            <h3 id="lbl-buyer">Buyer</h3>
            <p><strong contenteditable="true">MAD PERFUME LTD</strong></p>
            <p contenteditable="true">Almadena 80</p>
            <p contenteditable="true">Um Alfahem - Israel</p>
            <p><strong id="lbl-vat">VAT:</strong> <span contenteditable="true">515456093</span></p>
            <p><strong id="lbl-tel">Tel:</strong> <span contenteditable="true">00972525105889</span></p>
        </div>
    </div>

    <table id="invoice-table">
        <thead>
            <tr>
                <th id="lbl-desc">Description of Goods</th>
                <th class="right" id="lbl-qty">Quantity</th>
                <th class="right" id="lbl-price">Unit Price</th>
                <th class="right" id="lbl-amount">Amount</th>
                <th class="no-print">‚úñ</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>

    <div class="totals-wrapper">
        <div class="stamp-box" id="stamp-container">
            <span class="stamp-text no-print" style="color:#999; font-weight:bold;">Click to Upload Stamp / Signature</span>
            <img id="stamp-img" src="" alt="Stamp">
        </div>
        <div class="totals">
            <table>
                <tr>
                    <th id="lbl-total-qty">Total Quantity:</th>
                    <td class="right"><span id="total-qty">0</span></td>
                </tr>
                <tr>
                    <th id="lbl-total-amount">Total Amount:</th>
                    <td class="right"><span id="total-amount">0.00</span></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="bank-details">
        <h4 id="lbl-bank-title" style="margin-top:0; color:#004080; font-size:16px;">Bank Details</h4>
        <p><strong id="lbl-bank-name">Bank Name:</strong> <span contenteditable="true">T√úRKƒ∞YE EMLAK KATILIM BANKASI</span></p>
        <p><strong id="lbl-branch">Branch:</strong> <span contenteditable="true">MERTER</span></p>
    </div>
</div>

<script>
    const defaultData = [
        { desc: "100 CC PARFUME", qty: 80110, price: 0 },
        { desc: "200 CC PARFUME", qty: 1344, price: 0 },
        { desc: "50 CC PARFUME", qty: 288, price: 0 }
    ];

    const translations = {
        en: { title: "COMMERCIAL INVOICE", invNo: "Invoice No:", date: "Date:", currency: "Currency:", seller: "Seller", buyer: "Buyer", tax: "Tax No:", vat: "VAT:", tel: "Tel:", desc: "Description of Goods", qty: "Quantity", price: "Unit Price", amount: "Amount", totalQty: "Total Quantity:", totalAmount: "Total Amount:", bankTitle: "Bank Details", bankName: "Bank Name:", branch: "Branch:" },
        tr: { title: "Tƒ∞CARƒ∞ FATURA", invNo: "Fatura No:", date: "Tarih:", currency: "Para Birimi:", seller: "Satƒ±cƒ±", buyer: "Alƒ±cƒ±", tax: "Vergi No:", vat: "KDV No:", tel: "Tel:", desc: "Mal Tanƒ±mƒ±", qty: "Miktar", price: "Birim Fiyatƒ±", amount: "Tutar", totalQty: "Toplam Miktar:", totalAmount: "Toplam Tutar:", bankTitle: "Banka Bilgileri", bankName: "Banka Adƒ±:", branch: "≈ûube:" }
    };

    let currentLang = 'en';

    window.onload = () => {
        defaultData.forEach(item => addRow(item.desc, item.qty, item.price));
        calculateTotals();
    };

    function toggleLanguage() {
        currentLang = currentLang === 'en' ? 'tr' : 'en';
        const t = translations[currentLang];
        document.getElementById("lbl-title").innerText = t.title;
        document.getElementById("lbl-inv-no").innerText = t.invNo;
        document.getElementById("lbl-date").innerText = t.date;
        document.getElementById("lbl-currency").innerText = t.currency;
        document.getElementById("lbl-seller").innerText = t.seller;
        document.getElementById("lbl-buyer").innerText = t.buyer;
        document.getElementById("lbl-tax").innerText = t.tax;
        document.getElementById("lbl-vat").innerText = t.vat;
        document.getElementById("lbl-tel").innerText = t.tel;
        document.getElementById("lbl-desc").innerText = t.desc;
        document.getElementById("lbl-qty").innerText = t.qty;
        document.getElementById("lbl-price").innerText = t.price;
        document.getElementById("lbl-amount").innerText = t.amount;
        document.getElementById("lbl-total-qty").innerText = t.totalQty;
        document.getElementById("lbl-total-amount").innerText = t.totalAmount;
        document.getElementById("lbl-bank-title").innerText = t.bankTitle;
        document.getElementById("lbl-bank-name").innerText = t.bankName;
        document.getElementById("lbl-branch").innerText = t.branch;
    }

    function addRow(desc = "New Item", qty = 1, price = 0) {
        const tbody = document.getElementById("table-body");
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td contenteditable="true">${desc}</td>
            <td contenteditable="true" class="right qty-cell" oninput="calculateRow(this)">${qty}</td>
            <td contenteditable="true" class="right price-cell" oninput="calculateRow(this)">${price}</td>
            <td class="right amount-cell">0.00</td>
            <td class="no-print"><button class="delete-btn" onclick="deleteRow(this)">‚úñ</button></td>
        `;
        tbody.appendChild(tr);
        calculateRow(tr.querySelector('.qty-cell'));
    }

    function deleteRow(btn) { btn.closest("tr").remove(); calculateTotals(); }

    function calculateRow(element) {
        const tr = element.closest("tr");
        const qty = parseFloat(tr.querySelector(".qty-cell").innerText.replace(/,/g, '')) || 0;
        const price = parseFloat(tr.querySelector(".price-cell").innerText.replace(/,/g, '')) || 0;
        tr.querySelector(".amount-cell").innerText = (qty * price).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        calculateTotals();
    }

    function calculateTotals() {
        let totalQty = 0, totalAmount = 0;
        document.querySelectorAll("#table-body tr").forEach(tr => {
            totalQty += parseFloat(tr.querySelector(".qty-cell").innerText.replace(/,/g, '')) || 0;
            totalAmount += parseFloat(tr.querySelector(".amount-cell").innerText.replace(/,/g, '')) || 0;
        });
        document.getElementById("total-qty").innerText = totalQty.toLocaleString();
        document.getElementById("total-amount").innerText = totalAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    function importExcel(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
            document.getElementById("table-body").innerHTML = "";
            for (let i = 1; i < jsonData.length; i++) {
                let row = jsonData[i];
                if (row.length > 0 && row[0]) { addRow(row[0] || "", row[1] || 0, row[2] || 0); }
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function addStamp(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('stamp-img').src = e.target.result;
                document.getElementById('stamp-img').style.display = 'block';
                document.querySelector('.stamp-text').style.display = 'none';
            }
            reader.readAsDataURL(file);
        }
    }

    // ÿ™ÿµÿØŸäÿ± ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä ŸÖÿπ ÿ™ÿ±ŸÇŸäŸÖ ÿµŸÅÿ≠ÿßÿ™
    function exportPDF() {
        const element = document.getElementById('invoice');
        
        // ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™ ŸàÿßŸÑŸáŸàÿßŸÖÿ¥ (ÿ™ÿ™ÿ±ŸÉ ŸÖÿ≥ÿßÿ≠ÿ© ÿ≥ŸÅŸÑŸäÿ© ŸÑÿ™ÿ±ŸÇŸäŸÖ ÿßŸÑÿµŸÅÿ≠ÿßÿ™)
        const opt = {
            margin:       [0.5, 0.5, 0.8, 0.5], // ÿ£ÿπŸÑŸâ, Ÿäÿ≥ÿßÿ±, ÿ£ÿ≥ŸÅŸÑ, ŸäŸÖŸäŸÜ (ÿ®ÿßŸÑÿ•ŸÜÿ¥)
            filename:     'Commercial_Invoice_Enterprise.pdf',
            image:        { type: 'jpeg', quality: 1 },
            html2canvas:  { scale: 2, useCORS: true },
            jsPDF:        { unit: 'in', format: 'A4', orientation: 'portrait' },
            pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] } // ŸÑŸÖŸÜÿπ ŸÇÿ∑ÿπ ÿßŸÑÿ¨ÿØŸàŸÑ
        };
        
        document.querySelectorAll('.no-print').forEach(el => el.style.display = 'none');
        
        // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÄ PDF ÿ´ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿ±ŸÇÿßŸÖ ÿßŸÑÿµŸÅÿ≠ÿßÿ™
        html2pdf().set(opt).from(element).toPdf().get('pdf').then(function (pdf) {
            const totalPages = pdf.internal.getNumberOfPages();
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            
            for (let i = 1; i <= totalPages; i++) {
                pdf.setPage(i);
                pdf.setFontSize(10);
                pdf.setTextColor(120); // ŸÑŸàŸÜ ÿ±ŸÖÿßÿØŸä ÿßÿ≠ÿ™ÿ±ÿßŸÅŸä
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿÆÿ∑ ÿÆŸÅŸäŸÅ ÿ£ÿπŸÑŸâ ÿ±ŸÇŸÖ ÿßŸÑÿµŸÅÿ≠ÿ©
                pdf.setDrawColor(200);
                pdf.setLineWidth(0.01);
                pdf.line(0.5, pageHeight - 0.6, pageWidth - 0.5, pageHeight - 0.6);
                
                // ŸÜÿµ ÿ±ŸÇŸÖ ÿßŸÑÿµŸÅÿ≠ÿ© (ŸäŸÖŸäŸÜ ÿßŸÑÿµŸÅÿ≠ÿ©)
                const text = `Page ${i} of ${totalPages}`;
                const textWidth = pdf.getStringUnitWidth(text) * pdf.internal.getFontSize() / pdf.internal.scaleFactor;
                pdf.text(text, pageWidth - textWidth - 0.5, pageHeight - 0.4);
                
                // ÿ•ÿ∂ÿßŸÅÿ© ÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿ±ŸÉÿ© ŸÅŸä ÿßŸÑŸäÿ≥ÿßÿ± ŸÉÿπŸÑÿßŸÖÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
                pdf.text("UGUR SAHIN TEKSTIL LTD STI", 0.5, pageHeight - 0.4);
            }
        }).save().then(() => {
            document.querySelectorAll('.no-print').forEach(el => el.style.display = '');
        });
    }
</script>

</body>
</html>