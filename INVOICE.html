<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Commercial Invoice - Pro Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        body { font-family: 'Helvetica Neue', 'Helvetica', Arial, sans-serif; color: #222; background-color: #eef2f5; margin: 0; padding: 20px; }
        
        .controls { max-width: 900px; margin: 0 auto 20px auto; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        .controls button, .controls label.file-btn { background-color: #004080; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: 0.3s; font-weight: bold; }
        .controls button:hover, .controls label.file-btn:hover { background-color: #00264d; }
        .controls input[type="file"] { display: none; }
        .controls .lang-toggle { background-color: #218838; }
        .controls .lang-toggle:hover { background-color: #1e7e34; }
        .controls .add-col-btn { background-color: #fd7e14; }
        .controls .add-col-btn:hover { background-color: #e86e04; }

        .invoice-box { max-width: 900px; margin: auto; padding: 40px; background-color: #fff; box-shadow: 0 0 15px rgba(0, 0, 0, 0.1); }
        .header { display: flex; justify-content: space-between; margin-bottom: 30px; border-bottom: 3px solid #004080; padding-bottom: 20px; }
        .header h1 { margin: 0; font-size: 32px; color: #004080; letter-spacing: 1px;}
        .invoice-details p { margin: 5px 0; text-align: right; font-size: 15px;}
        .company-info { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .company-info div { width: 48%; }
        .company-info h3 { border-bottom: 2px solid #eee; padding-bottom: 5px; color: #444; text-transform: uppercase; font-size: 16px;}
        .company-info p { margin: 5px 0; font-size: 14px; color: #333;}
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        table th, table td { padding: 12px 10px; border: 1px solid #ddd; text-align: left; font-size: 14px; }
        table th { background-color: #f8f9fa; color: #333; font-weight: bold; }
        .right { text-align: right; }
        
        td[contenteditable="true"], th[contenteditable="true"], span[contenteditable="true"] { outline: none; transition: background 0.2s; }
        td[contenteditable="true"]:hover, th[contenteditable="true"]:hover, span[contenteditable="true"]:hover { background-color: #f1f8ff; border-bottom: 1px dashed #004080; }
        
        .totals-wrapper { display: flex; justify-content: space-between; margin-top: 30px; margin-bottom: 20px; page-break-inside: avoid;}
        .stamp-box { width: 40%; text-align: center; min-height: 120px; border: 2px dashed #bbb; display: flex; align-items: center; justify-content: center; position: relative;}
        .stamp-box img { max-width: 180px; max-height: 120px; display: none; }
        .totals { width: 45%; }
        .totals table { border: none; }
        .totals table td, .totals table th { border: none; border-bottom: 1px solid #eee; padding: 10px;}
        .totals table tr:last-child th, .totals table tr:last-child td { border-bottom: 3px solid #004080; font-weight: bold; font-size: 18px; color: #004080;}
        
        .bank-details { padding: 20px; background-color: #f8f9fa; border-left: 5px solid #004080; page-break-inside: avoid;}
        .bank-details p { margin: 5px 0; font-size: 14px; color: #444;}

        .delete-btn { color: #dc3545; cursor: pointer; font-weight: bold; border: none; background: none; font-size: 16px;}

        @media print {
            .controls, .delete-btn, .no-print { display: none !important; }
            body { background-color: #fff; padding: 0; }
            .invoice-box { box-shadow: none; padding: 0; border: none; max-width: 100%;}
            .stamp-box { border: none; }
            .stamp-text { display: none; }
        }

        thead { display: table-header-group; }
        tfoot { display: table-footer-group; }
        tr { page-break-inside: avoid; page-break-after: auto; }
        td { page-break-inside: avoid; page-break-after: auto; }
    </style>
</head>
<body>

<div class="controls no-print">
    <button onclick="addRow()">+ Add Row / Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯</button>
    <button class="add-col-btn" onclick="addColumn()">+ Add Column / Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯</button>
    
    <label class="file-btn">
        Import Excel / Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø°ÙƒÙŠ
        <input type="file" id="excelUpload" accept=".xlsx, .xls, .csv" onchange="importExcel(event)">
    </label>
    <label class="file-btn">
        Add Stamp / Ø¥Ø¶Ø§ÙØ© Ø®ØªÙ…
        <input type="file" id="stampUpload" accept="image/*" onchange="addStamp(event)">
    </label>
    <button class="lang-toggle" onclick="toggleLanguage()">ğŸ‡¹ğŸ‡· / ğŸ‡¬ğŸ‡§ Language</button>
    <button onclick="exportPDF()" style="background-color: #dc3545; margin-left: auto; font-size: 15px;">ğŸ“„ Export Enterprise PDF</button>
</div>

<div class="invoice-box" id="invoice">
    <div class="header">
        <div>
            <h1 id="lbl-title">COMMERCIAL INVOICE</h1>
        </div>
        <div class="invoice-details">
            <p><strong id="lbl-inv-no">Invoice No:</strong> <span contenteditable="true">UGR2026000000001</span></p>
            <p><strong id="lbl-date">Date:</strong> <span contenteditable="true">11.02.2026</span></p>
            <p><strong id="lbl-currency">Currency:</strong> <span contenteditable="true">USD ($)</span></p>
        </div>
    </div>

    <div class="company-info">
        <div>
            <h3 id="lbl-seller">Seller</h3>
            <p><strong contenteditable="true">UGUR SAHIN TEKSTIL ITHALAT IHRACAT LTD STI</strong></p>
            <p contenteditable="true">Basaksehir Mah. Toros Cad.</p>
            <p contenteditable="true">Arterium AVC No 1 /81</p>
            <p contenteditable="true">Basaksehir / Istanbul - Turkey</p>
            <p><strong id="lbl-tax">Tax No:</strong> <span contenteditable="true">8860874431</span></p>
        </div>
        <div>
            <h3 id="lbl-buyer">Buyer</h3>
            <p><strong contenteditable="true">MAD PERFUME LTD</strong></p>
            <p contenteditable="true">Almadena 80</p>
            <p contenteditable="true">Um Alfahem - Israel</p>
            <p><strong id="lbl-vat">VAT:</strong> <span contenteditable="true">515456093</span></p>
            <p><strong id="lbl-tel">Tel:</strong> <span contenteditable="true">00972525105889</span></p>
        </div>
    </div>

    <table id="invoice-table">
        <thead>
            <tr>
                <th id="lbl-desc" contenteditable="true">Description of Goods</th>
                <th contenteditable="true" class="right">Unit</th> <th class="right" id="lbl-qty" contenteditable="true">Quantity</th>
                <th class="right" id="lbl-price" contenteditable="true">Unit Price</th>
                <th class="right" id="lbl-amount" contenteditable="true">Amount</th>
                <th class="no-print">âœ–</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>

    <div class="totals-wrapper">
        <div class="stamp-box" id="stamp-container">
            <span class="stamp-text no-print" style="color:#999; font-weight:bold;">Click to Upload Stamp / Signature</span>
            <img id="stamp-img" src="" alt="Stamp">
        </div>
        <div class="totals">
            <table>
                <tr>
                    <th id="lbl-total-qty">Total Quantity:</th>
                    <td class="right"><span id="total-qty">0</span></td>
                </tr>
                <tr>
                    <th id="lbl-total-amount">Total Amount:</th>
                    <td class="right"><span id="total-amount">0.00</span></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="bank-details">
        <h4 id="lbl-bank-title" style="margin-top:0; color:#004080; font-size:16px;">Bank Details</h4>
        <p><strong id="lbl-bank-name">Bank Name:</strong> <span contenteditable="true">TÃœRKÄ°YE EMLAK KATILIM BANKASI</span></p>
        <p><strong id="lbl-branch">Branch:</strong> <span contenteditable="true">MERTER</span></p>
    </div>
</div>

<script>
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    const defaultData = [
        { desc: "100 CC PARFUME", unit: "PCS", qty: 80110, price: 0 },
        { desc: "200 CC PARFUME", unit: "PCS", qty: 1344, price: 0 },
        { desc: "50 CC PARFUME", unit: "PCS", qty: 288, price: 0 }
    ];

    window.onload = () => {
        defaultData.forEach(item => addRow(item.desc, item.unit, item.qty, item.price));
        calculateTotals();
    };

    function addRow(desc = "New Item", unit = "PCS", qty = 1, price = 0) {
        const tbody = document.getElementById("table-body");
        const tr = document.createElement("tr");
        
        // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø®Ù„Ø§ÙŠØ§ Ù…ØªØ·Ø§Ø¨Ù‚Ø©
        const colCount = document.querySelectorAll("#invoice-table thead th").length;
        
        let html = `
            <td contenteditable="true">${desc}</td>
            <td contenteditable="true" class="right">${unit}</td>
            <td contenteditable="true" class="right qty-cell" oninput="calculateRow(this)">${qty}</td>
            <td contenteditable="true" class="right price-cell" oninput="calculateRow(this)">${price}</td>
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„ÙØ§Ø±ØºØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ø£Ø¶Ø§Ù Ø£Ø¹Ù…Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
        for(let i = 5; i < colCount; i++){
            html += `<td contenteditable="true" class="right">-</td>`;
        }

        html += `
            <td class="right amount-cell">0.00</td>
            <td class="no-print"><button class="delete-btn" onclick="deleteRow(this)">âœ–</button></td>
        `;
        
        tr.innerHTML = html;
        tbody.appendChild(tr);
        calculateRow(tr.querySelector('.qty-cell'));
    }

    // Ù…ÙŠØ²Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„ Ø§Ù„ÙˆØ²Ù† Ø£Ùˆ ØºÙŠØ±Ù‡)
    function addColumn() {
        const colName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ø§Ù„: Net Weight, HS Code):", "New Column");
        if (!colName) return;

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© (Ù‚Ø¨Ù„ Ø¹Ù…ÙˆØ¯ Amount)
        const theadTr = document.querySelector("#invoice-table thead tr");
        const newTh = document.createElement("th");
        newTh.innerText = colName;
        newTh.contentEditable = "true";
        newTh.className = "right";
        // Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬ Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø§Ù„Ø£Ø®ÙŠØ±ÙŠÙ† (Amount Ùˆ Ø²Ø± Ø§Ù„Ø­Ø°Ù)
        theadTr.insertBefore(newTh, theadTr.children[theadTr.children.length - 2]);

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ù„ÙŠØ© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
        const rows = document.querySelectorAll("#table-body tr");
        rows.forEach(tr => {
            const newTd = document.createElement("td");
            newTd.contentEditable = "true";
            newTd.className = "right";
            newTd.innerText = "-";
            tr.insertBefore(newTd, tr.children[tr.children.length - 2]);
        });
    }

    function deleteRow(btn) { btn.closest("tr").remove(); calculateTotals(); }

    function calculateRow(element) {
        const tr = element.closest("tr");
        const qty = parseFloat(tr.querySelector(".qty-cell").innerText.replace(/,/g, '')) || 0;
        const price = parseFloat(tr.querySelector(".price-cell").innerText.replace(/,/g, '')) || 0;
        tr.querySelector(".amount-cell").innerText = (qty * price).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        calculateTotals();
    }

    function calculateTotals() {
        let totalQty = 0, totalAmount = 0;
        document.querySelectorAll("#table-body tr").forEach(tr => {
            totalQty += parseFloat(tr.querySelector(".qty-cell").innerText.replace(/,/g, '')) || 0;
            totalAmount += parseFloat(tr.querySelector(".amount-cell").innerText.replace(/,/g, '')) || 0;
        });
        document.getElementById("total-qty").innerText = totalQty.toLocaleString();
        document.getElementById("total-amount").innerText = totalAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø°ÙƒÙŠ ÙŠÙ‚Ø±Ø£ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ù„ØªØ¬Ù†Ø¨ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ÙØ§Ø±ØºØ©
    function importExcel(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            let colMap = { desc: -1, qty: -1, price: -1 };
            let headerRowIndex = -1;

            for (let i = 0; i < Math.min(20, jsonData.length); i++) {
                let row = jsonData[i];
                if (!row) continue;
                for (let j = 0; j < row.length; j++) {
                    let cellVal = String(row[j] || "").toUpperCase().trim();
                    if (cellVal.includes("DESCRIPTION")) colMap.desc = j;
                    if (cellVal.includes("QUANTITY") || cellVal === "QTY") colMap.qty = j;
                    if (cellVal.includes("UNIT PRICE") || cellVal.includes("PRICE")) colMap.price = j;
                }
                if (colMap.desc !== -1 && colMap.qty !== -1) {
                    headerRowIndex = i;
                    break;
                }
            }

            document.getElementById("table-body").innerHTML = "";
            let startRow = headerRowIndex !== -1 ? headerRowIndex + 1 : 1;

            for (let i = startRow; i < jsonData.length; i++) {
                let row = jsonData[i];
                if (!row || row.length === 0) continue;
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†ØŒ ÙŠÙØªØ±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© 0 Ùˆ 1
                let desc = colMap.desc !== -1 ? (row[colMap.desc] || "") : (row[0] || "");
                let qty = colMap.qty !== -1 ? (row[colMap.qty] || 0) : (row[1] || 0);
                let price = colMap.price !== -1 ? (row[colMap.price] || 0) : 0;
                
                if (desc.toString().trim() !== "" && desc.toString().toUpperCase() !== "DESCRIPTION") {
                    addRow(desc, "PCS", qty, price);
                }
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function addStamp(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('stamp-img').src = e.target.result;
                document.getElementById('stamp-img').style.display = 'block';
                document.querySelector('.stamp-text').style.display = 'none';
            }
            reader.readAsDataURL(file);
        }
    }

    function exportPDF() {
        const element = document.getElementById('invoice');
        const opt = {
            margin:       [0.5, 0.5, 0.8, 0.5],
            filename:     'Commercial_Invoice_Enterprise.pdf',
            image:        { type: 'jpeg', quality: 1 },
            html2canvas:  { scale: 2, useCORS: true },
            jsPDF:        { unit: 'in', format: 'A4', orientation: 'portrait' },
            pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
        };
        
        document.querySelectorAll('.no-print').forEach(el => el.style.display = 'none');
        
        html2pdf().set(opt).from(element).toPdf().get('pdf').then(function (pdf) {
            const totalPages = pdf.internal.getNumberOfPages();
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            
            for (let i = 1; i <= totalPages; i++) {
                pdf.setPage(i);
                pdf.setFontSize(10);
                pdf.setTextColor(120);
                pdf.setDrawColor(200);
                pdf.setLineWidth(0.01);
                pdf.line(0.5, pageHeight - 0.6, pageWidth - 0.5, pageHeight - 0.6);
                
                const text = `Page ${i} of ${totalPages}`;
                const textWidth = pdf.getStringUnitWidth(text) * pdf.internal.getFontSize() / pdf.internal.scaleFactor;
                pdf.text(text, pageWidth - textWidth - 0.5, pageHeight - 0.4);
                pdf.text("UGUR SAHIN TEKSTIL LTD STI", 0.5, pageHeight - 0.4);
            }
        }).save().then(() => {
            document.querySelectorAll('.no-print').forEach(el => el.style.display = '');
        });
    }

    const translations = {
        en: { title: "COMMERCIAL INVOICE", invNo: "Invoice No:", date: "Date:", currency: "Currency:", seller: "Seller", buyer: "Buyer", tax: "Tax No:", vat: "VAT:", tel: "Tel:", desc: "Description of Goods", qty: "Quantity", price: "Unit Price", amount: "Amount", totalQty: "Total Quantity:", totalAmount: "Total Amount:", bankTitle: "Bank Details", bankName: "Bank Name:", branch: "Branch:" },
        tr: { title: "TÄ°CARÄ° FATURA", invNo: "Fatura No:", date: "Tarih:", currency: "Para Birimi:", seller: "SatÄ±cÄ±", buyer: "AlÄ±cÄ±", tax: "Vergi No:", vat: "KDV No:", tel: "Tel:", desc: "Mal TanÄ±mÄ±", qty: "Miktar", price: "Birim FiyatÄ±", amount: "Tutar", totalQty: "Toplam Miktar:", totalAmount: "Toplam Tutar:", bankTitle: "Banka Bilgileri", bankName: "Banka AdÄ±:", branch: "Åube:" }
    };

    let currentLang = 'en';
    function toggleLanguage() {
        currentLang = currentLang === 'en' ? 'tr' : 'en';
        const t = translations[currentLang];
        document.getElementById("lbl-title").innerText = t.title;
        document.getElementById("lbl-inv-no").innerText = t.invNo;
        document.getElementById("lbl-date").innerText = t.date;
        document.getElementById("lbl-currency").innerText = t.currency;
        document.getElementById("lbl-seller").innerText = t.seller;
        document.getElementById("lbl-buyer").innerText = t.buyer;
        document.getElementById("lbl-tax").innerText = t.tax;
        document.getElementById("lbl-vat").innerText = t.vat;
        document.getElementById("lbl-tel").innerText = t.tel;
        document.getElementById("lbl-desc").innerText = t.desc;
        document.getElementById("lbl-qty").innerText = t.qty;
        document.getElementById("lbl-price").innerText = t.price;
        document.getElementById("lbl-amount").innerText = t.amount;
        document.getElementById("lbl-total-qty").innerText = t.totalQty;
        document.getElementById("lbl-total-amount").innerText = t.totalAmount;
        document.getElementById("lbl-bank-title").innerText = t.bankTitle;
        document.getElementById("lbl-bank-name").innerText = t.bankName;
        document.getElementById("lbl-branch").innerText = t.branch;
    }
</script>

</body>
</html>
