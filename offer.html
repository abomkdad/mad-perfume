<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAD PARFUMEUR – Offer</title>

<meta name="robots" content="index, follow">
<meta name="theme-color" content="#0a0a0a">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&family=Heebo:wght@400;600;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1072283127290819');
fbq('track', 'PageView');
</script>

<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];
  ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","publish","save","grant","revoke"];
  ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};
  for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);
  ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
  ttq.load('D2D02JBC77U4ENLN9SBG');
  ttq.page();
}(window, document, 'ttq');
</script>

<style>
:root {
  --bg: #0a0a0a;
  --card: #141414;
  --gold: #d4af37;
  --text: #ffffff;
  --muted: #aaaaaa;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: 'Cairo', 'Heebo', sans-serif;
  overflow-x: hidden;
  padding-bottom: 80px;
}

/* Header */
header {
  background: url("https://madparfumeurglobal.com/wp-content/uploads/2025/10/1920x600-BERGAY.jpg") center/cover no-repeat;
  padding: 40px 15px 30px;
  text-align: center;
  position: relative;
  border-bottom: 4px solid var(--gold);
}
header::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, rgba(0,0,0,0.7), var(--bg));
}
header * { position: relative; z-index: 2; }

.logo { width: 100px; margin: auto; }
.logo img { width: 100%; display: block; }

.brand {
  color: var(--gold);
  font-weight: 800;
  letter-spacing: 2px;
  margin-top: 15px;
  font-size: 1.2rem;
  text-transform: uppercase;
}

.branch-name {
  font-size: 26px;
  font-weight: 800;
  color: #fff;
  margin-top: 10px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.branch-hours {
  display: inline-flex;
  flex-direction: column;
  gap: 4px;
  margin-top: 10px;
  font-size: 14px;
  color: #ddd;
  background: rgba(0,0,0,0.4);
  padding: 8px;
  border-radius: 8px;
}

.socials {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 20px;
}
.socials a {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--gold);
  color: var(--gold);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  text-decoration: none;
  transition: 0.3s;
}
.socials a:hover {
  background: var(--gold);
  color: #000;
  transform: translateY(-3px);
}

/* Categories */
.categories {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding: 20px 15px;
  scrollbar-width: none;
}
.categories::-webkit-scrollbar { display: none; }

.categories button {
  background: transparent;
  color: var(--muted);
  border: 1px solid #333;
  border-radius: 30px;
  padding: 8px 18px;
  white-space: nowrap;
  cursor: pointer;
  font-family: inherit;
  font-size: 14px;
  font-weight: 600;
  transition: 0.3s;
}
.categories button.active, .categories button:hover {
  background: var(--gold);
  color: #000;
  border-color: var(--gold);
}

/* Products */
.products {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(165px, 1fr));
  gap: 15px;
  padding: 0 15px;
}

.card {
  background: var(--card);
  border: 1px solid #222;
  border-radius: 16px;
  padding: 12px;
  text-align: center;
  transition: 0.3s;
  position: relative;
}
.card:hover { transform: translateY(-5px); border-color: #333; }

.card img {
  width: 100%;
  aspect-ratio: 1/1;
  object-fit: cover;
  border-radius: 12px;
  background: #fff;
}

.code { margin-top: 10px; font-weight: 800; font-size: 16px; color: #fff; }
.price { color: var(--gold); margin: 5px 0; font-size: 15px; font-weight: 600; }

.btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  background: #25D366;
  color: #fff;
  text-decoration: none;
  border-radius: 8px;
  padding: 10px;
  margin-top: 10px;
  font-weight: 700;
  font-size: 14px;
}
.btn:hover { background: #20bd5a; }

/* Sticky WA */
.whatsapp-float {
  position: fixed;
  bottom: 25px; right: 25px;
  width: 60px; height: 60px;
  background: #25D366;
  border-radius: 50%;
  display: flex;
  align-items: center; justify-content: center;
  font-size: 30px; color: #fff;
  z-index: 99;
  box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
  text-decoration: none;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7); }
  70% { box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
  100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
}

.loading { text-align: center; padding: 40px; color: var(--muted); }
</style>
</head>

<body>

<header>
  <div class="logo">
    <img src="https://abomkdad.github.io/Digital-Business-Card/logo.png" alt="MAD">
  </div>
  <div class="brand">MAD PARFUMEUR</div>
  
  <div id="branchInfo" style="display:none;">
    <div class="branch-name" id="branchName"></div>
    <div class="branch-hours" id="branchHours"></div>
    <div class="socials">
      <a id="mapLink" target="_blank"><i class="fa-solid fa-location-dot"></i></a>
      <a id="tiktokLink" target="_blank"><i class="fa-brands fa-tiktok"></i></a>
      <a id="instaLink" target="_blank"><i class="fa-brands fa-instagram"></i></a>
      <a id="fbLink" target="_blank"><i class="fa-brands fa-facebook-f"></i></a>
      <a id="waHeaderLink" target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
    </div>
  </div>

  <div id="defaultInfo" style="display:none;">
    <div class="branch-name">Global Collection</div>
  </div>
</header>

<div class="categories" id="categories"></div>

<div class="products" id="products">
    <div class="loading"><i class="fa-solid fa-circle-notch fa-spin"></i> Loading...</div>
</div>

<a class="whatsapp-float" id="waFloat" target="_blank">
  <i class="fa-brands fa-whatsapp"></i>
</a>

<script>
// تحديد اللغة والاتجاه
const lang = navigator.language.startsWith("he") ? "he" : "ar";
document.documentElement.lang = lang;
document.documentElement.dir = "rtl";

let currentBranch = null;
let allProducts = [];
const params = new URLSearchParams(window.location.search);
const branchID = params.get("branch");

function init() {
  // 1. قراءة ملف الفروع (تأكد من أن الاسم يطابق الموجود في GitHub تماماً)
  Papa.parse("branches.csv", {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const branches = results.data;
      if (branchID) {
        currentBranch = branches.find(b => b.ID === branchID);
      }
      renderHeader();
      
      // 2. بعد تحميل الفروع، نقرأ ملف المنتجات
      Papa.parse("products.csv", {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          allProducts = results.data.filter(p => p["Title"]); // نتأكد من وجود الاسم
          extractCategories();
          renderProducts("ALL");
        },
        error: function(err) {
           document.getElementById("products").innerHTML = "<div style='text-align:center'>Error loading products.csv</div>";
           console.error("Error:", err);
        }
      });
    }
  });
}

function renderHeader() {
  const infoDiv = document.getElementById("branchInfo");
  const defaultDiv = document.getElementById("defaultInfo");
  const waFloat = document.getElementById("waFloat");

  if (currentBranch) {
    infoDiv.style.display = "block";
    defaultDiv.style.display = "none";
    
    document.getElementById("branchName").textContent = lang === "he" ? currentBranch["اسم الفرع عبري"] : currentBranch["اسم الفرع عربي"];
    document.getElementById("branchHours").innerHTML = lang === "he" ? currentBranch["ساعات الدوام عبري"] : currentBranch["ساعات الدوام عربي"];
    
    document.getElementById("mapLink").href = currentBranch["رابط Waze / Maps"];
    document.getElementById("instaLink").href = currentBranch["Instagram"];
    document.getElementById("tiktokLink").href = currentBranch["TikTok"];
    document.getElementById("fbLink").href = currentBranch["Facebook"];
    
    const waLink = currentBranch["WhatsApp"];
    document.getElementById("waHeaderLink").href = waLink;
    waFloat.href = waLink;
  } else {
    infoDiv.style.display = "none";
    defaultDiv.style.display = "block";
    waFloat.href = "https://wa.me/972549634449"; // رقم افتراضي
  }
}

function extractCategories() {
  const categoriesDiv = document.getElementById("categories");
  categoriesDiv.innerHTML = "";
  
  // اسم العمود في ملف CSV كما يظهر في الصورة
  const catKey = "Category (g:product_type)";
  
  const uniqueCats = [...new Set(allProducts.map(p => p[catKey]).filter(Boolean))];
  
  const allBtn = document.createElement("button");
  allBtn.textContent = lang === "he" ? "הכל" : "الكل";
  allBtn.classList.add("active");
  allBtn.onclick = () => { setActiveCat(allBtn); renderProducts("ALL"); };
  categoriesDiv.appendChild(allBtn);

  uniqueCats.forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = () => { setActiveCat(btn); renderProducts(cat); };
    categoriesDiv.appendChild(btn);
  });
}

function setActiveCat(clickedBtn) {
  document.querySelectorAll(".categories button").forEach(b => b.classList.remove("active"));
  clickedBtn.classList.add("active");
}

function renderProducts(filterCat) {
  const grid = document.getElementById("products");
  grid.innerHTML = "";
  
  const catKey = "Category (g:product_type)";
  
  const filtered = filterCat === "ALL" 
    ? allProducts 
    : allProducts.filter(p => p[catKey] === filterCat);

  if (filtered.length === 0) {
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:20px;">No products found / لا توجد منتجات</div>`;
    return;
  }

  filtered.forEach(p => {
    const baseWa = currentBranch ? currentBranch["WhatsApp"] : "https://wa.me/972549634449";
    const msg = lang === "he" 
      ? `היי, אני מעוניין במוצר: ${p["Title"]}` 
      : `مرحبا، أنا مهتم بالمنتج: ${p["Title"]}`;
    const finalLink = `${baseWa}?text=${encodeURIComponent(msg)}`;
    
    const btnText = lang === "he" ? "בדיקת זמינות" : "افحص التوفر";
    // تنظيف السعر من كلمة ILS إذا وجدت
    const price = p["Price"] ? p["Price"].replace("ILS", "₪").replace("New", "") : "";

    const card = document.createElement("div");
    card.className = "card";
    // استخدام الصورة الأولى فقط إذا كان هناك رابط
    const imgSrc = p["Image"] || 'https://via.placeholder.com/300?text=No+Image';

    card.innerHTML = `
      <img src="${imgSrc}" loading="lazy" alt="${p["Title"]}">
      <div class="code">${p["Title"]}</div>
      <div class="price">${price}</div>
      <a class="btn" href="${finalLink}" target="_blank">
        <i class="fa-brands fa-whatsapp"></i> ${btnText}
      </a>
    `;
    grid.appendChild(card);
  });
}

// بدء التشغيل
init();
</script>

</body>
</html>
